
	define("lib/cos-wx-sdk-v4.js", function(require, module, exports){ 			
"use strict";function t(t){this.appid=t.appid,this.bucket=t.bucket,this.region=t.region,this.sign_url=t.sign_url,this.progressInterval=t.progressInterval||1e3,t.getAppSign&&(this.getAppSign=t.getAppSign),t.getAppSignOnce&&(this.getAppSignOnce=t.getAppSignOnce)}function e(t,e){if(!t)return"";var o=this;return t=t.replace(/(^\/*)|(\/*$)/g,""),t="folder"==e?encodeURIComponent(t+"/").replace(/%2F/g,"/"):encodeURIComponent(t).replace(/%2F/g,"/"),o&&(o.path="/"+o.appid+"/"+o.bucket+"/"+t),t}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.prototype.cosapi_cgi_url="https://REGION.file.myqcloud.com/files/v2/",t.prototype.sliceSize=3145728,t.prototype.getExpired=function(t){return parseInt(Date.now()/1e3)+(t||60)},t.prototype.set=function(t){t&&(this.appid=t.appid,this.bucket=t.bucket,this.region=t.region,this.sign_url=t.sign_url,t.getAppSign&&(this.getAppSign=t.getAppSign),t.getAppSignOnce&&(this.getAppSignOnce=t.getAppSignOnce))},t.prototype.getCgiUrl=function(t){var e=this.region,o=this.bucket,i=this.cosapi_cgi_url;return(i=i.replace("REGION",e))+this.appid+"/"+o+"/"+t},t.prototype.updateFolder=function(t,o,i,r,n){r=e.call(this,r,"folder"),this.updateBase(t,o,i,r,n)},t.prototype.updateFile=function(t,o,i,r,n){r=e.call(this,r),this.updateBase(t,o,i,r,n)},t.prototype.updateBase=function(t,e,o,i,r,n,s){var p=this;p.getAppSignOnce(function(o){var a=p.getCgiUrl(i),u={op:"update"};r&&(u.biz_attr=r),n&&(u.authority=n),s&&(s=JSON.stringify(s),u.customHeaders=s),wx.request({method:"POST",url:a,header:{Authorization:o},data:u,success:t,fail:e})})},t.prototype.deleteFolder=function(t,o,i,r){r=e.call(this,r,"folder"),this.deleteBase(t,o,i,r)},t.prototype.deleteFile=function(t,o,i,r){r=e.call(this,r),this.deleteBase(t,o,i,r)},t.prototype.deleteBase=function(t,e,o,i){if("/"!=i){var r=this;this.getAppSignOnce(function(o){var n=r.getCgiUrl(i),s={op:"delete"};wx.request({method:"POST",url:n,header:{Authorization:o},data:s,success:t,fail:e})})}else e({code:10003,message:"不能删除Bucket"})},t.prototype.getFolderStat=function(t,o,i,r){r=e(r,"folder"),this.statBase(t,o,i,r)},t.prototype.getFileStat=function(t,o,i,r){r=e(r),this.statBase(t,o,i,r)},t.prototype.statBase=function(t,e,o,i){var r=this;this.getAppSign.call(r,function(o){var n=r.getCgiUrl(i),s={op:"stat"};wx.request({url:n,method:"GET",header:{Authorization:o},data:s,success:t,fail:e})})},t.prototype.createFolder=function(t,o,i,r,n){var s=this;this.getAppSign(function(i){r=e(r,"folder");var p=s.getCgiUrl(r),a={op:"create",biz_attr:n||""};wx.request({method:"POST",url:p,header:{Authorization:i},data:a,success:t,fail:o})})},t.prototype.copyFile=function(t,o,i,r,n,s){var p=this;this.getAppSign(function(i){r=e(r);var a=p.getCgiUrl(r),u={op:"copy",dest_fileid:n,to_over_write:s};wx.request({method:"POST",url:a,header:{Authorization:i},data:u,success:t,fail:o})})},t.prototype.moveFile=function(t,o,i,r,n,s){var p=this;this.getAppSign(function(i){r=e(r);var a=p.getCgiUrl(r),u={op:"move",dest_fileid:n,to_over_write:s};wx.request({method:"POST",url:a,header:{Authorization:i},data:u,success:t,fail:o})})},t.prototype.getFolderList=function(t,o,i,r,n,s,p,a,u){var l=this;r=e(r,"folder"),l.listBase(t,o,i,r,n,s,p,a)},t.prototype.listBase=function(t,e,o,i,r,n,s,p,a){var u=this;u.getAppSign(function(o){var a=u.getCgiUrl(i),l={op:"list",num:r=r||20,context:n=n||"",order:s=s||0,pattern:p=p||"eListBoth"};wx.request({url:a,method:"GET",header:{Authorization:o},data:l,success:t,fail:e})})},t.prototype.uploadFile=function(t,i,r,n,s,p){var a,u={},l={};"object"===(void 0===t?"undefined":o(t))&&(l=(u=t).bizAttr,t=u.success,i=u.error,u.bucket,n=u.path,s=u.filepath,p=u.insertOnly,u.onProgress&&"function"==typeof u.onProgress&&(a=function(){var t,e=Date.now(),o=0,i=0,r=0,n=function(){t=0;var n=Date.now(),s=parseInt((i-o)/((n-e)/1e3)*100)/100||0,p=parseInt(i/r*100)/100||0;e=n,o=i;try{u.onProgress({loaded:i,total:r,speed:s,percent:p})}catch(t){}};return function(e,o){if(e&&(i=e.totalBytesSent,r=e.totalBytesExpectedToSend),o)t&&(clearTimeout(t),n());else{if(t)return;t=setTimeout(n,c.progressInterval||1e3)}}}()));var c=this;n=e(n),c.getAppSign(function(e){var o=c.getCgiUrl(n),r={op:"upload"};p>=0&&(r.insertOnly=p),l&&(r.biz_attr=l),console.log("上传地址："+o);var u=wx.uploadFile({url:o,filePath:s,name:"fileContent",header:{Authorization:e},formData:r,success:function(e){e.data=JSON.parse(e.data),a(null,!0),t.call(this,e)},fail:i});a&&u&&u.onProgressUpdate&&u.onProgressUpdate(a)})},module.exports=t; 
 			});
 		define("lib/mv4.js", function(require, module, exports){ 			
(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?t(exports):typeof define==="function"&&define.amd?define(["exports"],t):t(e.GAME=e.GAME||{})})(this,function(e){"use strict";var t=/\/?[^/]+\.(\w{1,5})$/i;var i=/^(?:\w+:)?\/{2}/i;var r=/^[./]*?\//i;var n=/[^/\\\\]+$/;var a=function e(t){if(t._instance===undefined)t._instance=null;t.getInstance=function(){return t._instance===null?t._instance=new t:t._instance};return t};var s=function e(a){var s={absolute:false,relative:false};if(a==null){return s}var o=a.indexOf("?");if(o>-1){a=a.substr(0,o)}var h;if(i.test(a)){s.absolute=true}else if(r.test(a)){s.relative=true}if(h=a.match(t)){s.extension=h[1].toLowerCase()}if(h=a.match(n)){s.name=h[0].split(".")[0]}return s};var o=function e(t,i,r){i=i===undefined?0:i;r=r===undefined?t.byteLength:r;var n=new Uint8Array(t,i,r);var a=String.fromCharCode.apply(null,n);return a};var h=function e(t){var i=new Promise(function(e,i){if(t.indexOf(wx.env.USER_DATA_PATH)==-1){t=wx.env.USER_DATA_PATH+"/"+t}e(t)});return i};var l=function e(t){if(t.indexOf(wx.env.USER_DATA_PATH)==-1){t=wx.env.USER_DATA_PATH+"/"+t}return t};var c=function e(t){var i=new Promise(function(e,i){h(t).then(function(t){var i=void 0;wx.getFileSystemManager().access({path:t,success:function e(r){i={isExist:true,path:t}},fail:function e(r){i={isExist:false,path:t}},complete:function t(){e(i)}})})});return i};var u=function e(t){var i=new Promise(function(e,i){var r=t;h(r).then(c).then(function(t){var r=void 0;if(!t.isExist){wx.getFileSystemManager().mkdir({dirPath:t.path,success:function e(i){r=t.path},fail:function e(i){if(i.errMsg.indexOf("already")!=-1){r=t.path}else{r="createDir error"}},complete:function n(){if(r!==undefined)e(r);else i("writeFile"+t.path)}})}else{e(t.path)}})});return i};var f=function e(t,i){var r=new Promise(function(e,r){h(t).then(c).then(function(n){if(!n.isExist){var a=void 0;wx.getFileSystemManager().writeFile({filePath:n.path,data:i,success:function e(){a=t},fail:function e(i){if(i.errMsg.indexOf("already")!=-1){a=t}else{r("writeFile"+n.path)}},complete:function t(){if(a!==undefined)e(a);else r("writeFile"+n.path)}})}else{}})});return r};var d=function e(t){t=l(t);var i=new Promise(function(e,i){var r=void 0;c(t).then(function(n){if(!n.isExist){e([]);return}wx.getFileSystemManager().readdir({dirPath:t,success:function e(t){var i=t.files;r=i},fail:function e(t){},complete:function n(){if(r!==undefined)e(r);else i("readdir:"+t)}})})});return i};var p=function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var r=new Promise(function(e,r){h(t).then(function(t){var n=void 0;wx.getFileSystemManager().readFile({filePath:t,encoding:i,success:function e(t){var i=t.data;n=i},fail:function e(t){r(t.errMsg)},complete:function i(){if(n!==undefined)e(n);else r("readFile"+t)}})}).catch(r)});return r};var v=function e(t,i){var r=new Promise(function(e,r){t=l(t);i=l(i);var n=false;wx.getFileSystemManager().unzip({zipFilePath:t,targetPath:i,success:function e(t){n=true},fail:function e(t){n=false;r(t)},complete:function t(){n?e():r()}})});return r};var m=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var g=function(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}};var y=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();var _=function(e,t,i){if(t in e){Object.defineProperty(e,t,{value:i,enumerable:true,configurable:true,writable:true})}else{e[t]=i}return e};var x=function e(t,i,r){if(t===null)t=Function.prototype;var n=Object.getOwnPropertyDescriptor(t,i);if(n===undefined){var a=Object.getPrototypeOf(t);if(a===null){return undefined}else{return e(a,i,r)}}else if("value"in n){return n.value}else{var s=n.get;if(s===undefined){return undefined}return s.call(r)}};var w=function(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t};var b=function(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e};var M=function e(t,i,r,n){var a=Object.getOwnPropertyDescriptor(t,i);if(a===undefined){var s=Object.getPrototypeOf(t);if(s!==null){e(s,i,r,n)}}else if("value"in a&&a.writable){a.value=r}else{var o=a.set;if(o!==undefined){o.call(n,r)}}return r};var T=function(){function e(t,i){g(this,e);this._notifyMethod=t;this._notifyContext=i}y(e,[{key:"notifyObserver",value:function e(t){this._notifyMethod.apply(this._notifyContext,[t])}},{key:"compareNotifyContext",value:function e(t){return t===this._notifyContext}},{key:"notifyMethod",set:function e(t){this._notifyMethod=t},get:function e(){return this._notifyMethod}},{key:"notifyContext",set:function e(t){this._notifyContext=t},get:function e(){return this._notifyContext}}]);return e}();var E=function(){function e(){g(this,e);if(e._instance){throw new Error("Instance!!")}this.mediatorMap={};this.observerMap={}}y(e,[{key:"initializeView",value:function e(){}},{key:"notifyObservers",value:function e(t){if(this.observerMap[t.name]){var i=this.observerMap[t.name];var r;for(var n=0;n<i.length;n++){r=i[n];r.notifyObserver(t)}}}},{key:"registerObserver",value:function e(t,i){var r=this.observerMap[t];if(r){r.push(i)}else{this.observerMap[t]=[i]}}},{key:"removeObserver",value:function e(t,i){var r=this.observerMap[t];for(var n=0;n<r.length;n++){if(r[n].compareNotifyContext(i)){r.splice(n,1);break}}if(r.length==0)delete this.observerMap[t]}},{key:"registerMediator",value:function e(t){if(this.mediatorMap[t.name])return;this.mediatorMap[t.name]=t;var i=t.listNotificationInterests();if(i.length){var r=new T(t.handleNotification,t);for(var n=0;n<i.length;n++){this.registerObserver(i[n],r)}}t.onRegister()}},{key:"retrieveMediator",value:function e(t){return this.mediatorMap[t]}},{key:"removeMediator",value:function e(t){var i=this.mediatorMap[t];if(i){var r=i.listNotificationInterests();for(var n=0;n<r.length;n++){this.removeObserver(r[n],i)}delete this.mediatorMap[t];i.onRemove()}return i}},{key:"hasMediator",value:function e(t){return this.mediatorMap[t]}}]);return e}();E._instance=null;a(E);var S=function(){function e(){g(this,e);if(E._instance){throw new Error("Instance!!")}this.commandMap={};this.initializeController()}y(e,[{key:"initializeController",value:function e(){this.view=E.getInstance()}},{key:"execute",value:function e(t){var i=this.commandMap[t.name];if(i===undefined)return;if(typeof i=="function"){var r=new i}else{var r=i}r.execute(t)}},{key:"register",value:function e(t,i){if(this.commandMap[t]===undefined){this.view.registerObserver(t,new T(this.execute,this))}this.commandMap[t]=i}},{key:"hasCommand",value:function e(t){return this.commandMap[t]!=null}},{key:"remove",value:function e(t){if(this.hasCommand(t)){this.view.removeObserver(t,this);delete this.commandMap[t]}}}]);return e}();S._instance=null;a(S);var A=function(){function e(){g(this,e);if(e._instance){throw new Error("Singleton")}this.proxyMap={};this.initializeModel()}y(e,[{key:"initializeModel",value:function e(){}},{key:"register",value:function e(t){if(this.proxyMap[t.name])this.proxyMap[t.name].onRemove();this.proxyMap[t.name]=t;t.onRegister();return t}},{key:"retrieve",value:function e(t){return this.proxyMap[t]}},{key:"hasProxy",value:function e(t){return this.proxyMap[t]!=null}},{key:"remove",value:function e(t){var i=this.proxyMap[t];if(i){delete this.proxyMap[t];i.onRemove()}return i}}]);return e}();A._instance=null;a(A);var L=function e(t,i,r){g(this,e);this.name=t;this.body=i;this.type=r};var C=function(){function e(){g(this,e);this.initializeFacade()}y(e,[{key:"initializeFacade",value:function e(){this.initializeModel();this.initializeController();this.initializeView()}},{key:"initializeModel",value:function e(){if(this.model)return;this.model=A.getInstance()}},{key:"initializeController",value:function e(){if(this.controller)return;this.controller=S.getInstance()}},{key:"initializeView",value:function e(){if(this.view)return;this.view=E.getInstance()}},{key:"registerCommand",value:function e(t,i){return this.controller.register(t,i)}},{key:"removeCommand",value:function e(t){this.controller.remove(t)}},{key:"hasCommand",value:function e(t){return this.controller.hasCommand(t)}},{key:"registerProxy",value:function e(t){return this.model.register(t)}},{key:"retrieveProxy",value:function e(t){return this.model.retrieve(t)}},{key:"removeProxy",value:function e(t){return this.model.remove(t)}},{key:"hasProxy",value:function e(t){return this.model.hasProxy(t)}},{key:"registerMediator",value:function e(t){return this.view.registerMediator(t)}},{key:"retrieveMediator",value:function e(t){return this.view.retrieveMediator(t)}},{key:"removeMediator",value:function e(t){if((typeof t==="undefined"?"undefined":m(t))=="object"&&t.name){t=t.name}return this.view.removeMediator(t)}},{key:"hasMediator",value:function e(t){return this.view.hasMediator(t)}},{key:"sendNotification",value:function e(t,i,r){this.notifyObservers(new L(t,i,r))}},{key:"notifyObservers",value:function e(t){this.view.notifyObservers(t)}}],[{key:"getInstance",value:function t(){return e._instance===undefined?e._instance=new e:e._instance}}]);return e}();var R=function(){function e(t){g(this,e);this.name=t;this.facade=C.getInstance()}y(e,[{key:"onRegister",value:function e(){}},{key:"onRemove",value:function e(){}},{key:"sendNotification",value:function e(t,i,r){this.facade.sendNotification(t,i,r)}}]);return e}();var I=function(e){w(t,e);function t(e){g(this,t);return b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}y(t,[{key:"onRegister",value:function e(){}},{key:"onRemove",value:function e(){}},{key:"resizeCanvas",value:function e(){this.canvas.width=window.innerWidth;this.canvas.height=window.innerHeight}},{key:"canvas",set:function e(i){this._canvas=i;this.sendNotification(t.SET_CANVAS,this.canvas)},get:function e(){return this._canvas}}]);return t}(R);I.SET_CANVAS="game_set_canvas";var P=function(e){w(t,e);function t(e){g(this,t);return b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}y(t,[{key:"onRegister",value:function e(){var t=this;this.onResize=this.onResize.bind(this);this.onFocus=this.onFocus.bind(this);this.onBlur=this.onBlur.bind(this);this._tin=-1;this.onResize()}},{key:"onFocus",value:function e(){this.facade.sendNotification(t.STAGE_FOCUS,true)}},{key:"onBlur",value:function e(){this.facade.sendNotification(t.STAGE_FOCUS,false)}},{key:"onResize",value:function e(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},r=i.width,n=i.height;r=r||window.innerWidth;n=n||window.innerHeight;this.facade.sendNotification(t.STAGE_RESIZE,{width:r,height:n})}},{key:"onRemove",value:function e(){window.removeEventListener("resize",this._resizeEvent)}}]);return t}(R);P.STAGE_FOCUS="stage_focus";P.STAGE_RESIZE="stage_resize";if(Number.EPSILON===undefined){Number.EPSILON=Math.pow(2,-52)}if(Number.isInteger===undefined){Number.isInteger=function(e){return typeof e==="number"&&isFinite(e)&&Math.floor(e)===e}}if(Math.sign===undefined){Math.sign=function(e){return e<0?-1:e>0?1:+e}}if("name"in Function.prototype===false){Object.defineProperty(Function.prototype,"name",{get:function e(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}})}if(Object.assign===undefined){(function(){Object.assign=function(e){"use strict";if(e===undefined||e===null){throw new TypeError("Cannot convert undefined or null to object")}var t=Object(e);for(var i=1;i<arguments.length;i++){var r=arguments[i];if(r!==undefined&&r!==null){for(var n in r){if(Object.prototype.hasOwnProperty.call(r,n)){t[n]=r[n]}}}}return t}})()}function O(){}Object.assign(O.prototype,{addEventListener:function e(t,i){if(this._listeners===undefined)this._listeners={};var r=this._listeners;if(r[t]===undefined){r[t]=[]}if(r[t].indexOf(i)===-1){r[t].push(i)}},hasEventListener:function e(t,i){if(this._listeners===undefined)return false;var r=this._listeners;return r[t]!==undefined&&r[t].indexOf(i)!==-1},removeEventListener:function e(t,i){if(this._listeners===undefined)return;var r=this._listeners;var n=r[t];if(n!==undefined){var a=n.indexOf(i);if(a!==-1){n.splice(a,1)}}},dispatchEvent:function e(t){if(this._listeners===undefined)return;var i=this._listeners;var r=i[t.type];if(r!==undefined){t.target=this;var n=r.slice(0);for(var a=0,s=n.length;a<s;a++){n[a].call(this,t)}}}});var k="88";var N={LEFT:0,MIDDLE:1,RIGHT:2};var z=0;var B=1;var U=2;var D=3;var F=0;var j=1;var G=0;var H=1;var V=2;var W=0;var X=1;var Y=2;var q=1;var Z=2;var J=0;var Q=1;var K=2;var $=0;var ee=1;var te=2;var ie=3;var re=4;var ne=5;var ae=100;var se=101;var oe=102;var he=103;var le=104;var ce=200;var ue=201;var fe=202;var de=203;var pe=204;var ve=205;var me=206;var ge=207;var ye=208;var _e=209;var xe=210;var we=0;var be=1;var Me=2;var Te=3;var Ee=4;var Se=5;var Ae=6;var Le=7;var Ce=0;var Re=1;var Ie=2;var Pe=0;var Oe=1;var ke=2;var Ne=3;var ze=4;var Be=300;var Ue=301;var De=302;var Fe=303;var je=304;var Ge=305;var He=306;var Ve=307;var We=1e3;var Xe=1001;var Ye=1002;var qe=1003;var Ze=1004;var Je=1005;var Qe=1006;var Ke=1007;var $e=1008;var et=1009;var tt=1010;var it=1011;var rt=1012;var nt=1013;var at=1014;var st=1015;var ot=1016;var ht=1017;var lt=1018;var ct=1019;var ut=1020;var ft=1021;var dt=1022;var pt=1023;var vt=1024;var mt=1025;var gt=pt;var yt=1026;var _t=1027;var xt=2001;var wt=2002;var bt=2003;var Mt=2004;var Tt=2100;var Et=2101;var St=2102;var At=2103;var Lt=2151;var Ct=2200;var Rt=2201;var It=2202;var Pt=2300;var Ot=2301;var kt=2302;var Nt=2400;var zt=2401;var Bt=2402;var Ut=0;var Dt=1;var Ft=2;var jt=3e3;var Gt=3001;var Ht=3007;var Vt=3002;var Wt=3003;var Xt=3004;var Yt=3005;var qt=3006;var Zt=3200;var Jt=3201;var Qt={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");var t=0,i;return function r(){var n="";for(var a=0;a<36;a++){if(a===8||a===13||a===18||a===23){n+="-"}else if(a===14){n+="4"}else{if(t<=2)t=33554432+Math.random()*16777216|0;i=t&15;t=t>>4;n+=e[a===19?i&3|8:i]}}return n}}(),clamp:function e(t,i,r){return Math.max(i,Math.min(r,t))},euclideanModulo:function e(t,i){return(t%i+i)%i},mapLinear:function e(t,i,r,n,a){return n+(t-i)*(a-n)/(r-i)},lerp:function e(t,i,r){return(1-r)*t+r*i},smoothstep:function e(t,i,r){if(t<=i)return 0;if(t>=r)return 1;t=(t-i)/(r-i);return t*t*(3-2*t)},smootherstep:function e(t,i,r){if(t<=i)return 0;if(t>=r)return 1;t=(t-i)/(r-i);return t*t*t*(t*(t*6-15)+10)},randInt:function e(t,i){return t+Math.floor(Math.random()*(i-t+1))},randFloat:function e(t,i){return t+Math.random()*(i-t)},randFloatSpread:function e(t){return t*(.5-Math.random())},degToRad:function e(t){return t*Qt.DEG2RAD},radToDeg:function e(t){return t*Qt.RAD2DEG},isPowerOfTwo:function e(t){return(t&t-1)===0&&t!==0},ceilPowerOfTwo:function e(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function e(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}};function Kt(e,t){this.x=e||0;this.y=t||0}Object.defineProperties(Kt.prototype,{width:{get:function e(){return this.x},set:function e(t){this.x=t}},height:{get:function e(){return this.y},set:function e(t){this.y=t}}});Object.assign(Kt.prototype,{isVector2:true,set:function e(t,i){this.x=t;this.y=i;return this},setScalar:function e(t){this.x=t;this.y=t;return this},setX:function e(t){this.x=t;return this},setY:function e(t){this.y=t;return this},setComponent:function e(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function e(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function e(){return new this.constructor(this.x,this.y)},copy:function e(t){this.x=t.x;this.y=t.y;return this},add:function e(t,i){if(i!==undefined){console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(t,i)}this.x+=t.x;this.y+=t.y;return this},addScalar:function e(t){this.x+=t;this.y+=t;return this},addVectors:function e(t,i){this.x=t.x+i.x;this.y=t.y+i.y;return this},addScaledVector:function e(t,i){this.x+=t.x*i;this.y+=t.y*i;return this},sub:function e(t,i){if(i!==undefined){console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(t,i)}this.x-=t.x;this.y-=t.y;return this},subScalar:function e(t){this.x-=t;this.y-=t;return this},subVectors:function e(t,i){this.x=t.x-i.x;this.y=t.y-i.y;return this},multiply:function e(t){this.x*=t.x;this.y*=t.y;return this},multiplyScalar:function e(t){this.x*=t;this.y*=t;return this},divide:function e(t){this.x/=t.x;this.y/=t.y;return this},divideScalar:function e(t){return this.multiplyScalar(1/t)},applyMatrix3:function e(t){var i=this.x,r=this.y;var n=t.elements;this.x=n[0]*i+n[3]*r+n[6];this.y=n[1]*i+n[4]*r+n[7];return this},min:function e(t){this.x=Math.min(this.x,t.x);this.y=Math.min(this.y,t.y);return this},max:function e(t){this.x=Math.max(this.x,t.x);this.y=Math.max(this.y,t.y);return this},clamp:function e(t,i){this.x=Math.max(t.x,Math.min(i.x,this.x));this.y=Math.max(t.y,Math.min(i.y,this.y));return this},clampScalar:function(){var e=new Kt;var t=new Kt;return function i(r,n){e.set(r,r);t.set(n,n);return this.clamp(e,t)}}(),clampLength:function e(t,i){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))},floor:function e(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function e(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function e(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function e(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);return this},negate:function e(){this.x=-this.x;this.y=-this.y;return this},dot:function e(t){return this.x*t.x+this.y*t.y},lengthSq:function e(){return this.x*this.x+this.y*this.y},length:function e(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function e(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function e(){return this.divideScalar(this.length()||1)},angle:function e(){var e=Math.atan2(this.y,this.x);if(e<0)e+=2*Math.PI;return e},distanceTo:function e(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function e(t){var i=this.x-t.x,r=this.y-t.y;return i*i+r*r},manhattanDistanceTo:function e(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function e(t){return this.normalize().multiplyScalar(t)},lerp:function e(t,i){this.x+=(t.x-this.x)*i;this.y+=(t.y-this.y)*i;return this},lerpVectors:function e(t,i,r){return this.subVectors(i,t).multiplyScalar(r).add(t)},equals:function e(t){return t.x===this.x&&t.y===this.y},fromArray:function e(t,i){if(i===undefined)i=0;this.x=t[i];this.y=t[i+1];return this},toArray:function e(t,i){if(t===undefined)t=[];if(i===undefined)i=0;t[i]=this.x;t[i+1]=this.y;return t},fromBufferAttribute:function e(t,i,r){if(r!==undefined){console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute().")}this.x=t.getX(i);this.y=t.getY(i);return this},rotateAround:function e(t,i){var r=Math.cos(i),n=Math.sin(i);var a=this.x-t.x;var s=this.y-t.y;this.x=a*r-s*n+t.x;this.y=a*n+s*r+t.y;return this}});function $t(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];if(arguments.length>0){console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}}Object.assign($t.prototype,{isMatrix4:true,set:function e(t,i,r,n,a,s,o,h,l,c,u,f,d,p,v,m){var g=this.elements;g[0]=t;g[4]=i;g[8]=r;g[12]=n;g[1]=a;g[5]=s;g[9]=o;g[13]=h;g[2]=l;g[6]=c;g[10]=u;g[14]=f;g[3]=d;g[7]=p;g[11]=v;g[15]=m;return this},identity:function e(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function e(){return(new $t).fromArray(this.elements)},copy:function e(t){var i=this.elements;var r=t.elements;i[0]=r[0];i[1]=r[1];i[2]=r[2];i[3]=r[3];i[4]=r[4];i[5]=r[5];i[6]=r[6];i[7]=r[7];i[8]=r[8];i[9]=r[9];i[10]=r[10];i[11]=r[11];i[12]=r[12];i[13]=r[13];i[14]=r[14];i[15]=r[15];return this},copyPosition:function e(t){var i=this.elements,r=t.elements;i[12]=r[12];i[13]=r[13];i[14]=r[14];return this},extractBasis:function e(t,i,r){t.setFromMatrixColumn(this,0);i.setFromMatrixColumn(this,1);r.setFromMatrixColumn(this,2);return this},makeBasis:function e(t,i,r){this.set(t.x,i.x,r.x,0,t.y,i.y,r.y,0,t.z,i.z,r.z,0,0,0,0,1);return this},extractRotation:function(){var e=new ti;return function t(i){var r=this.elements;var n=i.elements;var a=1/e.setFromMatrixColumn(i,0).length();var s=1/e.setFromMatrixColumn(i,1).length();var o=1/e.setFromMatrixColumn(i,2).length();r[0]=n[0]*a;r[1]=n[1]*a;r[2]=n[2]*a;r[4]=n[4]*s;r[5]=n[5]*s;r[6]=n[6]*s;r[8]=n[8]*o;r[9]=n[9]*o;r[10]=n[10]*o;return this}}(),makeRotationFromEuler:function e(t){if(!(t&&t.isEuler)){console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var i=this.elements;var r=t.x,n=t.y,a=t.z;var s=Math.cos(r),o=Math.sin(r);var h=Math.cos(n),l=Math.sin(n);var c=Math.cos(a),u=Math.sin(a);if(t.order==="XYZ"){var f=s*c,d=s*u,p=o*c,v=o*u;i[0]=h*c;i[4]=-h*u;i[8]=l;i[1]=d+p*l;i[5]=f-v*l;i[9]=-o*h;i[2]=v-f*l;i[6]=p+d*l;i[10]=s*h}else if(t.order==="YXZ"){var m=h*c,g=h*u,y=l*c,_=l*u;i[0]=m+_*o;i[4]=y*o-g;i[8]=s*l;i[1]=s*u;i[5]=s*c;i[9]=-o;i[2]=g*o-y;i[6]=_+m*o;i[10]=s*h}else if(t.order==="ZXY"){var m=h*c,g=h*u,y=l*c,_=l*u;i[0]=m-_*o;i[4]=-s*u;i[8]=y+g*o;i[1]=g+y*o;i[5]=s*c;i[9]=_-m*o;i[2]=-s*l;i[6]=o;i[10]=s*h}else if(t.order==="ZYX"){var f=s*c,d=s*u,p=o*c,v=o*u;i[0]=h*c;i[4]=p*l-d;i[8]=f*l+v;i[1]=h*u;i[5]=v*l+f;i[9]=d*l-p;i[2]=-l;i[6]=o*h;i[10]=s*h}else if(t.order==="YZX"){var x=s*h,w=s*l,b=o*h,M=o*l;i[0]=h*c;i[4]=M-x*u;i[8]=b*u+w;i[1]=u;i[5]=s*c;i[9]=-o*c;i[2]=-l*c;i[6]=w*u+b;i[10]=x-M*u}else if(t.order==="XZY"){var x=s*h,w=s*l,b=o*h,M=o*l;i[0]=h*c;i[4]=-u;i[8]=l*c;i[1]=x*u+M;i[5]=s*c;i[9]=w*u-b;i[2]=b*u-w;i[6]=o*c;i[10]=M*u+x}i[3]=0;i[7]=0;i[11]=0;i[12]=0;i[13]=0;i[14]=0;i[15]=1;return this},makeRotationFromQuaternion:function e(t){var i=this.elements;var r=t._x,n=t._y,a=t._z,s=t._w;var o=r+r,h=n+n,l=a+a;var c=r*o,u=r*h,f=r*l;var d=n*h,p=n*l,v=a*l;var m=s*o,g=s*h,y=s*l;i[0]=1-(d+v);i[4]=u-y;i[8]=f+g;i[1]=u+y;i[5]=1-(c+v);i[9]=p-m;i[2]=f-g;i[6]=p+m;i[10]=1-(c+d);i[3]=0;i[7]=0;i[11]=0;i[12]=0;i[13]=0;i[14]=0;i[15]=1;return this},lookAt:function(){var e=new ti;var t=new ti;var i=new ti;return function r(n,a,s){var o=this.elements;i.subVectors(n,a);if(i.lengthSq()===0){i.z=1}i.normalize();e.crossVectors(s,i);if(e.lengthSq()===0){if(Math.abs(s.z)===1){i.x+=1e-4}else{i.z+=1e-4}i.normalize();e.crossVectors(s,i)}e.normalize();t.crossVectors(i,e);o[0]=e.x;o[4]=t.x;o[8]=i.x;o[1]=e.y;o[5]=t.y;o[9]=i.y;o[2]=e.z;o[6]=t.z;o[10]=i.z;return this}}(),multiply:function e(t,i){if(i!==undefined){console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.");return this.multiplyMatrices(t,i)}return this.multiplyMatrices(this,t)},premultiply:function e(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function e(t,i){var r=t.elements;var n=i.elements;var a=this.elements;var s=r[0],o=r[4],h=r[8],l=r[12];var c=r[1],u=r[5],f=r[9],d=r[13];var p=r[2],v=r[6],m=r[10],g=r[14];var y=r[3],_=r[7],x=r[11],w=r[15];var b=n[0],M=n[4],T=n[8],E=n[12];var S=n[1],A=n[5],L=n[9],C=n[13];var R=n[2],I=n[6],P=n[10],O=n[14];var k=n[3],N=n[7],z=n[11],B=n[15];a[0]=s*b+o*S+h*R+l*k;a[4]=s*M+o*A+h*I+l*N;a[8]=s*T+o*L+h*P+l*z;a[12]=s*E+o*C+h*O+l*B;a[1]=c*b+u*S+f*R+d*k;a[5]=c*M+u*A+f*I+d*N;a[9]=c*T+u*L+f*P+d*z;a[13]=c*E+u*C+f*O+d*B;a[2]=p*b+v*S+m*R+g*k;a[6]=p*M+v*A+m*I+g*N;a[10]=p*T+v*L+m*P+g*z;a[14]=p*E+v*C+m*O+g*B;a[3]=y*b+_*S+x*R+w*k;a[7]=y*M+_*A+x*I+w*N;a[11]=y*T+_*L+x*P+w*z;a[15]=y*E+_*C+x*O+w*B;return this},multiplyScalar:function e(t){var i=this.elements;i[0]*=t;i[4]*=t;i[8]*=t;i[12]*=t;i[1]*=t;i[5]*=t;i[9]*=t;i[13]*=t;i[2]*=t;i[6]*=t;i[10]*=t;i[14]*=t;i[3]*=t;i[7]*=t;i[11]*=t;i[15]*=t;return this},applyToBufferAttribute:function(){var e=new ti;return function t(i){for(var r=0,n=i.count;r<n;r++){e.x=i.getX(r);e.y=i.getY(r);e.z=i.getZ(r);e.applyMatrix4(this);i.setXYZ(r,e.x,e.y,e.z)}return i}}(),determinant:function e(){var t=this.elements;var i=t[0],r=t[4],n=t[8],a=t[12];var s=t[1],o=t[5],h=t[9],l=t[13];var c=t[2],u=t[6],f=t[10],d=t[14];var p=t[3],v=t[7],m=t[11],g=t[15];return p*(+a*h*u-n*l*u-a*o*f+r*l*f+n*o*d-r*h*d)+v*(+i*h*d-i*l*f+a*s*f-n*s*d+n*l*c-a*h*c)+m*(+i*l*u-i*o*d-a*s*u+r*s*d+a*o*c-r*l*c)+g*(-n*o*c-i*h*u+i*o*f+n*s*u-r*s*f+r*h*c)},transpose:function e(){var t=this.elements;var i;i=t[1];t[1]=t[4];t[4]=i;i=t[2];t[2]=t[8];t[8]=i;i=t[6];t[6]=t[9];t[9]=i;i=t[3];t[3]=t[12];t[12]=i;i=t[7];t[7]=t[13];t[13]=i;i=t[11];t[11]=t[14];t[14]=i;return this},setPosition:function e(t){var i=this.elements;i[12]=t.x;i[13]=t.y;i[14]=t.z;return this},getInverse:function e(t,i){var r=this.elements,n=t.elements,a=n[0],s=n[1],o=n[2],h=n[3],l=n[4],c=n[5],u=n[6],f=n[7],d=n[8],p=n[9],v=n[10],m=n[11],g=n[12],y=n[13],_=n[14],x=n[15],w=p*_*f-y*v*f+y*u*m-c*_*m-p*u*x+c*v*x,b=g*v*f-d*_*f-g*u*m+l*_*m+d*u*x-l*v*x,M=d*y*f-g*p*f+g*c*m-l*y*m-d*c*x+l*p*x,T=g*p*u-d*y*u-g*c*v+l*y*v+d*c*_-l*p*_;var E=a*w+s*b+o*M+h*T;if(E===0){var S="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(i===true){throw new Error(S)}else{console.warn(S)}return this.identity()}var A=1/E;r[0]=w*A;r[1]=(y*v*h-p*_*h-y*o*m+s*_*m+p*o*x-s*v*x)*A;r[2]=(c*_*h-y*u*h+y*o*f-s*_*f-c*o*x+s*u*x)*A;r[3]=(p*u*h-c*v*h-p*o*f+s*v*f+c*o*m-s*u*m)*A;r[4]=b*A;r[5]=(d*_*h-g*v*h+g*o*m-a*_*m-d*o*x+a*v*x)*A;r[6]=(g*u*h-l*_*h-g*o*f+a*_*f+l*o*x-a*u*x)*A;r[7]=(l*v*h-d*u*h+d*o*f-a*v*f-l*o*m+a*u*m)*A;r[8]=M*A;r[9]=(g*p*h-d*y*h-g*s*m+a*y*m+d*s*x-a*p*x)*A;r[10]=(l*y*h-g*c*h+g*s*f-a*y*f-l*s*x+a*c*x)*A;r[11]=(d*c*h-l*p*h-d*s*f+a*p*f+l*s*m-a*c*m)*A;r[12]=T*A;r[13]=(d*y*o-g*p*o+g*s*v-a*y*v-d*s*_+a*p*_)*A;r[14]=(g*c*o-l*y*o-g*s*u+a*y*u+l*s*_-a*c*_)*A;r[15]=(l*p*o-d*c*o+d*s*u-a*p*u-l*s*v+a*c*v)*A;return this},scale:function e(t){var i=this.elements;var r=t.x,n=t.y,a=t.z;i[0]*=r;i[4]*=n;i[8]*=a;i[1]*=r;i[5]*=n;i[9]*=a;i[2]*=r;i[6]*=n;i[10]*=a;i[3]*=r;i[7]*=n;i[11]*=a;return this},getMaxScaleOnAxis:function e(){var t=this.elements;var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];var r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6];var n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,r,n))},makeTranslation:function e(t,i,r){this.set(1,0,0,t,0,1,0,i,0,0,1,r,0,0,0,1);return this},makeRotationX:function e(t){var i=Math.cos(t),r=Math.sin(t);this.set(1,0,0,0,0,i,-r,0,0,r,i,0,0,0,0,1);return this},makeRotationY:function e(t){var i=Math.cos(t),r=Math.sin(t);this.set(i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1);return this},makeRotationZ:function e(t){var i=Math.cos(t),r=Math.sin(t);this.set(i,-r,0,0,r,i,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function e(t,i){var r=Math.cos(i);var n=Math.sin(i);var a=1-r;var s=t.x,o=t.y,h=t.z;var l=a*s,c=a*o;this.set(l*s+r,l*o-n*h,l*h+n*o,0,l*o+n*h,c*o+r,c*h-n*s,0,l*h-n*o,c*h+n*s,a*h*h+r,0,0,0,0,1);return this},makeScale:function e(t,i,r){this.set(t,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1);return this},makeShear:function e(t,i,r){this.set(1,i,r,0,t,1,r,0,t,i,1,0,0,0,0,1);return this},compose:function e(t,i,r){this.makeRotationFromQuaternion(i);this.scale(r);this.setPosition(t);return this},decompose:function(){var e=new ti;var t=new $t;return function i(r,n,a){var s=this.elements;var o=e.set(s[0],s[1],s[2]).length();var h=e.set(s[4],s[5],s[6]).length();var l=e.set(s[8],s[9],s[10]).length();var c=this.determinant();if(c<0)o=-o;r.x=s[12];r.y=s[13];r.z=s[14];t.copy(this);var u=1/o;var f=1/h;var d=1/l;t.elements[0]*=u;t.elements[1]*=u;t.elements[2]*=u;t.elements[4]*=f;t.elements[5]*=f;t.elements[6]*=f;t.elements[8]*=d;t.elements[9]*=d;t.elements[10]*=d;n.setFromRotationMatrix(t);a.x=o;a.y=h;a.z=l;return this}}(),makePerspective:function e(t,i,r,n,a,s){if(s===undefined){console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.")}var o=this.elements;var h=2*a/(i-t);var l=2*a/(r-n);var c=(i+t)/(i-t);var u=(r+n)/(r-n);var f=-(s+a)/(s-a);var d=-2*s*a/(s-a);o[0]=h;o[4]=0;o[8]=c;o[12]=0;o[1]=0;o[5]=l;o[9]=u;o[13]=0;o[2]=0;o[6]=0;o[10]=f;o[14]=d;o[3]=0;o[7]=0;o[11]=-1;o[15]=0;return this},makeOrthographic:function e(t,i,r,n,a,s){var o=this.elements;var h=1/(i-t);var l=1/(r-n);var c=1/(s-a);var u=(i+t)*h;var f=(r+n)*l;var d=(s+a)*c;o[0]=2*h;o[4]=0;o[8]=0;o[12]=-u;o[1]=0;o[5]=2*l;o[9]=0;o[13]=-f;o[2]=0;o[6]=0;o[10]=-2*c;o[14]=-d;o[3]=0;o[7]=0;o[11]=0;o[15]=1;return this},equals:function e(t){var i=this.elements;var r=t.elements;for(var n=0;n<16;n++){if(i[n]!==r[n])return false}return true},fromArray:function e(t,i){if(i===undefined)i=0;for(var r=0;r<16;r++){this.elements[r]=t[r+i]}return this},toArray:function e(t,i){if(t===undefined)t=[];if(i===undefined)i=0;var r=this.elements;t[i]=r[0];t[i+1]=r[1];t[i+2]=r[2];t[i+3]=r[3];t[i+4]=r[4];t[i+5]=r[5];t[i+6]=r[6];t[i+7]=r[7];t[i+8]=r[8];t[i+9]=r[9];t[i+10]=r[10];t[i+11]=r[11];t[i+12]=r[12];t[i+13]=r[13];t[i+14]=r[14];t[i+15]=r[15];return t}});function ei(e,t,i,r){this._x=e||0;this._y=t||0;this._z=i||0;this._w=r!==undefined?r:1}Object.assign(ei,{slerp:function e(t,i,r,n){return r.copy(t).slerp(i,n)},slerpFlat:function e(t,i,r,n,a,s,o){var h=r[n+0],l=r[n+1],c=r[n+2],u=r[n+3],f=a[s+0],d=a[s+1],p=a[s+2],v=a[s+3];if(u!==v||h!==f||l!==d||c!==p){var m=1-o,g=h*f+l*d+c*p+u*v,y=g>=0?1:-1,_=1-g*g;if(_>Number.EPSILON){var x=Math.sqrt(_),w=Math.atan2(x,g*y);m=Math.sin(m*w)/x;o=Math.sin(o*w)/x}var b=o*y;h=h*m+f*b;l=l*m+d*b;c=c*m+p*b;u=u*m+v*b;if(m===1-o){var M=1/Math.sqrt(h*h+l*l+c*c+u*u);h*=M;l*=M;c*=M;u*=M}}t[i]=h;t[i+1]=l;t[i+2]=c;t[i+3]=u}});Object.defineProperties(ei.prototype,{x:{get:function e(){return this._x},set:function e(t){this._x=t;this.onChangeCallback()}},y:{get:function e(){return this._y},set:function e(t){this._y=t;this.onChangeCallback()}},z:{get:function e(){return this._z},set:function e(t){this._z=t;this.onChangeCallback()}},w:{get:function e(){return this._w},set:function e(t){this._w=t;this.onChangeCallback()}}});Object.assign(ei.prototype,{set:function e(t,i,r,n){this._x=t;this._y=i;this._z=r;this._w=n;this.onChangeCallback();return this},clone:function e(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function e(t){this._x=t.x;this._y=t.y;this._z=t.z;this._w=t.w;this.onChangeCallback();return this},setFromEuler:function e(t,i){if(!(t&&t.isEuler)){throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.")}var r=t._x,n=t._y,a=t._z,s=t.order;var o=Math.cos;var h=Math.sin;var l=o(r/2);var c=o(n/2);var u=o(a/2);var f=h(r/2);var d=h(n/2);var p=h(a/2);if(s==="XYZ"){this._x=f*c*u+l*d*p;this._y=l*d*u-f*c*p;this._z=l*c*p+f*d*u;this._w=l*c*u-f*d*p}else if(s==="YXZ"){this._x=f*c*u+l*d*p;this._y=l*d*u-f*c*p;this._z=l*c*p-f*d*u;this._w=l*c*u+f*d*p}else if(s==="ZXY"){this._x=f*c*u-l*d*p;this._y=l*d*u+f*c*p;this._z=l*c*p+f*d*u;this._w=l*c*u-f*d*p}else if(s==="ZYX"){this._x=f*c*u-l*d*p;this._y=l*d*u+f*c*p;this._z=l*c*p-f*d*u;this._w=l*c*u+f*d*p}else if(s==="YZX"){this._x=f*c*u+l*d*p;this._y=l*d*u+f*c*p;this._z=l*c*p-f*d*u;this._w=l*c*u-f*d*p}else if(s==="XZY"){this._x=f*c*u-l*d*p;this._y=l*d*u-f*c*p;this._z=l*c*p+f*d*u;this._w=l*c*u+f*d*p}if(i!==false)this.onChangeCallback();return this},setFromAxisAngle:function e(t,i){var r=i/2,n=Math.sin(r);this._x=t.x*n;this._y=t.y*n;this._z=t.z*n;this._w=Math.cos(r);this.onChangeCallback();return this},setFromRotationMatrix:function e(t){var i=t.elements,r=i[0],n=i[4],a=i[8],s=i[1],o=i[5],h=i[9],l=i[2],c=i[6],u=i[10],f=r+o+u,d;if(f>0){d=.5/Math.sqrt(f+1);this._w=.25/d;this._x=(c-h)*d;this._y=(a-l)*d;this._z=(s-n)*d}else if(r>o&&r>u){d=2*Math.sqrt(1+r-o-u);this._w=(c-h)/d;this._x=.25*d;this._y=(n+s)/d;this._z=(a+l)/d}else if(o>u){d=2*Math.sqrt(1+o-r-u);this._w=(a-l)/d;this._x=(n+s)/d;this._y=.25*d;this._z=(h+c)/d}else{d=2*Math.sqrt(1+u-r-o);this._w=(s-n)/d;this._x=(a+l)/d;this._y=(h+c)/d;this._z=.25*d}this.onChangeCallback();return this},setFromUnitVectors:function(){var e=new ti;var t;var i=1e-6;return function r(n,a){if(e===undefined)e=new ti;t=n.dot(a)+1;if(t<i){t=0;if(Math.abs(n.x)>Math.abs(n.z)){e.set(-n.y,n.x,0)}else{e.set(0,-n.z,n.y)}}else{e.crossVectors(n,a)}this._x=e.x;this._y=e.y;this._z=e.z;this._w=t;return this.normalize()}}(),inverse:function e(){return this.conjugate().normalize()},conjugate:function e(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function e(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function e(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function e(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function e(){var t=this.length();if(t===0){this._x=0;this._y=0;this._z=0;this._w=1}else{t=1/t;this._x=this._x*t;this._y=this._y*t;this._z=this._z*t;this._w=this._w*t}this.onChangeCallback();return this},multiply:function e(t,i){if(i!==undefined){console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.");return this.multiplyQuaternions(t,i)}return this.multiplyQuaternions(this,t)},premultiply:function e(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function e(t,i){var r=t._x,n=t._y,a=t._z,s=t._w;var o=i._x,h=i._y,l=i._z,c=i._w;this._x=r*c+s*o+n*l-a*h;this._y=n*c+s*h+a*o-r*l;this._z=a*c+s*l+r*h-n*o;this._w=s*c-r*o-n*h-a*l;this.onChangeCallback();return this},slerp:function e(t,i){if(i===0)return this;if(i===1)return this.copy(t);var r=this._x,n=this._y,a=this._z,s=this._w;var o=s*t._w+r*t._x+n*t._y+a*t._z;if(o<0){this._w=-t._w;this._x=-t._x;this._y=-t._y;this._z=-t._z;o=-o}else{this.copy(t)}if(o>=1){this._w=s;this._x=r;this._y=n;this._z=a;return this}var h=Math.sqrt(1-o*o);if(Math.abs(h)<.001){this._w=.5*(s+this._w);this._x=.5*(r+this._x);this._y=.5*(n+this._y);this._z=.5*(a+this._z);return this}var l=Math.atan2(h,o);var c=Math.sin((1-i)*l)/h,u=Math.sin(i*l)/h;this._w=s*c+this._w*u;this._x=r*c+this._x*u;this._y=n*c+this._y*u;this._z=a*c+this._z*u;this.onChangeCallback();return this},equals:function e(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function e(t,i){if(i===undefined)i=0;this._x=t[i];this._y=t[i+1];this._z=t[i+2];this._w=t[i+3];this.onChangeCallback();return this},toArray:function e(t,i){if(t===undefined)t=[];if(i===undefined)i=0;t[i]=this._x;t[i+1]=this._y;t[i+2]=this._z;t[i+3]=this._w;return t},onChange:function e(t){this.onChangeCallback=t;return this},onChangeCallback:function e(){}});function ti(e,t,i){this.x=e||0;this.y=t||0;this.z=i||0}Object.assign(ti.prototype,{isVector3:true,set:function e(t,i,r){this.x=t;this.y=i;this.z=r;return this},setScalar:function e(t){this.x=t;this.y=t;this.z=t;return this},setX:function e(t){this.x=t;return this},setY:function e(t){this.y=t;return this},setZ:function e(t){this.z=t;return this},setComponent:function e(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function e(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function e(){return new this.constructor(this.x,this.y,this.z)},copy:function e(t){this.x=t.x;this.y=t.y;this.z=t.z;return this},add:function e(t,i){if(i!==undefined){console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(t,i)}this.x+=t.x;this.y+=t.y;this.z+=t.z;return this},addScalar:function e(t){this.x+=t;this.y+=t;this.z+=t;return this},addVectors:function e(t,i){this.x=t.x+i.x;this.y=t.y+i.y;this.z=t.z+i.z;return this},addScaledVector:function e(t,i){this.x+=t.x*i;this.y+=t.y*i;this.z+=t.z*i;return this},sub:function e(t,i){if(i!==undefined){console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(t,i)}this.x-=t.x;this.y-=t.y;this.z-=t.z;return this},subScalar:function e(t){this.x-=t;this.y-=t;this.z-=t;return this},subVectors:function e(t,i){this.x=t.x-i.x;this.y=t.y-i.y;this.z=t.z-i.z;return this},multiply:function e(t,i){if(i!==undefined){console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.");return this.multiplyVectors(t,i)}this.x*=t.x;this.y*=t.y;this.z*=t.z;return this},multiplyScalar:function e(t){this.x*=t;this.y*=t;this.z*=t;return this},multiplyVectors:function e(t,i){this.x=t.x*i.x;this.y=t.y*i.y;this.z=t.z*i.z;return this},applyEuler:function(){var e=new ei;return function t(i){if(!(i&&i.isEuler)){console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.")}return this.applyQuaternion(e.setFromEuler(i))}}(),applyAxisAngle:function(){var e=new ei;return function t(i,r){return this.applyQuaternion(e.setFromAxisAngle(i,r))}}(),applyMatrix3:function e(t){var i=this.x,r=this.y,n=this.z;var a=t.elements;this.x=a[0]*i+a[3]*r+a[6]*n;this.y=a[1]*i+a[4]*r+a[7]*n;this.z=a[2]*i+a[5]*r+a[8]*n;return this},applyMatrix4:function e(t){var i=this.x,r=this.y,n=this.z;var a=t.elements;var s=1/(a[3]*i+a[7]*r+a[11]*n+a[15]);this.x=(a[0]*i+a[4]*r+a[8]*n+a[12])*s;this.y=(a[1]*i+a[5]*r+a[9]*n+a[13])*s;this.z=(a[2]*i+a[6]*r+a[10]*n+a[14])*s;return this},applyQuaternion:function e(t){var i=this.x,r=this.y,n=this.z;var a=t.x,s=t.y,o=t.z,h=t.w;var l=h*i+s*n-o*r;var c=h*r+o*i-a*n;var u=h*n+a*r-s*i;var f=-a*i-s*r-o*n;this.x=l*h+f*-a+c*-o-u*-s;this.y=c*h+f*-s+u*-a-l*-o;this.z=u*h+f*-o+l*-s-c*-a;return this},project:function(){var e=new $t;return function t(i){e.multiplyMatrices(i.projectionMatrix,e.getInverse(i.matrixWorld));return this.applyMatrix4(e)}}(),unproject:function(){var e=new $t;return function t(i){e.multiplyMatrices(i.matrixWorld,e.getInverse(i.projectionMatrix));return this.applyMatrix4(e)}}(),transformDirection:function e(t){var i=this.x,r=this.y,n=this.z;var a=t.elements;this.x=a[0]*i+a[4]*r+a[8]*n;this.y=a[1]*i+a[5]*r+a[9]*n;this.z=a[2]*i+a[6]*r+a[10]*n;return this.normalize()},divide:function e(t){this.x/=t.x;this.y/=t.y;this.z/=t.z;return this},divideScalar:function e(t){return this.multiplyScalar(1/t)},min:function e(t){this.x=Math.min(this.x,t.x);this.y=Math.min(this.y,t.y);this.z=Math.min(this.z,t.z);return this},max:function e(t){this.x=Math.max(this.x,t.x);this.y=Math.max(this.y,t.y);this.z=Math.max(this.z,t.z);return this},clamp:function e(t,i){this.x=Math.max(t.x,Math.min(i.x,this.x));this.y=Math.max(t.y,Math.min(i.y,this.y));this.z=Math.max(t.z,Math.min(i.z,this.z));return this},clampScalar:function(){var e=new ti;var t=new ti;return function i(r,n){e.set(r,r,r);t.set(n,n,n);return this.clamp(e,t)}}(),clampLength:function e(t,i){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))},floor:function e(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function e(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function e(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function e(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);return this},negate:function e(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function e(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function e(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function e(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function e(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function e(){return this.divideScalar(this.length()||1)},setLength:function e(t){return this.normalize().multiplyScalar(t)},lerp:function e(t,i){this.x+=(t.x-this.x)*i;this.y+=(t.y-this.y)*i;this.z+=(t.z-this.z)*i;return this},lerpVectors:function e(t,i,r){return this.subVectors(i,t).multiplyScalar(r).add(t)},cross:function e(t,i){if(i!==undefined){console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.");return this.crossVectors(t,i)}return this.crossVectors(this,t)},crossVectors:function e(t,i){var r=t.x,n=t.y,a=t.z;var s=i.x,o=i.y,h=i.z;this.x=n*h-a*o;this.y=a*s-r*h;this.z=r*o-n*s;return this},projectOnVector:function e(t){var i=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(i)},projectOnPlane:function(){var e=new ti;return function t(i){e.copy(this).projectOnVector(i);return this.sub(e)}}(),reflect:function(){var e=new ti;return function t(i){return this.sub(e.copy(i).multiplyScalar(2*this.dot(i)))}}(),angleTo:function e(t){var i=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(Qt.clamp(i,-1,1))},distanceTo:function e(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function e(t){var i=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return i*i+r*r+n*n},manhattanDistanceTo:function e(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function e(t){var i=Math.sin(t.phi)*t.radius;this.x=i*Math.sin(t.theta);this.y=Math.cos(t.phi)*t.radius;this.z=i*Math.cos(t.theta);return this},setFromCylindrical:function e(t){this.x=t.radius*Math.sin(t.theta);this.y=t.y;this.z=t.radius*Math.cos(t.theta);return this},setFromMatrixPosition:function e(t){var i=t.elements;this.x=i[12];this.y=i[13];this.z=i[14];return this},setFromMatrixScale:function e(t){var i=this.setFromMatrixColumn(t,0).length();var r=this.setFromMatrixColumn(t,1).length();var n=this.setFromMatrixColumn(t,2).length();this.x=i;this.y=r;this.z=n;return this},setFromMatrixColumn:function e(t,i){return this.fromArray(t.elements,i*4)},equals:function e(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function e(t,i){if(i===undefined)i=0;this.x=t[i];this.y=t[i+1];this.z=t[i+2];return this},toArray:function e(t,i){if(t===undefined)t=[];if(i===undefined)i=0;t[i]=this.x;t[i+1]=this.y;t[i+2]=this.z;return t},fromBufferAttribute:function e(t,i,r){if(r!==undefined){console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute().")}this.x=t.getX(i);this.y=t.getY(i);this.z=t.getZ(i);return this}});function ii(){this.elements=[1,0,0,0,1,0,0,0,1];if(arguments.length>0){console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}}Object.assign(ii.prototype,{isMatrix3:true,set:function e(t,i,r,n,a,s,o,h,l){var c=this.elements;c[0]=t;c[1]=n;c[2]=o;c[3]=i;c[4]=a;c[5]=h;c[6]=r;c[7]=s;c[8]=l;return this},identity:function e(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function e(){return(new this.constructor).fromArray(this.elements)},copy:function e(t){var i=this.elements;var r=t.elements;i[0]=r[0];i[1]=r[1];i[2]=r[2];i[3]=r[3];i[4]=r[4];i[5]=r[5];i[6]=r[6];i[7]=r[7];i[8]=r[8];return this},setFromMatrix4:function e(t){var i=t.elements;this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]);return this},applyToBufferAttribute:function(){var e=new ti;return function t(i){for(var r=0,n=i.count;r<n;r++){e.x=i.getX(r);e.y=i.getY(r);e.z=i.getZ(r);e.applyMatrix3(this);i.setXYZ(r,e.x,e.y,e.z)}return i}}(),multiply:function e(t){return this.multiplyMatrices(this,t)},premultiply:function e(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function e(t,i){var r=t.elements;var n=i.elements;var a=this.elements;var s=r[0],o=r[3],h=r[6];var l=r[1],c=r[4],u=r[7];var f=r[2],d=r[5],p=r[8];var v=n[0],m=n[3],g=n[6];var y=n[1],_=n[4],x=n[7];var w=n[2],b=n[5],M=n[8];a[0]=s*v+o*y+h*w;a[3]=s*m+o*_+h*b;a[6]=s*g+o*x+h*M;a[1]=l*v+c*y+u*w;a[4]=l*m+c*_+u*b;a[7]=l*g+c*x+u*M;a[2]=f*v+d*y+p*w;a[5]=f*m+d*_+p*b;a[8]=f*g+d*x+p*M;return this},multiplyScalar:function e(t){var i=this.elements;i[0]*=t;i[3]*=t;i[6]*=t;i[1]*=t;i[4]*=t;i[7]*=t;i[2]*=t;i[5]*=t;i[8]*=t;return this},determinant:function e(){var t=this.elements;var i=t[0],r=t[1],n=t[2],a=t[3],s=t[4],o=t[5],h=t[6],l=t[7],c=t[8];return i*s*c-i*o*l-r*a*c+r*o*h+n*a*l-n*s*h},getInverse:function e(t,i){if(t&&t.isMatrix4){console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.")}var r=t.elements,n=this.elements,a=r[0],s=r[1],o=r[2],h=r[3],l=r[4],c=r[5],u=r[6],f=r[7],d=r[8],p=d*l-c*f,v=c*u-d*h,m=f*h-l*u,g=a*p+s*v+o*m;if(g===0){var y="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(i===true){throw new Error(y)}else{console.warn(y)}return this.identity()}var _=1/g;n[0]=p*_;n[1]=(o*f-d*s)*_;n[2]=(c*s-o*l)*_;n[3]=v*_;n[4]=(d*a-o*u)*_;n[5]=(o*h-c*a)*_;n[6]=m*_;n[7]=(s*u-f*a)*_;n[8]=(l*a-s*h)*_;return this},transpose:function e(){var t,i=this.elements;t=i[1];i[1]=i[3];i[3]=t;t=i[2];i[2]=i[6];i[6]=t;t=i[5];i[5]=i[7];i[7]=t;return this},getNormalMatrix:function e(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function e(t){var i=this.elements;t[0]=i[0];t[1]=i[3];t[2]=i[6];t[3]=i[1];t[4]=i[4];t[5]=i[7];t[6]=i[2];t[7]=i[5];t[8]=i[8];return this},setUvTransform:function e(t,i,r,n,a,s,o){var h=Math.cos(a);var l=Math.sin(a);this.set(r*h,r*l,-r*(h*s+l*o)+s+t,-n*l,n*h,-n*(-l*s+h*o)+o+i,0,0,1)},scale:function e(t,i){var r=this.elements;r[0]*=t;r[3]*=t;r[6]*=t;r[1]*=i;r[4]*=i;r[7]*=i;return this},rotate:function e(t){var i=Math.cos(t);var r=Math.sin(t);var n=this.elements;var a=n[0],s=n[3],o=n[6];var h=n[1],l=n[4],c=n[7];n[0]=i*a+r*h;n[3]=i*s+r*l;n[6]=i*o+r*c;n[1]=-r*a+i*h;n[4]=-r*s+i*l;n[7]=-r*o+i*c;return this},translate:function e(t,i){var r=this.elements;r[0]+=t*r[2];r[3]+=t*r[5];r[6]+=t*r[8];r[1]+=i*r[2];r[4]+=i*r[5];r[7]+=i*r[8];return this},equals:function e(t){var i=this.elements;var r=t.elements;for(var n=0;n<9;n++){if(i[n]!==r[n])return false}return true},fromArray:function e(t,i){if(i===undefined)i=0;for(var r=0;r<9;r++){this.elements[r]=t[r+i]}return this},toArray:function e(t,i){if(t===undefined)t=[];if(i===undefined)i=0;var r=this.elements;t[i]=r[0];t[i+1]=r[1];t[i+2]=r[2];t[i+3]=r[3];t[i+4]=r[4];t[i+5]=r[5];t[i+6]=r[6];t[i+7]=r[7];t[i+8]=r[8];return t}});var ri=0;function ni(e,t,i,r,n,a,s,o,h,l){Object.defineProperty(this,"id",{value:ri++});this.uuid=Qt.generateUUID();this.name="";this.image=e!==undefined?e:ni.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=t!==undefined?t:ni.DEFAULT_MAPPING;this.wrapS=i!==undefined?i:Xe;this.wrapT=r!==undefined?r:Xe;this.magFilter=n!==undefined?n:Qe;this.minFilter=a!==undefined?a:$e;this.anisotropy=h!==undefined?h:1;this.format=s!==undefined?s:pt;this.type=o!==undefined?o:et;this.offset=new Kt(0,0);this.repeat=new Kt(1,1);this.center=new Kt(0,0);this.rotation=0;this.matrixAutoUpdate=true;this.matrix=new ii;this.generateMipmaps=true;this.premultiplyAlpha=false;this.flipY=true;this.unpackAlignment=4;this.encoding=l!==undefined?l:jt;this.version=0;this.onUpdate=null}ni.DEFAULT_IMAGE=undefined;ni.DEFAULT_MAPPING=Be;Object.defineProperty(ni.prototype,"needsUpdate",{set:function e(t){if(t===true)this.version++}});Object.assign(ni.prototype,O.prototype,{constructor:ni,isTexture:true,clone:function e(){return(new this.constructor).copy(this)},copy:function e(t){this.name=t.name;this.image=t.image;this.mipmaps=t.mipmaps.slice(0);this.mapping=t.mapping;this.wrapS=t.wrapS;this.wrapT=t.wrapT;this.magFilter=t.magFilter;this.minFilter=t.minFilter;this.anisotropy=t.anisotropy;this.format=t.format;this.type=t.type;this.offset.copy(t.offset);this.repeat.copy(t.repeat);this.center.copy(t.center);this.rotation=t.rotation;this.matrixAutoUpdate=t.matrixAutoUpdate;this.matrix.copy(t.matrix);this.generateMipmaps=t.generateMipmaps;this.premultiplyAlpha=t.premultiplyAlpha;this.flipY=t.flipY;this.unpackAlignment=t.unpackAlignment;this.encoding=t.encoding;return this},toJSON:function e(t){var i=t===undefined||typeof t==="string";if(!i&&t.textures[this.uuid]!==undefined){return t.textures[this.uuid]}function r(e){var t;if(e instanceof HTMLCanvasElement){t=e}else{t=new wx.createCanvas;t.width=e.width;t.height=e.height;var i=t.getContext("2d");if(e instanceof ImageData){i.putImageData(e,0,0)}else{i.drawImage(e,0,0,e.width,e.height)}}if(t.width>2048||t.height>2048){return t.toDataURL("image/jpeg",.6)}else{return t.toDataURL("image/png")}}var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(this.image!==undefined){var a=this.image;if(a.uuid===undefined){a.uuid=Qt.generateUUID()}if(!i&&t.images[a.uuid]===undefined){t.images[a.uuid]={uuid:a.uuid,url:r(a)}}n.image=a.uuid}if(!i){t.textures[this.uuid]=n}return n},dispose:function e(){this.dispatchEvent({type:"dispose"})},transformUv:function e(t){if(this.mapping!==Be)return;t.applyMatrix3(this.matrix);if(t.x<0||t.x>1){switch(this.wrapS){case We:t.x=t.x-Math.floor(t.x);break;case Xe:t.x=t.x<0?0:1;break;case Ye:if(Math.abs(Math.floor(t.x)%2)===1){t.x=Math.ceil(t.x)-t.x}else{t.x=t.x-Math.floor(t.x)}break}}if(t.y<0||t.y>1){switch(this.wrapT){case We:t.y=t.y-Math.floor(t.y);break;case Xe:t.y=t.y<0?0:1;break;case Ye:if(Math.abs(Math.floor(t.y)%2)===1){t.y=Math.ceil(t.y)-t.y}else{t.y=t.y-Math.floor(t.y)}break}}if(this.flipY){t.y=1-t.y}}});function ai(e,t,i,r){this.x=e||0;this.y=t||0;this.z=i||0;this.w=r!==undefined?r:1}Object.assign(ai.prototype,{isVector4:true,set:function e(t,i,r,n){this.x=t;this.y=i;this.z=r;this.w=n;return this},setScalar:function e(t){this.x=t;this.y=t;this.z=t;this.w=t;return this},setX:function e(t){this.x=t;return this},setY:function e(t){this.y=t;return this},setZ:function e(t){this.z=t;return this},setW:function e(t){this.w=t;return this},setComponent:function e(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function e(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function e(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function e(t){this.x=t.x;this.y=t.y;this.z=t.z;this.w=t.w!==undefined?t.w:1;return this},add:function e(t,i){if(i!==undefined){console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(t,i)}this.x+=t.x;this.y+=t.y;this.z+=t.z;this.w+=t.w;return this},addScalar:function e(t){this.x+=t;this.y+=t;this.z+=t;this.w+=t;return this},addVectors:function e(t,i){this.x=t.x+i.x;this.y=t.y+i.y;this.z=t.z+i.z;this.w=t.w+i.w;return this},addScaledVector:function e(t,i){this.x+=t.x*i;this.y+=t.y*i;this.z+=t.z*i;this.w+=t.w*i;return this},sub:function e(t,i){if(i!==undefined){console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(t,i)}this.x-=t.x;this.y-=t.y;this.z-=t.z;this.w-=t.w;return this},subScalar:function e(t){this.x-=t;this.y-=t;this.z-=t;this.w-=t;return this},subVectors:function e(t,i){this.x=t.x-i.x;this.y=t.y-i.y;this.z=t.z-i.z;this.w=t.w-i.w;return this},multiplyScalar:function e(t){this.x*=t;this.y*=t;this.z*=t;this.w*=t;return this},applyMatrix4:function e(t){var i=this.x,r=this.y,n=this.z,a=this.w;var s=t.elements;this.x=s[0]*i+s[4]*r+s[8]*n+s[12]*a;this.y=s[1]*i+s[5]*r+s[9]*n+s[13]*a;this.z=s[2]*i+s[6]*r+s[10]*n+s[14]*a;this.w=s[3]*i+s[7]*r+s[11]*n+s[15]*a;return this},divideScalar:function e(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function e(t){this.w=2*Math.acos(t.w);var i=Math.sqrt(1-t.w*t.w);if(i<1e-4){this.x=1;this.y=0;this.z=0}else{this.x=t.x/i;this.y=t.y/i;this.z=t.z/i}return this},setAxisAngleFromRotationMatrix:function e(t){var i,r,n,a,s=.01,o=.1,h=t.elements,l=h[0],c=h[4],u=h[8],f=h[1],d=h[5],p=h[9],v=h[2],m=h[6],g=h[10];if(Math.abs(c-f)<s&&Math.abs(u-v)<s&&Math.abs(p-m)<s){if(Math.abs(c+f)<o&&Math.abs(u+v)<o&&Math.abs(p+m)<o&&Math.abs(l+d+g-3)<o){this.set(1,0,0,0);return this}i=Math.PI;var y=(l+1)/2;var _=(d+1)/2;var x=(g+1)/2;var w=(c+f)/4;var b=(u+v)/4;var M=(p+m)/4;if(y>_&&y>x){if(y<s){r=0;n=.707106781;a=.707106781}else{r=Math.sqrt(y);n=w/r;a=b/r}}else if(_>x){if(_<s){r=.707106781;n=0;a=.707106781}else{n=Math.sqrt(_);r=w/n;a=M/n}}else{if(x<s){r=.707106781;n=.707106781;a=0}else{a=Math.sqrt(x);r=b/a;n=M/a}}this.set(r,n,a,i);return this}var T=Math.sqrt((m-p)*(m-p)+(u-v)*(u-v)+(f-c)*(f-c));if(Math.abs(T)<.001)T=1;this.x=(m-p)/T;this.y=(u-v)/T;this.z=(f-c)/T;this.w=Math.acos((l+d+g-1)/2);return this},min:function e(t){this.x=Math.min(this.x,t.x);this.y=Math.min(this.y,t.y);this.z=Math.min(this.z,t.z);this.w=Math.min(this.w,t.w);return this},max:function e(t){this.x=Math.max(this.x,t.x);this.y=Math.max(this.y,t.y);this.z=Math.max(this.z,t.z);this.w=Math.max(this.w,t.w);return this},clamp:function e(t,i){this.x=Math.max(t.x,Math.min(i.x,this.x));this.y=Math.max(t.y,Math.min(i.y,this.y));this.z=Math.max(t.z,Math.min(i.z,this.z));this.w=Math.max(t.w,Math.min(i.w,this.w));return this},clampScalar:function(){var e,t;return function i(r,n){if(e===undefined){e=new ai;t=new ai}e.set(r,r,r,r);t.set(n,n,n,n);return this.clamp(e,t)}}(),clampLength:function e(t,i){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))},floor:function e(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function e(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function e(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function e(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w);return this},negate:function e(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function e(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function e(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function e(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function e(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function e(){return this.divideScalar(this.length()||1)},setLength:function e(t){return this.normalize().multiplyScalar(t)},lerp:function e(t,i){this.x+=(t.x-this.x)*i;this.y+=(t.y-this.y)*i;this.z+=(t.z-this.z)*i;this.w+=(t.w-this.w)*i;return this},lerpVectors:function e(t,i,r){return this.subVectors(i,t).multiplyScalar(r).add(t)},equals:function e(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function e(t,i){if(i===undefined)i=0;this.x=t[i];this.y=t[i+1];this.z=t[i+2];this.w=t[i+3];return this},toArray:function e(t,i){if(t===undefined)t=[];if(i===undefined)i=0;t[i]=this.x;t[i+1]=this.y;t[i+2]=this.z;t[i+3]=this.w;return t},fromBufferAttribute:function e(t,i,r){if(r!==undefined){console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute().")}this.x=t.getX(i);this.y=t.getY(i);this.z=t.getZ(i);this.w=t.getW(i);return this}});function si(e,t,i){this.uuid=Qt.generateUUID();this.width=e;this.height=t;this.scissor=new ai(0,0,e,t);this.scissorTest=false;this.viewport=new ai(0,0,e,t);i=i||{};if(i.minFilter===undefined)i.minFilter=Qe;this.texture=new ni(undefined,undefined,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding);this.depthBuffer=i.depthBuffer!==undefined?i.depthBuffer:true;this.stencilBuffer=i.stencilBuffer!==undefined?i.stencilBuffer:true;this.depthTexture=i.depthTexture!==undefined?i.depthTexture:null}Object.assign(si.prototype,O.prototype,{isWebGLRenderTarget:true,setSize:function e(t,i){if(this.width!==t||this.height!==i){this.width=t;this.height=i;this.dispose()}this.viewport.set(0,0,t,i);this.scissor.set(0,0,t,i)},clone:function e(){return(new this.constructor).copy(this)},copy:function e(t){this.width=t.width;this.height=t.height;this.viewport.copy(t.viewport);this.texture=t.texture.clone();this.depthBuffer=t.depthBuffer;this.stencilBuffer=t.stencilBuffer;this.depthTexture=t.depthTexture;return this},dispose:function e(){this.dispatchEvent({type:"dispose"})}});function oi(e,t,i){si.call(this,e,t,i);this.activeCubeFace=0;this.activeMipMapLevel=0}oi.prototype=Object.create(si.prototype);oi.prototype.constructor=oi;oi.prototype.isWebGLRenderTargetCube=true;function hi(e,t,i,r,n,a,s,o,h,l,c,u){ni.call(this,null,a,s,o,h,l,r,n,c,u);this.image={data:e,width:t,height:i};this.magFilter=h!==undefined?h:qe;this.minFilter=l!==undefined?l:qe;this.generateMipmaps=false;this.flipY=false;this.unpackAlignment=1}hi.prototype=Object.create(ni.prototype);hi.prototype.constructor=hi;hi.prototype.isDataTexture=true;function li(e,t,i,r,n,a,s,o,h,l){e=e!==undefined?e:[];t=t!==undefined?t:Ue;ni.call(this,e,t,i,r,n,a,s,o,h,l);this.flipY=false}li.prototype=Object.create(ni.prototype);li.prototype.constructor=li;li.prototype.isCubeTexture=true;Object.defineProperty(li.prototype,"images",{get:function e(){return this.image},set:function e(t){this.image=t}});var ci=new ni;var ui=new li;function fi(){this.seq=[];this.map={}}var di=[];var pi=[];var vi=new Float32Array(16);var mi=new Float32Array(9);function gi(e,t,i){var r=e[0];if(r<=0||r>0)return e;var n=t*i,a=di[n];if(a===undefined){a=new Float32Array(n);di[n]=a}if(t!==0){r.toArray(a,0);for(var s=1,o=0;s!==t;++s){o+=i;e[s].toArray(a,o)}}return a}function yi(e,t){var i=pi[t];if(i===undefined){i=new Int32Array(t);pi[t]=i}for(var r=0;r!==t;++r){i[r]=e.allocTextureUnit()}return i}function _i(e,t){e.uniform1f(this.addr,t)}function xi(e,t){e.uniform1i(this.addr,t)}function wi(e,t){if(t.x===undefined){e.uniform2fv(this.addr,t)}else{e.uniform2f(this.addr,t.x,t.y)}}function bi(e,t){if(t.x!==undefined){e.uniform3f(this.addr,t.x,t.y,t.z)}else if(t.r!==undefined){e.uniform3f(this.addr,t.r,t.g,t.b)}else{e.uniform3fv(this.addr,t)}}function Mi(e,t){if(t.x===undefined){e.uniform4fv(this.addr,t)}else{e.uniform4f(this.addr,t.x,t.y,t.z,t.w)}}function Ti(e,t){e.uniformMatrix2fv(this.addr,false,t.elements||t)}function Ei(e,t){if(t.elements===undefined){e.uniformMatrix3fv(this.addr,false,t)}else{mi.set(t.elements);e.uniformMatrix3fv(this.addr,false,mi)}}function Si(e,t){if(t.elements===undefined){e.uniformMatrix4fv(this.addr,false,t)}else{vi.set(t.elements);e.uniformMatrix4fv(this.addr,false,vi)}}function Ai(e,t,i){var r=i.allocTextureUnit();e.uniform1i(this.addr,r);i.setTexture2D(t||ci,r)}function Li(e,t,i){var r=i.allocTextureUnit();e.uniform1i(this.addr,r);i.setTextureCube(t||ui,r)}function Ci(e,t){e.uniform2iv(this.addr,t)}function Ri(e,t){e.uniform3iv(this.addr,t)}function Ii(e,t){e.uniform4iv(this.addr,t)}function Pi(e){switch(e){case 5126:return _i;case 35664:return wi;case 35665:return bi;case 35666:return Mi;case 35674:return Ti;case 35675:return Ei;case 35676:return Si;case 35678:case 36198:return Ai;case 35680:return Li;case 5124:case 35670:return xi;case 35667:case 35671:return Ci;case 35668:case 35672:return Ri;case 35669:case 35673:return Ii}}function Oi(e,t){e.uniform1fv(this.addr,t)}function ki(e,t){e.uniform1iv(this.addr,t)}function Ni(e,t){e.uniform2fv(this.addr,gi(t,this.size,2))}function zi(e,t){e.uniform3fv(this.addr,gi(t,this.size,3))}function Bi(e,t){e.uniform4fv(this.addr,gi(t,this.size,4))}function Ui(e,t){e.uniformMatrix2fv(this.addr,false,gi(t,this.size,4))}function Di(e,t){e.uniformMatrix3fv(this.addr,false,gi(t,this.size,9))}function Fi(e,t){e.uniformMatrix4fv(this.addr,false,gi(t,this.size,16))}function ji(e,t,i){var r=t.length,n=yi(i,r);e.uniform1iv(this.addr,n);for(var a=0;a!==r;++a){i.setTexture2D(t[a]||ci,n[a])}}function Gi(e,t,i){var r=t.length,n=yi(i,r);e.uniform1iv(this.addr,n);for(var a=0;a!==r;++a){i.setTextureCube(t[a]||ui,n[a])}}function Hi(e){switch(e){case 5126:return Oi;case 35664:return Ni;case 35665:return zi;case 35666:return Bi;case 35674:return Ui;case 35675:return Di;case 35676:return Fi;case 35678:return ji;case 35680:return Gi;case 5124:case 35670:return ki;case 35667:case 35671:return Ci;case 35668:case 35672:return Ri;case 35669:case 35673:return Ii}}function Vi(e,t,i){this.id=e;this.addr=i;this.setValue=Pi(t.type)}function Wi(e,t,i){this.id=e;this.addr=i;this.size=t.size;this.setValue=Hi(t.type)}function Xi(e){this.id=e;fi.call(this)}Xi.prototype.setValue=function(e,t){var i=this.seq;for(var r=0,n=i.length;r!==n;++r){var a=i[r];a.setValue(e,t[a.id])}};var Yi=/([\w\d_]+)(\])?(\[|\.)?/g;function qi(e,t){e.seq.push(t);e.map[t.id]=t}function Zi(e,t,i){var r=e.name,n=r.length;Yi.lastIndex=0;for(;;){var a=Yi.exec(r),s=Yi.lastIndex,o=a[1],h=a[2]==="]",l=a[3];if(h)o=o|0;if(l===undefined||l==="["&&s+2===n){qi(i,l===undefined?new Vi(o,e,t):new Wi(o,e,t));break}else{var c=i.map,u=c[o];if(u===undefined){u=new Xi(o);qi(i,u)}i=u}}}function Ji(e,t,i){fi.call(this);this.renderer=i;var r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(var n=0;n<r;++n){var a=e.getActiveUniform(t,n),s=a.name,o=e.getUniformLocation(t,s);Zi(a,o,this)}}Ji.prototype.setValue=function(e,t,i){var r=this.map[t];if(r!==undefined)r.setValue(e,i,this.renderer)};Ji.prototype.setOptional=function(e,t,i){var r=t[i];if(r!==undefined)this.setValue(e,i,r)};Ji.upload=function(e,t,i,r){for(var n=0,a=t.length;n!==a;++n){var s=t[n],o=i[s.id];if(o.needsUpdate!==false){s.setValue(e,o.value,r)}}};Ji.seqWithValue=function(e,t){var i=[];for(var r=0,n=e.length;r!==n;++r){var a=e[r];if(a.id in t)i.push(a)}return i};var Qi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Ki(e,t,i){if(t===undefined&&i===undefined){return this.set(e)}return this.setRGB(e,t,i)}Object.assign(Ki.prototype,{isColor:true,r:1,g:1,b:1,set:function e(t){if(t&&t.isColor){this.copy(t)}else if(typeof t==="number"){this.setHex(t)}else if(typeof t==="string"){this.setStyle(t)}return this},setScalar:function e(t){this.r=t;this.g=t;this.b=t;return this},setHex:function e(t){t=Math.floor(t);this.r=(t>>16&255)/255;this.g=(t>>8&255)/255;this.b=(t&255)/255;return this},setRGB:function e(t,i,r){this.r=t;this.g=i;this.b=r;return this},setHSL:function(){function e(e,t,i){if(i<0)i+=1;if(i>1)i-=1;if(i<1/6)return e+(t-e)*6*i;if(i<1/2)return t;if(i<2/3)return e+(t-e)*6*(2/3-i);return e}return function t(i,r,n){i=Qt.euclideanModulo(i,1);r=Qt.clamp(r,0,1);n=Qt.clamp(n,0,1);if(r===0){this.r=this.g=this.b=n}else{var a=n<=.5?n*(1+r):n+r-n*r;var s=2*n-a;this.r=e(s,a,i+1/3);this.g=e(s,a,i);this.b=e(s,a,i-1/3)}return this}}(),setStyle:function e(t){function i(e){if(e===undefined)return;if(parseFloat(e)<1){console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var n;var a=r[1];var s=r[2];switch(a){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(s)){this.r=Math.min(255,parseInt(n[1],10))/255;this.g=Math.min(255,parseInt(n[2],10))/255;this.b=Math.min(255,parseInt(n[3],10))/255;i(n[5]);return this}if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(s)){this.r=Math.min(100,parseInt(n[1],10))/100;this.g=Math.min(100,parseInt(n[2],10))/100;this.b=Math.min(100,parseInt(n[3],10))/100;i(n[5]);return this}break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(s)){var o=parseFloat(n[1])/360;var h=parseInt(n[2],10)/100;var l=parseInt(n[3],10)/100;i(n[5]);return this.setHSL(o,h,l)}break}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(t)){var c=r[1];var u=c.length;if(u===3){this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255;this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255;this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255;return this}else if(u===6){this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255;this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255;this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255;return this}}if(t&&t.length>0){var c=Qi[t];if(c!==undefined){this.setHex(c)}else{console.warn("THREE.Color: Unknown color "+t)}}return this},clone:function e(){return new this.constructor(this.r,this.g,this.b)},copy:function e(t){this.r=t.r;this.g=t.g;this.b=t.b;return this},copyGammaToLinear:function e(t,i){if(i===undefined)i=2;this.r=Math.pow(t.r,i);this.g=Math.pow(t.g,i);this.b=Math.pow(t.b,i);return this},copyLinearToGamma:function e(t,i){if(i===undefined)i=2;var r=i>0?1/i:1;this.r=Math.pow(t.r,r);this.g=Math.pow(t.g,r);this.b=Math.pow(t.b,r);return this},convertGammaToLinear:function e(){var t=this.r,i=this.g,r=this.b;this.r=t*t;this.g=i*i;this.b=r*r;return this},convertLinearToGamma:function e(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function e(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function e(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function e(t){var i=t||{h:0,s:0,l:0};var r=this.r,n=this.g,a=this.b;var s=Math.max(r,n,a);var o=Math.min(r,n,a);var h,l;var c=(o+s)/2;if(o===s){h=0;l=0}else{var u=s-o;l=c<=.5?u/(s+o):u/(2-s-o);switch(s){case r:h=(n-a)/u+(n<a?6:0);break;case n:h=(a-r)/u+2;break;case a:h=(r-n)/u+4;break}h/=6}i.h=h;i.s=l;i.l=c;return i},getStyle:function e(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function e(t,i,r){var n=this.getHSL();n.h+=t;n.s+=i;n.l+=r;this.setHSL(n.h,n.s,n.l);return this},add:function e(t){this.r+=t.r;this.g+=t.g;this.b+=t.b;return this},addColors:function e(t,i){this.r=t.r+i.r;this.g=t.g+i.g;this.b=t.b+i.b;return this},addScalar:function e(t){this.r+=t;this.g+=t;this.b+=t;return this},sub:function e(t){this.r=Math.max(0,this.r-t.r);this.g=Math.max(0,this.g-t.g);this.b=Math.max(0,this.b-t.b);return this},multiply:function e(t){this.r*=t.r;this.g*=t.g;this.b*=t.b;return this},multiplyScalar:function e(t){this.r*=t;this.g*=t;this.b*=t;return this},lerp:function e(t,i){this.r+=(t.r-this.r)*i;this.g+=(t.g-this.g)*i;this.b+=(t.b-this.b)*i;return this},equals:function e(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function e(t,i){if(i===undefined)i=0;this.r=t[i];this.g=t[i+1];this.b=t[i+2];return this},toArray:function e(t,i){if(t===undefined)t=[];if(i===undefined)i=0;t[i]=this.r;t[i+1]=this.g;t[i+2]=this.b;return t},toJSON:function e(){return this.getHex()}});var $i={common:{diffuse:{value:new Ki(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new ii},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Kt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ki(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Ki(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new ii}}};var er={merge:function e(t){var i={};for(var r=0;r<t.length;r++){var n=this.clone(t[r]);for(var a in n){i[a]=n[a]}}return i},clone:function e(t){var i={};for(var r in t){i[r]={};for(var n in t[r]){var a=t[r][n];if(a&&(a.isColor||a.isMatrix3||a.isMatrix4||a.isVector2||a.isVector3||a.isVector4||a.isTexture)){i[r][n]=a.clone()}else if(Array.isArray(a)){i[r][n]=a.slice()}else{i[r][n]=a}}}return i}};var tr="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n";var ir="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n";var rr="#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n";var nr="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n";var ar="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif";var sr="\nvec3 transformed = vec3( position );\n";var or="\nvec3 objectNormal = vec3( normal );\n";var hr="float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat theta = acos( dot( N, V ) );\n\tvec2 uv = vec2(\n\t\tsqrt( saturate( roughness ) ),\n\t\tsaturate( theta / ( 0.5 * PI ) ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.86267 + (0.49788 + 0.01436 * y ) * y;\n\tfloat b = 3.45068 + (4.18814 + y) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = (x > 0.0) ? v : 0.5 * inversesqrt( 1.0 - x * x ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tvec3 result = vec3( LTC_ClippedSphereFormFactor( vectorFormFactor ) );\n\treturn result;\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n";var lr="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n";var cr="#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t\t\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\t\tvec4 plane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t\n\t#endif\n#endif\n";var ur="#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n";var fr="#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n";var dr="#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n";var pr="#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif";var vr="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n";var mr="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif";var gr="#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif";var yr="#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\n";var _r="#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n";var xr="vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n";var wr="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n";var br="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n";var Mr="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n";var Tr="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n";var Er="  gl_FragColor = linearToOutputTexel( gl_FragColor );\n";var Sr="\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n";var Ar="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n";var Lr="#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n";var Cr="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n";var Rr="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n";var Ir="\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif";var Pr="#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n";var Or="#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n";var kr="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n";var Nr="#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n";var zr="#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n";var Br="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif";var Ur="vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n";var Dr="uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltcMat;\tuniform sampler2D ltcMag;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n";var Fr="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n";var jr="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n";var Gr="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n";var Hr="struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tfloat norm = texture2D( ltcMag, uv ).a;\n\t\tvec4 t = texture2D( ltcMat, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3(   1,   0, t.y ),\n\t\t\tvec3(   0, t.z,   0 ),\n\t\t\tvec3( t.w,   0, t.x )\n\t\t);\n\t\treflectedLight.directSpecular += lightColor * material.specularColor * norm * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n";var Vr="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n";var Wr="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif";var Xr="#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n";var Yr="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif";var qr="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif\n";var Zr="#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n";var Jr="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n";var Qr="#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n";var Kr="#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\n";var $r="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n";var en="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif";var tn="#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n";var rn="#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif";var nn="#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n";var an="#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n";var sn="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n";var on="vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n";var hn="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n";var ln="vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n";var cn="#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n";var un="#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n";var fn="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n";var dn="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif";var pn="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n";var vn="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n";var mn="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n";var gn="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n";var yn="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif";var _n="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n";var xn="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n";var wn="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n";var bn="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif";var Mn="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif";var Tn="#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n";var En="#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n";var Sn="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif";var An="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n";var Ln="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif";var Cn="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif";var Rn="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif";var In="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif";var Pn="#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n";var On="uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n";var kn="varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}\n";var Nn="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n";var zn="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n";var Bn="#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n";var Un="#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n";var Dn="uniform sampler2D tEquirect;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n";var Fn="varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n";var jn="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";var Gn="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n";var Hn="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";var Vn="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n";var Wn="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n";var Xn="#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n";var Yn="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n";var qn="#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n";var Zn="#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n";var Jn="#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n";var Qn="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n";var Kn="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n";var $n="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";var ea="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n";var ta="uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}\n";var ia="#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n";var ra={alphamap_fragment:tr,alphamap_pars_fragment:ir,alphatest_fragment:rr,aomap_fragment:nr,aomap_pars_fragment:ar,begin_vertex:sr,beginnormal_vertex:or,bsdfs:hr,bumpmap_pars_fragment:lr,clipping_planes_fragment:cr,clipping_planes_pars_fragment:ur,clipping_planes_pars_vertex:fr,clipping_planes_vertex:dr,color_fragment:pr,color_pars_fragment:vr,color_pars_vertex:mr,color_vertex:gr,common:yr,cube_uv_reflection_fragment:_r,defaultnormal_vertex:xr,displacementmap_pars_vertex:wr,displacementmap_vertex:br,emissivemap_fragment:Mr,emissivemap_pars_fragment:Tr,encodings_fragment:Er,encodings_pars_fragment:Sr,envmap_fragment:Ar,envmap_pars_fragment:Lr,envmap_pars_vertex:Cr,envmap_vertex:Rr,fog_vertex:Ir,fog_pars_vertex:Pr,fog_fragment:Or,fog_pars_fragment:kr,gradientmap_pars_fragment:Nr,lightmap_fragment:zr,lightmap_pars_fragment:Br,lights_lambert_vertex:Ur,lights_pars:Dr,lights_phong_fragment:Fr,lights_phong_pars_fragment:jr,lights_physical_fragment:Gr,lights_physical_pars_fragment:Hr,lights_template:Vr,logdepthbuf_fragment:Wr,logdepthbuf_pars_fragment:Xr,logdepthbuf_pars_vertex:Yr,logdepthbuf_vertex:qr,map_fragment:Zr,map_pars_fragment:Jr,map_particle_fragment:Qr,map_particle_pars_fragment:Kr,metalnessmap_fragment:$r,metalnessmap_pars_fragment:en,morphnormal_vertex:tn,morphtarget_pars_vertex:rn,morphtarget_vertex:nn,normal_fragment:an,normalmap_pars_fragment:sn,packing:on,premultiplied_alpha_fragment:hn,project_vertex:ln,dithering_fragment:cn,dithering_pars_fragment:un,roughnessmap_fragment:fn,roughnessmap_pars_fragment:dn,shadowmap_pars_fragment:pn,shadowmap_pars_vertex:vn,shadowmap_vertex:mn,shadowmask_pars_fragment:gn,skinbase_vertex:yn,skinning_pars_vertex:_n,skinning_vertex:xn,skinnormal_vertex:wn,specularmap_fragment:bn,specularmap_pars_fragment:Mn,tonemapping_fragment:Tn,tonemapping_pars_fragment:En,uv_pars_fragment:Sn,uv_pars_vertex:An,uv_vertex:Ln,uv2_pars_fragment:Cn,uv2_pars_vertex:Rn,uv2_vertex:In,worldpos_vertex:Pn,cube_frag:On,cube_vert:kn,depth_frag:Nn,depth_vert:zn,distanceRGBA_frag:Bn,distanceRGBA_vert:Un,equirect_frag:Dn,equirect_vert:Fn,linedashed_frag:jn,linedashed_vert:Gn,meshbasic_frag:Hn,meshbasic_vert:Vn,meshlambert_frag:Wn,meshlambert_vert:Xn,meshphong_frag:Yn,meshphong_vert:qn,meshphysical_frag:Zn,meshphysical_vert:Jn,normal_frag:Qn,normal_vert:Kn,points_frag:$n,points_vert:ea,shadow_frag:ta,shadow_vert:ia};var na={basic:{uniforms:er.merge([$i.common,$i.specularmap,$i.envmap,$i.aomap,$i.lightmap,$i.fog]),vertexShader:ra.meshbasic_vert,fragmentShader:ra.meshbasic_frag},lambert:{uniforms:er.merge([$i.common,$i.specularmap,$i.envmap,$i.aomap,$i.lightmap,$i.emissivemap,$i.fog,$i.lights,{emissive:{value:new Ki(0)}}]),vertexShader:ra.meshlambert_vert,fragmentShader:ra.meshlambert_frag},phong:{uniforms:er.merge([$i.common,$i.specularmap,$i.envmap,$i.aomap,$i.lightmap,$i.emissivemap,$i.bumpmap,$i.normalmap,$i.displacementmap,$i.gradientmap,$i.fog,$i.lights,{emissive:{value:new Ki(0)},specular:{value:new Ki(1118481)},shininess:{value:30}}]),vertexShader:ra.meshphong_vert,fragmentShader:ra.meshphong_frag},standard:{uniforms:er.merge([$i.common,$i.envmap,$i.aomap,$i.lightmap,$i.emissivemap,$i.bumpmap,$i.normalmap,$i.displacementmap,$i.roughnessmap,$i.metalnessmap,$i.fog,$i.lights,{emissive:{value:new Ki(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:ra.meshphysical_vert,fragmentShader:ra.meshphysical_frag},points:{uniforms:er.merge([$i.points,$i.fog]),vertexShader:ra.points_vert,fragmentShader:ra.points_frag},dashed:{uniforms:er.merge([$i.common,$i.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ra.linedashed_vert,fragmentShader:ra.linedashed_frag},depth:{uniforms:er.merge([$i.common,$i.displacementmap]),vertexShader:ra.depth_vert,fragmentShader:ra.depth_frag},normal:{uniforms:er.merge([$i.common,$i.bumpmap,$i.normalmap,$i.displacementmap,{opacity:{value:1}}]),vertexShader:ra.normal_vert,fragmentShader:ra.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ra.cube_vert,fragmentShader:ra.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ra.equirect_vert,fragmentShader:ra.equirect_frag},distanceRGBA:{uniforms:er.merge([$i.common,$i.displacementmap,{referencePosition:{value:new ti},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ra.distanceRGBA_vert,fragmentShader:ra.distanceRGBA_frag},shadow:{uniforms:er.merge([$i.lights,$i.fog,{color:{value:new Ki(0)},opacity:{value:1}}]),vertexShader:ra.shadow_vert,fragmentShader:ra.shadow_frag}};na.physical={uniforms:er.merge([na.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:ra.meshphysical_vert,fragmentShader:ra.meshphysical_frag};function aa(e,t){this.min=e!==undefined?e:new Kt(+Infinity,+Infinity);this.max=t!==undefined?t:new Kt(-Infinity,-Infinity)}Object.assign(aa.prototype,{set:function e(t,i){this.min.copy(t);this.max.copy(i);return this},setFromPoints:function e(t){this.makeEmpty();for(var i=0,r=t.length;i<r;i++){this.expandByPoint(t[i])}return this},setFromCenterAndSize:function(){var e=new Kt;return function t(i,r){var n=e.copy(r).multiplyScalar(.5);this.min.copy(i).sub(n);this.max.copy(i).add(n);return this}}(),clone:function e(){return(new this.constructor).copy(this)},copy:function e(t){this.min.copy(t.min);this.max.copy(t.max);return this},makeEmpty:function e(){this.min.x=this.min.y=+Infinity;this.max.x=this.max.y=-Infinity;return this},isEmpty:function e(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function e(t){var i=t||new Kt;return this.isEmpty()?i.set(0,0):i.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function e(t){var i=t||new Kt;return this.isEmpty()?i.set(0,0):i.subVectors(this.max,this.min)},expandByPoint:function e(t){this.min.min(t);this.max.max(t);return this},expandByVector:function e(t){this.min.sub(t);this.max.add(t);return this},expandByScalar:function e(t){this.min.addScalar(-t);this.max.addScalar(t);return this},containsPoint:function e(t){return t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y?false:true},containsBox:function e(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function e(t,i){var r=i||new Kt;return r.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function e(t){return t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y?false:true},clampPoint:function e(t,i){var r=i||new Kt;return r.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var e=new Kt;return function t(i){var r=e.copy(i).clamp(this.min,this.max);return r.sub(i).length()}}(),intersect:function e(t){this.min.max(t.min);this.max.min(t.max);return this},union:function e(t){this.min.min(t.min);this.max.max(t.max);return this},translate:function e(t){this.min.add(t);this.max.add(t);return this},equals:function e(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});function sa(e,t,i,r,n){var a,s;var o,h,l,c;var u,f;function d(){var e=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]);var r=new Uint16Array([0,1,2,0,2,3]);a=t.createBuffer();s=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a);t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s);t.bufferData(t.ELEMENT_ARRAY_BUFFER,r,t.STATIC_DRAW);u=t.createTexture();f=t.createTexture();i.bindTexture(t.TEXTURE_2D,u);t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST);i.bindTexture(t.TEXTURE_2D,f);t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST);o={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvUV = uv;","\tvec2 pos = position;","\tif ( renderType == 2 ) {","\t\tvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","\t\tvVisibility =        visibility.r / 9.0;","\t\tvVisibility *= 1.0 - visibility.g / 9.0;","\t\tvVisibility *=       visibility.b / 9.0;","\t\tvVisibility *= 1.0 - visibility.a / 9.0;","\t\tpos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","\t\tpos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","\t}","\tgl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tif ( renderType == 0 ) {","\t\tgl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","\t} else if ( renderType == 1 ) {","\t\tgl_FragColor = texture2D( map, vUV );","\t} else {","\t\tvec4 texture = texture2D( map, vUV );","\t\ttexture.a *= opacity * vVisibility;","\t\tgl_FragColor = texture;","\t\tgl_FragColor.rgb *= color;","\t}","}"].join("\n")};h=p(o);l={vertex:t.getAttribLocation(h,"position"),uv:t.getAttribLocation(h,"uv")};c={renderType:t.getUniformLocation(h,"renderType"),map:t.getUniformLocation(h,"map"),occlusionMap:t.getUniformLocation(h,"occlusionMap"),opacity:t.getUniformLocation(h,"opacity"),color:t.getUniformLocation(h,"color"),scale:t.getUniformLocation(h,"scale"),rotation:t.getUniformLocation(h,"rotation"),screenPosition:t.getUniformLocation(h,"screenPosition")}}this.render=function(e,n,o,p){if(e.length===0)return;var v=new ti;var m=p.w/p.z,g=p.z*.5,y=p.w*.5;var _=16/p.w,x=new Kt(_*m,_);var w=new ti(1,1,0),b=new Kt(1,1);var M=new aa;M.min.set(p.x,p.y);M.max.set(p.x+(p.z-16),p.y+(p.w-16));if(h===undefined){d()}i.useProgram(h);i.initAttributes();i.enableAttribute(l.vertex);i.enableAttribute(l.uv);i.disableUnusedAttributes();t.uniform1i(c.occlusionMap,0);t.uniform1i(c.map,1);t.bindBuffer(t.ARRAY_BUFFER,a);t.vertexAttribPointer(l.vertex,2,t.FLOAT,false,2*8,0);t.vertexAttribPointer(l.uv,2,t.FLOAT,false,2*8,8);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s);i.disable(t.CULL_FACE);i.buffers.depth.setMask(false);for(var T=0,E=e.length;T<E;T++){_=16/p.w;x.set(_*m,_);var S=e[T];v.set(S.matrixWorld.elements[12],S.matrixWorld.elements[13],S.matrixWorld.elements[14]);v.applyMatrix4(o.matrixWorldInverse);v.applyMatrix4(o.projectionMatrix);w.copy(v);b.x=p.x+w.x*g+g-8;b.y=p.y+w.y*y+y-8;if(M.containsPoint(b)===true){i.activeTexture(t.TEXTURE0);i.bindTexture(t.TEXTURE_2D,null);i.activeTexture(t.TEXTURE1);i.bindTexture(t.TEXTURE_2D,u);t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,b.x,b.y,16,16,0);t.uniform1i(c.renderType,0);t.uniform2f(c.scale,x.x,x.y);t.uniform3f(c.screenPosition,w.x,w.y,w.z);i.disable(t.BLEND);i.enable(t.DEPTH_TEST);t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0);i.activeTexture(t.TEXTURE0);i.bindTexture(t.TEXTURE_2D,f);t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,b.x,b.y,16,16,0);t.uniform1i(c.renderType,1);i.disable(t.DEPTH_TEST);i.activeTexture(t.TEXTURE1);i.bindTexture(t.TEXTURE_2D,u);t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0);S.positionScreen.copy(w);if(S.customUpdateCallback){S.customUpdateCallback(S)}else{S.updateLensFlares()}t.uniform1i(c.renderType,2);i.enable(t.BLEND);for(var A=0,L=S.lensFlares.length;A<L;A++){var C=S.lensFlares[A];if(C.opacity>.001&&C.scale>.001){w.x=C.x;w.y=C.y;w.z=C.z;_=C.size*C.scale/p.w;x.x=_*m;x.y=_;t.uniform3f(c.screenPosition,w.x,w.y,w.z);t.uniform2f(c.scale,x.x,x.y);t.uniform1f(c.rotation,C.rotation);t.uniform1f(c.opacity,C.opacity);t.uniform3f(c.color,C.color.r,C.color.g,C.color.b);i.setBlending(C.blending,C.blendEquation,C.blendSrc,C.blendDst);r.setTexture2D(C.texture,1);t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)}}}}i.enable(t.CULL_FACE);i.enable(t.DEPTH_TEST);i.buffers.depth.setMask(true);i.reset()};function p(e){var i=t.createProgram();var r=t.createShader(t.FRAGMENT_SHADER);var a=t.createShader(t.VERTEX_SHADER);var s="precision "+n.precision+" float;\n";t.shaderSource(r,s+e.fragmentShader);t.shaderSource(a,s+e.vertexShader);t.compileShader(r);t.compileShader(a);t.attachShader(i,r);t.attachShader(i,a);t.linkProgram(i);return i}}function oa(e,t,i,r,n,a,s,o,h){ni.call(this,e,t,i,r,n,a,s,o,h);this.needsUpdate=true}oa.prototype=Object.create(ni.prototype);oa.prototype.constructor=oa;function ha(e,t,i,r,n){var a,s;var o,h,l;var c;var u=new ti;var f=new ei;var d=new ti;function p(){var e=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]);var i=new Uint16Array([0,1,2,0,2,3]);a=t.createBuffer();s=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a);t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s);t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW);o=v();h={position:t.getAttribLocation(o,"position"),uv:t.getAttribLocation(o,"uv")};l={uvOffset:t.getUniformLocation(o,"uvOffset"),uvScale:t.getUniformLocation(o,"uvScale"),rotation:t.getUniformLocation(o,"rotation"),scale:t.getUniformLocation(o,"scale"),color:t.getUniformLocation(o,"color"),map:t.getUniformLocation(o,"map"),opacity:t.getUniformLocation(o,"opacity"),modelViewMatrix:t.getUniformLocation(o,"modelViewMatrix"),projectionMatrix:t.getUniformLocation(o,"projectionMatrix"),fogType:t.getUniformLocation(o,"fogType"),fogDensity:t.getUniformLocation(o,"fogDensity"),fogNear:t.getUniformLocation(o,"fogNear"),fogFar:t.getUniformLocation(o,"fogFar"),fogColor:t.getUniformLocation(o,"fogColor"),fogDepth:t.getUniformLocation(o,"fogDepth"),alphaTest:t.getUniformLocation(o,"alphaTest")};var r=new wx.createCanvas;r.width=8;r.height=8;var n=r.getContext("2d");n.fillStyle="white";n.fillRect(0,0,8,8);c=new oa(r)}this.render=function(n,v,g){if(n.length===0)return;if(o===undefined){p()}i.useProgram(o);i.initAttributes();i.enableAttribute(h.position);i.enableAttribute(h.uv);i.disableUnusedAttributes();i.disable(t.CULL_FACE);i.enable(t.BLEND);t.bindBuffer(t.ARRAY_BUFFER,a);t.vertexAttribPointer(h.position,2,t.FLOAT,false,2*8,0);t.vertexAttribPointer(h.uv,2,t.FLOAT,false,2*8,8);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s);t.uniformMatrix4fv(l.projectionMatrix,false,g.projectionMatrix.elements);i.activeTexture(t.TEXTURE0);t.uniform1i(l.map,0);var y=0;var _=0;var x=v.fog;if(x){t.uniform3f(l.fogColor,x.color.r,x.color.g,x.color.b);if(x.isFog){t.uniform1f(l.fogNear,x.near);t.uniform1f(l.fogFar,x.far);t.uniform1i(l.fogType,1);y=1;_=1}else if(x.isFogExp2){t.uniform1f(l.fogDensity,x.density);t.uniform1i(l.fogType,2);y=2;_=2}}else{t.uniform1i(l.fogType,0);y=0;_=0}for(var w=0,b=n.length;w<b;w++){var M=n[w];M.modelViewMatrix.multiplyMatrices(g.matrixWorldInverse,M.matrixWorld);M.z=-M.modelViewMatrix.elements[14]}n.sort(m);var T=[];for(var w=0,b=n.length;w<b;w++){var M=n[w];var E=M.material;if(E.visible===false)continue;M.onBeforeRender(e,v,g,undefined,E,undefined);t.uniform1f(l.alphaTest,E.alphaTest);t.uniformMatrix4fv(l.modelViewMatrix,false,M.modelViewMatrix.elements);M.matrixWorld.decompose(u,f,d);T[0]=d.x;T[1]=d.y;var S=0;if(v.fog&&E.fog){S=_}if(y!==S){t.uniform1i(l.fogType,S);y=S}if(E.map!==null){t.uniform2f(l.uvOffset,E.map.offset.x,E.map.offset.y);t.uniform2f(l.uvScale,E.map.repeat.x,E.map.repeat.y)}else{t.uniform2f(l.uvOffset,0,0);t.uniform2f(l.uvScale,1,1)}t.uniform1f(l.opacity,E.opacity);t.uniform3f(l.color,E.color.r,E.color.g,E.color.b);t.uniform1f(l.rotation,E.rotation);t.uniform2fv(l.scale,T);i.setBlending(E.blending,E.blendEquation,E.blendSrc,E.blendDst,E.blendEquationAlpha,E.blendSrcAlpha,E.blendDstAlpha,E.premultipliedAlpha);i.buffers.depth.setTest(E.depthTest);i.buffers.depth.setMask(E.depthWrite);i.buffers.color.setMask(E.colorWrite);r.setTexture2D(E.map||c,0);t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0);M.onAfterRender(e,v,g,undefined,E,undefined)}i.enable(t.CULL_FACE);i.reset()};function v(){var e=t.createProgram();var i=t.createShader(t.VERTEX_SHADER);var r=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(i,["precision "+n.precision+" float;","#define SHADER_NAME "+"SpriteMaterial","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float fogDepth;","void main() {","\tvUV = uvOffset + uv * uvScale;","\tvec2 alignedPosition = position * scale;","\tvec2 rotatedPosition;","\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","\tvec4 mvPosition;","\tmvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","\tmvPosition.xy += rotatedPosition;","\tgl_Position = projectionMatrix * mvPosition;","\tfogDepth = - mvPosition.z;","}"].join("\n"));t.shaderSource(r,["precision "+n.precision+" float;","#define SHADER_NAME "+"SpriteMaterial","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","varying float fogDepth;","void main() {","\tvec4 texture = texture2D( map, vUV );","\tgl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","\tif ( gl_FragColor.a < alphaTest ) discard;","\tif ( fogType > 0 ) {","\t\tfloat fogFactor = 0.0;","\t\tif ( fogType == 1 ) {","\t\t\tfogFactor = smoothstep( fogNear, fogFar, fogDepth );","\t\t} else {","\t\t\tconst float LOG2 = 1.442695;","\t\t\tfogFactor = exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 );","\t\t\tfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","\t\t}","\t\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );","\t}","}"].join("\n"));t.compileShader(i);t.compileShader(r);t.attachShader(e,i);t.attachShader(e,r);t.linkProgram(e);return e}function m(e,t){if(e.renderOrder!==t.renderOrder){return e.renderOrder-t.renderOrder}else if(e.z!==t.z){return t.z-e.z}else{return t.id-e.id}}}var la=0;function ca(){Object.defineProperty(this,"id",{value:la++});this.uuid=Qt.generateUUID();this.name="";this.type="Material";this.fog=true;this.lights=true;this.blending=ee;this.side=W;this.flatShading=false;this.vertexColors=J;this.opacity=1;this.transparent=false;this.blendSrc=pe;this.blendDst=ve;this.blendEquation=ae;this.blendSrcAlpha=null;this.blendDstAlpha=null;this.blendEquationAlpha=null;this.depthFunc=Te;this.depthTest=true;this.depthWrite=true;this.clippingPlanes=null;this.clipIntersection=false;this.clipShadows=false;this.colorWrite=true;this.precision=null;this.polygonOffset=false;this.polygonOffsetFactor=0;this.polygonOffsetUnits=0;this.dithering=false;this.alphaTest=0;this.premultipliedAlpha=false;this.overdraw=0;this.visible=true;this.userData={};this.needsUpdate=true}Object.assign(ca.prototype,O.prototype,{isMaterial:true,onBeforeCompile:function e(){},setValues:function e(t){if(t===undefined)return;for(var i in t){var r=t[i];if(r===undefined){console.warn("THREE.Material: '"+i+"' parameter is undefined.");continue}if(i==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.");this.flatShading=r===q?true:false;continue}var n=this[i];if(n===undefined){continue}if(n&&n.isColor){n.set(r)}else if(n&&n.isVector3&&r&&r.isVector3){n.copy(r)}else if(i==="overdraw"){this[i]=Number(r)}else{this[i]=r}}},toJSON:function e(t){var i=t===undefined||typeof t==="string";if(i){t={textures:{},images:{}}}var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid;r.type=this.type;if(this.name!=="")r.name=this.name;if(this.color&&this.color.isColor)r.color=this.color.getHex();if(this.roughness!==undefined)r.roughness=this.roughness;if(this.metalness!==undefined)r.metalness=this.metalness;if(this.emissive&&this.emissive.isColor)r.emissive=this.emissive.getHex();if(this.emissiveIntensity!==1)r.emissiveIntensity=this.emissiveIntensity;if(this.specular&&this.specular.isColor)r.specular=this.specular.getHex();if(this.shininess!==undefined)r.shininess=this.shininess;if(this.clearCoat!==undefined)r.clearCoat=this.clearCoat;if(this.clearCoatRoughness!==undefined)r.clearCoatRoughness=this.clearCoatRoughness;if(this.map&&this.map.isTexture)r.map=this.map.toJSON(t).uuid;if(this.alphaMap&&this.alphaMap.isTexture)r.alphaMap=this.alphaMap.toJSON(t).uuid;if(this.lightMap&&this.lightMap.isTexture)r.lightMap=this.lightMap.toJSON(t).uuid;if(this.bumpMap&&this.bumpMap.isTexture){r.bumpMap=this.bumpMap.toJSON(t).uuid;r.bumpScale=this.bumpScale}if(this.normalMap&&this.normalMap.isTexture){r.normalMap=this.normalMap.toJSON(t).uuid;r.normalScale=this.normalScale.toArray()}if(this.displacementMap&&this.displacementMap.isTexture){r.displacementMap=this.displacementMap.toJSON(t).uuid;r.displacementScale=this.displacementScale;r.displacementBias=this.displacementBias}if(this.roughnessMap&&this.roughnessMap.isTexture)r.roughnessMap=this.roughnessMap.toJSON(t).uuid;if(this.metalnessMap&&this.metalnessMap.isTexture)r.metalnessMap=this.metalnessMap.toJSON(t).uuid;if(this.emissiveMap&&this.emissiveMap.isTexture)r.emissiveMap=this.emissiveMap.toJSON(t).uuid;if(this.specularMap&&this.specularMap.isTexture)r.specularMap=this.specularMap.toJSON(t).uuid;if(this.envMap&&this.envMap.isTexture){r.envMap=this.envMap.toJSON(t).uuid;r.reflectivity=this.reflectivity}if(this.gradientMap&&this.gradientMap.isTexture){r.gradientMap=this.gradientMap.toJSON(t).uuid}if(this.size!==undefined)r.size=this.size;if(this.sizeAttenuation!==undefined)r.sizeAttenuation=this.sizeAttenuation;if(this.blending!==ee)r.blending=this.blending;if(this.flatShading===true)r.flatShading=this.flatShading;if(this.side!==W)r.side=this.side;if(this.vertexColors!==J)r.vertexColors=this.vertexColors;if(this.opacity<1)r.opacity=this.opacity;if(this.transparent===true)r.transparent=this.transparent;r.depthFunc=this.depthFunc;r.depthTest=this.depthTest;r.depthWrite=this.depthWrite;if(this.rotation!==0)r.rotation=this.rotation;if(this.linewidth!==1)r.linewidth=this.linewidth;if(this.dashSize!==undefined)r.dashSize=this.dashSize;if(this.gapSize!==undefined)r.gapSize=this.gapSize;if(this.scale!==undefined)r.scale=this.scale;if(this.dithering===true)r.dithering=true;if(this.alphaTest>0)r.alphaTest=this.alphaTest;if(this.premultipliedAlpha===true)r.premultipliedAlpha=this.premultipliedAlpha;if(this.wireframe===true)r.wireframe=this.wireframe;if(this.wireframeLinewidth>1)r.wireframeLinewidth=this.wireframeLinewidth;if(this.wireframeLinecap!=="round")r.wireframeLinecap=this.wireframeLinecap;if(this.wireframeLinejoin!=="round")r.wireframeLinejoin=this.wireframeLinejoin;if(this.morphTargets===true)r.morphTargets=true;if(this.skinning===true)r.skinning=true;if(this.visible===false)r.visible=false;if(JSON.stringify(this.userData)!=="{}")r.userData=this.userData;function n(e){var t=[];for(var i in e){var r=e[i];delete r.metadata;t.push(r)}return t}if(i){var a=n(t.textures);var s=n(t.images);if(a.length>0)r.textures=a;if(s.length>0)r.images=s}return r},clone:function e(){return(new this.constructor).copy(this)},copy:function e(t){this.name=t.name;this.fog=t.fog;this.lights=t.lights;this.blending=t.blending;this.side=t.side;this.flatShading=t.flatShading;this.vertexColors=t.vertexColors;this.opacity=t.opacity;this.transparent=t.transparent;this.blendSrc=t.blendSrc;this.blendDst=t.blendDst;this.blendEquation=t.blendEquation;this.blendSrcAlpha=t.blendSrcAlpha;this.blendDstAlpha=t.blendDstAlpha;this.blendEquationAlpha=t.blendEquationAlpha;this.depthFunc=t.depthFunc;this.depthTest=t.depthTest;this.depthWrite=t.depthWrite;this.colorWrite=t.colorWrite;this.precision=t.precision;this.polygonOffset=t.polygonOffset;this.polygonOffsetFactor=t.polygonOffsetFactor;this.polygonOffsetUnits=t.polygonOffsetUnits;this.dithering=t.dithering;this.alphaTest=t.alphaTest;this.premultipliedAlpha=t.premultipliedAlpha;this.overdraw=t.overdraw;this.visible=t.visible;this.userData=JSON.parse(JSON.stringify(t.userData));this.clipShadows=t.clipShadows;this.clipIntersection=t.clipIntersection;var i=t.clippingPlanes,r=null;if(i!==null){var n=i.length;r=new Array(n);for(var a=0;a!==n;++a){r[a]=i[a].clone()}}this.clippingPlanes=r;return this},dispose:function e(){this.dispatchEvent({type:"dispose"})}});function ua(e){ca.call(this);this.type="MeshDepthMaterial";this.depthPacking=Zt;this.skinning=false;this.morphTargets=false;this.map=null;this.alphaMap=null;this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;this.lights=false;this.setValues(e)}ua.prototype=Object.create(ca.prototype);ua.prototype.constructor=ua;ua.prototype.isMeshDepthMaterial=true;ua.prototype.copy=function(e){ca.prototype.copy.call(this,e);this.depthPacking=e.depthPacking;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.map=e.map;this.alphaMap=e.alphaMap;this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;return this};function fa(e){ca.call(this);this.type="MeshDistanceMaterial";this.referencePosition=new ti;this.nearDistance=1;this.farDistance=1e3;this.skinning=false;this.morphTargets=false;this.map=null;this.alphaMap=null;this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.fog=false;this.lights=false;this.setValues(e)}fa.prototype=Object.create(ca.prototype);fa.prototype.constructor=fa;fa.prototype.isMeshDistanceMaterial=true;fa.prototype.copy=function(e){ca.prototype.copy.call(this,e);this.referencePosition.copy(e.referencePosition);this.nearDistance=e.nearDistance;this.farDistance=e.farDistance;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.map=e.map;this.alphaMap=e.alphaMap;this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;return this};function da(e,t){this.min=e!==undefined?e:new ti(+Infinity,+Infinity,+Infinity);this.max=t!==undefined?t:new ti(-Infinity,-Infinity,-Infinity)}Object.assign(da.prototype,{isBox3:true,set:function e(t,i){this.min.copy(t);this.max.copy(i);return this},setFromArray:function e(t){var i=+Infinity;var r=+Infinity;var n=+Infinity;var a=-Infinity;var s=-Infinity;var o=-Infinity;for(var h=0,l=t.length;h<l;h+=3){var c=t[h];var u=t[h+1];var f=t[h+2];if(c<i)i=c;if(u<r)r=u;if(f<n)n=f;if(c>a)a=c;if(u>s)s=u;if(f>o)o=f}this.min.set(i,r,n);this.max.set(a,s,o);return this},setFromBufferAttribute:function e(t){var i=+Infinity;var r=+Infinity;var n=+Infinity;var a=-Infinity;var s=-Infinity;var o=-Infinity;for(var h=0,l=t.count;h<l;h++){var c=t.getX(h);var u=t.getY(h);var f=t.getZ(h);if(c<i)i=c;if(u<r)r=u;if(f<n)n=f;if(c>a)a=c;if(u>s)s=u;if(f>o)o=f}this.min.set(i,r,n);this.max.set(a,s,o);return this},setFromPoints:function e(t){this.makeEmpty();for(var i=0,r=t.length;i<r;i++){this.expandByPoint(t[i])}return this},setFromCenterAndSize:function(){var e=new ti;return function t(i,r){var n=e.copy(r).multiplyScalar(.5);this.min.copy(i).sub(n);this.max.copy(i).add(n);return this}}(),setFromObject:function e(t){this.makeEmpty();return this.expandByObject(t)},clone:function e(){return(new this.constructor).copy(this)},copy:function e(t){this.min.copy(t.min);this.max.copy(t.max);return this},makeEmpty:function e(){this.min.x=this.min.y=this.min.z=+Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},isEmpty:function e(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function e(t){var i=t||new ti;return this.isEmpty()?i.set(0,0,0):i.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function e(t){var i=t||new ti;return this.isEmpty()?i.set(0,0,0):i.subVectors(this.max,this.min)},expandByPoint:function e(t){this.min.min(t);this.max.max(t);return this},expandByVector:function e(t){this.min.sub(t);this.max.add(t);return this},expandByScalar:function e(t){this.min.addScalar(-t);this.max.addScalar(t);return this},expandByObject:function(){var e,t,i;var r=new ti;function n(n){var a=n.geometry;if(a!==undefined){if(a.isGeometry){var s=a.vertices;for(t=0,i=s.length;t<i;t++){r.copy(s[t]);r.applyMatrix4(n.matrixWorld);e.expandByPoint(r)}}else if(a.isBufferGeometry){var o=a.attributes.position;if(o!==undefined){for(t=0,i=o.count;t<i;t++){r.fromBufferAttribute(o,t).applyMatrix4(n.matrixWorld);e.expandByPoint(r)}}}}}return function t(i){e=this;i.updateMatrixWorld(true);i.traverse(n);return this}}(),containsPoint:function e(t){return t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z?false:true},containsBox:function e(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function e(t,i){var r=i||new ti;return r.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function e(t){return t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z?false:true},intersectsSphere:function(){var e=new ti;return function t(i){this.clampPoint(i.center,e);return e.distanceToSquared(i.center)<=i.radius*i.radius}}(),intersectsPlane:function e(t){var i,r;if(t.normal.x>0){i=t.normal.x*this.min.x;r=t.normal.x*this.max.x}else{i=t.normal.x*this.max.x;r=t.normal.x*this.min.x}if(t.normal.y>0){i+=t.normal.y*this.min.y;r+=t.normal.y*this.max.y}else{i+=t.normal.y*this.max.y;r+=t.normal.y*this.min.y}if(t.normal.z>0){i+=t.normal.z*this.min.z;r+=t.normal.z*this.max.z}else{i+=t.normal.z*this.max.z;r+=t.normal.z*this.min.z}return i<=t.constant&&r>=t.constant},clampPoint:function e(t,i){var r=i||new ti;return r.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var e=new ti;return function t(i){var r=e.copy(i).clamp(this.min,this.max);return r.sub(i).length()}}(),getBoundingSphere:function(){var e=new ti;return function t(i){var r=i||new pa;this.getCenter(r.center);r.radius=this.getSize(e).length()*.5;return r}}(),intersect:function e(t){this.min.max(t.min);this.max.min(t.max);if(this.isEmpty())this.makeEmpty();return this},union:function e(t){this.min.min(t.min);this.max.max(t.max);return this},applyMatrix4:function(){var e=[new ti,new ti,new ti,new ti,new ti,new ti,new ti,new ti];return function t(i){if(this.isEmpty())return this;e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(i);e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(i);e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(i);e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(i);e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(i);e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(i);e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(i);e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(i);this.setFromPoints(e);return this}}(),translate:function e(t){this.min.add(t);this.max.add(t);return this},equals:function e(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});function pa(e,t){this.center=e!==undefined?e:new ti;this.radius=t!==undefined?t:0}Object.assign(pa.prototype,{set:function e(t,i){this.center.copy(t);this.radius=i;return this},setFromPoints:function(){var e=new da;return function t(i,r){var n=this.center;if(r!==undefined){n.copy(r)}else{e.setFromPoints(i).getCenter(n)}var a=0;for(var s=0,o=i.length;s<o;s++){a=Math.max(a,n.distanceToSquared(i[s]))}this.radius=Math.sqrt(a);return this}}(),clone:function e(){return(new this.constructor).copy(this)},copy:function e(t){this.center.copy(t.center);this.radius=t.radius;return this},empty:function e(){return this.radius<=0},containsPoint:function e(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function e(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function e(t){var i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i},intersectsBox:function e(t){return t.intersectsSphere(this)},intersectsPlane:function e(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function e(t,i){var r=this.center.distanceToSquared(t);var n=i||new ti;n.copy(t);if(r>this.radius*this.radius){n.sub(this.center).normalize();n.multiplyScalar(this.radius).add(this.center)}return n},getBoundingBox:function e(t){var i=t||new da;i.set(this.center,this.center);i.expandByScalar(this.radius);return i},applyMatrix4:function e(t){this.center.applyMatrix4(t);this.radius=this.radius*t.getMaxScaleOnAxis();return this},translate:function e(t){this.center.add(t);return this},equals:function e(t){return t.center.equals(this.center)&&t.radius===this.radius}});function va(e,t){this.normal=e!==undefined?e:new ti(1,0,0);this.constant=t!==undefined?t:0}Object.assign(va.prototype,{set:function e(t,i){this.normal.copy(t);this.constant=i;return this},setComponents:function e(t,i,r,n){this.normal.set(t,i,r);this.constant=n;return this},setFromNormalAndCoplanarPoint:function e(t,i){this.normal.copy(t);this.constant=-i.dot(this.normal);return this},setFromCoplanarPoints:function(){var e=new ti;var t=new ti;return function i(r,n,a){var s=e.subVectors(a,n).cross(t.subVectors(r,n)).normalize();this.setFromNormalAndCoplanarPoint(s,r);return this}}(),clone:function e(){return(new this.constructor).copy(this)},copy:function e(t){this.normal.copy(t.normal);this.constant=t.constant;return this},normalize:function e(){var t=1/this.normal.length();this.normal.multiplyScalar(t);this.constant*=t;return this},negate:function e(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function e(t){return this.normal.dot(t)+this.constant},distanceToSphere:function e(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function e(t,i){var r=i||new ti;return r.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(){var e=new ti;return function t(i,r){var n=r||new ti;var a=i.delta(e);var s=this.normal.dot(a);if(s===0){if(this.distanceToPoint(i.start)===0){return n.copy(i.start)}return undefined}var o=-(i.start.dot(this.normal)+this.constant)/s;if(o<0||o>1){return undefined}return n.copy(a).multiplyScalar(o).add(i.start)}}(),intersectsLine:function e(t){var i=this.distanceToPoint(t.start);var r=this.distanceToPoint(t.end);return i<0&&r>0||r<0&&i>0},intersectsBox:function e(t){return t.intersectsPlane(this)},intersectsSphere:function e(t){return t.intersectsPlane(this)},coplanarPoint:function e(t){var i=t||new ti;return i.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new ti;var t=new ii;return function i(r,n){var a=n||t.getNormalMatrix(r);var s=this.coplanarPoint(e).applyMatrix4(r);var o=this.normal.applyMatrix3(a).normalize();this.constant=-s.dot(o);return this}}(),translate:function e(t){this.constant-=t.dot(this.normal);return this},equals:function e(t){return t.normal.equals(this.normal)&&t.constant===this.constant}});function ma(e,t,i,r,n,a){this.planes=[e!==undefined?e:new va,t!==undefined?t:new va,i!==undefined?i:new va,r!==undefined?r:new va,n!==undefined?n:new va,a!==undefined?a:new va]}Object.assign(ma.prototype,{set:function e(t,i,r,n,a,s){var o=this.planes;o[0].copy(t);o[1].copy(i);o[2].copy(r);o[3].copy(n);o[4].copy(a);o[5].copy(s);return this},clone:function e(){return(new this.constructor).copy(this)},copy:function e(t){var i=this.planes;for(var r=0;r<6;r++){i[r].copy(t.planes[r])}return this},setFromMatrix:function e(t){var i=this.planes;var r=t.elements;var n=r[0],a=r[1],s=r[2],o=r[3];var h=r[4],l=r[5],c=r[6],u=r[7];var f=r[8],d=r[9],p=r[10],v=r[11];var m=r[12],g=r[13],y=r[14],_=r[15];i[0].setComponents(o-n,u-h,v-f,_-m).normalize();i[1].setComponents(o+n,u+h,v+f,_+m).normalize();i[2].setComponents(o+a,u+l,v+d,_+g).normalize();i[3].setComponents(o-a,u-l,v-d,_-g).normalize();i[4].setComponents(o-s,u-c,v-p,_-y).normalize();i[5].setComponents(o+s,u+c,v+p,_+y).normalize();return this},intersectsObject:function(){var e=new pa;return function t(i){var r=i.geometry;if(r.boundingSphere===null)r.computeBoundingSphere();e.copy(r.boundingSphere).applyMatrix4(i.matrixWorld);return this.intersectsSphere(e)}}(),intersectsSprite:function(){var e=new pa;return function t(i){e.center.set(0,0,0);e.radius=.7071067811865476;e.applyMatrix4(i.matrixWorld);return this.intersectsSphere(e)}}(),intersectsSphere:function e(t){var i=this.planes;var r=t.center;var n=-t.radius;for(var a=0;a<6;a++){var s=i[a].distanceToPoint(r);if(s<n){return false}}return true},intersectsBox:function(){var e=new ti,t=new ti;return function i(r){var n=this.planes;for(var a=0;a<6;a++){var s=n[a];e.x=s.normal.x>0?r.min.x:r.max.x;t.x=s.normal.x>0?r.max.x:r.min.x;e.y=s.normal.y>0?r.min.y:r.max.y;t.y=s.normal.y>0?r.max.y:r.min.y;e.z=s.normal.z>0?r.min.z:r.max.z;t.z=s.normal.z>0?r.max.z:r.min.z;var o=s.distanceToPoint(e);var h=s.distanceToPoint(t);if(o<0&&h<0){return false}}return true}}(),containsPoint:function e(t){var i=this.planes;for(var r=0;r<6;r++){if(i[r].distanceToPoint(t)<0){return false}}return true}});function ga(e,t,i){var r=new ma,n=new $t,a=new Kt,s=new Kt(i,i),o=new ti,h=new ti,l=1,c=2,u=(l|c)+1,f=new Array(u),d=new Array(u),p={};var v=[new ti(1,0,0),new ti(-1,0,0),new ti(0,0,1),new ti(0,0,-1),new ti(0,1,0),new ti(0,-1,0)];var m=[new ti(0,1,0),new ti(0,1,0),new ti(0,1,0),new ti(0,1,0),new ti(0,0,1),new ti(0,0,-1)];var g=[new ai,new ai,new ai,new ai,new ai,new ai];for(var y=0;y!==u;++y){var _=(y&l)!==0;var x=(y&c)!==0;var w=new ua({depthPacking:Jt,morphTargets:_,skinning:x});f[y]=w;var b=new fa({morphTargets:_,skinning:x});d[y]=b}var M=this;this.enabled=false;this.autoUpdate=true;this.needsUpdate=false;this.type=H;this.renderReverseSided=true;this.renderSingleSided=true;this.render=function(t,i,l){if(M.enabled===false)return;if(M.autoUpdate===false&&M.needsUpdate===false)return;if(t.length===0)return;var c=e.context;var u=e.state;u.disable(c.BLEND);u.buffers.color.setClear(1,1,1,1);u.buffers.depth.setTest(true);u.setScissorTest(false);var f;for(var d=0,p=t.length;d<p;d++){var y=t[d];var _=y.shadow;var x=y&&y.isPointLight;if(_===undefined){console.warn("THREE.WebGLShadowMap:",y,"has no shadow.");continue}var w=_.camera;a.copy(_.mapSize);a.min(s);if(x){var b=a.x;var T=a.y;g[0].set(b*2,T,b,T);g[1].set(0,T,b,T);g[2].set(b*3,T,b,T);g[3].set(b,T,b,T);g[4].set(b*3,0,b,T);g[5].set(b,0,b,T);a.x*=4;a.y*=2}if(_.map===null){var S={minFilter:qe,magFilter:qe,format:pt};_.map=new si(a.x,a.y,S);_.map.texture.name=y.name+".shadowMap";w.updateProjectionMatrix()}if(_.isSpotLightShadow){_.update(y)}var A=_.map;var L=_.matrix;h.setFromMatrixPosition(y.matrixWorld);w.position.copy(h);if(x){f=6;L.makeTranslation(-h.x,-h.y,-h.z)}else{f=1;o.setFromMatrixPosition(y.target.matrixWorld);w.lookAt(o);w.updateMatrixWorld();L.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);L.multiply(w.projectionMatrix);L.multiply(w.matrixWorldInverse)}e.setRenderTarget(A);e.clear();for(var C=0;C<f;C++){if(x){o.copy(w.position);o.add(v[C]);w.up.copy(m[C]);w.lookAt(o);w.updateMatrixWorld();var R=g[C];u.viewport(R)}n.multiplyMatrices(w.projectionMatrix,w.matrixWorldInverse);r.setFromMatrix(n);E(i,l,w,x)}}M.needsUpdate=false};function T(t,i,r,n,a,s){var o=t.geometry;var h=null;var u=f;var v=t.customDepthMaterial;if(r){u=d;v=t.customDistanceMaterial}if(!v){var m=false;if(i.morphTargets){if(o&&o.isBufferGeometry){m=o.morphAttributes&&o.morphAttributes.position&&o.morphAttributes.position.length>0}else if(o&&o.isGeometry){m=o.morphTargets&&o.morphTargets.length>0}}if(t.isSkinnedMesh&&i.skinning===false){console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t)}var g=t.isSkinnedMesh&&i.skinning;var y=0;if(m)y|=l;if(g)y|=c;h=u[y]}else{h=v}if(e.localClippingEnabled&&i.clipShadows===true&&i.clippingPlanes.length!==0){var _=h.uuid,x=i.uuid;var w=p[_];if(w===undefined){w={};p[_]=w}var b=w[x];if(b===undefined){b=h.clone();w[x]=b}h=b}h.visible=i.visible;h.wireframe=i.wireframe;var T=i.side;if(M.renderSingleSided&&T==Y){T=W}if(M.renderReverseSided){if(T===W)T=X;else if(T===X)T=W}h.side=T;h.clipShadows=i.clipShadows;h.clippingPlanes=i.clippingPlanes;h.clipIntersection=i.clipIntersection;h.wireframeLinewidth=i.wireframeLinewidth;h.linewidth=i.linewidth;if(r&&h.isMeshDistanceMaterial){h.referencePosition.copy(n);h.nearDistance=a;h.farDistance=s}return h}function E(i,n,a,s){if(i.visible===false)return;var o=i.layers.test(n.layers);if(o&&(i.isMesh||i.isLine||i.isPoints)){if(i.castShadow&&(!i.frustumCulled||r.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,i.matrixWorld);var l=t.update(i);var c=i.material;if(Array.isArray(c)){var u=l.groups;for(var f=0,d=u.length;f<d;f++){var p=u[f];var v=c[p.materialIndex];if(v&&v.visible){var m=T(i,v,s,h,a.near,a.far);e.renderBufferDirect(a,null,l,m,i,p)}}}else if(c.visible){var m=T(i,c,s,h,a.near,a.far);e.renderBufferDirect(a,null,l,m,i,null)}}}var g=i.children;for(var y=0,_=g.length;y<_;y++){E(g[y],n,a,s)}}}function ya(e){var t={};function i(t,i){var r=t.array;var n=t.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW;var a=e.createBuffer();e.bindBuffer(i,a);e.bufferData(i,r,n);t.onUploadCallback();var s=e.FLOAT;if(r instanceof Float32Array){s=e.FLOAT}else if(r instanceof Float64Array){console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array.")}else if(r instanceof Uint16Array){s=e.UNSIGNED_SHORT}else if(r instanceof Int16Array){s=e.SHORT}else if(r instanceof Uint32Array){s=e.UNSIGNED_INT}else if(r instanceof Int32Array){s=e.INT}else if(r instanceof Int8Array){s=e.BYTE}else if(r instanceof Uint8Array){s=e.UNSIGNED_BYTE}return{buffer:a,type:s,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}function r(t,i,r){var n=i.array;var a=i.updateRange;e.bindBuffer(r,t);if(i.dynamic===false){e.bufferData(r,n,e.STATIC_DRAW)}else if(a.count===-1){e.bufferSubData(r,0,n)}else if(a.count===0){console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually.")}else{e.bufferSubData(r,a.offset*n.BYTES_PER_ELEMENT,n.subarray(a.offset,a.offset+a.count));a.count=-1}}function n(e){if(e.isInterleavedBufferAttribute)e=e.data;return t[e.uuid]}function a(i){if(i.isInterleavedBufferAttribute)i=i.data;var r=t[i.uuid];if(r){e.deleteBuffer(r.buffer);delete t[i.uuid]}}function s(e,n){if(e.isInterleavedBufferAttribute)e=e.data;var a=t[e.uuid];if(a===undefined){t[e.uuid]=i(e,n)}else if(a.version<e.version){r(a.buffer,e,n);a.version=e.version}}return{get:n,remove:a,update:s}}function _a(e,t,i,r){this._x=e||0;this._y=t||0;this._z=i||0;this._order=r||_a.DefaultOrder}_a.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];_a.DefaultOrder="XYZ";Object.defineProperties(_a.prototype,{x:{get:function e(){return this._x},set:function e(t){this._x=t;this.onChangeCallback()}},y:{get:function e(){return this._y},set:function e(t){this._y=t;this.onChangeCallback()}},z:{get:function e(){return this._z},set:function e(t){this._z=t;this.onChangeCallback()}},order:{get:function e(){return this._order},set:function e(t){this._order=t;this.onChangeCallback()}}});Object.assign(_a.prototype,{isEuler:true,set:function e(t,i,r,n){this._x=t;this._y=i;this._z=r;this._order=n||this._order;this.onChangeCallback();return this},clone:function e(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function e(t){this._x=t._x;this._y=t._y;this._z=t._z;this._order=t._order;this.onChangeCallback();return this},setFromRotationMatrix:function e(t,i,r){var n=Qt.clamp;var a=t.elements;var s=a[0],o=a[4],h=a[8];var l=a[1],c=a[5],u=a[9];var f=a[2],d=a[6],p=a[10];i=i||this._order;if(i==="XYZ"){this._y=Math.asin(n(h,-1,1));if(Math.abs(h)<.99999){this._x=Math.atan2(-u,p);this._z=Math.atan2(-o,s)}else{this._x=Math.atan2(d,c);this._z=0}}else if(i==="YXZ"){this._x=Math.asin(-n(u,-1,1));if(Math.abs(u)<.99999){this._y=Math.atan2(h,p);this._z=Math.atan2(l,c)}else{this._y=Math.atan2(-f,s);this._z=0}}else if(i==="ZXY"){this._x=Math.asin(n(d,-1,1));if(Math.abs(d)<.99999){this._y=Math.atan2(-f,p);this._z=Math.atan2(-o,c)}else{this._y=0;this._z=Math.atan2(l,s)}}else if(i==="ZYX"){this._y=Math.asin(-n(f,-1,1));if(Math.abs(f)<.99999){this._x=Math.atan2(d,p);this._z=Math.atan2(l,s)}else{this._x=0;this._z=Math.atan2(-o,c)}}else if(i==="YZX"){this._z=Math.asin(n(l,-1,1));if(Math.abs(l)<.99999){this._x=Math.atan2(-u,c);this._y=Math.atan2(-f,s)}else{this._x=0;this._y=Math.atan2(h,p)}}else if(i==="XZY"){this._z=Math.asin(-n(o,-1,1));if(Math.abs(o)<.99999){this._x=Math.atan2(d,c);this._y=Math.atan2(h,s)}else{this._x=Math.atan2(-u,p);this._y=0}}else{console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+i)}this._order=i;if(r!==false)this.onChangeCallback();return this},setFromQuaternion:function(){var e=new $t;return function t(i,r,n){e.makeRotationFromQuaternion(i);return this.setFromRotationMatrix(e,r,n)}}(),setFromVector3:function e(t,i){return this.set(t.x,t.y,t.z,i||this._order)},reorder:function(){var e=new ei;return function t(i){e.setFromEuler(this);return this.setFromQuaternion(e,i)}}(),equals:function e(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function e(t){this._x=t[0];this._y=t[1];this._z=t[2];if(t[3]!==undefined)this._order=t[3];this.onChangeCallback();return this},toArray:function e(t,i){if(t===undefined)t=[];if(i===undefined)i=0;t[i]=this._x;t[i+1]=this._y;t[i+2]=this._z;t[i+3]=this._order;return t},toVector3:function e(t){if(t){return t.set(this._x,this._y,this._z)}else{return new ti(this._x,this._y,this._z)}},onChange:function e(t){this.onChangeCallback=t;return this},onChangeCallback:function e(){}});function xa(){this.mask=1|0}Object.assign(xa.prototype,{set:function e(t){this.mask=1<<t|0},enable:function e(t){this.mask|=1<<t|0},toggle:function e(t){this.mask^=1<<t|0},disable:function e(t){this.mask&=~(1<<t|0)},test:function e(t){return(this.mask&t.mask)!==0}});var wa=0;function ba(){Object.defineProperty(this,"id",{value:wa++});this.uuid=Qt.generateUUID();this.name="";this.type="Object3D";this.parent=null;this.children=[];this.up=ba.DefaultUp.clone();var e=new ti;var t=new _a;var i=new ei;var r=new ti(1,1,1);function n(){i.setFromEuler(t,false)}function a(){t.setFromQuaternion(i,undefined,false)}t.onChange(n);i.onChange(a);Object.defineProperties(this,{position:{enumerable:true,value:e},rotation:{enumerable:true,value:t},quaternion:{enumerable:true,value:i},scale:{enumerable:true,value:r},modelViewMatrix:{value:new $t},normalMatrix:{value:new ii}});this.matrix=new $t;this.matrixWorld=new $t;this.matrixAutoUpdate=ba.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=false;this.layers=new xa;this.visible=true;this.castShadow=false;this.receiveShadow=false;this.frustumCulled=true;this.renderOrder=0;this.userData={}}ba.DefaultUp=new ti(0,1,0);ba.DefaultMatrixAutoUpdate=true;Object.assign(ba.prototype,O.prototype,{isObject3D:true,onBeforeRender:function e(){},onAfterRender:function e(){},applyMatrix:function e(t){this.matrix.multiplyMatrices(t,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function e(t){this.quaternion.premultiply(t);return this},setRotationFromAxisAngle:function e(t,i){this.quaternion.setFromAxisAngle(t,i)},setRotationFromEuler:function e(t){this.quaternion.setFromEuler(t,true)},setRotationFromMatrix:function e(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function e(t){this.quaternion.copy(t)},rotateOnAxis:function(){var e=new ei;return function t(i,r){e.setFromAxisAngle(i,r);this.quaternion.multiply(e);return this}}(),rotateOnWorldAxis:function(){var e=new ei;return function t(i,r){e.setFromAxisAngle(i,r);this.quaternion.premultiply(e);return this}}(),rotateX:function(){var e=new ti(1,0,0);return function t(i){return this.rotateOnAxis(e,i)}}(),rotateY:function(){var e=new ti(0,1,0);return function t(i){return this.rotateOnAxis(e,i)}}(),rotateZ:function(){var e=new ti(0,0,1);return function t(i){return this.rotateOnAxis(e,i)}}(),translateOnAxis:function(){var e=new ti;return function t(i,r){e.copy(i).applyQuaternion(this.quaternion);this.position.add(e.multiplyScalar(r));return this}}(),translateX:function(){var e=new ti(1,0,0);return function t(i){return this.translateOnAxis(e,i)}}(),translateY:function(){var e=new ti(0,1,0);return function t(i){return this.translateOnAxis(e,i)}}(),translateZ:function(){var e=new ti(0,0,1);return function t(i){return this.translateOnAxis(e,i)}}(),localToWorld:function e(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new $t;return function t(i){return i.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new $t;var t=new ti;return function i(r,n,a){if(r.isVector3){t.copy(r)}else{t.set(r,n,a)}if(this.isCamera){e.lookAt(this.position,t,this.up)}else{e.lookAt(t,this.position,this.up)}this.quaternion.setFromRotationMatrix(e)}}(),add:function e(t){if(arguments.length>1){for(var i=0;i<arguments.length;i++){this.add(arguments[i])}return this}if(t===this){console.error("THREE.Object3D.add: object can't be added as a child of itself.",t);return this}if(t&&t.isObject3D){if(t.parent!==null){t.parent.remove(t)}t.parent=this;t.dispatchEvent({type:"added"});this.children.push(t)}else{console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t)}return this},remove:function e(t){if(arguments.length>1){for(var i=0;i<arguments.length;i++){this.remove(arguments[i])}return this}var r=this.children.indexOf(t);if(r!==-1){t.parent=null;t.dispatchEvent({type:"removed"});this.children.splice(r,1)}return this},getObjectById:function e(t){return this.getObjectByProperty("id",t)},getObjectByName:function e(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function e(t,i){if(this[t]===i)return this;for(var r=0,n=this.children.length;r<n;r++){var a=this.children[r];var s=a.getObjectByProperty(t,i);if(s!==undefined){return s}}return undefined},getWorldPosition:function e(t){var i=t||new ti;this.updateMatrixWorld(true);return i.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new ti;var t=new ti;return function i(r){var n=r||new ei;this.updateMatrixWorld(true);this.matrixWorld.decompose(e,n,t);return n}}(),getWorldRotation:function(){var e=new ei;return function t(i){var r=i||new _a;this.getWorldQuaternion(e);return r.setFromQuaternion(e,this.rotation.order,false)}}(),getWorldScale:function(){var e=new ti;var t=new ei;return function i(r){var n=r||new ti;this.updateMatrixWorld(true);this.matrixWorld.decompose(e,t,n);return n}}(),getWorldDirection:function(){var e=new ei;return function t(i){var r=i||new ti;this.getWorldQuaternion(e);return r.set(0,0,1).applyQuaternion(e)}}(),raycast:function e(){},traverse:function e(t){t(this);var i=this.children;for(var r=0,n=i.length;r<n;r++){i[r].traverse(t)}},traverseVisible:function e(t){if(this.visible===false)return;t(this);var i=this.children;for(var r=0,n=i.length;r<n;r++){i[r].traverseVisible(t)}},traverseAncestors:function e(t){var i=this.parent;if(i!==null){t(i);i.traverseAncestors(t)}},updateMatrix:function e(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=true},updateMatrixWorld:function e(t){if(this.matrixAutoUpdate)this.updateMatrix();if(this.matrixWorldNeedsUpdate||t){if(this.parent===null){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}this.matrixWorldNeedsUpdate=false;t=true}var i=this.children;for(var r=0,n=i.length;r<n;r++){i[r].updateMatrixWorld(t)}},toJSON:function e(t){var i=t===undefined||typeof t==="string";var r={};if(i){t={geometries:{},materials:{},textures:{},images:{}};r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"}}var n={};n.uuid=this.uuid;n.type=this.type;if(this.name!=="")n.name=this.name;if(this.castShadow===true)n.castShadow=true;if(this.receiveShadow===true)n.receiveShadow=true;if(this.visible===false)n.visible=false;if(JSON.stringify(this.userData)!=="{}")n.userData=this.userData;n.matrix=this.matrix.toArray();function a(e,i){if(e[i.uuid]===undefined){e[i.uuid]=i.toJSON(t)}return i.uuid}if(this.geometry!==undefined){n.geometry=a(t.geometries,this.geometry)}if(this.material!==undefined){if(Array.isArray(this.material)){var s=[];for(var o=0,h=this.material.length;o<h;o++){s.push(a(t.materials,this.material[o]))}n.material=s}else{n.material=a(t.materials,this.material)}}if(this.children.length>0){n.children=[];for(var o=0;o<this.children.length;o++){n.children.push(this.children[o].toJSON(t).object)}}if(i){var l=d(t.geometries);var c=d(t.materials);var u=d(t.textures);var f=d(t.images);if(l.length>0)r.geometries=l;if(c.length>0)r.materials=c;if(u.length>0)r.textures=u;if(f.length>0)r.images=f}r.object=n;return r;function d(e){var t=[];for(var i in e){var r=e[i];delete r.metadata;t.push(r)}return t}},clone:function e(t){return(new this.constructor).copy(this,t)},copy:function e(t,i){if(i===undefined)i=true;this.name=t.name;this.up.copy(t.up);this.position.copy(t.position);this.quaternion.copy(t.quaternion);this.scale.copy(t.scale);this.matrix.copy(t.matrix);this.matrixWorld.copy(t.matrixWorld);this.matrixAutoUpdate=t.matrixAutoUpdate;this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate;this.layers.mask=t.layers.mask;this.visible=t.visible;this.castShadow=t.castShadow;this.receiveShadow=t.receiveShadow;this.frustumCulled=t.frustumCulled;this.renderOrder=t.renderOrder;this.userData=JSON.parse(JSON.stringify(t.userData));if(i===true){for(var r=0;r<t.children.length;r++){var n=t.children[r];this.add(n.clone())}}return this}});function Ma(){ba.call(this);this.type="Camera";this.matrixWorldInverse=new $t;this.projectionMatrix=new $t}Ma.prototype=Object.assign(Object.create(ba.prototype),{constructor:Ma,isCamera:true,copy:function e(t,i){ba.prototype.copy.call(this,t,i);this.matrixWorldInverse.copy(t.matrixWorldInverse);this.projectionMatrix.copy(t.projectionMatrix);return this},getWorldDirection:function(){var e=new ei;return function t(i){var r=i||new ti;this.getWorldQuaternion(e);return r.set(0,0,-1).applyQuaternion(e)}}(),updateMatrixWorld:function e(t){ba.prototype.updateMatrixWorld.call(this,t);this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function e(){return(new this.constructor).copy(this)}});function Ta(e,t,i,r,n,a){Ma.call(this);this.type="OrthographicCamera";this.zoom=1;this.view=null;this.left=e;this.right=t;this.top=i;this.bottom=r;this.near=n!==undefined?n:.1;this.far=a!==undefined?a:2e3;this.updateProjectionMatrix()}Ta.prototype=Object.assign(Object.create(Ma.prototype),{constructor:Ta,isOrthographicCamera:true,copy:function e(t,i){Ma.prototype.copy.call(this,t,i);this.left=t.left;this.right=t.right;this.top=t.top;this.bottom=t.bottom;this.near=t.near;this.far=t.far;this.zoom=t.zoom;this.view=t.view===null?null:Object.assign({},t.view);return this},setViewOffset:function e(t,i,r,n,a,s){if(this.view===null){this.view={enabled:true,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}}this.view.enabled=true;this.view.fullWidth=t;this.view.fullHeight=i;this.view.offsetX=r;this.view.offsetY=n;this.view.width=a;this.view.height=s;this.updateProjectionMatrix()},clearViewOffset:function e(){if(this.view!==null){this.view.enabled=false}this.updateProjectionMatrix()},updateProjectionMatrix:function e(){var t=(this.right-this.left)/(2*this.zoom);var i=(this.top-this.bottom)/(2*this.zoom);var r=(this.right+this.left)/2;var n=(this.top+this.bottom)/2;var a=r-t;var s=r+t;var o=n+i;var h=n-i;if(this.view!==null&&this.view.enabled){var l=this.zoom/(this.view.width/this.view.fullWidth);var c=this.zoom/(this.view.height/this.view.fullHeight);var u=(this.right-this.left)/this.view.width;var f=(this.top-this.bottom)/this.view.height;a+=u*(this.view.offsetX/l);s=a+u*(this.view.width/l);o-=f*(this.view.offsetY/c);h=o-f*(this.view.height/c)}this.projectionMatrix.makeOrthographic(a,s,o,h,this.near,this.far)},toJSON:function e(t){var i=ba.prototype.toJSON.call(this,t);i.object.zoom=this.zoom;i.object.left=this.left;i.object.right=this.right;i.object.top=this.top;i.object.bottom=this.bottom;i.object.near=this.near;i.object.far=this.far;if(this.view!==null)i.object.view=Object.assign({},this.view);return i}});function Ea(e,t,i,r,n,a){this.a=e;this.b=t;this.c=i;this.normal=r&&r.isVector3?r:new ti;this.vertexNormals=Array.isArray(r)?r:[];this.color=n&&n.isColor?n:new Ki;this.vertexColors=Array.isArray(n)?n:[];this.materialIndex=a!==undefined?a:0}Object.assign(Ea.prototype,{clone:function e(){return(new this.constructor).copy(this)},copy:function e(t){this.a=t.a;this.b=t.b;this.c=t.c;this.normal.copy(t.normal);this.color.copy(t.color);this.materialIndex=t.materialIndex;for(var i=0,r=t.vertexNormals.length;i<r;i++){this.vertexNormals[i]=t.vertexNormals[i].clone()}for(var i=0,r=t.vertexColors.length;i<r;i++){this.vertexColors[i]=t.vertexColors[i].clone()}return this}});var Sa=0;function Aa(){Object.defineProperty(this,"id",{value:Sa+=2});this.uuid=Qt.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingBox=null;this.boundingSphere=null;this.elementsNeedUpdate=false;this.verticesNeedUpdate=false;this.uvsNeedUpdate=false;this.normalsNeedUpdate=false;this.colorsNeedUpdate=false;this.lineDistancesNeedUpdate=false;this.groupsNeedUpdate=false}Object.assign(Aa.prototype,O.prototype,{isGeometry:true,applyMatrix:function e(t){var i=(new ii).getNormalMatrix(t);for(var r=0,n=this.vertices.length;r<n;r++){var a=this.vertices[r];a.applyMatrix4(t)}for(var r=0,n=this.faces.length;r<n;r++){var s=this.faces[r];s.normal.applyMatrix3(i).normalize();for(var o=0,h=s.vertexNormals.length;o<h;o++){s.vertexNormals[o].applyMatrix3(i).normalize()}}if(this.boundingBox!==null){this.computeBoundingBox()}if(this.boundingSphere!==null){this.computeBoundingSphere()}this.verticesNeedUpdate=true;this.normalsNeedUpdate=true;return this},rotateX:function(){var e=new $t;return function t(i){e.makeRotationX(i);this.applyMatrix(e);return this}}(),rotateY:function(){var e=new $t;return function t(i){e.makeRotationY(i);this.applyMatrix(e);return this}}(),rotateZ:function(){var e=new $t;return function t(i){e.makeRotationZ(i);this.applyMatrix(e);return this}}(),translate:function(){var e=new $t;return function t(i,r,n){e.makeTranslation(i,r,n);this.applyMatrix(e);return this}}(),scale:function(){var e=new $t;return function t(i,r,n){e.makeScale(i,r,n);this.applyMatrix(e);return this}}(),lookAt:function(){var e=new ba;return function t(i){e.lookAt(i);e.updateMatrix();this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function e(t){var i=this;var r=t.index!==null?t.index.array:undefined;var n=t.attributes;var a=n.position.array;var s=n.normal!==undefined?n.normal.array:undefined;var o=n.color!==undefined?n.color.array:undefined;var h=n.uv!==undefined?n.uv.array:undefined;var l=n.uv2!==undefined?n.uv2.array:undefined;if(l!==undefined)this.faceVertexUvs[1]=[];var c=[];var u=[];var f=[];for(var d=0,p=0;d<a.length;d+=3,p+=2){i.vertices.push(new ti(a[d],a[d+1],a[d+2]));if(s!==undefined){c.push(new ti(s[d],s[d+1],s[d+2]))}if(o!==undefined){i.colors.push(new Ki(o[d],o[d+1],o[d+2]))}if(h!==undefined){u.push(new Kt(h[p],h[p+1]))}if(l!==undefined){f.push(new Kt(l[p],l[p+1]))}}function v(e,t,r,n){var a=s!==undefined?[c[e].clone(),c[t].clone(),c[r].clone()]:[];var d=o!==undefined?[i.colors[e].clone(),i.colors[t].clone(),i.colors[r].clone()]:[];var p=new Ea(e,t,r,a,d,n);i.faces.push(p);if(h!==undefined){i.faceVertexUvs[0].push([u[e].clone(),u[t].clone(),u[r].clone()])}if(l!==undefined){i.faceVertexUvs[1].push([f[e].clone(),f[t].clone(),f[r].clone()])}}var m=t.groups;if(m.length>0){for(var d=0;d<m.length;d++){var g=m[d];var y=g.start;var _=g.count;for(var p=y,x=y+_;p<x;p+=3){if(r!==undefined){v(r[p],r[p+1],r[p+2],g.materialIndex)}else{v(p,p+1,p+2,g.materialIndex)}}}}else{if(r!==undefined){for(var d=0;d<r.length;d+=3){v(r[d],r[d+1],r[d+2])}}else{for(var d=0;d<a.length/3;d+=3){v(d,d+1,d+2)}}}this.computeFaceNormals();if(t.boundingBox!==null){this.boundingBox=t.boundingBox.clone()}if(t.boundingSphere!==null){this.boundingSphere=t.boundingSphere.clone()}return this},center:function e(){this.computeBoundingBox();var t=this.boundingBox.getCenter().negate();this.translate(t.x,t.y,t.z);return t},normalize:function e(){this.computeBoundingSphere();var t=this.boundingSphere.center;var i=this.boundingSphere.radius;var r=i===0?1:1/i;var n=new $t;n.set(r,0,0,-r*t.x,0,r,0,-r*t.y,0,0,r,-r*t.z,0,0,0,1);this.applyMatrix(n);return this},computeFaceNormals:function e(){var t=new ti,i=new ti;for(var r=0,n=this.faces.length;r<n;r++){var a=this.faces[r];var s=this.vertices[a.a];var o=this.vertices[a.b];var h=this.vertices[a.c];t.subVectors(h,o);i.subVectors(s,o);t.cross(i);t.normalize();a.normal.copy(t)}},computeVertexNormals:function e(t){if(t===undefined)t=true;var i,r,n,a,s,o;o=new Array(this.vertices.length);for(i=0,r=this.vertices.length;i<r;i++){o[i]=new ti}if(t){var h,l,c;var u=new ti,f=new ti;for(n=0,a=this.faces.length;n<a;n++){s=this.faces[n];h=this.vertices[s.a];l=this.vertices[s.b];c=this.vertices[s.c];u.subVectors(c,l);f.subVectors(h,l);u.cross(f);o[s.a].add(u);o[s.b].add(u);o[s.c].add(u)}}else{this.computeFaceNormals();for(n=0,a=this.faces.length;n<a;n++){s=this.faces[n];o[s.a].add(s.normal);o[s.b].add(s.normal);o[s.c].add(s.normal)}}for(i=0,r=this.vertices.length;i<r;i++){o[i].normalize()}for(n=0,a=this.faces.length;n<a;n++){s=this.faces[n];var d=s.vertexNormals;if(d.length===3){d[0].copy(o[s.a]);d[1].copy(o[s.b]);d[2].copy(o[s.c])}else{d[0]=o[s.a].clone();d[1]=o[s.b].clone();d[2]=o[s.c].clone()}}if(this.faces.length>0){this.normalsNeedUpdate=true}},computeFlatVertexNormals:function e(){var t,i,r;this.computeFaceNormals();for(t=0,i=this.faces.length;t<i;t++){r=this.faces[t];var n=r.vertexNormals;if(n.length===3){n[0].copy(r.normal);n[1].copy(r.normal);n[2].copy(r.normal)}else{n[0]=r.normal.clone();n[1]=r.normal.clone();n[2]=r.normal.clone()}}if(this.faces.length>0){this.normalsNeedUpdate=true}},computeMorphNormals:function e(){var t,i,r,n,a;for(r=0,n=this.faces.length;r<n;r++){a=this.faces[r];if(!a.__originalFaceNormal){a.__originalFaceNormal=a.normal.clone()}else{a.__originalFaceNormal.copy(a.normal)}if(!a.__originalVertexNormals)a.__originalVertexNormals=[];for(t=0,i=a.vertexNormals.length;t<i;t++){if(!a.__originalVertexNormals[t]){a.__originalVertexNormals[t]=a.vertexNormals[t].clone()}else{a.__originalVertexNormals[t].copy(a.vertexNormals[t])}}}var s=new Aa;s.faces=this.faces;for(t=0,i=this.morphTargets.length;t<i;t++){if(!this.morphNormals[t]){this.morphNormals[t]={};this.morphNormals[t].faceNormals=[];this.morphNormals[t].vertexNormals=[];var o=this.morphNormals[t].faceNormals;var h=this.morphNormals[t].vertexNormals;var l,c;for(r=0,n=this.faces.length;r<n;r++){l=new ti;c={a:new ti,b:new ti,c:new ti};o.push(l);h.push(c)}}var u=this.morphNormals[t];s.vertices=this.morphTargets[t].vertices;s.computeFaceNormals();s.computeVertexNormals();var l,c;for(r=0,n=this.faces.length;r<n;r++){a=this.faces[r];l=u.faceNormals[r];c=u.vertexNormals[r];l.copy(a.normal);c.a.copy(a.vertexNormals[0]);c.b.copy(a.vertexNormals[1]);c.c.copy(a.vertexNormals[2])}}for(r=0,n=this.faces.length;r<n;r++){a=this.faces[r];a.normal=a.__originalFaceNormal;a.vertexNormals=a.__originalVertexNormals}},computeLineDistances:function e(){var t=0;var i=this.vertices;for(var r=0,n=i.length;r<n;r++){if(r>0){t+=i[r].distanceTo(i[r-1])}this.lineDistances[r]=t}},computeBoundingBox:function e(){if(this.boundingBox===null){this.boundingBox=new da}this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function e(){if(this.boundingSphere===null){this.boundingSphere=new pa}this.boundingSphere.setFromPoints(this.vertices)},merge:function e(t,i,r){if(!(t&&t.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);return}var n,a=this.vertices.length,s=this.vertices,o=t.vertices,h=this.faces,l=t.faces,c=this.faceVertexUvs[0],u=t.faceVertexUvs[0],f=this.colors,d=t.colors;if(r===undefined)r=0;if(i!==undefined){n=(new ii).getNormalMatrix(i)}for(var p=0,v=o.length;p<v;p++){var m=o[p];var g=m.clone();if(i!==undefined)g.applyMatrix4(i);s.push(g)}for(var p=0,v=d.length;p<v;p++){f.push(d[p].clone())}for(p=0,v=l.length;p<v;p++){var y=l[p],_,x,w,b=y.vertexNormals,M=y.vertexColors;_=new Ea(y.a+a,y.b+a,y.c+a);_.normal.copy(y.normal);if(n!==undefined){_.normal.applyMatrix3(n).normalize()}for(var T=0,E=b.length;T<E;T++){x=b[T].clone();if(n!==undefined){x.applyMatrix3(n).normalize()}_.vertexNormals.push(x)}_.color.copy(y.color);for(var T=0,E=M.length;T<E;T++){w=M[T];_.vertexColors.push(w.clone())}_.materialIndex=y.materialIndex+r;h.push(_)}for(p=0,v=u.length;p<v;p++){var S=u[p],A=[];if(S===undefined){continue}for(var T=0,E=S.length;T<E;T++){A.push(S[T].clone())}c.push(A)}},mergeMesh:function e(t){if(!(t&&t.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t);return}t.matrixAutoUpdate&&t.updateMatrix();this.merge(t.geometry,t.matrix)},mergeVertices:function e(){var t={};var i=[],r=[];var n,a;var s=4;var o=Math.pow(10,s);var h,l,c;var u,f,d;for(h=0,l=this.vertices.length;h<l;h++){n=this.vertices[h];a=Math.round(n.x*o)+"_"+Math.round(n.y*o)+"_"+Math.round(n.z*o);if(t[a]===undefined){t[a]=h;i.push(this.vertices[h]);r[h]=i.length-1}else{r[h]=r[t[a]]}}var p=[];for(h=0,l=this.faces.length;h<l;h++){c=this.faces[h];c.a=r[c.a];c.b=r[c.b];c.c=r[c.c];u=[c.a,c.b,c.c];for(var v=0;v<3;v++){if(u[v]===u[(v+1)%3]){p.push(h);break}}}for(h=p.length-1;h>=0;h--){var m=p[h];this.faces.splice(m,1);for(f=0,d=this.faceVertexUvs.length;f<d;f++){this.faceVertexUvs[f].splice(m,1)}}var g=this.vertices.length-i.length;this.vertices=i;return g},setFromPoints:function e(t){this.vertices=[];for(var i=0,r=t.length;i<r;i++){var n=t[i];this.vertices.push(new ti(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function e(){var t=this.faces;var i=t.length;for(var r=0;r<i;r++){t[r]._id=r}function n(e,t){return e.materialIndex-t.materialIndex}t.sort(n);var a=this.faceVertexUvs[0];var s=this.faceVertexUvs[1];var o,h;if(a&&a.length===i)o=[];if(s&&s.length===i)h=[];for(var r=0;r<i;r++){var l=t[r]._id;if(o)o.push(a[l]);if(h)h.push(s[l])}if(o)this.faceVertexUvs[0]=o;if(h)this.faceVertexUvs[1]=h},toJSON:function e(){var t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};t.uuid=this.uuid;t.type=this.type;if(this.name!=="")t.name=this.name;if(this.parameters!==undefined){var i=this.parameters;for(var r in i){if(i[r]!==undefined)t[r]=i[r]}return t}var n=[];for(var a=0;a<this.vertices.length;a++){var s=this.vertices[a];n.push(s.x,s.y,s.z)}var o=[];var h=[];var l={};var c=[];var u={};var f=[];var d={};for(var a=0;a<this.faces.length;a++){var p=this.faces[a];var v=true;var m=false;var g=this.faceVertexUvs[0][a]!==undefined;var y=p.normal.length()>0;var _=p.vertexNormals.length>0;var x=p.color.r!==1||p.color.g!==1||p.color.b!==1;var w=p.vertexColors.length>0;var b=0;b=S(b,0,0);b=S(b,1,v);b=S(b,2,m);b=S(b,3,g);b=S(b,4,y);b=S(b,5,_);b=S(b,6,x);b=S(b,7,w);o.push(b);o.push(p.a,p.b,p.c);o.push(p.materialIndex);if(g){var M=this.faceVertexUvs[0][a];o.push(C(M[0]),C(M[1]),C(M[2]))}if(y){o.push(A(p.normal))}if(_){var T=p.vertexNormals;o.push(A(T[0]),A(T[1]),A(T[2]))}if(x){o.push(L(p.color))}if(w){var E=p.vertexColors;o.push(L(E[0]),L(E[1]),L(E[2]))}}function S(e,t,i){return i?e|1<<t:e&~(1<<t)}function A(e){var t=e.x.toString()+e.y.toString()+e.z.toString();if(l[t]!==undefined){return l[t]}l[t]=h.length/3;h.push(e.x,e.y,e.z);return l[t]}function L(e){var t=e.r.toString()+e.g.toString()+e.b.toString();if(u[t]!==undefined){return u[t]}u[t]=c.length;c.push(e.getHex());return u[t]}function C(e){var t=e.x.toString()+e.y.toString();if(d[t]!==undefined){return d[t]}d[t]=f.length/2;f.push(e.x,e.y);return d[t]}t.data={};t.data.vertices=n;t.data.normals=h;if(c.length>0)t.data.colors=c;if(f.length>0)t.data.uvs=[f];t.data.faces=o;return t},clone:function e(){return(new Aa).copy(this)},copy:function e(t){var i,r,n,a,s,o;this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingBox=null;this.boundingSphere=null;this.name=t.name;var h=t.vertices;for(i=0,r=h.length;i<r;i++){this.vertices.push(h[i].clone())}var l=t.colors;for(i=0,r=l.length;i<r;i++){this.colors.push(l[i].clone())}var c=t.faces;for(i=0,r=c.length;i<r;i++){this.faces.push(c[i].clone())}for(i=0,r=t.faceVertexUvs.length;i<r;i++){var u=t.faceVertexUvs[i];if(this.faceVertexUvs[i]===undefined){this.faceVertexUvs[i]=[]}for(n=0,a=u.length;n<a;n++){var f=u[n],d=[];for(s=0,o=f.length;s<o;s++){var p=f[s];d.push(p.clone())}this.faceVertexUvs[i].push(d)}}var v=t.morphTargets;for(i=0,r=v.length;i<r;i++){var m={};m.name=v[i].name;if(v[i].vertices!==undefined){m.vertices=[];for(n=0,a=v[i].vertices.length;n<a;n++){m.vertices.push(v[i].vertices[n].clone())}}if(v[i].normals!==undefined){m.normals=[];for(n=0,a=v[i].normals.length;n<a;n++){m.normals.push(v[i].normals[n].clone())}}this.morphTargets.push(m)}var g=t.morphNormals;for(i=0,r=g.length;i<r;i++){var y={};if(g[i].vertexNormals!==undefined){y.vertexNormals=[];for(n=0,a=g[i].vertexNormals.length;n<a;n++){var _=g[i].vertexNormals[n];var x={};x.a=_.a.clone();x.b=_.b.clone();x.c=_.c.clone();y.vertexNormals.push(x)}}if(g[i].faceNormals!==undefined){y.faceNormals=[];for(n=0,a=g[i].faceNormals.length;n<a;n++){y.faceNormals.push(g[i].faceNormals[n].clone())}}this.morphNormals.push(y)}var w=t.skinWeights;for(i=0,r=w.length;i<r;i++){this.skinWeights.push(w[i].clone())}var b=t.skinIndices;for(i=0,r=b.length;i<r;i++){this.skinIndices.push(b[i].clone())}var M=t.lineDistances;for(i=0,r=M.length;i<r;i++){this.lineDistances.push(M[i])}var T=t.boundingBox;if(T!==null){this.boundingBox=T.clone()}var E=t.boundingSphere;if(E!==null){this.boundingSphere=E.clone()}this.elementsNeedUpdate=t.elementsNeedUpdate;this.verticesNeedUpdate=t.verticesNeedUpdate;this.uvsNeedUpdate=t.uvsNeedUpdate;this.normalsNeedUpdate=t.normalsNeedUpdate;this.colorsNeedUpdate=t.colorsNeedUpdate;this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate;this.groupsNeedUpdate=t.groupsNeedUpdate;return this},dispose:function e(){this.dispatchEvent({type:"dispose"})}});function La(e,t,i){if(Array.isArray(e)){throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.")}this.uuid=Qt.generateUUID();this.name="";this.array=e;this.itemSize=t;this.count=e!==undefined?e.length/t:0;this.normalized=i===true;this.dynamic=false;this.updateRange={offset:0,count:-1};this.onUploadCallback=function(){};this.version=0}Object.defineProperty(La.prototype,"needsUpdate",{set:function e(t){if(t===true)this.version++}});Object.assign(La.prototype,{isBufferAttribute:true,setArray:function e(t){if(Array.isArray(t)){throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.")}this.count=t!==undefined?t.length/this.itemSize:0;this.array=t},setDynamic:function e(t){this.dynamic=t;return this},copy:function e(t){this.array=new t.array.constructor(t.array);this.itemSize=t.itemSize;this.count=t.count;this.normalized=t.normalized;this.dynamic=t.dynamic;return this},copyAt:function e(t,i,r){t*=this.itemSize;r*=i.itemSize;for(var n=0,a=this.itemSize;n<a;n++){this.array[t+n]=i.array[r+n]}return this},copyArray:function e(t){this.array.set(t);return this},copyColorsArray:function e(t){var i=this.array,r=0;for(var n=0,a=t.length;n<a;n++){var s=t[n];if(s===undefined){console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n);s=new Ki}i[r++]=s.r;i[r++]=s.g;i[r++]=s.b}return this},copyIndicesArray:function e(t){var i=this.array,r=0;for(var n=0,a=t.length;n<a;n++){var s=t[n];i[r++]=s.a;i[r++]=s.b;i[r++]=s.c}return this},copyVector2sArray:function e(t){var i=this.array,r=0;for(var n=0,a=t.length;n<a;n++){var s=t[n];if(s===undefined){console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n);s=new Kt}i[r++]=s.x;i[r++]=s.y}return this},copyVector3sArray:function e(t){var i=this.array,r=0;for(var n=0,a=t.length;n<a;n++){var s=t[n];if(s===undefined){console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n);s=new ti}i[r++]=s.x;i[r++]=s.y;i[r++]=s.z}return this},copyVector4sArray:function e(t){var i=this.array,r=0;for(var n=0,a=t.length;n<a;n++){var s=t[n];if(s===undefined){console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n);s=new ai}i[r++]=s.x;i[r++]=s.y;i[r++]=s.z;i[r++]=s.w}return this},set:function e(t,i){if(i===undefined)i=0;this.array.set(t,i);return this},getX:function e(t){return this.array[t*this.itemSize]},setX:function e(t,i){this.array[t*this.itemSize]=i;return this},getY:function e(t){return this.array[t*this.itemSize+1]},setY:function e(t,i){this.array[t*this.itemSize+1]=i;return this},getZ:function e(t){return this.array[t*this.itemSize+2]},setZ:function e(t,i){this.array[t*this.itemSize+2]=i;return this},getW:function e(t){return this.array[t*this.itemSize+3]},setW:function e(t,i){this.array[t*this.itemSize+3]=i;return this},setXY:function e(t,i,r){t*=this.itemSize;this.array[t+0]=i;this.array[t+1]=r;return this},setXYZ:function e(t,i,r,n){t*=this.itemSize;this.array[t+0]=i;this.array[t+1]=r;this.array[t+2]=n;return this},setXYZW:function e(t,i,r,n,a){t*=this.itemSize;this.array[t+0]=i;this.array[t+1]=r;this.array[t+2]=n;this.array[t+3]=a;return this},onUpload:function e(t){this.onUploadCallback=t;return this},clone:function e(){return new this.constructor(this.array,this.itemSize).copy(this)}});function Ca(e,t,i){La.call(this,new Int8Array(e),t,i)}Ca.prototype=Object.create(La.prototype);Ca.prototype.constructor=Ca;function Ra(e,t,i){La.call(this,new Uint8Array(e),t,i)}Ra.prototype=Object.create(La.prototype);Ra.prototype.constructor=Ra;function Ia(e,t,i){La.call(this,new Uint8ClampedArray(e),t,i)}Ia.prototype=Object.create(La.prototype);Ia.prototype.constructor=Ia;function Pa(e,t,i){La.call(this,new Int16Array(e),t,i)}Pa.prototype=Object.create(La.prototype);Pa.prototype.constructor=Pa;function Oa(e,t,i){La.call(this,new Uint16Array(e),t,i)}Oa.prototype=Object.create(La.prototype);Oa.prototype.constructor=Oa;function ka(e,t,i){La.call(this,new Int32Array(e),t,i)}ka.prototype=Object.create(La.prototype);ka.prototype.constructor=ka;function Na(e,t,i){La.call(this,new Uint32Array(e),t,i)}Na.prototype=Object.create(La.prototype);Na.prototype.constructor=Na;function za(e,t,i){La.call(this,new Float32Array(e),t,i)}za.prototype=Object.create(La.prototype);za.prototype.constructor=za;function Ba(e,t,i){La.call(this,new Float64Array(e),t,i)}Ba.prototype=Object.create(La.prototype);Ba.prototype.constructor=Ba;function Ua(){this.indices=[];this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=[];this.skinIndices=[];this.boundingBox=null;this.boundingSphere=null;this.verticesNeedUpdate=false;this.normalsNeedUpdate=false;this.colorsNeedUpdate=false;this.uvsNeedUpdate=false;this.groupsNeedUpdate=false}Object.assign(Ua.prototype,{computeGroups:function e(t){var i;var r=[];var n=undefined;var a=t.faces;for(var s=0;s<a.length;s++){var o=a[s];if(o.materialIndex!==n){n=o.materialIndex;if(i!==undefined){i.count=s*3-i.start;r.push(i)}i={start:s*3,materialIndex:n}}}if(i!==undefined){i.count=s*3-i.start;r.push(i)}this.groups=r},fromGeometry:function e(t){var i=t.faces;var r=t.vertices;var n=t.faceVertexUvs;var a=n[0]&&n[0].length>0;var s=n[1]&&n[1].length>0;var o=t.morphTargets;var h=o.length;var l;if(h>0){l=[];for(var c=0;c<h;c++){l[c]=[]}this.morphTargets.position=l}var u=t.morphNormals;var f=u.length;var d;if(f>0){d=[];for(var c=0;c<f;c++){d[c]=[]}this.morphTargets.normal=d}var p=t.skinIndices;var v=t.skinWeights;var m=p.length===r.length;var g=v.length===r.length;for(var c=0;c<i.length;c++){var y=i[c];this.vertices.push(r[y.a],r[y.b],r[y.c]);var _=y.vertexNormals;if(_.length===3){this.normals.push(_[0],_[1],_[2])}else{var x=y.normal;this.normals.push(x,x,x)}var w=y.vertexColors;if(w.length===3){this.colors.push(w[0],w[1],w[2])}else{var b=y.color;this.colors.push(b,b,b)}if(a===true){var M=n[0][c];if(M!==undefined){this.uvs.push(M[0],M[1],M[2])}else{console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c);this.uvs.push(new Kt,new Kt,new Kt)}}if(s===true){var M=n[1][c];if(M!==undefined){this.uvs2.push(M[0],M[1],M[2])}else{console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c);this.uvs2.push(new Kt,new Kt,new Kt)}}for(var T=0;T<h;T++){var E=o[T].vertices;l[T].push(E[y.a],E[y.b],E[y.c])}for(var T=0;T<f;T++){var S=u[T].vertexNormals[c];d[T].push(S.a,S.b,S.c)}if(m){this.skinIndices.push(p[y.a],p[y.b],p[y.c])}if(g){this.skinWeights.push(v[y.a],v[y.b],v[y.c])}}this.computeGroups(t);this.verticesNeedUpdate=t.verticesNeedUpdate;this.normalsNeedUpdate=t.normalsNeedUpdate;this.colorsNeedUpdate=t.colorsNeedUpdate;this.uvsNeedUpdate=t.uvsNeedUpdate;this.groupsNeedUpdate=t.groupsNeedUpdate;return this}});function Da(e){if(e.length===0)return-Infinity;var t=e[0];for(var i=1,r=e.length;i<r;++i){if(e[i]>t)t=e[i]}return t}var Fa=1;function ja(){Object.defineProperty(this,"id",{value:Fa+=2});this.uuid=Qt.generateUUID();this.name="";this.type="BufferGeometry";this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingBox=null;this.boundingSphere=null;this.drawRange={start:0,count:Infinity}}Object.assign(ja.prototype,O.prototype,{isBufferGeometry:true,getIndex:function e(){return this.index},setIndex:function e(t){if(Array.isArray(t)){this.index=new(Da(t)>65535?Na:Oa)(t,1)}else{this.index=t}},addAttribute:function e(t,i){if(!(i&&i.isBufferAttribute)&&!(i&&i.isInterleavedBufferAttribute)){console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).");this.addAttribute(t,new La(arguments[1],arguments[2]));return}if(t==="index"){console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute.");this.setIndex(i);return}this.attributes[t]=i;return this},getAttribute:function e(t){return this.attributes[t]},removeAttribute:function e(t){delete this.attributes[t];return this},addGroup:function e(t,i,r){this.groups.push({start:t,count:i,materialIndex:r!==undefined?r:0})},clearGroups:function e(){this.groups=[]},setDrawRange:function e(t,i){this.drawRange.start=t;this.drawRange.count=i},applyMatrix:function e(t){var i=this.attributes.position;if(i!==undefined){t.applyToBufferAttribute(i);i.needsUpdate=true}var r=this.attributes.normal;if(r!==undefined){var n=(new ii).getNormalMatrix(t);n.applyToBufferAttribute(r);r.needsUpdate=true}if(this.boundingBox!==null){this.computeBoundingBox()}if(this.boundingSphere!==null){this.computeBoundingSphere()}return this},rotateX:function(){var e=new $t;return function t(i){e.makeRotationX(i);this.applyMatrix(e);return this}}(),rotateY:function(){var e=new $t;return function t(i){e.makeRotationY(i);this.applyMatrix(e);return this}}(),rotateZ:function(){var e=new $t;return function t(i){e.makeRotationZ(i);this.applyMatrix(e);return this}}(),translate:function(){var e=new $t;return function t(i,r,n){e.makeTranslation(i,r,n);this.applyMatrix(e);return this}}(),scale:function(){var e=new $t;return function t(i,r,n){e.makeScale(i,r,n);this.applyMatrix(e);return this}}(),lookAt:function(){var e=new ba;return function t(i){e.lookAt(i);e.updateMatrix();this.applyMatrix(e.matrix)}}(),center:function e(){this.computeBoundingBox();var t=this.boundingBox.getCenter().negate();this.translate(t.x,t.y,t.z);return t},setFromObject:function e(t){var i=t.geometry;if(t.isPoints||t.isLine){var r=new za(i.vertices.length*3,3);var n=new za(i.colors.length*3,3);this.addAttribute("position",r.copyVector3sArray(i.vertices));this.addAttribute("color",n.copyColorsArray(i.colors));if(i.lineDistances&&i.lineDistances.length===i.vertices.length){var a=new za(i.lineDistances.length,1);this.addAttribute("lineDistance",a.copyArray(i.lineDistances))}if(i.boundingSphere!==null){this.boundingSphere=i.boundingSphere.clone()}if(i.boundingBox!==null){this.boundingBox=i.boundingBox.clone()}}else if(t.isMesh){if(i&&i.isGeometry){this.fromGeometry(i)}}return this},setFromPoints:function e(t){var i=[];for(var r=0,n=t.length;r<n;r++){var a=t[r];i.push(a.x,a.y,a.z||0)}this.addAttribute("position",new za(i,3));return this},updateFromObject:function e(t){var i=t.geometry;if(t.isMesh){var r=i.__directGeometry;if(i.elementsNeedUpdate===true){r=undefined;i.elementsNeedUpdate=false}if(r===undefined){return this.fromGeometry(i)}r.verticesNeedUpdate=i.verticesNeedUpdate;r.normalsNeedUpdate=i.normalsNeedUpdate;r.colorsNeedUpdate=i.colorsNeedUpdate;r.uvsNeedUpdate=i.uvsNeedUpdate;r.groupsNeedUpdate=i.groupsNeedUpdate;i.verticesNeedUpdate=false;i.normalsNeedUpdate=false;i.colorsNeedUpdate=false;i.uvsNeedUpdate=false;i.groupsNeedUpdate=false;i=r}var n;if(i.verticesNeedUpdate===true){n=this.attributes.position;if(n!==undefined){n.copyVector3sArray(i.vertices);n.needsUpdate=true}i.verticesNeedUpdate=false}if(i.normalsNeedUpdate===true){n=this.attributes.normal;if(n!==undefined){n.copyVector3sArray(i.normals);n.needsUpdate=true}i.normalsNeedUpdate=false}if(i.colorsNeedUpdate===true){n=this.attributes.color;if(n!==undefined){n.copyColorsArray(i.colors);n.needsUpdate=true}i.colorsNeedUpdate=false}if(i.uvsNeedUpdate){n=this.attributes.uv;if(n!==undefined){n.copyVector2sArray(i.uvs);n.needsUpdate=true}i.uvsNeedUpdate=false}if(i.lineDistancesNeedUpdate){n=this.attributes.lineDistance;if(n!==undefined){n.copyArray(i.lineDistances);n.needsUpdate=true}i.lineDistancesNeedUpdate=false}if(i.groupsNeedUpdate){i.computeGroups(t.geometry);this.groups=i.groups;i.groupsNeedUpdate=false}return this},fromGeometry:function e(t){t.__directGeometry=(new Ua).fromGeometry(t);return this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function e(t){var i=new Float32Array(t.vertices.length*3);this.addAttribute("position",new La(i,3).copyVector3sArray(t.vertices));if(t.normals.length>0){var r=new Float32Array(t.normals.length*3);this.addAttribute("normal",new La(r,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var n=new Float32Array(t.colors.length*3);this.addAttribute("color",new La(n,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var a=new Float32Array(t.uvs.length*2);this.addAttribute("uv",new La(a,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var s=new Float32Array(t.uvs2.length*2);this.addAttribute("uv2",new La(s,2).copyVector2sArray(t.uvs2))}if(t.indices.length>0){var o=Da(t.indices)>65535?Uint32Array:Uint16Array;var h=new o(t.indices.length*3);this.setIndex(new La(h,1).copyIndicesArray(t.indices))}this.groups=t.groups;for(var l in t.morphTargets){var c=[];var u=t.morphTargets[l];for(var f=0,d=u.length;f<d;f++){var p=u[f];var v=new za(p.length*3,3);c.push(v.copyVector3sArray(p))}this.morphAttributes[l]=c}if(t.skinIndices.length>0){var m=new za(t.skinIndices.length*4,4);this.addAttribute("skinIndex",m.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var g=new za(t.skinWeights.length*4,4);this.addAttribute("skinWeight",g.copyVector4sArray(t.skinWeights))}if(t.boundingSphere!==null){this.boundingSphere=t.boundingSphere.clone()}if(t.boundingBox!==null){this.boundingBox=t.boundingBox.clone()}return this},computeBoundingBox:function e(){if(this.boundingBox===null){this.boundingBox=new da}var t=this.attributes.position;if(t!==undefined){this.boundingBox.setFromBufferAttribute(t)}else{this.boundingBox.makeEmpty()}if(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)){console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}},computeBoundingSphere:function(){var e=new da;var t=new ti;return function i(){if(this.boundingSphere===null){this.boundingSphere=new pa}var r=this.attributes.position;if(r){var n=this.boundingSphere.center;e.setFromBufferAttribute(r);e.getCenter(n);var a=0;for(var s=0,o=r.count;s<o;s++){t.x=r.getX(s);t.y=r.getY(s);t.z=r.getZ(s);a=Math.max(a,n.distanceToSquared(t))}this.boundingSphere.radius=Math.sqrt(a);if(isNaN(this.boundingSphere.radius)){console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}}(),computeFaceNormals:function e(){},computeVertexNormals:function e(){var t=this.index;var i=this.attributes;var r=this.groups;if(i.position){var n=i.position.array;if(i.normal===undefined){this.addAttribute("normal",new La(new Float32Array(n.length),3))}else{var a=i.normal.array;for(var s=0,o=a.length;s<o;s++){a[s]=0}}var h=i.normal.array;var l,c,u;var f=new ti,d=new ti,p=new ti;var v=new ti,m=new ti;if(t){var g=t.array;if(r.length===0){this.addGroup(0,g.length)}for(var y=0,_=r.length;y<_;++y){var x=r[y];var w=x.start;var b=x.count;for(var s=w,o=w+b;s<o;s+=3){l=g[s+0]*3;c=g[s+1]*3;u=g[s+2]*3;f.fromArray(n,l);d.fromArray(n,c);p.fromArray(n,u);v.subVectors(p,d);m.subVectors(f,d);v.cross(m);h[l]+=v.x;h[l+1]+=v.y;h[l+2]+=v.z;h[c]+=v.x;h[c+1]+=v.y;h[c+2]+=v.z;h[u]+=v.x;h[u+1]+=v.y;h[u+2]+=v.z}}}else{for(var s=0,o=n.length;s<o;s+=9){f.fromArray(n,s);d.fromArray(n,s+3);p.fromArray(n,s+6);v.subVectors(p,d);m.subVectors(f,d);v.cross(m);h[s]=v.x;h[s+1]=v.y;h[s+2]=v.z;h[s+3]=v.x;h[s+4]=v.y;h[s+5]=v.z;h[s+6]=v.x;h[s+7]=v.y;h[s+8]=v.z}}this.normalizeNormals();i.normal.needsUpdate=true}},merge:function e(t,i){if(!(t&&t.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);return}if(i===undefined)i=0;var r=this.attributes;for(var n in r){if(t.attributes[n]===undefined)continue;var a=r[n];var s=a.array;var o=t.attributes[n];var h=o.array;var l=o.itemSize;for(var c=0,u=l*i;c<h.length;c++,u++){s[u]=h[c]}}return this},normalizeNormals:function(){var e=new ti;return function t(){var i=this.attributes.normal;for(var r=0,n=i.count;r<n;r++){e.x=i.getX(r);e.y=i.getY(r);e.z=i.getZ(r);e.normalize();i.setXYZ(r,e.x,e.y,e.z)}}}(),toNonIndexed:function e(){if(this.index===null){console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed.");return this}var t=new ja;var i=this.index.array;var r=this.attributes;for(var n in r){var a=r[n];var s=a.array;var o=a.itemSize;var h=new s.constructor(i.length*o);var l=0,c=0;for(var u=0,f=i.length;u<f;u++){l=i[u]*o;for(var d=0;d<o;d++){h[c++]=s[l++]}}t.addAttribute(n,new La(h,o))}return t},toJSON:function e(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};t.uuid=this.uuid;t.type=this.type;if(this.name!=="")t.name=this.name;if(this.parameters!==undefined){var i=this.parameters;for(var r in i){if(i[r]!==undefined)t[r]=i[r]}return t}t.data={attributes:{}};var n=this.index;if(n!==null){var a=Array.prototype.slice.call(n.array);t.data.index={type:n.array.constructor.name,array:a}}var s=this.attributes;for(var r in s){var o=s[r];var a=Array.prototype.slice.call(o.array);t.data.attributes[r]={itemSize:o.itemSize,type:o.array.constructor.name,array:a,normalized:o.normalized}}var h=this.groups;if(h.length>0){t.data.groups=JSON.parse(JSON.stringify(h))}var l=this.boundingSphere;if(l!==null){t.data.boundingSphere={center:l.center.toArray(),radius:l.radius}}return t},clone:function e(){return(new ja).copy(this)},copy:function e(t){var i,r,n;this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingBox=null;this.boundingSphere=null;this.name=t.name;var a=t.index;if(a!==null){this.setIndex(a.clone())}var s=t.attributes;for(i in s){var o=s[i];this.addAttribute(i,o.clone())}var h=t.morphAttributes;for(i in h){var l=[];var c=h[i];for(r=0,n=c.length;r<n;r++){l.push(c[r].clone())}this.morphAttributes[i]=l}var u=t.groups;for(r=0,n=u.length;r<n;r++){var f=u[r];this.addGroup(f.start,f.count,f.materialIndex)}var d=t.boundingBox;if(d!==null){this.boundingBox=d.clone()}var p=t.boundingSphere;if(p!==null){this.boundingSphere=p.clone()}this.drawRange.start=t.drawRange.start;this.drawRange.count=t.drawRange.count;return this},dispose:function e(){this.dispatchEvent({type:"dispose"})}});function Ga(e,t,i,r,n,a){Aa.call(this);this.type="BoxGeometry";this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:a};this.fromBufferGeometry(new Ha(e,t,i,r,n,a));this.mergeVertices()}Ga.prototype=Object.create(Aa.prototype);Ga.prototype.constructor=Ga;function Ha(e,t,i,r,n,a){ja.call(this);this.type="BoxBufferGeometry";this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:a};var s=this;e=e||1;t=t||1;i=i||1;r=Math.floor(r)||1;n=Math.floor(n)||1;a=Math.floor(a)||1;var o=[];var h=[];var l=[];var c=[];var u=0;var f=0;d("z","y","x",-1,-1,i,t,e,a,n,0);d("z","y","x",1,-1,i,t,-e,a,n,1);d("x","z","y",1,1,e,i,t,r,a,2);d("x","z","y",1,-1,e,i,-t,r,a,3);d("x","y","z",1,-1,e,t,i,r,n,4);d("x","y","z",-1,-1,e,t,-i,r,n,5);this.setIndex(o);this.addAttribute("position",new za(h,3));this.addAttribute("normal",new za(l,3));this.addAttribute("uv",new za(c,2));function d(e,t,i,r,n,a,d,p,v,m,g){var y=a/v;var _=d/m;var x=a/2;var w=d/2;var b=p/2;var M=v+1;var T=m+1;var E=0;var S=0;var A,L;var C=new ti;for(L=0;L<T;L++){var R=L*_-w;for(A=0;A<M;A++){var I=A*y-x;C[e]=I*r;C[t]=R*n;C[i]=b;h.push(C.x,C.y,C.z);C[e]=0;C[t]=0;C[i]=p>0?1:-1;l.push(C.x,C.y,C.z);c.push(A/v);c.push(1-L/m);E+=1}}for(L=0;L<m;L++){for(A=0;A<v;A++){var P=u+A+M*L;var O=u+A+M*(L+1);var k=u+(A+1)+M*(L+1);var N=u+(A+1)+M*L;o.push(P,O,N);o.push(O,k,N);S+=6}}s.addGroup(f,S,g);f+=S;u+=E}}Ha.prototype=Object.create(ja.prototype);Ha.prototype.constructor=Ha;function Va(e,t,i,r){Aa.call(this);this.type="PlaneGeometry";this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};this.fromBufferGeometry(new Wa(e,t,i,r));this.mergeVertices()}Va.prototype=Object.create(Aa.prototype);Va.prototype.constructor=Va;function Wa(e,t,i,r){ja.call(this);this.type="PlaneBufferGeometry";this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};e=e||1;t=t||1;var n=e/2;var a=t/2;var s=Math.floor(i)||1;var o=Math.floor(r)||1;var h=s+1;var l=o+1;var c=e/s;var u=t/o;var f,d;var p=[];var v=[];var m=[];var g=[];for(d=0;d<l;d++){var y=d*u-a;for(f=0;f<h;f++){var _=f*c-n;v.push(_,-y,0);m.push(0,0,1);g.push(f/s);g.push(1-d/o)}}for(d=0;d<o;d++){for(f=0;f<s;f++){var x=f+h*d;var w=f+h*(d+1);var b=f+1+h*(d+1);var M=f+1+h*d;p.push(x,w,M);p.push(w,b,M)}}this.setIndex(p);this.addAttribute("position",new za(v,3));this.addAttribute("normal",new za(m,3));this.addAttribute("uv",new za(g,2))}Wa.prototype=Object.create(ja.prototype);Wa.prototype.constructor=Wa;function Xa(e){ca.call(this);this.type="MeshBasicMaterial";this.color=new Ki(16777215);this.map=null;this.lightMap=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=Ce;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.skinning=false;this.morphTargets=false;this.lights=false;this.setValues(e)}Xa.prototype=Object.create(ca.prototype);Xa.prototype.constructor=Xa;Xa.prototype.isMeshBasicMaterial=true;Xa.prototype.copy=function(e){ca.prototype.copy.call(this,e);this.color.copy(e.color);this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.specularMap=e.specularMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.combine=e.combine;this.reflectivity=e.reflectivity;this.refractionRatio=e.refractionRatio;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;this.skinning=e.skinning;this.morphTargets=e.morphTargets;return this};function Ya(e){ca.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.linewidth=1;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;this.lights=false;this.clipping=false;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.extensions={derivatives:false,fragDepth:false,drawBuffers:false,shaderTextureLOD:false};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=undefined;if(e!==undefined){if(e.attributes!==undefined){console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead.")}this.setValues(e)}}Ya.prototype=Object.create(ca.prototype);Ya.prototype.constructor=Ya;Ya.prototype.isShaderMaterial=true;Ya.prototype.copy=function(e){ca.prototype.copy.call(this,e);this.fragmentShader=e.fragmentShader;this.vertexShader=e.vertexShader;this.uniforms=er.clone(e.uniforms);this.defines=e.defines;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.lights=e.lights;this.clipping=e.clipping;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.morphNormals=e.morphNormals;this.extensions=e.extensions;return this};Ya.prototype.toJSON=function(e){var t=ca.prototype.toJSON.call(this,e);t.uniforms=this.uniforms;t.vertexShader=this.vertexShader;t.fragmentShader=this.fragmentShader;return t};function qa(e,t){this.origin=e!==undefined?e:new ti;this.direction=t!==undefined?t:new ti}Object.assign(qa.prototype,{set:function e(t,i){this.origin.copy(t);this.direction.copy(i);return this},clone:function e(){return(new this.constructor).copy(this)},copy:function e(t){this.origin.copy(t.origin);this.direction.copy(t.direction);return this},at:function e(t,i){var r=i||new ti;return r.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function e(t){this.direction.copy(t).sub(this.origin).normalize();return this},recast:function(){var e=new ti;return function t(i){this.origin.copy(this.at(i,e));return this}}(),closestPointToPoint:function e(t,i){var r=i||new ti;r.subVectors(t,this.origin);var n=r.dot(this.direction);if(n<0){return r.copy(this.origin)}return r.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function e(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(){var e=new ti;return function t(i){var r=e.subVectors(i,this.origin).dot(this.direction);if(r<0){return this.origin.distanceToSquared(i)}e.copy(this.direction).multiplyScalar(r).add(this.origin);return e.distanceToSquared(i)}}(),distanceSqToSegment:function(){var e=new ti;var t=new ti;var i=new ti;return function r(n,a,s,o){e.copy(n).add(a).multiplyScalar(.5);t.copy(a).sub(n).normalize();i.copy(this.origin).sub(e);var h=n.distanceTo(a)*.5;var l=-this.direction.dot(t);var c=i.dot(this.direction);var u=-i.dot(t);var f=i.lengthSq();var d=Math.abs(1-l*l);var p,v,m,g;if(d>0){p=l*u-c;v=l*c-u;g=h*d;if(p>=0){if(v>=-g){if(v<=g){var y=1/d;p*=y;v*=y;m=p*(p+l*v+2*c)+v*(l*p+v+2*u)+f}else{v=h;p=Math.max(0,-(l*v+c));m=-p*p+v*(v+2*u)+f}}else{v=-h;p=Math.max(0,-(l*v+c));m=-p*p+v*(v+2*u)+f}}else{if(v<=-g){p=Math.max(0,-(-l*h+c));v=p>0?-h:Math.min(Math.max(-h,-u),h);m=-p*p+v*(v+2*u)+f}else if(v<=g){p=0;v=Math.min(Math.max(-h,-u),h);m=v*(v+2*u)+f}else{p=Math.max(0,-(l*h+c));v=p>0?h:Math.min(Math.max(-h,-u),h);m=-p*p+v*(v+2*u)+f}}}else{v=l>0?-h:h;p=Math.max(0,-(l*v+c));m=-p*p+v*(v+2*u)+f}if(s){s.copy(this.direction).multiplyScalar(p).add(this.origin)}if(o){o.copy(t).multiplyScalar(v).add(e)}return m}}(),intersectSphere:function(){var e=new ti;return function t(i,r){e.subVectors(i.center,this.origin);var n=e.dot(this.direction);var a=e.dot(e)-n*n;var s=i.radius*i.radius;if(a>s)return null;var o=Math.sqrt(s-a);var h=n-o;var l=n+o;if(h<0&&l<0)return null;if(h<0)return this.at(l,r);return this.at(h,r)}}(),intersectsSphere:function e(t){return this.distanceToPoint(t.center)<=t.radius},distanceToPlane:function e(t){var i=t.normal.dot(this.direction);if(i===0){if(t.distanceToPoint(this.origin)===0){return 0}return null}var r=-(this.origin.dot(t.normal)+t.constant)/i;return r>=0?r:null},intersectPlane:function e(t,i){var r=this.distanceToPlane(t);if(r===null){return null}return this.at(r,i)},intersectsPlane:function e(t){var i=t.distanceToPoint(this.origin);if(i===0){return true}var r=t.normal.dot(this.direction);if(r*i<0){return true}return false},intersectBox:function e(t,i){var r,n,a,s,o,h;var l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z;var f=this.origin;if(l>=0){r=(t.min.x-f.x)*l;n=(t.max.x-f.x)*l}else{r=(t.max.x-f.x)*l;n=(t.min.x-f.x)*l}if(c>=0){a=(t.min.y-f.y)*c;s=(t.max.y-f.y)*c}else{a=(t.max.y-f.y)*c;s=(t.min.y-f.y)*c}if(r>s||a>n)return null;if(a>r||r!==r)r=a;if(s<n||n!==n)n=s;if(u>=0){o=(t.min.z-f.z)*u;h=(t.max.z-f.z)*u}else{o=(t.max.z-f.z)*u;h=(t.min.z-f.z)*u}if(r>h||o>n)return null;if(o>r||r!==r)r=o;if(h<n||n!==n)n=h;if(n<0)return null;return this.at(r>=0?r:n,i)},intersectsBox:function(){var e=new ti;return function t(i){return this.intersectBox(i,e)!==null}}(),intersectTriangle:function(){var e=new ti;var t=new ti;var i=new ti;var r=new ti;return function n(a,s,o,h,l){t.subVectors(s,a);i.subVectors(o,a);r.crossVectors(t,i);var c=this.direction.dot(r);var u;if(c>0){if(h)return null;u=1}else if(c<0){u=-1;c=-c}else{return null}e.subVectors(this.origin,a);var f=u*this.direction.dot(i.crossVectors(e,i));if(f<0){return null}var d=u*this.direction.dot(t.cross(e));if(d<0){return null}if(f+d>c){return null}var p=-u*e.dot(r);if(p<0){return null}return this.at(p/c,l)}}(),applyMatrix4:function e(t){this.origin.applyMatrix4(t);this.direction.transformDirection(t);return this},equals:function e(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}});function Za(e,t){this.start=e!==undefined?e:new ti;this.end=t!==undefined?t:new ti}Object.assign(Za.prototype,{set:function e(t,i){this.start.copy(t);this.end.copy(i);return this},clone:function e(){return(new this.constructor).copy(this)},copy:function e(t){this.start.copy(t.start);this.end.copy(t.end);return this},getCenter:function e(t){var i=t||new ti;return i.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function e(t){var i=t||new ti;return i.subVectors(this.end,this.start)},distanceSq:function e(){return this.start.distanceToSquared(this.end)},distance:function e(){return this.start.distanceTo(this.end)},at:function e(t,i){var r=i||new ti;return this.delta(r).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(){var e=new ti;var t=new ti;return function i(r,n){e.subVectors(r,this.start);t.subVectors(this.end,this.start);var a=t.dot(t);var s=t.dot(e);var o=s/a;if(n){o=Qt.clamp(o,0,1)}return o}}(),closestPointToPoint:function e(t,i,r){var n=this.closestPointToPointParameter(t,i);var a=r||new ti;return this.delta(a).multiplyScalar(n).add(this.start)},applyMatrix4:function e(t){this.start.applyMatrix4(t);this.end.applyMatrix4(t);return this},equals:function e(t){return t.start.equals(this.start)&&t.end.equals(this.end)}});function Ja(e,t,i){this.a=e!==undefined?e:new ti;this.b=t!==undefined?t:new ti;this.c=i!==undefined?i:new ti}Object.assign(Ja,{normal:function(){var e=new ti;return function t(i,r,n,a){var s=a||new ti;s.subVectors(n,r);e.subVectors(i,r);s.cross(e);var o=s.lengthSq();if(o>0){return s.multiplyScalar(1/Math.sqrt(o))}return s.set(0,0,0)}}(),barycoordFromPoint:function(){var e=new ti;var t=new ti;var i=new ti;return function r(n,a,s,o,h){e.subVectors(o,a);t.subVectors(s,a);i.subVectors(n,a);var l=e.dot(e);var c=e.dot(t);var u=e.dot(i);var f=t.dot(t);var d=t.dot(i);var p=l*f-c*c;var v=h||new ti;if(p===0){return v.set(-2,-1,-1)}var m=1/p;var g=(f*u-c*d)*m;var y=(l*d-c*u)*m;return v.set(1-g-y,y,g)}}(),containsPoint:function(){var e=new ti;return function t(i,r,n,a){var s=Ja.barycoordFromPoint(i,r,n,a,e);return s.x>=0&&s.y>=0&&s.x+s.y<=1}}()});Object.assign(Ja.prototype,{set:function e(t,i,r){this.a.copy(t);this.b.copy(i);this.c.copy(r);return this},setFromPointsAndIndices:function e(t,i,r,n){this.a.copy(t[i]);this.b.copy(t[r]);this.c.copy(t[n]);return this},clone:function e(){return(new this.constructor).copy(this)},copy:function e(t){this.a.copy(t.a);this.b.copy(t.b);this.c.copy(t.c);return this},area:function(){var e=new ti;var t=new ti;return function i(){e.subVectors(this.c,this.b);t.subVectors(this.a,this.b);return e.cross(t).length()*.5}}(),midpoint:function e(t){var i=t||new ti;return i.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function e(t){return Ja.normal(this.a,this.b,this.c,t)},plane:function e(t){var i=t||new va;return i.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function e(t,i){return Ja.barycoordFromPoint(t,this.a,this.b,this.c,i)},containsPoint:function e(t){return Ja.containsPoint(t,this.a,this.b,this.c)},closestPointToPoint:function(){var e=new va;var t=[new Za,new Za,new Za];var i=new ti;var r=new ti;return function n(a,s){var o=s||new ti;var h=Infinity;e.setFromCoplanarPoints(this.a,this.b,this.c);e.projectPoint(a,i);if(this.containsPoint(i)===true){o.copy(i)}else{t[0].set(this.a,this.b);t[1].set(this.b,this.c);t[2].set(this.c,this.a);for(var l=0;l<t.length;l++){t[l].closestPointToPoint(i,true,r);var c=i.distanceToSquared(r);if(c<h){h=c;o.copy(r)}}}return o}}(),equals:function e(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}});function Qa(e,t){ba.call(this);this.type="Mesh";this.geometry=e!==undefined?e:new ja;this.material=t!==undefined?t:new Xa({color:Math.random()*16777215});this.drawMode=Ut;this.updateMorphTargets()}Qa.prototype=Object.assign(Object.create(ba.prototype),{constructor:Qa,isMesh:true,setDrawMode:function e(t){this.drawMode=t},copy:function e(t){ba.prototype.copy.call(this,t);this.drawMode=t.drawMode;if(t.morphTargetInfluences!==undefined){this.morphTargetInfluences=t.morphTargetInfluences.slice()}if(t.morphTargetDictionary!==undefined){this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)}return this},updateMorphTargets:function e(){var t=this.geometry;var i,r,n;if(t.isBufferGeometry){var a=t.morphAttributes;var s=Object.keys(a);if(s.length>0){var o=a[s[0]];if(o!==undefined){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(i=0,r=o.length;i<r;i++){n=o[i].name||String(i);this.morphTargetInfluences.push(0);this.morphTargetDictionary[n]=i}}}}else{var h=t.morphTargets;if(h!==undefined&&h.length>0){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(i=0,r=h.length;i<r;i++){n=h[i].name||String(i);this.morphTargetInfluences.push(0);this.morphTargetDictionary[n]=i}}}},raycast:function(){var e=new $t;var t=new qa;var i=new pa;var r=new ti;var n=new ti;var a=new ti;var s=new ti;var o=new ti;var h=new ti;var l=new Kt;var c=new Kt;var u=new Kt;var f=new ti;var d=new ti;var p=new ti;function v(e,t,i,r,n,a,s){Ja.barycoordFromPoint(e,t,i,r,f);n.multiplyScalar(f.x);a.multiplyScalar(f.y);s.multiplyScalar(f.z);n.add(a).add(s);return n.clone()}function m(e,t,i,r,n,a,s,o){var h;if(t.side===X){h=r.intersectTriangle(s,a,n,true,o)}else{h=r.intersectTriangle(n,a,s,t.side!==Y,o)}if(h===null)return null;p.copy(o);p.applyMatrix4(e.matrixWorld);var l=i.ray.origin.distanceTo(p);if(l<i.near||l>i.far)return null;return{distance:l,point:p.clone(),object:e}}function g(e,t,i,s,o,h,f,p){r.fromBufferAttribute(s,h);n.fromBufferAttribute(s,f);a.fromBufferAttribute(s,p);var g=m(e,e.material,t,i,r,n,a,d);if(g){if(o){l.fromBufferAttribute(o,h);c.fromBufferAttribute(o,f);u.fromBufferAttribute(o,p);g.uv=v(d,r,n,a,l,c,u)}g.face=new Ea(h,f,p,Ja.normal(r,n,a));g.faceIndex=h}return g}return function f(p,y){var _=this.geometry;var x=this.material;var w=this.matrixWorld;if(x===undefined)return;if(_.boundingSphere===null)_.computeBoundingSphere();i.copy(_.boundingSphere);i.applyMatrix4(w);if(p.ray.intersectsSphere(i)===false)return;e.getInverse(w);t.copy(p.ray).applyMatrix4(e);if(_.boundingBox!==null){if(t.intersectsBox(_.boundingBox)===false)return}var b;if(_.isBufferGeometry){var M,T,E;var S=_.index;var A=_.attributes.position;var L=_.attributes.uv;var C,R;if(S!==null){for(C=0,R=S.count;C<R;C+=3){M=S.getX(C);T=S.getX(C+1);E=S.getX(C+2);b=g(this,p,t,A,L,M,T,E);if(b){b.faceIndex=Math.floor(C/3);y.push(b)}}}else if(A!==undefined){for(C=0,R=A.count;C<R;C+=3){M=C;T=C+1;E=C+2;b=g(this,p,t,A,L,M,T,E);if(b){b.index=M;y.push(b)}}}}else if(_.isGeometry){var I,P,O;var k=Array.isArray(x);var N=_.vertices;var z=_.faces;var B;var U=_.faceVertexUvs[0];if(U.length>0)B=U;for(var D=0,F=z.length;D<F;D++){var j=z[D];var G=k?x[j.materialIndex]:x;if(G===undefined)continue;I=N[j.a];P=N[j.b];O=N[j.c];if(G.morphTargets===true){var H=_.morphTargets;var V=this.morphTargetInfluences;r.set(0,0,0);n.set(0,0,0);a.set(0,0,0);for(var W=0,X=H.length;W<X;W++){var Y=V[W];if(Y===0)continue;var q=H[W].vertices;r.addScaledVector(s.subVectors(q[j.a],I),Y);n.addScaledVector(o.subVectors(q[j.b],P),Y);a.addScaledVector(h.subVectors(q[j.c],O),Y)}r.add(I);n.add(P);a.add(O);I=r;P=n;O=a}b=m(this,G,p,t,I,P,O,d);if(b){if(B&&B[D]){var Z=B[D];l.copy(Z[0]);c.copy(Z[1]);u.copy(Z[2]);b.uv=v(d,I,P,O,l,c,u)}b.face=j;b.faceIndex=D;y.push(b)}}}}}(),clone:function e(){return new this.constructor(this.geometry,this.material).copy(this)}});function Ka(e,t,i,r){var n=new Ki(0);var a=0;var s,o;var h;function l(t,r,l,u){var f=r.background;if(f===null){c(n,a)}else if(f&&f.isColor){c(f,1);u=true}if(e.autoClear||u){e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil)}if(f&&f.isCubeTexture){if(h===undefined){h=new Qa(new Ha(1,1,1),new Ya({uniforms:na.cube.uniforms,vertexShader:na.cube.vertexShader,fragmentShader:na.cube.fragmentShader,side:X,depthTest:true,depthWrite:false,fog:false}));h.geometry.removeAttribute("normal");h.geometry.removeAttribute("uv");h.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)};i.update(h.geometry)}h.material.uniforms.tCube.value=f;t.push(h,h.geometry,h.material,0,null)}else if(f&&f.isTexture){if(s===undefined){s=new Ta(-1,1,1,-1,0,1);o=new Qa(new Wa(2,2),new Xa({depthTest:false,depthWrite:false,fog:false}));i.update(o.geometry)}o.material.map=f;e.renderBufferDirect(s,null,o.geometry,o.material,o,null)}}function c(e,i){t.buffers.color.setClear(e.r,e.g,e.b,i,r)}return{getClearColor:function e(){return n},setClearColor:function e(t,i){n.set(t);a=i!==undefined?i:1;c(n,a)},getClearAlpha:function e(){return a},setClearAlpha:function e(t){a=t;c(n,a)},render:l}}function $a(e,t){if(e.renderOrder!==t.renderOrder){return e.renderOrder-t.renderOrder}else if(e.program&&t.program&&e.program!==t.program){return e.program.id-t.program.id}else if(e.material.id!==t.material.id){return e.material.id-t.material.id}else if(e.z!==t.z){return e.z-t.z}else{return e.id-t.id}}function es(e,t){if(e.renderOrder!==t.renderOrder){return e.renderOrder-t.renderOrder}if(e.z!==t.z){return t.z-e.z}else{return e.id-t.id}}function ts(){var e=[];var t=0;var i=[];var r=[];function n(){t=0;i.length=0;r.length=0}function a(n,a,s,o,h){var l=e[t];if(l===undefined){l={id:n.id,object:n,geometry:a,material:s,program:s.program,renderOrder:n.renderOrder,z:o,group:h};e[t]=l}else{l.id=n.id;l.object=n;l.geometry=a;l.material=s;l.program=s.program;l.renderOrder=n.renderOrder;l.z=o;l.group=h}(s.transparent===true?r:i).push(l);t++}function s(){if(i.length>1)i.sort($a);if(r.length>1)r.sort(es)}return{opaque:i,transparent:r,init:n,push:a,sort:s}}function is(){var e={};function t(t,i){var r=t.id+","+i.id;var n=e[r];if(n===undefined){n=new ts;e[r]=n}return n}function i(){e={}}return{get:t,dispose:i}}function rs(e,t){return Math.abs(t[1])-Math.abs(e[1])}function ns(e){var t={};var i=new Float32Array(8);function r(r,n,a,s){var o=r.morphTargetInfluences;var h=o.length;var l=t[n.id];if(l===undefined){l=[];for(var c=0;c<h;c++){l[c]=[c,0]}t[n.id]=l}var u=a.morphTargets&&n.morphAttributes.position;var f=a.morphNormals&&n.morphAttributes.normal;for(var c=0;c<h;c++){var d=l[c];if(d[1]!==0){if(u)n.removeAttribute("morphTarget"+c);if(f)n.removeAttribute("morphNormal"+c)}}for(var c=0;c<h;c++){var d=l[c];d[0]=c;d[1]=o[c]}l.sort(rs);for(var c=0;c<8;c++){var d=l[c];if(d){var p=d[0];var v=d[1];if(v){if(u)n.addAttribute("morphTarget"+c,u[p]);if(f)n.addAttribute("morphNormal"+c,f[p]);i[c]=v;continue}}i[c]=0}s.getUniforms().setValue(e,"morphTargetInfluences",i)}return{update:r}}function as(e,t,i){var r;function n(e){r=e}var a,s;function o(e){a=e.type;s=e.bytesPerElement}function h(t,n){e.drawElements(r,n,a,t*s);i.calls++;i.vertices+=n;if(r===e.TRIANGLES)i.faces+=n/3;else if(r===e.POINTS)i.points+=n}function l(n,o,h){var l=t.get("ANGLE_instanced_arrays");if(l===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}l.drawElementsInstancedANGLE(r,h,a,o*s,n.maxInstancedCount);i.calls++;i.vertices+=h*n.maxInstancedCount;if(r===e.TRIANGLES)i.faces+=n.maxInstancedCount*h/3;else if(r===e.POINTS)i.points+=n.maxInstancedCount*h}this.setMode=n;this.setIndex=o;this.render=h;this.renderInstances=l}function ss(e,t,i){var r;function n(e){r=e}function a(t,n){e.drawArrays(r,t,n);i.calls++;i.vertices+=n;if(r===e.TRIANGLES)i.faces+=n/3;else if(r===e.POINTS)i.points+=n}function s(n,a,s){var o=t.get("ANGLE_instanced_arrays");if(o===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}var h=n.attributes.position;if(h.isInterleavedBufferAttribute){s=h.data.count;o.drawArraysInstancedANGLE(r,0,s,n.maxInstancedCount)}else{o.drawArraysInstancedANGLE(r,a,s,n.maxInstancedCount)}i.calls++;i.vertices+=s*n.maxInstancedCount;if(r===e.TRIANGLES)i.faces+=n.maxInstancedCount*s/3;else if(r===e.POINTS)i.points+=n.maxInstancedCount*s}this.setMode=n;this.render=a;this.renderInstances=s}function os(e,t,i){var r={};var n={};function a(e){var s=e.target;var o=r[s.id];if(o.index!==null){t.remove(o.index)}for(var h in o.attributes){t.remove(o.attributes[h])}s.removeEventListener("dispose",a);delete r[s.id];var l=n[s.id];if(l){t.remove(l);delete n[s.id]}l=n[o.id];if(l){t.remove(l);delete n[o.id]}i.geometries--}function s(e,t){var n=r[t.id];if(n)return n;t.addEventListener("dispose",a);if(t.isBufferGeometry){n=t}else if(t.isGeometry){if(t._bufferGeometry===undefined){t._bufferGeometry=(new ja).setFromObject(e)}n=t._bufferGeometry}r[t.id]=n;i.geometries++;return n}function o(i){var r=i.index;var n=i.attributes;if(r!==null){t.update(r,e.ELEMENT_ARRAY_BUFFER)}for(var a in n){t.update(n[a],e.ARRAY_BUFFER)}var s=i.morphAttributes;for(var a in s){var o=s[a];for(var h=0,l=o.length;h<l;h++){t.update(o[h],e.ARRAY_BUFFER)}}}function h(i){var r=n[i.id];if(r)return r;var a=[];var s=i.index;var o=i.attributes;if(s!==null){var h=s.array;for(var l=0,c=h.length;l<c;l+=3){var u=h[l+0];var f=h[l+1];var d=h[l+2];a.push(u,f,f,d,d,u)}}else{var h=o.position.array;for(var l=0,c=h.length/3-1;l<c;l+=3){var u=l+0;var f=l+1;var d=l+2;a.push(u,f,f,d,d,u)}}r=new(Da(a)>65535?Na:Oa)(a,1);t.update(r,e.ELEMENT_ARRAY_BUFFER);n[i.id]=r;return r}return{get:s,update:o,getWireframeAttribute:h}}function hs(){var e={};return{get:function t(i){if(e[i.id]!==undefined){return e[i.id]}var r;switch(i.type){case"DirectionalLight":r={direction:new ti,color:new Ki,shadow:false,shadowBias:0,shadowRadius:1,shadowMapSize:new Kt};break;case"SpotLight":r={position:new ti,direction:new ti,color:new Ki,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:false,shadowBias:0,shadowRadius:1,shadowMapSize:new Kt};break;case"PointLight":r={position:new ti,color:new Ki,distance:0,decay:0,shadow:false,shadowBias:0,shadowRadius:1,shadowMapSize:new Kt,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":r={direction:new ti,skyColor:new Ki,groundColor:new Ki};break;case"RectAreaLight":r={color:new Ki,position:new ti,halfWidth:new ti,halfHeight:new ti};break}e[i.id]=r;return r}}}function ls(){var e=new hs;var t={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};var i=new ti;var r=new $t;var n=new $t;function a(a,s,o){var h=0,l=0,c=0;var u=0;var f=0;var d=0;var p=0;var v=0;var m=o.matrixWorldInverse;for(var g=0,y=a.length;g<y;g++){var _=a[g];var x=_.color;var w=_.intensity;var b=_.distance;var M=_.shadow&&_.shadow.map?_.shadow.map.texture:null;if(_.isAmbientLight){h+=x.r*w;l+=x.g*w;c+=x.b*w}else if(_.isDirectionalLight){var T=e.get(_);T.color.copy(_.color).multiplyScalar(_.intensity);T.direction.setFromMatrixPosition(_.matrixWorld);i.setFromMatrixPosition(_.target.matrixWorld);T.direction.sub(i);T.direction.transformDirection(m);T.shadow=_.castShadow;if(_.castShadow){var E=_.shadow;T.shadowBias=E.bias;T.shadowRadius=E.radius;T.shadowMapSize=E.mapSize}t.directionalShadowMap[u]=M;t.directionalShadowMatrix[u]=_.shadow.matrix;t.directional[u]=T;u++}else if(_.isSpotLight){var T=e.get(_);T.position.setFromMatrixPosition(_.matrixWorld);T.position.applyMatrix4(m);T.color.copy(x).multiplyScalar(w);T.distance=b;T.direction.setFromMatrixPosition(_.matrixWorld);i.setFromMatrixPosition(_.target.matrixWorld);T.direction.sub(i);T.direction.transformDirection(m);T.coneCos=Math.cos(_.angle);T.penumbraCos=Math.cos(_.angle*(1-_.penumbra));T.decay=_.distance===0?0:_.decay;T.shadow=_.castShadow;if(_.castShadow){var E=_.shadow;T.shadowBias=E.bias;T.shadowRadius=E.radius;T.shadowMapSize=E.mapSize}t.spotShadowMap[d]=M;t.spotShadowMatrix[d]=_.shadow.matrix;t.spot[d]=T;d++}else if(_.isRectAreaLight){var T=e.get(_);T.color.copy(x).multiplyScalar(w/(_.width*_.height));T.position.setFromMatrixPosition(_.matrixWorld);T.position.applyMatrix4(m);n.identity();r.copy(_.matrixWorld);r.premultiply(m);n.extractRotation(r);T.halfWidth.set(_.width*.5,0,0);T.halfHeight.set(0,_.height*.5,0);T.halfWidth.applyMatrix4(n);T.halfHeight.applyMatrix4(n);t.rectArea[p]=T;p++}else if(_.isPointLight){var T=e.get(_);T.position.setFromMatrixPosition(_.matrixWorld);T.position.applyMatrix4(m);T.color.copy(_.color).multiplyScalar(_.intensity);T.distance=_.distance;T.decay=_.distance===0?0:_.decay;T.shadow=_.castShadow;if(_.castShadow){var E=_.shadow;T.shadowBias=E.bias;T.shadowRadius=E.radius;T.shadowMapSize=E.mapSize;T.shadowCameraNear=E.camera.near;T.shadowCameraFar=E.camera.far}t.pointShadowMap[f]=M;t.pointShadowMatrix[f]=_.shadow.matrix;t.point[f]=T;f++}else if(_.isHemisphereLight){var T=e.get(_);T.direction.setFromMatrixPosition(_.matrixWorld);T.direction.transformDirection(m);T.direction.normalize();T.skyColor.copy(_.color).multiplyScalar(w);T.groundColor.copy(_.groundColor).multiplyScalar(w);t.hemi[v]=T;v++}}t.ambient[0]=h;t.ambient[1]=l;t.ambient[2]=c;t.directional.length=u;t.spot.length=d;t.rectArea.length=p;t.point.length=f;t.hemi.length=v;t.hash=u+","+f+","+d+","+p+","+v+","+s.length}return{setup:a,state:t}}function cs(e,t){var i={};function r(r){var n=t.frame;var a=r.geometry;var s=e.get(r,a);if(i[s.id]!==n){if(a.isGeometry){s.updateFromObject(r)}e.update(s);i[s.id]=n}return s}function n(){i={}}return{update:r,clear:n}}function us(e){var t=e.split("\n");for(var i=0;i<t.length;i++){t[i]=i+1+": "+t[i]}return t.join("\n")}function fs(e,t,i){var r=e.createShader(t);e.shaderSource(r,i);e.compileShader(r);if(e.getShaderParameter(r,e.COMPILE_STATUS)===false){console.error("THREE.WebGLShader: Shader couldn't compile.")}if(e.getShaderInfoLog(r)!==""){console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t===e.VERTEX_SHADER?"vertex":"fragment",e.getShaderInfoLog(r),us(i))}return r}var ds=0;function ps(e){switch(e){case jt:return["Linear","( value )"];case Gt:return["sRGB","( value )"];case Vt:return["RGBE","( value )"];case Xt:return["RGBM","( value, 7.0 )"];case Yt:return["RGBM","( value, 16.0 )"];case qt:return["RGBD","( value, 256.0 )"];case Ht:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e)}}function vs(e,t){var i=ps(t);return"vec4 "+e+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function ms(e,t){var i=ps(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function gs(e,t){var i;switch(t){case Oe:i="Linear";break;case ke:i="Reinhard";break;case Ne:i="Uncharted2";break;case ze:i="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function ys(e,t,i){e=e||{};var r=[e.derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&i.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&i.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&i.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""];return r.filter(ws).join("\n")}function _s(e){var t=[];for(var i in e){var r=e[i];if(r===false)continue;t.push("#define "+i+" "+r)}return t.join("\n")}function xs(e,t){var i={};var r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(var n=0;n<r;n++){var a=e.getActiveAttrib(t,n);var s=a.name;i[s]=e.getAttribLocation(t,s)}return i}function ws(e){return e!==""}function bs(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function Ms(e){var t=/^[ \t]*#include +<([\w\d.]+)>/gm;function i(e,t){var i=ra[t];if(i===undefined){throw new Error("Can not resolve #include <"+t+">")}return Ms(i)}return e.replace(t,i)}function Ts(e){var t=/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function i(e,t,i,r){var n="";for(var a=parseInt(t);a<parseInt(i);a++){n+=r.replace(/\[ i \]/g,"[ "+a+" ]")}return n}return e.replace(t,i)}function Es(e,t,i,r,n,a){var s=e.context;var o=r.defines;var h=n.vertexShader;var l=n.fragmentShader;var c="SHADOWMAP_TYPE_BASIC";if(a.shadowMapType===H){c="SHADOWMAP_TYPE_PCF"}else if(a.shadowMapType===V){c="SHADOWMAP_TYPE_PCF_SOFT"}var u="ENVMAP_TYPE_CUBE";var f="ENVMAP_MODE_REFLECTION";var d="ENVMAP_BLENDING_MULTIPLY";if(a.envMap){switch(r.envMap.mapping){case Ue:case De:u="ENVMAP_TYPE_CUBE";break;case He:case Ve:u="ENVMAP_TYPE_CUBE_UV";break;case Fe:case je:u="ENVMAP_TYPE_EQUIREC";break;case Ge:u="ENVMAP_TYPE_SPHERE";break}switch(r.envMap.mapping){case De:case je:f="ENVMAP_MODE_REFRACTION";break}switch(r.combine){case Ce:d="ENVMAP_BLENDING_MULTIPLY";break;case Re:d="ENVMAP_BLENDING_MIX";break;case Ie:d="ENVMAP_BLENDING_ADD";break}}var p=e.gammaFactor>0?e.gammaFactor:1;var v=ys(r.extensions,a,t);var m=_s(o);var g=s.createProgram();var y,_;if(r.isRawShaderMaterial){y=[m].filter(ws).join("\n");if(y.length>0){y+="\n"}_=[v,m].filter(ws).join("\n");if(_.length>0){_+="\n"}}else{y=["precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+n.name,m,a.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+p,"#define MAX_BONES "+a.maxBones,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+f:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexColors?"#define USE_COLOR":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&a.flatShading===false?"#define USE_MORPHNORMALS":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+a.numClippingPlanes,a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+c:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&t.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ws).join("\n");_=[v,"precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+n.name,m,a.alphaTest?"#define ALPHATEST "+a.alphaTest:"","#define GAMMA_FACTOR "+p,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+u:"",a.envMap?"#define "+f:"",a.envMap?"#define "+d:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexColors?"#define USE_COLOR":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+a.numClippingPlanes,"#define UNION_CLIPPING_PLANES "+(a.numClippingPlanes-a.numClipIntersection),a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+c:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&t.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",a.envMap&&t.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",a.toneMapping!==Pe?"#define TONE_MAPPING":"",a.toneMapping!==Pe?ra["tonemapping_pars_fragment"]:"",a.toneMapping!==Pe?gs("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",a.outputEncoding||a.mapEncoding||a.envMapEncoding||a.emissiveMapEncoding?ra["encodings_pars_fragment"]:"",a.mapEncoding?vs("mapTexelToLinear",a.mapEncoding):"",a.envMapEncoding?vs("envMapTexelToLinear",a.envMapEncoding):"",a.emissiveMapEncoding?vs("emissiveMapTexelToLinear",a.emissiveMapEncoding):"",a.outputEncoding?ms("linearToOutputTexel",a.outputEncoding):"",a.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(ws).join("\n")}h=Ms(h);h=bs(h,a);l=Ms(l);l=bs(l,a);if(!r.isShaderMaterial){h=Ts(h);l=Ts(l)}var x=y+h;var w=_+l;var b=fs(s,s.VERTEX_SHADER,x);var M=fs(s,s.FRAGMENT_SHADER,w);s.attachShader(g,b);s.attachShader(g,M);if(r.index0AttributeName!==undefined){s.bindAttribLocation(g,0,r.index0AttributeName)}else if(a.morphTargets===true){s.bindAttribLocation(g,0,"position")}s.linkProgram(g);var T=s.getProgramInfoLog(g);var E=s.getShaderInfoLog(b);var S=s.getShaderInfoLog(M);var A=true;var L=true;if(s.getProgramParameter(g,s.LINK_STATUS)===false){A=false;console.error("THREE.WebGLProgram: shader error: ",s.getError(),"gl.VALIDATE_STATUS",s.getProgramParameter(g,s.VALIDATE_STATUS),"gl.getProgramInfoLog",T,E,S)}else if(T!==""){}else if(E===""||S===""){L=false}if(L){this.diagnostics={runnable:A,material:r,programLog:T,vertexShader:{log:E,prefix:y},fragmentShader:{log:S,prefix:_}}}s.deleteShader(b);s.deleteShader(M);var C;this.getUniforms=function(){if(C===undefined){C=new Ji(s,g,e)}return C};var R;this.getAttributes=function(){if(R===undefined){R=xs(s,g)}return R};this.destroy=function(){s.deleteProgram(g);this.program=undefined};Object.defineProperties(this,{uniforms:{get:function e(){console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms().");return this.getUniforms()}},attributes:{get:function e(){console.warn("THREE.WebGLProgram: .attributes is now .getAttributes().");return this.getAttributes()}}});this.id=ds++;this.code=i;this.usedTimes=1;this.program=g;this.vertexShader=b;this.fragmentShader=M;return this}function Ss(e,t,i){var r=[];var n={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow"};var a=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function s(e){var t=e.skeleton;var r=t.bones;if(i.floatVertexTextures){return 1024}else{var n=i.maxVertexUniforms;var a=Math.floor((n-20)/4);var s=Math.min(a,r.length);if(s<r.length){console.warn("THREE.WebGLRenderer: Skeleton has "+r.length+" bones. This GPU supports "+s+".");return 0}return s}}function o(e,t){var i;if(!e){i=jt}else if(e.isTexture){i=e.encoding}else if(e.isWebGLRenderTarget){console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead.");i=e.texture.encoding}if(i===jt&&t){i=Ht}return i}this.getParameters=function(t,r,a,h,l,c,u){var f=n[t.type];var d=u.isSkinnedMesh?s(u):0;var p=i.precision;if(t.precision!==null){p=i.getMaxPrecision(t.precision);if(p!==t.precision){console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",p,"instead.")}}var v=e.getRenderTarget();var m={shaderID:f,precision:p,supportsVertexTextures:i.vertexTextures,outputEncoding:o(!v?null:v.texture,e.gammaOutput),map:!!t.map,mapEncoding:o(t.map,e.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:o(t.envMap,e.gammaInput),envMapCubeUV:!!t.envMap&&(t.envMap.mapping===He||t.envMap.mapping===Ve),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:o(t.emissiveMap,e.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,combine:t.combine,vertexColors:t.vertexColors,fog:!!h,useFog:t.fog,fogExp:h&&h.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:i.logarithmicDepthBuffer,skinning:t.skinning&&d>0,maxBones:d,useVertexTexture:i.floatVertexTextures,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:r.directional.length,numPointLights:r.point.length,numSpotLights:r.spot.length,numRectAreaLights:r.rectArea.length,numHemiLights:r.hemi.length,numClippingPlanes:l,numClipIntersection:c,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.receiveShadow&&a.length>0,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:t.side===Y,flipSided:t.side===X,depthPacking:t.depthPacking!==undefined?t.depthPacking:false};return m};this.getProgramCode=function(t,i){var r=[];if(i.shaderID){r.push(i.shaderID)}else{r.push(t.fragmentShader);r.push(t.vertexShader)}if(t.defines!==undefined){for(var n in t.defines){r.push(n);r.push(t.defines[n])}}for(var s=0;s<a.length;s++){r.push(i[a[s]])}r.push(t.onBeforeCompile.toString());r.push(e.gammaOutput);return r.join()};this.acquireProgram=function(i,n,a,s){var o;for(var h=0,l=r.length;h<l;h++){var c=r[h];if(c.code===s){o=c;++o.usedTimes;break}}if(o===undefined){o=new Es(e,t,s,i,n,a);r.push(o)}return o};this.releaseProgram=function(e){if(--e.usedTimes===0){var t=r.indexOf(e);r[t]=r[r.length-1];r.pop();e.destroy()}};this.programs=r}function As(e,t,i,r,n,a,s){var o=typeof WebGL2RenderingContext!=="undefined"&&e instanceof window.WebGL2RenderingContext;function h(e,t){if(e.width>t||e.height>t){var i=t/Math.max(e.width,e.height);var r=new wx.createCanvas;r.width=Math.floor(e.width*i);r.height=Math.floor(e.height*i);var n=r.getContext("2d");n.drawImage(e,0,0,e.width,e.height,0,0,r.width,r.height);console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+r.width+"x"+r.height,e);return r}return e}function l(e){return Qt.isPowerOfTwo(e.width)&&Qt.isPowerOfTwo(e.height)}function c(e){if(e){var t=new wx.createCanvas;t.width=Qt.floorPowerOfTwo(e.width);t.height=Qt.floorPowerOfTwo(e.height);var i=t.getContext("2d");i.drawImage(e,0,0,t.width,t.height);return t}return e}function u(e){return e.wrapS!==Xe||e.wrapT!==Xe||e.minFilter!==qe&&e.minFilter!==Qe}function f(e,t){return e.generateMipmaps&&t&&e.minFilter!==qe&&e.minFilter!==Qe}function d(t){if(t===qe||t===Ze||t===Je){return e.NEAREST}return e.LINEAR}function p(e){var t=e.target;t.removeEventListener("dispose",p);m(t);s.textures--}function v(e){var t=e.target;t.removeEventListener("dispose",v);g(t);s.textures--}function m(t){var i=r.get(t);if(t.image&&i.__image__webglTextureCube){e.deleteTexture(i.__image__webglTextureCube)}else{if(i.__webglInit===undefined)return;e.deleteTexture(i.__webglTexture)}r.remove(t)}function g(t){var i=r.get(t);var n=r.get(t.texture);if(!t)return;if(n.__webglTexture!==undefined){e.deleteTexture(n.__webglTexture)}if(t.depthTexture){t.depthTexture.dispose()}if(t.isWebGLRenderTargetCube){for(var a=0;a<6;a++){e.deleteFramebuffer(i.__webglFramebuffer[a]);if(i.__webglDepthbuffer)e.deleteRenderbuffer(i.__webglDepthbuffer[a])}}else{e.deleteFramebuffer(i.__webglFramebuffer);if(i.__webglDepthbuffer)e.deleteRenderbuffer(i.__webglDepthbuffer)}r.remove(t.texture);r.remove(t)}function y(t,n){var a=r.get(t);if(t.version>0&&a.__version!==t.version){var s=t.image;if(s===undefined){console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",t)}else if(s.complete===false){console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",t)}else{b(a,t,n);return}}i.activeTexture(e.TEXTURE0+n);i.bindTexture(e.TEXTURE_2D,a.__webglTexture)}function _(t,o){var c=r.get(t);if(t.image.length===6){if(t.version>0&&c.__version!==t.version){if(!c.__image__webglTextureCube){t.addEventListener("dispose",p);c.__image__webglTextureCube=e.createTexture();s.textures++}i.activeTexture(e.TEXTURE0+o);i.bindTexture(e.TEXTURE_CUBE_MAP,c.__image__webglTextureCube);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY);var u=t&&t.isCompressedTexture;var d=t.image[0]&&t.image[0].isDataTexture;var v=[];for(var m=0;m<6;m++){if(!u&&!d){v[m]=h(t.image[m],n.maxCubemapSize)}else{v[m]=d?t.image[m].image:t.image[m]}}var g=v[0],y=l(g),_=a.convert(t.format),x=a.convert(t.type);w(e.TEXTURE_CUBE_MAP,t,y);for(var m=0;m<6;m++){if(!u){if(d){i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,_,v[m].width,v[m].height,0,_,x,v[m].data)}else{i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,_,_,x,v[m])}}else{var b,M=v[m].mipmaps;for(var T=0,E=M.length;T<E;T++){b=M[T];if(t.format!==pt&&t.format!==dt){if(i.getCompressedTextureFormats().indexOf(_)>-1){i.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+m,T,_,b.width,b.height,0,b.data)}else{console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()")}}else{i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+m,T,_,b.width,b.height,0,_,x,b.data)}}}}if(f(t,y)){e.generateMipmap(e.TEXTURE_CUBE_MAP)}c.__version=t.version;if(t.onUpdate)t.onUpdate(t)}else{i.activeTexture(e.TEXTURE0+o);i.bindTexture(e.TEXTURE_CUBE_MAP,c.__image__webglTextureCube)}}}function x(t,n){i.activeTexture(e.TEXTURE0+n);i.bindTexture(e.TEXTURE_CUBE_MAP,r.get(t).__webglTexture)}function w(i,s,o){var h;if(o){e.texParameteri(i,e.TEXTURE_WRAP_S,a.convert(s.wrapS));e.texParameteri(i,e.TEXTURE_WRAP_T,a.convert(s.wrapT));e.texParameteri(i,e.TEXTURE_MAG_FILTER,a.convert(s.magFilter));e.texParameteri(i,e.TEXTURE_MIN_FILTER,a.convert(s.minFilter))}else{e.texParameteri(i,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(i,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);if(s.wrapS!==Xe||s.wrapT!==Xe){console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",s)}e.texParameteri(i,e.TEXTURE_MAG_FILTER,d(s.magFilter));e.texParameteri(i,e.TEXTURE_MIN_FILTER,d(s.minFilter));if(s.minFilter!==qe&&s.minFilter!==Qe){console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",s)}}h=t.get("EXT_texture_filter_anisotropic");if(h){if(s.type===st&&t.get("OES_texture_float_linear")===null)return;if(s.type===ot&&t.get("OES_texture_half_float_linear")===null)return;if(s.anisotropy>1||r.get(s).__currentAnisotropy){e.texParameterf(i,h.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,n.getMaxAnisotropy()));r.get(s).__currentAnisotropy=s.anisotropy}}}function b(t,r,d){if(t.__webglInit===undefined){t.__webglInit=true;r.addEventListener("dispose",p);t.__webglTexture=e.createTexture();s.textures++}i.activeTexture(e.TEXTURE0+d);i.bindTexture(e.TEXTURE_2D,t.__webglTexture);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY);e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha);e.pixelStorei(e.UNPACK_ALIGNMENT,r.unpackAlignment);var v=h(r.image,n.maxTextureSize);if(u(r)&&l(v)===false){v=c(v)}var m=l(v),g=a.convert(r.format),y=a.convert(r.type);w(e.TEXTURE_2D,r,m);var _,x=r.mipmaps;if(r.isDepthTexture){var b=e.DEPTH_COMPONENT;if(r.type===st){if(!o)throw new Error("Float Depth Texture only supported in WebGL2.0");b=e.DEPTH_COMPONENT32F}else if(o){b=e.DEPTH_COMPONENT16}if(r.format===yt&&b===e.DEPTH_COMPONENT){if(r.type!==rt&&r.type!==at){console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture.");r.type=rt;y=a.convert(r.type)}}if(r.format===_t){b=e.DEPTH_STENCIL;if(r.type!==ut){console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture.");r.type=ut;y=a.convert(r.type)}}i.texImage2D(e.TEXTURE_2D,0,b,v.width,v.height,0,g,y,null)}else if(r.isDataTexture){if(x.length>0&&m){for(var M=0,T=x.length;M<T;M++){_=x[M];i.texImage2D(e.TEXTURE_2D,M,g,_.width,_.height,0,g,y,_.data)}r.generateMipmaps=false}else{i.texImage2D(e.TEXTURE_2D,0,g,v.width,v.height,0,g,y,v.data)}}else if(r.isCompressedTexture){for(var M=0,T=x.length;M<T;M++){_=x[M];if(r.format!==pt&&r.format!==dt){if(i.getCompressedTextureFormats().indexOf(g)>-1){i.compressedTexImage2D(e.TEXTURE_2D,M,g,_.width,_.height,0,_.data)}else{console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()")}}else{i.texImage2D(e.TEXTURE_2D,M,g,_.width,_.height,0,g,y,_.data)}}}else{if(x.length>0&&m){for(var M=0,T=x.length;M<T;M++){_=x[M];i.texImage2D(e.TEXTURE_2D,M,g,g,y,_)}r.generateMipmaps=false}else{i.texImage2D(e.TEXTURE_2D,0,g,g,y,v)}}if(f(r,m))e.generateMipmap(e.TEXTURE_2D);t.__version=r.version;if(r.onUpdate)r.onUpdate(r)}function M(t,n,s,o){var h=a.convert(n.texture.format);var l=a.convert(n.texture.type);i.texImage2D(o,0,h,n.width,n.height,0,h,l,null);e.bindFramebuffer(e.FRAMEBUFFER,t);e.framebufferTexture2D(e.FRAMEBUFFER,s,o,r.get(n.texture).__webglTexture,0);e.bindFramebuffer(e.FRAMEBUFFER,null)}function T(t,i){e.bindRenderbuffer(e.RENDERBUFFER,t);if(i.depthBuffer&&!i.stencilBuffer){e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,i.width,i.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(i.depthBuffer&&i.stencilBuffer){e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,i.width,i.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{e.renderbufferStorage(e.RENDERBUFFER,e.RGBA4,i.width,i.height)}e.bindRenderbuffer(e.RENDERBUFFER,null)}function E(t,i){var n=i&&i.isWebGLRenderTargetCube;if(n)throw new Error("Depth Texture with cube render targets is not supported");e.bindFramebuffer(e.FRAMEBUFFER,t);if(!(i.depthTexture&&i.depthTexture.isDepthTexture)){throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture")}if(!r.get(i.depthTexture).__webglTexture||i.depthTexture.image.width!==i.width||i.depthTexture.image.height!==i.height){i.depthTexture.image.width=i.width;i.depthTexture.image.height=i.height;i.depthTexture.needsUpdate=true}y(i.depthTexture,0);var a=r.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===yt){e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0)}else if(i.depthTexture.format===_t){e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0)}else{throw new Error("Unknown depthTexture format")}}function S(t){var i=r.get(t);var n=t.isWebGLRenderTargetCube===true;if(t.depthTexture){if(n)throw new Error("target.depthTexture not supported in Cube render targets");E(i.__webglFramebuffer,t)}else{if(n){i.__webglDepthbuffer=[];for(var a=0;a<6;a++){e.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[a]);i.__webglDepthbuffer[a]=e.createRenderbuffer();T(i.__webglDepthbuffer[a],t)}}else{e.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer);i.__webglDepthbuffer=e.createRenderbuffer();T(i.__webglDepthbuffer,t)}}e.bindFramebuffer(e.FRAMEBUFFER,null)}function A(t){var n=r.get(t);var a=r.get(t.texture);t.addEventListener("dispose",v);a.__webglTexture=e.createTexture();s.textures++;var o=t.isWebGLRenderTargetCube===true;var h=l(t);if(o){n.__webglFramebuffer=[];for(var c=0;c<6;c++){n.__webglFramebuffer[c]=e.createFramebuffer()}}else{n.__webglFramebuffer=e.createFramebuffer()}if(o){i.bindTexture(e.TEXTURE_CUBE_MAP,a.__webglTexture);w(e.TEXTURE_CUBE_MAP,t.texture,h);for(var c=0;c<6;c++){M(n.__webglFramebuffer[c],t,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+c)}if(f(t.texture,h))e.generateMipmap(e.TEXTURE_CUBE_MAP);i.bindTexture(e.TEXTURE_CUBE_MAP,null)}else{i.bindTexture(e.TEXTURE_2D,a.__webglTexture);w(e.TEXTURE_2D,t.texture,h);M(n.__webglFramebuffer,t,e.COLOR_ATTACHMENT0,e.TEXTURE_2D);if(f(t.texture,h))e.generateMipmap(e.TEXTURE_2D);i.bindTexture(e.TEXTURE_2D,null)}if(t.depthBuffer){S(t)}}function L(t){var n=t.texture;var a=l(t);if(f(n,a)){var s=t.isWebGLRenderTargetCube?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D;var o=r.get(n).__webglTexture;i.bindTexture(s,o);e.generateMipmap(s);i.bindTexture(s,null)}}this.setTexture2D=y;this.setTextureCube=_;this.setTextureCubeDynamic=x;this.setupRenderTarget=A;this.updateRenderTargetMipmap=L}function Ls(){var e={};function t(t){var i=t.uuid;var r=e[i];if(r===undefined){r={};e[i]=r}return r}function i(t){delete e[t.uuid]}function r(){e={}}return{get:t,remove:i,clear:r}}function Cs(e,t,i){function r(){var t=false;var i=new ai;var r=null;var n=new ai(0,0,0,0);return{setMask:function i(n){if(r!==n&&!t){e.colorMask(n,n,n,n);r=n}},setLocked:function e(i){t=i},setClear:function t(r,a,s,o,h){if(h===true){r*=o;a*=o;s*=o}i.set(r,a,s,o);if(n.equals(i)===false){e.clearColor(r,a,s,o);n.copy(i)}},reset:function e(){t=false;r=null;n.set(-1,0,0,0)}}}function n(){var t=false;var i=null;var r=null;var n=null;return{setTest:function t(i){if(i){W(e.DEPTH_TEST)}else{q(e.DEPTH_TEST)}},setMask:function r(n){if(i!==n&&!t){e.depthMask(n);i=n}},setFunc:function t(i){if(r!==i){if(i){switch(i){case we:e.depthFunc(e.NEVER);break;case be:e.depthFunc(e.ALWAYS);break;case Me:e.depthFunc(e.LESS);break;case Te:e.depthFunc(e.LEQUAL);break;case Ee:e.depthFunc(e.EQUAL);break;case Se:e.depthFunc(e.GEQUAL);break;case Ae:e.depthFunc(e.GREATER);break;case Le:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}}else{e.depthFunc(e.LEQUAL)}r=i}},setLocked:function e(i){t=i},setClear:function t(i){if(n!==i){e.clearDepth(i);n=i}},reset:function e(){t=false;i=null;r=null;n=null}}}function a(){var t=false;var i=null;var r=null;var n=null;var a=null;var s=null;var o=null;var h=null;var l=null;return{setTest:function t(i){if(i){W(e.STENCIL_TEST)}else{q(e.STENCIL_TEST)}},setMask:function r(n){if(i!==n&&!t){e.stencilMask(n);i=n}},setFunc:function t(i,s,o){if(r!==i||n!==s||a!==o){e.stencilFunc(i,s,o);r=i;n=s;a=o}},setOp:function t(i,r,n){if(s!==i||o!==r||h!==n){e.stencilOp(i,r,n);s=i;o=r;h=n}},setLocked:function e(i){t=i},setClear:function t(i){if(l!==i){e.clearStencil(i);l=i}},reset:function e(){t=false;i=null;r=null;n=null;a=null;s=null;o=null;h=null;l=null}}}var s=new r;var o=new n;var h=new a;var l=e.getParameter(e.MAX_VERTEX_ATTRIBS);var c=new Uint8Array(l);var u=new Uint8Array(l);var f=new Uint8Array(l);var d={};var p=null;var v=null;var m=null;var g=null;var y=null;var _=null;var x=null;var w=null;var b=null;var M=false;var T=null;var E=null;var S=null;var A=null;var L=null;var C=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);var R=1.1;var I=parseFloat(R)>=1;var P=null;var O={};var k=new ai;var N=new ai;function D(t,i,r){var n=new Uint8Array(4);var a=e.createTexture();e.bindTexture(t,a);e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST);e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var s=0;s<r;s++){e.texImage2D(i+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,n)}return a}var F={};F[e.TEXTURE_2D]=D(e.TEXTURE_2D,e.TEXTURE_2D,1);F[e.TEXTURE_CUBE_MAP]=D(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6);s.setClear(0,0,0,1);o.setClear(1);h.setClear(0);W(e.DEPTH_TEST);o.setFunc(Te);ae(false);se(B);W(e.CULL_FACE);W(e.BLEND);Q(ee);function j(){for(var e=0,t=c.length;e<t;e++){c[e]=0}}function G(i){c[i]=1;if(u[i]===0){e.enableVertexAttribArray(i);u[i]=1}if(f[i]!==0){var r=t.get("ANGLE_instanced_arrays");r.vertexAttribDivisorANGLE(i,0);f[i]=0}}function H(i,r){c[i]=1;if(u[i]===0){e.enableVertexAttribArray(i);u[i]=1}if(f[i]!==r){var n=t.get("ANGLE_instanced_arrays");n.vertexAttribDivisorANGLE(i,r);f[i]=r}}function V(){for(var t=0,i=u.length;t!==i;++t){if(u[t]!==c[t]){e.disableVertexAttribArray(t);u[t]=0}}}function W(t){if(d[t]!==true){e.enable(t);d[t]=true}}function q(t){if(d[t]!==false){e.disable(t);d[t]=false}}function Z(){if(p===null){p=[];if(t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")){var i=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS);for(var r=0;r<i.length;r++){p.push(i[r])}}}return p}function J(t){if(v!==t){e.useProgram(t);v=t;return true}return false}function Q(t,r,n,a,s,o,h,l){if(t!==$){W(e.BLEND)}else{q(e.BLEND)}if(t!==ne){if(t!==m||l!==M){switch(t){case te:if(l){e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD);e.blendFuncSeparate(e.ONE,e.ONE,e.ONE,e.ONE)}else{e.blendEquation(e.FUNC_ADD);e.blendFunc(e.SRC_ALPHA,e.ONE)}break;case ie:if(l){e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD);e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA)}else{e.blendEquation(e.FUNC_ADD);e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR)}break;case re:if(l){e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD);e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA)}else{e.blendEquation(e.FUNC_ADD);e.blendFunc(e.ZERO,e.SRC_COLOR)}break;default:if(l){e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD);e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)}else{e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD);e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)}}}g=null;y=null;_=null;x=null;w=null;b=null}else{s=s||r;o=o||n;h=h||a;if(r!==g||s!==x){e.blendEquationSeparate(i.convert(r),i.convert(s));g=r;x=s}if(n!==y||a!==_||o!==w||h!==b){e.blendFuncSeparate(i.convert(n),i.convert(a),i.convert(o),i.convert(h));y=n;_=a;w=o;b=h}}m=t;M=l}function K(t){t.side===Y?q(e.CULL_FACE):W(e.CULL_FACE);ae(t.side===X);t.transparent===true?Q(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha):Q($);o.setFunc(t.depthFunc);o.setTest(t.depthTest);o.setMask(t.depthWrite);s.setMask(t.colorWrite);he(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)}function ae(t){if(T!==t){if(t){e.frontFace(e.CW)}else{e.frontFace(e.CCW)}T=t}}function se(t){if(t!==z){W(e.CULL_FACE);if(t!==E){if(t===B){e.cullFace(e.BACK)}else if(t===U){e.cullFace(e.FRONT)}else{e.cullFace(e.FRONT_AND_BACK)}}}else{q(e.CULL_FACE)}E=t}function oe(t){if(t!==S){if(I)e.lineWidth(t);S=t}}function he(t,i,r){if(t){W(e.POLYGON_OFFSET_FILL);if(A!==i||L!==r){e.polygonOffset(i,r);A=i;L=r}}else{q(e.POLYGON_OFFSET_FILL)}}function le(t){if(t){W(e.SCISSOR_TEST)}else{q(e.SCISSOR_TEST)}}function ce(t){if(t===undefined)t=e.TEXTURE0+C-1;if(P!==t){e.activeTexture(t);P=t}}function ue(t,i){if(P===null){ce()}var r=O[P];if(r===undefined){r={type:undefined,texture:undefined};O[P]=r}if(r.type!==t||r.texture!==i){e.bindTexture(t,i||F[t]);r.type=t;r.texture=i}}function fe(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}}function de(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}}function pe(t){if(k.equals(t)===false){e.scissor(t.x,t.y,t.z,t.w);k.copy(t)}}function ve(t){if(N.equals(t)===false){e.viewport(t.x,t.y,t.z,t.w);N.copy(t)}}function me(){for(var t=0;t<u.length;t++){if(u[t]===1){e.disableVertexAttribArray(t);u[t]=0}}d={};p=null;P=null;O={};v=null;m=null;T=null;E=null;s.reset();o.reset();h.reset()}return{buffers:{color:s,depth:o,stencil:h},initAttributes:j,enableAttribute:G,enableAttributeAndDivisor:H,disableUnusedAttributes:V,enable:W,disable:q,getCompressedTextureFormats:Z,useProgram:J,setBlending:Q,setMaterial:K,setFlipSided:ae,setCullFace:se,setLineWidth:oe,setPolygonOffset:he,setScissorTest:le,activeTexture:ce,bindTexture:ue,compressedTexImage2D:fe,texImage2D:de,scissor:pe,viewport:ve,reset:me}}function Rs(e,t,i){var r;function n(){if(r!==undefined)return r;var i=t.get("EXT_texture_filter_anisotropic");if(i!==null){r=e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else{r=0}return r}function a(t){if(t==="highp"){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0){return"highp"}t="mediump"}if(t==="mediump"){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0){return"mediump"}}return"lowp"}var s=i.precision!==undefined?i.precision:"highp";var o=a(s);if(o!==s){s=o}var h=i.logarithmicDepthBuffer===true;var l=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);var c=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS);var u=e.getParameter(e.MAX_TEXTURE_SIZE);var f=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE);var d=e.getParameter(e.MAX_VERTEX_ATTRIBS);var p=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS);var v=e.getParameter(e.MAX_VARYING_VECTORS);var m=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS);var g=c>0;var y=!!t.get("OES_texture_float");var _=g&&y;return{getMaxAnisotropy:n,getMaxPrecision:a,precision:s,logarithmicDepthBuffer:h,maxTextures:l,maxVertexTextures:c,maxTextureSize:u,maxCubemapSize:f,maxAttributes:d,maxVertexUniforms:p,maxVaryings:v,maxFragmentUniforms:m,vertexTextures:g,floatFragmentTextures:y,floatVertexTextures:_}}function Is(e,t,i,r){Ma.call(this);this.type="PerspectiveCamera";this.fov=e!==undefined?e:50;this.zoom=1;this.near=i!==undefined?i:.1;this.far=r!==undefined?r:2e3;this.focus=10;this.aspect=t!==undefined?t:1;this.view=null;this.filmGauge=35;this.filmOffset=0;this.updateProjectionMatrix()}Is.prototype=Object.assign(Object.create(Ma.prototype),{constructor:Is,isPerspectiveCamera:true,copy:function e(t,i){Ma.prototype.copy.call(this,t,i);this.fov=t.fov;this.zoom=t.zoom;this.near=t.near;this.far=t.far;this.focus=t.focus;this.aspect=t.aspect;this.view=t.view===null?null:Object.assign({},t.view);this.filmGauge=t.filmGauge;this.filmOffset=t.filmOffset;return this},setFocalLength:function e(t){var i=.5*this.getFilmHeight()/t;this.fov=Qt.RAD2DEG*2*Math.atan(i);this.updateProjectionMatrix()},getFocalLength:function e(){var t=Math.tan(Qt.DEG2RAD*.5*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function e(){return Qt.RAD2DEG*2*Math.atan(Math.tan(Qt.DEG2RAD*.5*this.fov)/this.zoom)},getFilmWidth:function e(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function e(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function e(t,i,r,n,a,s){this.aspect=t/i;if(this.view===null){this.view={enabled:true,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}}this.view.enabled=true;this.view.fullWidth=t;this.view.fullHeight=i;this.view.offsetX=r;this.view.offsetY=n;this.view.width=a;this.view.height=s;this.updateProjectionMatrix()},clearViewOffset:function e(){if(this.view!==null){this.view.enabled=false}this.updateProjectionMatrix()},updateProjectionMatrix:function e(){var t=this.near,i=t*Math.tan(Qt.DEG2RAD*.5*this.fov)/this.zoom,r=2*i,n=this.aspect*r,a=-.5*n,s=this.view;if(this.view!==null&&this.view.enabled){var o=s.fullWidth,h=s.fullHeight;a+=s.offsetX*n/o;i-=s.offsetY*r/h;n*=s.width/o;r*=s.height/h}var l=this.filmOffset;if(l!==0)a+=t*l/this.getFilmWidth();this.projectionMatrix.makePerspective(a,a+n,i,i-r,t,this.far)},toJSON:function e(t){var i=ba.prototype.toJSON.call(this,t);i.object.fov=this.fov;i.object.zoom=this.zoom;i.object.near=this.near;i.object.far=this.far;i.object.focus=this.focus;i.object.aspect=this.aspect;if(this.view!==null)i.object.view=Object.assign({},this.view);i.object.filmGauge=this.filmGauge;i.object.filmOffset=this.filmOffset;return i}});function Ps(e){Is.call(this);this.cameras=e||[]}Ps.prototype=Object.assign(Object.create(Is.prototype),{constructor:Ps,isArrayCamera:true});function Os(e){var t=this;var i=null;var r=null;if(typeof window!=="undefined"&&"VRFrameData"in window){r=new window.VRFrameData}var n=new $t;var a=new $t;var s=new $t;var o=new Is;o.bounds=new ai(0,0,.5,1);o.layers.enable(1);var h=new Is;h.bounds=new ai(.5,0,.5,1);h.layers.enable(2);var l=new Ps([o,h]);l.layers.enable(1);l.layers.enable(2);var c,u;function f(){if(i!==null&&i.isPresenting){var r=i.getEyeParameters("left");var n=r.renderWidth;var a=r.renderHeight;u=e.getPixelRatio();c=e.getSize();e.setDrawingBufferSize(n*2,a,1)}else if(t.enabled){e.setDrawingBufferSize(c.width,c.height,u)}}if(typeof window!=="undefined"){window.addEventListener("vrdisplaypresentchange",f,false)}this.enabled=false;this.standing=false;this.getDevice=function(){return i};this.setDevice=function(e){if(e!==undefined)i=e};this.getCamera=function(e){if(i===null)return e;i.depthNear=e.near;i.depthFar=e.far;i.getFrameData(r);var t=r.pose;if(t.position!==null){e.position.fromArray(t.position)}else{e.position.set(0,0,0)}if(t.orientation!==null){e.quaternion.fromArray(t.orientation)}e.updateMatrixWorld();var c=i.stageParameters;if(this.standing&&c){a.fromArray(c.sittingToStandingTransform);s.getInverse(a);e.matrixWorld.multiply(a);e.matrixWorldInverse.multiply(s)}if(i.isPresenting===false)return e;o.near=e.near;h.near=e.near;o.far=e.far;h.far=e.far;l.matrixWorld.copy(e.matrixWorld);l.matrixWorldInverse.copy(e.matrixWorldInverse);o.matrixWorldInverse.fromArray(r.leftViewMatrix);h.matrixWorldInverse.fromArray(r.rightViewMatrix);if(this.standing&&c){o.matrixWorldInverse.multiply(s);h.matrixWorldInverse.multiply(s)}var u=e.parent;if(u!==null){n.getInverse(u.matrixWorld);o.matrixWorldInverse.multiply(n);h.matrixWorldInverse.multiply(n)}o.matrixWorld.getInverse(o.matrixWorldInverse);h.matrixWorld.getInverse(h.matrixWorldInverse);o.projectionMatrix.fromArray(r.leftProjectionMatrix);h.projectionMatrix.fromArray(r.rightProjectionMatrix);l.projectionMatrix.copy(o.projectionMatrix);var f=i.getLayers();if(f.length){var d=f[0];if(d.leftBounds!==null&&d.leftBounds.length===4){o.bounds.fromArray(d.leftBounds)}if(d.rightBounds!==null&&d.rightBounds.length===4){h.bounds.fromArray(d.rightBounds)}}return l};this.getStandingMatrix=function(){return a};this.submitFrame=function(){if(i&&i.isPresenting)i.submitFrame()};this.dispose=function(){if(typeof window!=="undefined"){window.removeEventListener("vrdisplaypresentchange",f)}}}function ks(e){var t={};return{get:function i(r){if(t[r]!==undefined){return t[r]}var n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":n=e.getExtension("WEBGL_compressed_texture_etc1");break;default:n=e.getExtension(r)}if(n===null){}t[r]=n;return n}}}function Ns(){var e=this,t=null,i=0,r=false,n=false,a=new va,s=new ii,o={value:null,needsUpdate:false};this.uniform=o;this.numPlanes=0;this.numIntersection=0;this.init=function(e,n,a){var s=e.length!==0||n||i!==0||r;r=n;t=l(e,a,0);i=e.length;return s};this.beginShadows=function(){n=true;l(null)};this.endShadows=function(){n=false;h()};this.setState=function(e,a,s,c,u,f){if(!r||e===null||e.length===0||n&&!s){if(n){l(null)}else{h()}}else{var d=n?0:i,p=d*4,v=u.clippingState||null;o.value=v;v=l(e,c,p,f);for(var m=0;m!==p;++m){v[m]=t[m]}u.clippingState=v;this.numIntersection=a?this.numPlanes:0;this.numPlanes+=d}};function h(){if(o.value!==t){o.value=t;o.needsUpdate=i>0}e.numPlanes=i;e.numIntersection=0}function l(t,i,r,n){var h=t!==null?t.length:0,l=null;if(h!==0){l=o.value;if(n!==true||l===null){var c=r+h*4,u=i.matrixWorldInverse;s.getNormalMatrix(u);if(l===null||l.length<c){l=new Float32Array(c)}for(var f=0,d=r;f!==h;++f,d+=4){a.copy(t[f]).applyMatrix4(u,s);a.normal.toArray(l,d);l[d+3]=a.constant}}o.value=l;o.needsUpdate=true}e.numPlanes=h;return l}}function zs(e,t){function i(i){var r;if(i===We)return e.REPEAT;if(i===Xe)return e.CLAMP_TO_EDGE;if(i===Ye)return e.MIRRORED_REPEAT;if(i===qe)return e.NEAREST;if(i===Ze)return e.NEAREST_MIPMAP_NEAREST;if(i===Je)return e.NEAREST_MIPMAP_LINEAR;if(i===Qe)return e.LINEAR;if(i===Ke)return e.LINEAR_MIPMAP_NEAREST;if(i===$e)return e.LINEAR_MIPMAP_LINEAR;if(i===et)return e.UNSIGNED_BYTE;if(i===ht)return e.UNSIGNED_SHORT_4_4_4_4;if(i===lt)return e.UNSIGNED_SHORT_5_5_5_1;if(i===ct)return e.UNSIGNED_SHORT_5_6_5;if(i===tt)return e.BYTE;if(i===it)return e.SHORT;if(i===rt)return e.UNSIGNED_SHORT;if(i===nt)return e.INT;if(i===at)return e.UNSIGNED_INT;if(i===st)return e.FLOAT;if(i===ot){r=t.get("OES_texture_half_float");if(r!==null)return r.HALF_FLOAT_OES}if(i===ft)return e.ALPHA;if(i===dt)return e.RGB;if(i===pt)return e.RGBA;if(i===vt)return e.LUMINANCE;if(i===mt)return e.LUMINANCE_ALPHA;if(i===yt)return e.DEPTH_COMPONENT;if(i===_t)return e.DEPTH_STENCIL;if(i===ae)return e.FUNC_ADD;if(i===se)return e.FUNC_SUBTRACT;if(i===oe)return e.FUNC_REVERSE_SUBTRACT;if(i===ce)return e.ZERO;if(i===ue)return e.ONE;if(i===fe)return e.SRC_COLOR;if(i===de)return e.ONE_MINUS_SRC_COLOR;if(i===pe)return e.SRC_ALPHA;if(i===ve)return e.ONE_MINUS_SRC_ALPHA;if(i===me)return e.DST_ALPHA;if(i===ge)return e.ONE_MINUS_DST_ALPHA;if(i===ye)return e.DST_COLOR;if(i===_e)return e.ONE_MINUS_DST_COLOR;if(i===xe)return e.SRC_ALPHA_SATURATE;if(i===xt||i===wt||i===bt||i===Mt){r=t.get("WEBGL_compressed_texture_s3tc");if(r!==null){if(i===xt)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===wt)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===bt)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===Mt)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}}if(i===Tt||i===Et||i===St||i===At){r=t.get("WEBGL_compressed_texture_pvrtc");if(r!==null){if(i===Tt)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===Et)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===St)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===At)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}}if(i===Lt){r=t.get("WEBGL_compressed_texture_etc1");if(r!==null)return r.COMPRESSED_RGB_ETC1_WEBGL}if(i===he||i===le){r=t.get("EXT_blend_minmax");if(r!==null){if(i===he)return r.MIN_EXT;if(i===le)return r.MAX_EXT}}if(i===ut){r=t.get("WEBGL_depth_texture");if(r!==null)return r.UNSIGNED_INT_24_8_WEBGL}return 0}return{convert:i}}function Bs(e){console.log("THREE.WebGLRenderer",k);e=e||{};var t=e.canvas!==undefined?e.canvas:new wx.createCanvas,i=e.context!==undefined?e.context:null,r=e.alpha!==undefined?e.alpha:false,n=e.depth!==undefined?e.depth:true,a=e.stencil!==undefined?e.stencil:true,s=e.antialias!==undefined?e.antialias:false,o=e.premultipliedAlpha!==undefined?e.premultipliedAlpha:true,h=e.preserveDrawingBuffer!==undefined?e.preserveDrawingBuffer:false;var l=[];var c=[];var u=null;var f=[];var d=[];this.domElement=t;this.context=null;this.autoClear=true;this.autoClearColor=true;this.autoClearDepth=true;this.autoClearStencil=true;this.sortObjects=true;this.clippingPlanes=[];this.localClippingEnabled=false;this.gammaFactor=2;this.gammaInput=false;this.gammaOutput=false;this.physicallyCorrectLights=false;this.toneMapping=Oe;this.toneMappingExposure=1;this.toneMappingWhitePoint=1;this.maxMorphTargets=8;this.maxMorphNormals=4;var p=this,v=false,m=null,g=null,y=-1,_="",x=null,w=null,b=new ai,M=new ai,T=null,E=0,S=t.width,A=t.height,L=1,C=new ai(0,0,S,A),R=new ai(0,0,S,A),I=false,P=new ma,O=new Ns,N=false,z=false,B=new $t,U=new ti,D={geometries:0,textures:0},j={frame:0,calls:0,vertices:0,faces:0,points:0};this.info={render:j,memory:D,programs:null};function G(){return m===null?L:1}var H;try{var V={alpha:r,depth:n,stencil:a,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:h};H=i||t.getContext("webgl",V)||t.getContext("experimental-webgl",V);if(H===null){if(t.getContext("webgl")!==null){throw"Error creating WebGL context with your selected attributes."}else{throw"Error creating WebGL context."}}if(H.getShaderPrecisionFormat===undefined){H.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}}t.addEventListener("webglcontextlost",de,false);t.addEventListener("webglcontextrestored",pe,false)}catch(e){console.error("THREE.WebGLRenderer: "+e)}var W,X,Y;var q,Z,Q,K,$,ee;var te,ie;var re,ne,ae,se;var oe,he;var le;function ce(){W=new ks(H);W.get("WEBGL_depth_texture");W.get("OES_texture_float");W.get("OES_texture_float_linear");W.get("OES_texture_half_float");W.get("OES_texture_half_float_linear");W.get("OES_standard_derivatives");W.get("OES_element_index_uint");W.get("ANGLE_instanced_arrays");le=new zs(H,W);X=new Rs(H,W,e);Y=new Cs(H,W,le);Y.scissor(M.copy(R).multiplyScalar(L));Y.viewport(b.copy(C).multiplyScalar(L));q=new Ls;Z=new As(H,W,Y,q,X,le,D);Q=new ya(H);K=new os(H,Q,D);$=new cs(K,j);ne=new ns(H);te=new Ss(p,W,X);ee=new ls;ie=new is;re=new Ka(p,Y,K,o);ae=new ss(H,W,j);se=new as(H,W,j);oe=new sa(p,H,Y,Z,X);he=new ha(p,H,Y,Z,X);p.info.programs=te.programs;p.context=H;p.capabilities=X;p.extensions=W;p.properties=q;p.renderLists=ie;p.state=Y}ce();var ue=new Os(p);this.vr=ue;var fe=new ga(p,$,X.maxTextureSize);this.shadowMap=fe;this.getContext=function(){return H};this.getContextAttributes=function(){return H.getContextAttributes()};this.forceContextLoss=function(){var e=W.get("WEBGL_lose_context");if(e)e.loseContext()};this.forceContextRestore=function(){var e=W.get("WEBGL_lose_context");if(e)e.restoreContext()};this.getPixelRatio=function(){return L};this.setPixelRatio=function(e){if(e===undefined)return;L=e;this.setSize(S,A,false)};this.getSize=function(){return{width:S,height:A}};this.setSize=function(e,i,r){var n=ue.getDevice();if(n&&n.isPresenting){return}S=e;A=i;t.width=e*L;t.height=i*L;if(r!==false){t.style.width=e+"px";t.style.height=i+"px"}this.setViewport(0,0,e,i)};this.getDrawingBufferSize=function(){return{width:S*L,height:A*L}};this.setDrawingBufferSize=function(e,i,r){S=e;A=i;L=r;t.width=e*r;t.height=i*r;this.setViewport(0,0,e,i)};this.setViewport=function(e,t,i,r){C.set(e,A-t-r,i,r);Y.viewport(b.copy(C).multiplyScalar(L))};this.setScissor=function(e,t,i,r){R.set(e,A-t-r,i,r);Y.scissor(M.copy(R).multiplyScalar(L))};this.setScissorTest=function(e){Y.setScissorTest(I=e)};this.getClearColor=function(){return re.getClearColor()};this.setClearColor=function(){re.setClearColor.apply(re,arguments)};this.getClearAlpha=function(){return re.getClearAlpha()};this.setClearAlpha=function(){re.setClearAlpha.apply(re,arguments)};this.clear=function(e,t,i){var r=0;if(e===undefined||e)r|=H.COLOR_BUFFER_BIT;if(t===undefined||t)r|=H.DEPTH_BUFFER_BIT;if(i===undefined||i)r|=H.STENCIL_BUFFER_BIT;H.clear(r)};this.clearColor=function(){this.clear(true,false,false)};this.clearDepth=function(){this.clear(false,true,false)};this.clearStencil=function(){this.clear(false,false,true)};this.clearTarget=function(e,t,i,r){this.setRenderTarget(e);this.clear(t,i,r)};this.dispose=function(){t.removeEventListener("webglcontextlost",de,false);t.removeEventListener("webglcontextrestored",pe,false);ie.dispose();ue.dispose()};function de(e){e.preventDefault();console.log("THREE.WebGLRenderer: Context Lost.");v=true}function pe(){console.log("THREE.WebGLRenderer: Context Restored.");v=false;ce()}function ve(e){var t=e.target;t.removeEventListener("dispose",ve);me(t)}function me(e){ge(e);q.remove(e)}function ge(e){var t=q.get(e).program;e.program=undefined;if(t!==undefined){te.releaseProgram(t)}}function ye(e,t,i){e.render(function(e){p.renderBufferImmediate(e,t,i)})}this.renderBufferImmediate=function(e,t,i){Y.initAttributes();var r=q.get(e);if(e.hasPositions&&!r.position)r.position=H.createBuffer();if(e.hasNormals&&!r.normal)r.normal=H.createBuffer();if(e.hasUvs&&!r.uv)r.uv=H.createBuffer();if(e.hasColors&&!r.color)r.color=H.createBuffer();var n=t.getAttributes();if(e.hasPositions){H.bindBuffer(H.ARRAY_BUFFER,r.position);H.bufferData(H.ARRAY_BUFFER,e.positionArray,H.DYNAMIC_DRAW);Y.enableAttribute(n.position);H.vertexAttribPointer(n.position,3,H.FLOAT,false,0,0)}if(e.hasNormals){H.bindBuffer(H.ARRAY_BUFFER,r.normal);if(!i.isMeshPhongMaterial&&!i.isMeshStandardMaterial&&!i.isMeshNormalMaterial&&i.flatShading===true){for(var a=0,s=e.count*3;a<s;a+=9){var o=e.normalArray;var h=(o[a+0]+o[a+3]+o[a+6])/3;var l=(o[a+1]+o[a+4]+o[a+7])/3;var c=(o[a+2]+o[a+5]+o[a+8])/3;o[a+0]=h;o[a+1]=l;o[a+2]=c;o[a+3]=h;o[a+4]=l;o[a+5]=c;o[a+6]=h;o[a+7]=l;o[a+8]=c}}H.bufferData(H.ARRAY_BUFFER,e.normalArray,H.DYNAMIC_DRAW);Y.enableAttribute(n.normal);H.vertexAttribPointer(n.normal,3,H.FLOAT,false,0,0)}if(e.hasUvs&&i.map){H.bindBuffer(H.ARRAY_BUFFER,r.uv);H.bufferData(H.ARRAY_BUFFER,e.uvArray,H.DYNAMIC_DRAW);Y.enableAttribute(n.uv);H.vertexAttribPointer(n.uv,2,H.FLOAT,false,0,0)}if(e.hasColors&&i.vertexColors!==J){H.bindBuffer(H.ARRAY_BUFFER,r.color);H.bufferData(H.ARRAY_BUFFER,e.colorArray,H.DYNAMIC_DRAW);Y.enableAttribute(n.color);H.vertexAttribPointer(n.color,3,H.FLOAT,false,0,0)}Y.disableUnusedAttributes();H.drawArrays(H.TRIANGLES,0,e.count);e.count=0};this.renderBufferDirect=function(e,t,i,r,n,a){Y.setMaterial(r);var s=Le(e,t,r,n);var o=i.id+"_"+s.id+"_"+(r.wireframe===true);var h=false;if(o!==_){_=o;h=true}if(n.morphTargetInfluences){ne.update(n,i,r,s);h=true}var l=i.index;var c=i.attributes.position;var u=1;if(r.wireframe===true){l=K.getWireframeAttribute(i);u=2}var f;var d=ae;if(l!==null){f=Q.get(l);d=se;d.setIndex(f)}if(h){_e(r,s,i);if(l!==null){H.bindBuffer(H.ELEMENT_ARRAY_BUFFER,f.buffer)}}var p=0;if(l!==null){p=l.count}else if(c!==undefined){p=c.count}var v=i.drawRange.start*u;var m=i.drawRange.count*u;var g=a!==null?a.start*u:0;var y=a!==null?a.count*u:Infinity;var x=Math.max(v,g);var w=Math.min(p,v+m,g+y)-1;var b=Math.max(0,w-x+1);if(b===0)return;if(n.isMesh){if(r.wireframe===true){Y.setLineWidth(r.wireframeLinewidth*G());d.setMode(H.LINES)}else{switch(n.drawMode){case Ut:d.setMode(H.TRIANGLES);break;case Dt:d.setMode(H.TRIANGLE_STRIP);break;case Ft:d.setMode(H.TRIANGLE_FAN);break}}}else if(n.isLine){var M=r.linewidth;if(M===undefined)M=1;Y.setLineWidth(M*G());if(n.isLineSegments){d.setMode(H.LINES)}else if(n.isLineLoop){d.setMode(H.LINE_LOOP)}else{d.setMode(H.LINE_STRIP)}}else if(n.isPoints){d.setMode(H.POINTS)}if(i&&i.isInstancedBufferGeometry){if(i.maxInstancedCount>0){d.renderInstances(i,x,b)}}else{d.render(x,b)}};function _e(e,t,i,r){if(i&&i.isInstancedBufferGeometry){if(W.get("ANGLE_instanced_arrays")===null){console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}}if(r===undefined)r=0;Y.initAttributes();var n=i.attributes;var a=t.getAttributes();var s=e.defaultAttributeValues;for(var o in a){var h=a[o];if(h>=0){var l=n[o];if(l!==undefined){var c=l.normalized;var u=l.itemSize;var f=Q.get(l);if(f===undefined)continue;var d=f.buffer;var p=f.type;var v=f.bytesPerElement;if(l.isInterleavedBufferAttribute){var m=l.data;var g=m.stride;var y=l.offset;if(m&&m.isInstancedInterleavedBuffer){Y.enableAttributeAndDivisor(h,m.meshPerAttribute);if(i.maxInstancedCount===undefined){i.maxInstancedCount=m.meshPerAttribute*m.count}}else{Y.enableAttribute(h)}H.bindBuffer(H.ARRAY_BUFFER,d);H.vertexAttribPointer(h,u,p,c,g*v,(r*g+y)*v)}else{if(l.isInstancedBufferAttribute){Y.enableAttributeAndDivisor(h,l.meshPerAttribute);if(i.maxInstancedCount===undefined){i.maxInstancedCount=l.meshPerAttribute*l.count}}else{Y.enableAttribute(h)}H.bindBuffer(H.ARRAY_BUFFER,d);H.vertexAttribPointer(h,u,p,c,0,r*u*v)}}else if(s!==undefined){var _=s[o];if(_!==undefined){switch(_.length){case 2:H.vertexAttrib2fv(h,_);break;case 3:H.vertexAttrib3fv(h,_);break;case 4:H.vertexAttrib4fv(h,_);break;default:H.vertexAttrib1fv(h,_)}}}}}Y.disableUnusedAttributes()}this.compile=function(e,t){l.length=0;c.length=0;e.traverse(function(e){if(e.isLight){l.push(e);if(e.castShadow){c.push(e)}}});ee.setup(l,c,t);e.traverse(function(t){if(t.material){if(Array.isArray(t.material)){for(var i=0;i<t.material.length;i++){Ae(t.material[i],e.fog,t)}}else{Ae(t.material,e.fog,t)}}})};var xe=false;var we=null;function be(){if(xe)return;var e=ue.getDevice();if(e&&e.isPresenting){e.requestAnimationFrame(Me)}else{window.requestAnimationFrame(Me)}xe=true}function Me(e){if(we!==null)we(e);var t=ue.getDevice();if(t&&t.isPresenting){t.requestAnimationFrame(Me)}else{window.requestAnimationFrame(Me)}}this.animate=function(e){we=e;be()};this.render=function(e,t,i,r){if(!(t&&t.isCamera)){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(v)return;_="";y=-1;x=null;if(e.autoUpdate===true)e.updateMatrixWorld();if(t.parent===null)t.updateMatrixWorld();if(ue.enabled){t=ue.getCamera(t)}B.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);P.setFromMatrix(B);l.length=0;c.length=0;f.length=0;d.length=0;z=this.localClippingEnabled;N=O.init(this.clippingPlanes,z,t);u=ie.get(e,t);u.init();Te(e,t,p.sortObjects);if(p.sortObjects===true){u.sort()}if(N)O.beginShadows();fe.render(c,e,t);ee.setup(l,c,t);if(N)O.endShadows();j.frame++;j.calls=0;j.vertices=0;j.faces=0;j.points=0;if(i===undefined){i=null}this.setRenderTarget(i);re.render(u,e,t,r);var n=u.opaque;var a=u.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;if(n.length)Ee(n,e,t,s);if(a.length)Ee(a,e,t,s)}else{if(n.length)Ee(n,e,t);if(a.length)Ee(a,e,t)}he.render(f,e,t);oe.render(d,e,t,b);if(i){Z.updateRenderTargetMipmap(i)}Y.buffers.depth.setTest(true);Y.buffers.depth.setMask(true);Y.buffers.color.setMask(true);Y.setPolygonOffset(false);if(ue.enabled){ue.submitFrame()}};function Te(e,t,i){if(e.visible===false)return;var r=e.layers.test(t.layers);if(r){if(e.isLight){l.push(e);if(e.castShadow){c.push(e)}}else if(e.isSprite){if(!e.frustumCulled||P.intersectsSprite(e)){f.push(e)}}else if(e.isLensFlare){d.push(e)}else if(e.isImmediateRenderObject){if(i){U.setFromMatrixPosition(e.matrixWorld).applyMatrix4(B)}u.push(e,null,e.material,U.z,null)}else if(e.isMesh||e.isLine||e.isPoints){if(e.isSkinnedMesh){e.skeleton.update()}if(!e.frustumCulled||P.intersectsObject(e)){if(i){U.setFromMatrixPosition(e.matrixWorld).applyMatrix4(B)}var n=$.update(e);var a=e.material;if(Array.isArray(a)){var s=n.groups;for(var o=0,h=s.length;o<h;o++){var p=s[o];var v=a[p.materialIndex];if(v&&v.visible){u.push(e,n,v,U.z,p)}}}else if(a.visible){u.push(e,n,a,U.z,null)}}}}var m=e.children;for(var o=0,h=m.length;o<h;o++){Te(m[o],t,i)}}function Ee(e,t,i,r){for(var n=0,a=e.length;n<a;n++){var s=e[n];var o=s.object;var h=s.geometry;var l=r===undefined?s.material:r;var c=s.group;if(i.isArrayCamera){w=i;var u=i.cameras;for(var f=0,d=u.length;f<d;f++){var p=u[f];if(o.layers.test(p.layers)){var v=p.bounds;var m=v.x*S;var g=v.y*A;var y=v.z*S;var _=v.w*A;Y.viewport(b.set(m,g,y,_).multiplyScalar(L));Se(o,t,p,h,l,c)}}}else{w=null;Se(o,t,i,h,l,c)}}}function Se(e,t,i,r,n,a){e.onBeforeRender(p,t,i,r,n,a);e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld);e.normalMatrix.getNormalMatrix(e.modelViewMatrix);if(e.isImmediateRenderObject){Y.setMaterial(n);var s=Le(i,t.fog,n,e);_="";ye(e,s,n)}else{p.renderBufferDirect(i,t.fog,r,n,e,a)}e.onAfterRender(p,t,i,r,n,a)}function Ae(e,t,i){var r=q.get(e);var n=te.getParameters(e,ee.state,c,t,O.numPlanes,O.numIntersection,i);var a=te.getProgramCode(e,n);var s=r.program;var o=true;if(s===undefined){e.addEventListener("dispose",ve)}else if(s.code!==a){ge(e)}else if(n.shaderID!==undefined){return}else{o=false}if(o){if(n.shaderID){var h=na[n.shaderID];r.shader={name:e.type,uniforms:er.clone(h.uniforms),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader}}else{r.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}}e.onBeforeCompile(r.shader);s=te.acquireProgram(e,r.shader,n,a);r.program=s;e.program=s}var l=s.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var u=0;u<p.maxMorphTargets;u++){if(l["morphTarget"+u]>=0){e.numSupportedMorphTargets++}}}if(e.morphNormals){e.numSupportedMorphNormals=0;for(var u=0;u<p.maxMorphNormals;u++){if(l["morphNormal"+u]>=0){e.numSupportedMorphNormals++}}}var f=r.shader.uniforms;if(!e.isShaderMaterial&&!e.isRawShaderMaterial||e.clipping===true){r.numClippingPlanes=O.numPlanes;r.numIntersection=O.numIntersection;f.clippingPlanes=O.uniform}r.fog=t;r.lightsHash=ee.state.hash;if(e.lights){f.ambientLightColor.value=ee.state.ambient;f.directionalLights.value=ee.state.directional;f.spotLights.value=ee.state.spot;f.rectAreaLights.value=ee.state.rectArea;f.pointLights.value=ee.state.point;f.hemisphereLights.value=ee.state.hemi;f.directionalShadowMap.value=ee.state.directionalShadowMap;f.directionalShadowMatrix.value=ee.state.directionalShadowMatrix;f.spotShadowMap.value=ee.state.spotShadowMap;f.spotShadowMatrix.value=ee.state.spotShadowMatrix;f.pointShadowMap.value=ee.state.pointShadowMap;f.pointShadowMatrix.value=ee.state.pointShadowMatrix}var d=r.program.getUniforms(),v=Ji.seqWithValue(d.seq,f);r.uniformsList=v}function Le(e,t,i,r){E=0;var n=q.get(i);if(N){if(z||e!==x){var a=e===x&&i.id===y;O.setState(i.clippingPlanes,i.clipIntersection,i.clipShadows,e,n,a)}}if(i.needsUpdate===false){if(n.program===undefined){i.needsUpdate=true}else if(i.fog&&n.fog!==t){i.needsUpdate=true}else if(i.lights&&n.lightsHash!==ee.state.hash){i.needsUpdate=true}else if(n.numClippingPlanes!==undefined&&(n.numClippingPlanes!==O.numPlanes||n.numIntersection!==O.numIntersection)){i.needsUpdate=true}}if(i.needsUpdate){Ae(i,t,r);i.needsUpdate=false}var s=false;var o=false;var h=false;var l=n.program,c=l.getUniforms(),u=n.shader.uniforms;if(Y.useProgram(l.program)){s=true;o=true;h=true}if(i.id!==y){y=i.id;o=true}if(s||e!==x){c.setValue(H,"projectionMatrix",e.projectionMatrix);if(X.logarithmicDepthBuffer){c.setValue(H,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2))}if(x!==(w||e)){x=w||e;o=true;h=true}if(i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.envMap){var f=c.map.cameraPosition;if(f!==undefined){f.setValue(H,U.setFromMatrixPosition(e.matrixWorld))}}if(i.isMeshPhongMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.skinning){c.setValue(H,"viewMatrix",e.matrixWorldInverse)}}if(i.skinning){c.setOptional(H,r,"bindMatrix");c.setOptional(H,r,"bindMatrixInverse");var d=r.skeleton;if(d){var v=d.bones;if(X.floatVertexTextures){if(d.boneTexture===undefined){var m=Math.sqrt(v.length*4);m=Qt.ceilPowerOfTwo(m);m=Math.max(m,4);var g=new Float32Array(m*m*4);g.set(d.boneMatrices);var _=new hi(g,m,m,pt,st);d.boneMatrices=g;d.boneTexture=_;d.boneTextureSize=m}c.setValue(H,"boneTexture",d.boneTexture);c.setValue(H,"boneTextureSize",d.boneTextureSize)}else{c.setOptional(H,d,"boneMatrices")}}}if(o){c.setValue(H,"toneMappingExposure",p.toneMappingExposure);c.setValue(H,"toneMappingWhitePoint",p.toneMappingWhitePoint);if(i.lights){He(u,h)}if(t&&i.fog){ke(u,t)}if(i.isMeshBasicMaterial){Ce(u,i)}else if(i.isMeshLambertMaterial){Ce(u,i);Ne(u,i)}else if(i.isMeshPhongMaterial){Ce(u,i);if(i.isMeshToonMaterial){Be(u,i)}else{ze(u,i)}}else if(i.isMeshStandardMaterial){Ce(u,i);if(i.isMeshPhysicalMaterial){De(u,i)}else{Ue(u,i)}}else if(i.isMeshDepthMaterial){Ce(u,i);Fe(u,i)}else if(i.isMeshDistanceMaterial){Ce(u,i);je(u,i)}else if(i.isMeshNormalMaterial){Ce(u,i);Ge(u,i)}else if(i.isLineBasicMaterial){Re(u,i);if(i.isLineDashedMaterial){Ie(u,i)}}else if(i.isPointsMaterial){Pe(u,i)}else if(i.isShadowMaterial){u.color.value=i.color;u.opacity.value=i.opacity}if(u.ltcMat!==undefined)u.ltcMat.value=$i.LTC_MAT_TEXTURE;if(u.ltcMag!==undefined)u.ltcMag.value=$i.LTC_MAG_TEXTURE;Ji.upload(H,n.uniformsList,u,p)}c.setValue(H,"modelViewMatrix",r.modelViewMatrix);c.setValue(H,"normalMatrix",r.normalMatrix);c.setValue(H,"modelMatrix",r.matrixWorld);return l}function Ce(e,t){e.opacity.value=t.opacity;if(t.color){e.diffuse.value=t.color}if(t.emissive){e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity)}if(t.map){e.map.value=t.map}if(t.alphaMap){e.alphaMap.value=t.alphaMap}if(t.specularMap){e.specularMap.value=t.specularMap}if(t.envMap){e.envMap.value=t.envMap;e.flipEnvMap.value=!(t.envMap&&t.envMap.isCubeTexture)?1:-1;e.reflectivity.value=t.reflectivity;e.refractionRatio.value=t.refractionRatio}if(t.lightMap){e.lightMap.value=t.lightMap;e.lightMapIntensity.value=t.lightMapIntensity}if(t.aoMap){e.aoMap.value=t.aoMap;e.aoMapIntensity.value=t.aoMapIntensity}var i;if(t.map){i=t.map}else if(t.specularMap){i=t.specularMap}else if(t.displacementMap){i=t.displacementMap}else if(t.normalMap){i=t.normalMap}else if(t.bumpMap){i=t.bumpMap}else if(t.roughnessMap){i=t.roughnessMap}else if(t.metalnessMap){i=t.metalnessMap}else if(t.alphaMap){i=t.alphaMap}else if(t.emissiveMap){i=t.emissiveMap}if(i!==undefined){if(i.isWebGLRenderTarget){i=i.texture}if(i.matrixAutoUpdate===true){var r=i.offset;var n=i.repeat;var a=i.rotation;var s=i.center;i.matrix.setUvTransform(r.x,r.y,n.x,n.y,a,s.x,s.y)}e.uvTransform.value.copy(i.matrix)}}function Re(e,t){e.diffuse.value=t.color;e.opacity.value=t.opacity}function Ie(e,t){e.dashSize.value=t.dashSize;e.totalSize.value=t.dashSize+t.gapSize;e.scale.value=t.scale}function Pe(e,t){e.diffuse.value=t.color;e.opacity.value=t.opacity;e.size.value=t.size*L;e.scale.value=A*.5;e.map.value=t.map;if(t.map!==null){if(t.map.matrixAutoUpdate===true){var i=t.map.offset;var r=t.map.repeat;var n=t.map.rotation;var a=t.map.center;t.map.matrix.setUvTransform(i.x,i.y,r.x,r.y,n,a.x,a.y)}e.uvTransform.value.copy(t.map.matrix)}}function ke(e,t){e.fogColor.value=t.color;if(t.isFog){e.fogNear.value=t.near;e.fogFar.value=t.far}else if(t.isFogExp2){e.fogDensity.value=t.density}}function Ne(e,t){if(t.emissiveMap){e.emissiveMap.value=t.emissiveMap}}function ze(e,t){e.specular.value=t.specular;e.shininess.value=Math.max(t.shininess,1e-4);if(t.emissiveMap){e.emissiveMap.value=t.emissiveMap}if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale)}if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}}function Be(e,t){ze(e,t);if(t.gradientMap){e.gradientMap.value=t.gradientMap}}function Ue(e,t){e.roughness.value=t.roughness;e.metalness.value=t.metalness;if(t.roughnessMap){e.roughnessMap.value=t.roughnessMap}if(t.metalnessMap){e.metalnessMap.value=t.metalnessMap}if(t.emissiveMap){e.emissiveMap.value=t.emissiveMap}if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale)}if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}if(t.envMap){e.envMapIntensity.value=t.envMapIntensity}}function De(e,t){e.clearCoat.value=t.clearCoat;e.clearCoatRoughness.value=t.clearCoatRoughness;Ue(e,t)}function Fe(e,t){if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}}function je(e,t){if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}e.referencePosition.value.copy(t.referencePosition);e.nearDistance.value=t.nearDistance;e.farDistance.value=t.farDistance}function Ge(e,t){if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale)}if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}}function He(e,t){e.ambientLightColor.needsUpdate=t;e.directionalLights.needsUpdate=t;e.pointLights.needsUpdate=t;e.spotLights.needsUpdate=t;e.rectAreaLights.needsUpdate=t;e.hemisphereLights.needsUpdate=t}this.setFaceCulling=function(e,t){Y.setCullFace(e);Y.setFlipSided(t===F)};function Ve(){var e=E;if(e>=X.maxTextures){}E+=1;return e}this.allocTextureUnit=Ve;this.setTexture2D=function(){var e=false;return function t(i,r){if(i&&i.isWebGLRenderTarget){if(!e){e=true}i=i.texture}Z.setTexture2D(i,r)}}();this.setTexture=function(){var e=false;return function t(i,r){if(!e){e=true}Z.setTexture2D(i,r)}}();this.setTextureCube=function(){var e=false;return function t(i,r){if(i&&i.isWebGLRenderTargetCube){if(!e){e=true}i=i.texture}if(i&&i.isCubeTexture||Array.isArray(i.image)&&i.image.length===6){Z.setTextureCube(i,r)}else{Z.setTextureCubeDynamic(i,r)}}}();this.getRenderTarget=function(){return m};this.setRenderTarget=function(e){m=e;if(e&&q.get(e).__webglFramebuffer===undefined){Z.setupRenderTarget(e)}var t=null;var i=false;if(e){var r=q.get(e).__webglFramebuffer;if(e.isWebGLRenderTargetCube){t=r[e.activeCubeFace];i=true}else{t=r}b.copy(e.viewport);M.copy(e.scissor);T=e.scissorTest}else{b.copy(C).multiplyScalar(L);M.copy(R).multiplyScalar(L);T=I}if(g!==t){H.bindFramebuffer(H.FRAMEBUFFER,t);g=t}Y.viewport(b);Y.scissor(M);Y.setScissorTest(T);if(i){var n=q.get(e.texture);H.framebufferTexture2D(H.FRAMEBUFFER,H.COLOR_ATTACHMENT0,H.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,n.__webglTexture,e.activeMipMapLevel)}};this.readRenderTargetPixels=function(e,t,i,r,n,a){if(!(e&&e.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}var s=q.get(e).__webglFramebuffer;if(s){var o=false;if(s!==g){H.bindFramebuffer(H.FRAMEBUFFER,s);o=true}try{var h=e.texture;var l=h.format;var c=h.type;if(l!==pt&&le.convert(l)!==H.getParameter(H.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(c!==et&&le.convert(c)!==H.getParameter(H.IMPLEMENTATION_COLOR_READ_TYPE)&&!(c===st&&(W.get("OES_texture_float")||W.get("WEBGL_color_buffer_float")))&&!(c===ot&&W.get("EXT_color_buffer_half_float"))){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}if(H.checkFramebufferStatus(H.FRAMEBUFFER)===H.FRAMEBUFFER_COMPLETE){if(t>=0&&t<=e.width-r&&i>=0&&i<=e.height-n){H.readPixels(t,i,r,n,le.convert(l),le.convert(c),a)}}else{console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}}finally{if(o){H.bindFramebuffer(H.FRAMEBUFFER,g)}}}}}function Us(e,t){this.name="";this.color=new Ki(e);this.density=t!==undefined?t:25e-5}Us.prototype.isFogExp2=true;Us.prototype.clone=function(){return new Us(this.color.getHex(),this.density)};Us.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}};function Ds(e,t,i){this.name="";this.color=new Ki(e);this.near=t!==undefined?t:1;this.far=i!==undefined?i:1e3}Ds.prototype.isFog=true;Ds.prototype.clone=function(){return new Ds(this.color.getHex(),this.near,this.far)};Ds.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}};function Fs(){ba.call(this);this.type="Scene";this.background=null;this.fog=null;this.overrideMaterial=null;this.autoUpdate=true}Fs.prototype=Object.assign(Object.create(ba.prototype),{constructor:Fs,copy:function e(t,i){ba.prototype.copy.call(this,t,i);if(t.background!==null)this.background=t.background.clone();if(t.fog!==null)this.fog=t.fog.clone();if(t.overrideMaterial!==null)this.overrideMaterial=t.overrideMaterial.clone();this.autoUpdate=t.autoUpdate;this.matrixAutoUpdate=t.matrixAutoUpdate;return this},toJSON:function e(t){var i=ba.prototype.toJSON.call(this,t);if(this.background!==null)i.object.background=this.background.toJSON(t);if(this.fog!==null)i.object.fog=this.fog.toJSON();return i}});function js(e,t,i,r,n){ba.call(this);this.lensFlares=[];this.positionScreen=new ti;this.customUpdateCallback=undefined;if(e!==undefined){this.add(e,t,i,r,n)}}js.prototype=Object.assign(Object.create(ba.prototype),{constructor:js,isLensFlare:true,copy:function e(t){ba.prototype.copy.call(this,t);this.positionScreen.copy(t.positionScreen);this.customUpdateCallback=t.customUpdateCallback;for(var i=0,r=t.lensFlares.length;i<r;i++){this.lensFlares.push(t.lensFlares[i])}return this},add:function e(t,i,r,n,a,s){if(i===undefined)i=-1;if(r===undefined)r=0;if(s===undefined)s=1;if(a===undefined)a=new Ki(16777215);if(n===undefined)n=ee;r=Math.min(r,Math.max(0,r));this.lensFlares.push({texture:t,size:i,distance:r,x:0,y:0,z:0,scale:1,rotation:0,opacity:s,color:a,blending:n})},updateLensFlares:function e(){var t,i=this.lensFlares.length;var r;var n=-this.positionScreen.x*2;var a=-this.positionScreen.y*2;for(t=0;t<i;t++){r=this.lensFlares[t];r.x=this.positionScreen.x+n*r.distance;r.y=this.positionScreen.y+a*r.distance;r.wantedRotation=r.x*Math.PI*.25;r.rotation+=(r.wantedRotation-r.rotation)*.25}}});function Gs(e){ca.call(this);this.type="SpriteMaterial";this.color=new Ki(16777215);this.map=null;this.rotation=0;this.fog=false;this.lights=false;this.setValues(e)}Gs.prototype=Object.create(ca.prototype);Gs.prototype.constructor=Gs;Gs.prototype.isSpriteMaterial=true;Gs.prototype.copy=function(e){ca.prototype.copy.call(this,e);this.color.copy(e.color);this.map=e.map;this.rotation=e.rotation;return this};function Hs(e){ba.call(this);this.type="Sprite";this.material=e!==undefined?e:new Gs}Hs.prototype=Object.assign(Object.create(ba.prototype),{constructor:Hs,isSprite:true,raycast:function(){var e=new ti;var t=new ti;var i=new ti;return function r(n,a){t.setFromMatrixPosition(this.matrixWorld);n.ray.closestPointToPoint(t,e);i.setFromMatrixScale(this.matrixWorld);var s=i.x*i.y/4;if(t.distanceToSquared(e)>s)return;var o=n.ray.origin.distanceTo(e);if(o<n.near||o>n.far)return;a.push({distance:o,point:e.clone(),face:null,object:this})}}(),clone:function e(){return new this.constructor(this.material).copy(this)}});function Vs(){ba.call(this);this.type="LOD";Object.defineProperties(this,{levels:{enumerable:true,value:[]}})}Vs.prototype=Object.assign(Object.create(ba.prototype),{constructor:Vs,copy:function e(t){ba.prototype.copy.call(this,t,false);var i=t.levels;for(var r=0,n=i.length;r<n;r++){var a=i[r];this.addLevel(a.object.clone(),a.distance)}return this},addLevel:function e(t,i){if(i===undefined)i=0;i=Math.abs(i);var r=this.levels;for(var n=0;n<r.length;n++){if(i<r[n].distance){break}}r.splice(n,0,{distance:i,object:t});this.add(t)},getObjectForDistance:function e(t){var i=this.levels;for(var r=1,n=i.length;r<n;r++){if(t<i[r].distance){break}}return i[r-1].object},raycast:function(){var e=new ti;return function t(i,r){e.setFromMatrixPosition(this.matrixWorld);var n=i.ray.origin.distanceTo(e);this.getObjectForDistance(n).raycast(i,r)}}(),update:function(){var e=new ti;var t=new ti;return function i(r){var n=this.levels;if(n.length>1){e.setFromMatrixPosition(r.matrixWorld);t.setFromMatrixPosition(this.matrixWorld);var a=e.distanceTo(t);n[0].object.visible=true;for(var s=1,o=n.length;s<o;s++){if(a>=n[s].distance){n[s-1].object.visible=false;n[s].object.visible=true}else{break}}for(;s<o;s++){n[s].object.visible=false}}}}(),toJSON:function e(t){var i=ba.prototype.toJSON.call(this,t);i.object.levels=[];var r=this.levels;for(var n=0,a=r.length;n<a;n++){var s=r[n];i.object.levels.push({object:s.object.uuid,distance:s.distance})}return i}});function Ws(e,t){e=e||[];this.bones=e.slice(0);this.boneMatrices=new Float32Array(this.bones.length*16);if(t===undefined){this.calculateInverses()}else{if(this.bones.length===t.length){this.boneInverses=t.slice(0)}else{this.boneInverses=[];for(var i=0,r=this.bones.length;i<r;i++){this.boneInverses.push(new $t)}}}}Object.assign(Ws.prototype,{calculateInverses:function e(){this.boneInverses=[];for(var t=0,i=this.bones.length;t<i;t++){var r=new $t;if(this.bones[t]){r.getInverse(this.bones[t].matrixWorld)}this.boneInverses.push(r)}},pose:function e(){var t,i,r;for(i=0,r=this.bones.length;i<r;i++){t=this.bones[i];if(t){t.matrixWorld.getInverse(this.boneInverses[i])}}for(i=0,r=this.bones.length;i<r;i++){t=this.bones[i];if(t){if(t.parent&&t.parent.isBone){t.matrix.getInverse(t.parent.matrixWorld);t.matrix.multiply(t.matrixWorld)}else{t.matrix.copy(t.matrixWorld)}t.matrix.decompose(t.position,t.quaternion,t.scale)}}},update:function(){var e=new $t;var t=new $t;return function i(){var r=this.bones;var n=this.boneInverses;var a=this.boneMatrices;var s=this.boneTexture;for(var o=0,h=r.length;o<h;o++){var l=r[o]?r[o].matrixWorld:t;e.multiplyMatrices(l,n[o]);e.toArray(a,o*16)}if(s!==undefined){s.needsUpdate=true}}}(),clone:function e(){return new Ws(this.bones,this.boneInverses)}});function Xs(){ba.call(this);this.type="Bone"}Xs.prototype=Object.assign(Object.create(ba.prototype),{constructor:Xs,isBone:true});function Ys(e,t){Qa.call(this,e,t);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new $t;this.bindMatrixInverse=new $t;var i=this.initBones();var r=new Ws(i);this.bind(r,this.matrixWorld);this.normalizeSkinWeights()}Ys.prototype=Object.assign(Object.create(Qa.prototype),{constructor:Ys,isSkinnedMesh:true,initBones:function e(){var t=[],i,r;var n,a;if(this.geometry&&this.geometry.bones!==undefined){for(n=0,a=this.geometry.bones.length;n<a;n++){r=this.geometry.bones[n];i=new Xs;t.push(i);i.name=r.name;i.position.fromArray(r.pos);i.quaternion.fromArray(r.rotq);if(r.scl!==undefined)i.scale.fromArray(r.scl)}for(n=0,a=this.geometry.bones.length;n<a;n++){r=this.geometry.bones[n];if(r.parent!==-1&&r.parent!==null&&t[r.parent]!==undefined){t[r.parent].add(t[n])}else{this.add(t[n])}}}this.updateMatrixWorld(true);return t},bind:function e(t,i){this.skeleton=t;if(i===undefined){this.updateMatrixWorld(true);this.skeleton.calculateInverses();i=this.matrixWorld}this.bindMatrix.copy(i);this.bindMatrixInverse.getInverse(i)},pose:function e(){this.skeleton.pose()},normalizeSkinWeights:function e(){var t,i;if(this.geometry&&this.geometry.isGeometry){for(i=0;i<this.geometry.skinWeights.length;i++){var r=this.geometry.skinWeights[i];t=1/r.manhattanLength();if(t!==Infinity){r.multiplyScalar(t)}else{r.set(1,0,0,0)}}}else if(this.geometry&&this.geometry.isBufferGeometry){var n=new ai;var a=this.geometry.attributes.skinWeight;for(i=0;i<a.count;i++){n.x=a.getX(i);n.y=a.getY(i);n.z=a.getZ(i);n.w=a.getW(i);t=1/n.manhattanLength();if(t!==Infinity){n.multiplyScalar(t)}else{n.set(1,0,0,0)}a.setXYZW(i,n.x,n.y,n.z,n.w)}}},updateMatrixWorld:function e(t){Qa.prototype.updateMatrixWorld.call(this,t);if(this.bindMode==="attached"){this.bindMatrixInverse.getInverse(this.matrixWorld)}else if(this.bindMode==="detached"){this.bindMatrixInverse.getInverse(this.bindMatrix)}else{}},clone:function e(){return new this.constructor(this.geometry,this.material).copy(this)}});function qs(e){ca.call(this);this.type="LineBasicMaterial";this.color=new Ki(16777215);this.linewidth=1;this.linecap="round";this.linejoin="round";this.lights=false;this.setValues(e)}qs.prototype=Object.create(ca.prototype);qs.prototype.constructor=qs;qs.prototype.isLineBasicMaterial=true;qs.prototype.copy=function(e){ca.prototype.copy.call(this,e);this.color.copy(e.color);this.linewidth=e.linewidth;this.linecap=e.linecap;this.linejoin=e.linejoin;return this};function Zs(e,t,i){if(i===1){return new Js(e,t)}ba.call(this);this.type="Line";this.geometry=e!==undefined?e:new ja;this.material=t!==undefined?t:new qs({color:Math.random()*16777215})}Zs.prototype=Object.assign(Object.create(ba.prototype),{constructor:Zs,isLine:true,raycast:function(){var e=new $t;var t=new qa;var i=new pa;return function r(n,a){var s=n.linePrecision;var o=s*s;var h=this.geometry;var l=this.matrixWorld;if(h.boundingSphere===null)h.computeBoundingSphere();i.copy(h.boundingSphere);i.applyMatrix4(l);if(n.ray.intersectsSphere(i)===false)return;e.getInverse(l);t.copy(n.ray).applyMatrix4(e);var c=new ti;var u=new ti;var f=new ti;var d=new ti;var p=this&&this.isLineSegments?2:1;if(h.isBufferGeometry){var v=h.index;var m=h.attributes;var g=m.position.array;if(v!==null){var y=v.array;for(var _=0,x=y.length-1;_<x;_+=p){var w=y[_];var b=y[_+1];c.fromArray(g,w*3);u.fromArray(g,b*3);var M=t.distanceSqToSegment(c,u,d,f);if(M>o)continue;d.applyMatrix4(this.matrixWorld);var T=n.ray.origin.distanceTo(d);if(T<n.near||T>n.far)continue;a.push({distance:T,point:f.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}else{for(var _=0,x=g.length/3-1;_<x;_+=p){c.fromArray(g,3*_);u.fromArray(g,3*_+3);var M=t.distanceSqToSegment(c,u,d,f);if(M>o)continue;d.applyMatrix4(this.matrixWorld);var T=n.ray.origin.distanceTo(d);if(T<n.near||T>n.far)continue;a.push({distance:T,point:f.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}else if(h.isGeometry){var E=h.vertices;var S=E.length;for(var _=0;_<S-1;_+=p){var M=t.distanceSqToSegment(E[_],E[_+1],d,f);if(M>o)continue;d.applyMatrix4(this.matrixWorld);var T=n.ray.origin.distanceTo(d);if(T<n.near||T>n.far)continue;a.push({distance:T,point:f.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}}(),clone:function e(){return new this.constructor(this.geometry,this.material).copy(this)}});function Js(e,t){Zs.call(this,e,t);this.type="LineSegments"}Js.prototype=Object.assign(Object.create(Zs.prototype),{constructor:Js,isLineSegments:true});function Qs(e,t){Zs.call(this,e,t);this.type="LineLoop"}Qs.prototype=Object.assign(Object.create(Zs.prototype),{constructor:Qs,isLineLoop:true});function Ks(e){ca.call(this);this.type="PointsMaterial";this.color=new Ki(16777215);this.map=null;this.size=1;this.sizeAttenuation=true;this.lights=false;this.setValues(e)}Ks.prototype=Object.create(ca.prototype);Ks.prototype.constructor=Ks;Ks.prototype.isPointsMaterial=true;Ks.prototype.copy=function(e){ca.prototype.copy.call(this,e);this.color.copy(e.color);this.map=e.map;this.size=e.size;this.sizeAttenuation=e.sizeAttenuation;return this};function $s(e,t){ba.call(this);this.type="Points";this.geometry=e!==undefined?e:new ja;this.material=t!==undefined?t:new Ks({color:Math.random()*16777215})}$s.prototype=Object.assign(Object.create(ba.prototype),{constructor:$s,isPoints:true,raycast:function(){var e=new $t;var t=new qa;var i=new pa;return function r(n,a){var s=this;var o=this.geometry;var h=this.matrixWorld;var l=n.params.Points.threshold;if(o.boundingSphere===null)o.computeBoundingSphere();i.copy(o.boundingSphere);i.applyMatrix4(h);i.radius+=l;if(n.ray.intersectsSphere(i)===false)return;e.getInverse(h);t.copy(n.ray).applyMatrix4(e);var c=l/((this.scale.x+this.scale.y+this.scale.z)/3);var u=c*c;var f=new ti;function d(e,i){var r=t.distanceSqToPoint(e);if(r<u){var o=t.closestPointToPoint(e);o.applyMatrix4(h);var l=n.ray.origin.distanceTo(o);if(l<n.near||l>n.far)return;a.push({distance:l,distanceToRay:Math.sqrt(r),point:o.clone(),index:i,face:null,object:s})}}if(o.isBufferGeometry){var p=o.index;var v=o.attributes;var m=v.position.array;if(p!==null){var g=p.array;for(var y=0,_=g.length;y<_;y++){var x=g[y];f.fromArray(m,x*3);d(f,x)}}else{for(var y=0,w=m.length/3;y<w;y++){f.fromArray(m,y*3);d(f,y)}}}else{var b=o.vertices;for(var y=0,w=b.length;y<w;y++){d(b[y],y)}}}}(),clone:function e(){return new this.constructor(this.geometry,this.material).copy(this)}});function eo(){ba.call(this);this.type="Group"}eo.prototype=Object.assign(Object.create(ba.prototype),{constructor:eo});function to(e,t,i,r,n,a,s,o,h){ni.call(this,e,t,i,r,n,a,s,o,h);this.generateMipmaps=false;var l=this;function c(){var e=l.image;if(e.readyState>=e.HAVE_CURRENT_DATA){l.needsUpdate=true}requestAnimationFrame(c)}requestAnimationFrame(c)}to.prototype=Object.create(ni.prototype);to.prototype.constructor=to;function io(e,t,i,r,n,a,s,o,h,l,c,u){ni.call(this,null,a,s,o,h,l,r,n,c,u);this.image={width:t,height:i};this.mipmaps=e;this.flipY=false;this.generateMipmaps=false}io.prototype=Object.create(ni.prototype);io.prototype.constructor=io;io.prototype.isCompressedTexture=true;function ro(e,t,i,r,n,a,s,o,h,l){l=l!==undefined?l:yt;if(l!==yt&&l!==_t){throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat")}if(i===undefined&&l===yt)i=rt;if(i===undefined&&l===_t)i=ut;ni.call(this,null,r,n,a,s,o,l,i,h);this.image={width:e,height:t};this.magFilter=s!==undefined?s:qe;this.minFilter=o!==undefined?o:qe;this.flipY=false;this.generateMipmaps=false}ro.prototype=Object.create(ni.prototype);ro.prototype.constructor=ro;ro.prototype.isDepthTexture=true;function no(e){ja.call(this);this.type="WireframeGeometry";var t=[];var i,r,n,a,s;var o=[0,0],h={},l,c,u;var f,d=["a","b","c"];var p;if(e&&e.isGeometry){var v=e.faces;for(i=0,n=v.length;i<n;i++){var m=v[i];for(r=0;r<3;r++){c=m[d[r]];u=m[d[(r+1)%3]];o[0]=Math.min(c,u);o[1]=Math.max(c,u);f=o[0]+","+o[1];if(h[f]===undefined){h[f]={index1:o[0],index2:o[1]}}}}for(f in h){l=h[f];p=e.vertices[l.index1];t.push(p.x,p.y,p.z);p=e.vertices[l.index2];t.push(p.x,p.y,p.z)}}else if(e&&e.isBufferGeometry){var g,y,_;var x,w,b;var M,T;p=new ti;if(e.index!==null){g=e.attributes.position;y=e.index;_=e.groups;if(_.length===0){_=[{start:0,count:y.count,materialIndex:0}]}for(a=0,s=_.length;a<s;++a){x=_[a];w=x.start;b=x.count;for(i=w,n=w+b;i<n;i+=3){for(r=0;r<3;r++){c=y.getX(i+r);u=y.getX(i+(r+1)%3);o[0]=Math.min(c,u);o[1]=Math.max(c,u);f=o[0]+","+o[1];if(h[f]===undefined){h[f]={index1:o[0],index2:o[1]}}}}}for(f in h){l=h[f];p.fromBufferAttribute(g,l.index1);t.push(p.x,p.y,p.z);p.fromBufferAttribute(g,l.index2);t.push(p.x,p.y,p.z)}}else{g=e.attributes.position;for(i=0,n=g.count/3;i<n;i++){for(r=0;r<3;r++){M=3*i+r;p.fromBufferAttribute(g,M);t.push(p.x,p.y,p.z);T=3*i+(r+1)%3;p.fromBufferAttribute(g,T);t.push(p.x,p.y,p.z)}}}}this.addAttribute("position",new za(t,3))}no.prototype=Object.create(ja.prototype);no.prototype.constructor=no;function ao(e,t,i){Aa.call(this);this.type="ParametricGeometry";this.parameters={func:e,slices:t,stacks:i};this.fromBufferGeometry(new so(e,t,i));this.mergeVertices()}ao.prototype=Object.create(Aa.prototype);ao.prototype.constructor=ao;function so(e,t,i){ja.call(this);this.type="ParametricBufferGeometry";this.parameters={func:e,slices:t,stacks:i};var r=[];var n=[];var a=[];var s=[];var o=1e-5;var h=new ti;var l=new ti,c=new ti;var u=new ti,f=new ti;var d,p;var v=t+1;for(d=0;d<=i;d++){var m=d/i;for(p=0;p<=t;p++){var g=p/t;l=e(g,m,l);n.push(l.x,l.y,l.z);if(g-o>=0){c=e(g-o,m,c);u.subVectors(l,c)}else{c=e(g+o,m,c);u.subVectors(c,l)}if(m-o>=0){c=e(g,m-o,c);f.subVectors(l,c)}else{c=e(g,m+o,c);f.subVectors(c,l)}h.crossVectors(u,f).normalize();a.push(h.x,h.y,h.z);s.push(g,m)}}for(d=0;d<i;d++){for(p=0;p<t;p++){var y=d*v+p;var _=d*v+p+1;var x=(d+1)*v+p+1;var w=(d+1)*v+p;r.push(y,_,w);r.push(_,x,w)}}this.setIndex(r);this.addAttribute("position",new za(n,3));this.addAttribute("normal",new za(a,3));this.addAttribute("uv",new za(s,2))}so.prototype=Object.create(ja.prototype);so.prototype.constructor=so;function oo(e,t,i,r){Aa.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:e,indices:t,radius:i,detail:r};this.fromBufferGeometry(new ho(e,t,i,r));this.mergeVertices()}oo.prototype=Object.create(Aa.prototype);oo.prototype.constructor=oo;function ho(e,t,i,r){ja.call(this);this.type="PolyhedronBufferGeometry";this.parameters={vertices:e,indices:t,radius:i,detail:r};i=i||1;r=r||0;var n=[];var a=[];s(r);h(i);l();this.addAttribute("position",new za(n,3));this.addAttribute("normal",new za(n.slice(),3));this.addAttribute("uv",new za(a,2));if(r===0){this.computeVertexNormals()}else{this.normalizeNormals()}function s(e){var i=new ti;var r=new ti;var n=new ti;for(var a=0;a<t.length;a+=3){f(t[a+0],i);f(t[a+1],r);f(t[a+2],n);o(i,r,n,e)}}function o(e,t,i,r){var n=Math.pow(2,r);var a=[];var s,o;for(s=0;s<=n;s++){a[s]=[];var h=e.clone().lerp(i,s/n);var l=t.clone().lerp(i,s/n);var c=n-s;for(o=0;o<=c;o++){if(o===0&&s===n){a[s][o]=h}else{a[s][o]=h.clone().lerp(l,o/c)}}}for(s=0;s<n;s++){for(o=0;o<2*(n-s)-1;o++){var f=Math.floor(o/2);if(o%2===0){u(a[s][f+1]);u(a[s+1][f]);u(a[s][f])}else{u(a[s][f+1]);u(a[s+1][f+1]);u(a[s+1][f])}}}}function h(e){var t=new ti;for(var i=0;i<n.length;i+=3){t.x=n[i+0];t.y=n[i+1];t.z=n[i+2];t.normalize().multiplyScalar(e);n[i+0]=t.x;n[i+1]=t.y;n[i+2]=t.z}}function l(){var e=new ti;for(var t=0;t<n.length;t+=3){e.x=n[t+0];e.y=n[t+1];e.z=n[t+2];var i=v(e)/2/Math.PI+.5;var r=m(e)/Math.PI+.5;a.push(i,1-r)}d();c()}function c(){for(var e=0;e<a.length;e+=6){var t=a[e+0];var i=a[e+2];var r=a[e+4];var n=Math.max(t,i,r);var s=Math.min(t,i,r);if(n>.9&&s<.1){if(t<.2)a[e+0]+=1;if(i<.2)a[e+2]+=1;if(r<.2)a[e+4]+=1}}}function u(e){n.push(e.x,e.y,e.z)}function f(t,i){var r=t*3;i.x=e[r+0];i.y=e[r+1];i.z=e[r+2]}function d(){var e=new ti;var t=new ti;var i=new ti;var r=new ti;var s=new Kt;var o=new Kt;var h=new Kt;for(var l=0,c=0;l<n.length;l+=9,c+=6){e.set(n[l+0],n[l+1],n[l+2]);t.set(n[l+3],n[l+4],n[l+5]);i.set(n[l+6],n[l+7],n[l+8]);s.set(a[c+0],a[c+1]);o.set(a[c+2],a[c+3]);h.set(a[c+4],a[c+5]);r.copy(e).add(t).add(i).divideScalar(3);var u=v(r);p(s,c+0,e,u);p(o,c+2,t,u);p(h,c+4,i,u)}}function p(e,t,i,r){if(r<0&&e.x===1){a[t]=e.x-1}if(i.x===0&&i.z===0){a[t]=r/2/Math.PI+.5}}function v(e){return Math.atan2(e.z,-e.x)}function m(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}}ho.prototype=Object.create(ja.prototype);ho.prototype.constructor=ho;function lo(e,t){Aa.call(this);this.type="TetrahedronGeometry";this.parameters={radius:e,detail:t};this.fromBufferGeometry(new co(e,t));this.mergeVertices()}lo.prototype=Object.create(Aa.prototype);lo.prototype.constructor=lo;function co(e,t){var i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1];var r=[2,1,0,0,3,2,1,3,0,2,3,1];ho.call(this,i,r,e,t);this.type="TetrahedronBufferGeometry";this.parameters={radius:e,detail:t}}co.prototype=Object.create(ho.prototype);co.prototype.constructor=co;function uo(e,t){Aa.call(this);this.type="OctahedronGeometry";this.parameters={radius:e,detail:t};this.fromBufferGeometry(new fo(e,t));this.mergeVertices()}uo.prototype=Object.create(Aa.prototype);uo.prototype.constructor=uo;function fo(e,t){var i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1];var r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];ho.call(this,i,r,e,t);this.type="OctahedronBufferGeometry";this.parameters={radius:e,detail:t}}fo.prototype=Object.create(ho.prototype);fo.prototype.constructor=fo;function po(e,t){Aa.call(this);this.type="IcosahedronGeometry";this.parameters={radius:e,detail:t};this.fromBufferGeometry(new vo(e,t));this.mergeVertices()}po.prototype=Object.create(Aa.prototype);po.prototype.constructor=po;function vo(e,t){var i=(1+Math.sqrt(5))/2;var r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1];var n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];ho.call(this,r,n,e,t);this.type="IcosahedronBufferGeometry";this.parameters={radius:e,detail:t}}vo.prototype=Object.create(ho.prototype);vo.prototype.constructor=vo;function mo(e,t){Aa.call(this);this.type="DodecahedronGeometry";this.parameters={radius:e,detail:t};this.fromBufferGeometry(new go(e,t));this.mergeVertices()}mo.prototype=Object.create(Aa.prototype);mo.prototype.constructor=mo;function go(e,t){var i=(1+Math.sqrt(5))/2;var r=1/i;var n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r];var a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];ho.call(this,n,a,e,t);this.type="DodecahedronBufferGeometry";this.parameters={radius:e,detail:t}}go.prototype=Object.create(ho.prototype);go.prototype.constructor=go;function yo(e,t,i,r,n,a){Aa.call(this);this.type="TubeGeometry";this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:n};var s=new _o(e,t,i,r,n);this.tangents=s.tangents;this.normals=s.normals;this.binormals=s.binormals;this.fromBufferGeometry(s);this.mergeVertices()}yo.prototype=Object.create(Aa.prototype);yo.prototype.constructor=yo;function _o(e,t,i,r,n){ja.call(this);this.type="TubeBufferGeometry";this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:n};t=t||64;i=i||1;r=r||8;n=n||false;var a=e.computeFrenetFrames(t,n);this.tangents=a.tangents;this.normals=a.normals;this.binormals=a.binormals;var s=new ti;var o=new ti;var h=new Kt;var l=new ti;var c,u;var f=[];var d=[];var p=[];var v=[];m();this.setIndex(v);this.addAttribute("position",new za(f,3));this.addAttribute("normal",new za(d,3));this.addAttribute("uv",new za(p,2));function m(){for(c=0;c<t;c++){g(c)}g(n===false?t:0);_();y()}function g(n){l=e.getPointAt(n/t,l);var h=a.normals[n];var c=a.binormals[n];for(u=0;u<=r;u++){var p=u/r*Math.PI*2;var v=Math.sin(p);var m=-Math.cos(p);o.x=m*h.x+v*c.x;o.y=m*h.y+v*c.y;o.z=m*h.z+v*c.z;o.normalize();d.push(o.x,o.y,o.z);s.x=l.x+i*o.x;s.y=l.y+i*o.y;s.z=l.z+i*o.z;f.push(s.x,s.y,s.z)}}function y(){for(u=1;u<=t;u++){for(c=1;c<=r;c++){var e=(r+1)*(u-1)+(c-1);var i=(r+1)*u+(c-1);var n=(r+1)*u+c;var a=(r+1)*(u-1)+c;v.push(e,i,a);v.push(i,n,a)}}}function _(){for(c=0;c<=t;c++){for(u=0;u<=r;u++){h.x=c/t;h.y=u/r;p.push(h.x,h.y)}}}}_o.prototype=Object.create(ja.prototype);_o.prototype.constructor=_o;function xo(e,t,i,r,n,a,s){Aa.call(this);this.type="TorusKnotGeometry";this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:a};this.fromBufferGeometry(new wo(e,t,i,r,n,a));this.mergeVertices()}xo.prototype=Object.create(Aa.prototype);xo.prototype.constructor=xo;function wo(e,t,i,r,n,a){ja.call(this);this.type="TorusKnotBufferGeometry";this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:a};e=e||1;t=t||.4;i=Math.floor(i)||64;r=Math.floor(r)||8;n=n||2;a=a||3;var s=[];var o=[];var h=[];var l=[];var c,u;var f=new ti;var d=new ti;var p=new ti;var v=new ti;var m=new ti;var g=new ti;var y=new ti;for(c=0;c<=i;++c){var _=c/i*n*Math.PI*2;A(_,n,a,e,p);A(_+.01,n,a,e,v);g.subVectors(v,p);y.addVectors(v,p);m.crossVectors(g,y);y.crossVectors(m,g);m.normalize();y.normalize();for(u=0;u<=r;++u){var x=u/r*Math.PI*2;var w=-t*Math.cos(x);var b=t*Math.sin(x);f.x=p.x+(w*y.x+b*m.x);f.y=p.y+(w*y.y+b*m.y);f.z=p.z+(w*y.z+b*m.z);o.push(f.x,f.y,f.z);d.subVectors(f,p).normalize();h.push(d.x,d.y,d.z);l.push(c/i);l.push(u/r)}}for(u=1;u<=i;u++){for(c=1;c<=r;c++){var M=(r+1)*(u-1)+(c-1);var T=(r+1)*u+(c-1);var E=(r+1)*u+c;var S=(r+1)*(u-1)+c;s.push(M,T,S);s.push(T,E,S)}}this.setIndex(s);this.addAttribute("position",new za(o,3));this.addAttribute("normal",new za(h,3));this.addAttribute("uv",new za(l,2));function A(e,t,i,r,n){var a=Math.cos(e);var s=Math.sin(e);var o=i/t*e;var h=Math.cos(o);n.x=r*(2+h)*.5*a;n.y=r*(2+h)*s*.5;n.z=r*Math.sin(o)*.5}}wo.prototype=Object.create(ja.prototype);wo.prototype.constructor=wo;function bo(e,t,i,r,n){Aa.call(this);this.type="TorusGeometry";this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n};this.fromBufferGeometry(new Mo(e,t,i,r,n));this.mergeVertices()}bo.prototype=Object.create(Aa.prototype);bo.prototype.constructor=bo;function Mo(e,t,i,r,n){ja.call(this);this.type="TorusBufferGeometry";this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n};e=e||1;t=t||.4;i=Math.floor(i)||8;r=Math.floor(r)||6;n=n||Math.PI*2;var a=[];var s=[];var o=[];var h=[];var l=new ti;var c=new ti;var u=new ti;var f,d;for(f=0;f<=i;f++){for(d=0;d<=r;d++){var p=d/r*n;var v=f/i*Math.PI*2;c.x=(e+t*Math.cos(v))*Math.cos(p);c.y=(e+t*Math.cos(v))*Math.sin(p);c.z=t*Math.sin(v);s.push(c.x,c.y,c.z);l.x=e*Math.cos(p);l.y=e*Math.sin(p);u.subVectors(c,l).normalize();o.push(u.x,u.y,u.z);h.push(d/r);h.push(f/i)}}for(f=1;f<=i;f++){for(d=1;d<=r;d++){var m=(r+1)*f+d-1;var g=(r+1)*(f-1)+d-1;var y=(r+1)*(f-1)+d;var _=(r+1)*f+d;a.push(m,g,_);a.push(g,y,_)}}this.setIndex(a);this.addAttribute("position",new za(s,3));this.addAttribute("normal",new za(o,3));this.addAttribute("uv",new za(h,2))}Mo.prototype=Object.create(ja.prototype);Mo.prototype.constructor=Mo;var To={area:function e(t){var i=t.length;var r=0;for(var n=i-1,a=0;a<i;n=a++){r+=t[n].x*t[a].y-t[a].x*t[n].y}return r*.5},triangulate:function(){function e(e,t,i,r,n,a){var s;var o,h,l,c;var u,f,d,p;o=e[a[t]].x;h=e[a[t]].y;l=e[a[i]].x;c=e[a[i]].y;u=e[a[r]].x;f=e[a[r]].y;if((l-o)*(f-h)-(c-h)*(u-o)<=0)return false;var v,m,g,y,_,x;var w,b,M,T,E,S;var A,L,C;v=u-l;m=f-c;g=o-u;y=h-f;_=l-o;x=c-h;for(s=0;s<n;s++){d=e[a[s]].x;p=e[a[s]].y;if(d===o&&p===h||d===l&&p===c||d===u&&p===f)continue;w=d-o;b=p-h;M=d-l;T=p-c;E=d-u;S=p-f;C=v*T-m*M;A=_*b-x*w;L=g*S-y*E;if(C>=-Number.EPSILON&&L>=-Number.EPSILON&&A>=-Number.EPSILON)return false}return true}return function t(i,r){var n=i.length;if(n<3)return null;var a=[],s=[],o=[];var h,l,c;if(To.area(i)>0){for(l=0;l<n;l++){s[l]=l}}else{for(l=0;l<n;l++){s[l]=n-1-l}}var u=n;var f=2*u;for(l=u-1;u>2;){if(f--<=0){if(r)return o;return a}h=l;if(u<=h)h=0;l=h+1;if(u<=l)l=0;c=l+1;if(u<=c)c=0;if(e(i,h,l,c,u,s)){var d,p,v,m,g;d=s[h];p=s[l];v=s[c];a.push([i[d],i[p],i[v]]);o.push([s[h],s[l],s[c]]);for(m=l,g=l+1;g<u;m++,g++){s[m]=s[g]}u--;f=2*u}}if(r)return o;return a}}(),triangulateShape:function e(t,i){function r(e){var t=e.length;if(t>2&&e[t-1].equals(e[0])){e.pop()}}r(t);i.forEach(r);function n(e,t,i){if(e.x!==t.x){if(e.x<t.x){return e.x<=i.x&&i.x<=t.x}else{return t.x<=i.x&&i.x<=e.x}}else{if(e.y<t.y){return e.y<=i.y&&i.y<=t.y}else{return t.y<=i.y&&i.y<=e.y}}}function a(e,t,i,r,a){var s=t.x-e.x,o=t.y-e.y;var h=r.x-i.x,l=r.y-i.y;var c=e.x-i.x;var u=e.y-i.y;var f=o*h-s*l;var d=o*c-s*u;if(Math.abs(f)>Number.EPSILON){var p;if(f>0){if(d<0||d>f)return[];p=l*c-h*u;if(p<0||p>f)return[]}else{if(d>0||d<f)return[];p=l*c-h*u;if(p>0||p<f)return[]}if(p===0){if(a&&(d===0||d===f))return[];return[e]}if(p===f){if(a&&(d===0||d===f))return[];return[t]}if(d===0)return[i];if(d===f)return[r];var v=p/f;return[{x:e.x+v*s,y:e.y+v*o}]}else{if(d!==0||l*c!==h*u)return[];var m=s===0&&o===0;var g=h===0&&l===0;if(m&&g){if(e.x!==i.x||e.y!==i.y)return[];return[e]}if(m){if(!n(i,r,e))return[];return[e]}if(g){if(!n(e,t,i))return[];return[i]}var y,_,x,w;var b,M,T,E;if(s!==0){if(e.x<t.x){y=e;x=e.x;_=t;w=t.x}else{y=t;x=t.x;_=e;w=e.x}if(i.x<r.x){b=i;T=i.x;M=r;E=r.x}else{b=r;T=r.x;M=i;E=i.x}}else{if(e.y<t.y){y=e;x=e.y;_=t;w=t.y}else{y=t;x=t.y;_=e;w=e.y}if(i.y<r.y){b=i;T=i.y;M=r;E=r.y}else{b=r;T=r.y;M=i;E=i.y}}if(x<=T){if(w<T)return[];if(w===T){if(a)return[];return[b]}if(w<=E)return[b,_];return[b,M]}else{if(x>E)return[];if(x===E){if(a)return[];return[y]}if(w<=E)return[y,_];return[y,M]}}}function s(e,t,i,r){var n=t.x-e.x,a=t.y-e.y;var s=i.x-e.x,o=i.y-e.y;var h=r.x-e.x,l=r.y-e.y;var c=n*o-a*s;var u=n*l-a*h;if(Math.abs(c)>Number.EPSILON){var f=h*o-l*s;if(c>0){return u>=0&&f>=0}else{return u>=0||f>=0}}else{return u>0}}function o(e,t){var i=e.concat();var r;function n(e,t){var n=i.length-1;var a=e-1;if(a<0)a=n;var o=e+1;if(o>n)o=0;var h=s(i[e],i[a],i[o],r[t]);if(!h){return false}var l=r.length-1;var c=t-1;if(c<0)c=l;var u=t+1;if(u>l)u=0;h=s(r[t],r[c],r[u],i[e]);if(!h){return false}return true}function o(e,t){var r,n,s;for(r=0;r<i.length;r++){n=r+1;n%=i.length;s=a(e,t,i[r],i[n],true);if(s.length>0)return true}return false}var h=[];function l(e,i){var r,n,s,o,l;for(r=0;r<h.length;r++){n=t[h[r]];for(s=0;s<n.length;s++){o=s+1;o%=n.length;l=a(e,i,n[s],n[o],true);if(l.length>0)return true}}return false}var c,u,f,d,p,v,m=[],g,y,_,x;for(var w=0,b=t.length;w<b;w++){h.push(w)}var M=0;var T=h.length*2;while(h.length>0){T--;if(T<0){console.log('THREE.ShapeUtils: Infinite Loop! Holes left:" + indepHoles.length + ", Probably Hole outside Shape!');break}for(u=M;u<i.length;u++){f=i[u];c=-1;for(var w=0;w<h.length;w++){p=h[w];v=f.x+":"+f.y+":"+p;if(m[v]!==undefined)continue;r=t[p];for(var E=0;E<r.length;E++){d=r[E];if(!n(u,E))continue;if(o(f,d))continue;if(l(f,d))continue;c=E;h.splice(w,1);g=i.slice(0,u+1);y=i.slice(u);_=r.slice(c);x=r.slice(0,c+1);i=g.concat(_).concat(x).concat(y);M=u;break}if(c>=0)break;m[v]=true}if(c>=0)break}}return i}var h,l,c,u,f,d,p={};var v=t.concat();for(var m=0,g=i.length;m<g;m++){Array.prototype.push.apply(v,i[m])}for(h=0,l=v.length;h<l;h++){f=v[h].x+":"+v[h].y;if(p[f]!==undefined){}p[f]=h}var y=o(t,i);var _=To.triangulate(y,false);for(h=0,l=_.length;h<l;h++){u=_[h];for(c=0;c<3;c++){f=u[c].x+":"+u[c].y;d=p[f];if(d!==undefined){u[c]=d}}}return _.concat()},isClockWise:function e(t){return To.area(t)<0}};function Eo(e,t){Aa.call(this);this.type="ExtrudeGeometry";this.parameters={shapes:e,options:t};this.fromBufferGeometry(new So(e,t));this.mergeVertices()}Eo.prototype=Object.create(Aa.prototype);Eo.prototype.constructor=Eo;function So(e,t){if(typeof e==="undefined"){return}ja.call(this);this.type="ExtrudeBufferGeometry";e=Array.isArray(e)?e:[e];this.addShapeList(e,t);this.computeVertexNormals()}So.prototype=Object.create(ja.prototype);So.prototype.constructor=So;So.prototype.getArrays=function(){var e=this.getAttribute("position");var t=e?Array.prototype.slice.call(e.array):[];var i=this.getAttribute("uv");var r=i?Array.prototype.slice.call(i.array):[];var n=this.index;var a=n?Array.prototype.slice.call(n.array):[];return{position:t,uv:r,index:a}};So.prototype.addShapeList=function(e,t){var i=e.length;t.arrays=this.getArrays();for(var r=0;r<i;r++){var n=e[r];this.addShape(n,t)}this.setIndex(t.arrays.index);this.addAttribute("position",new za(t.arrays.position,3));this.addAttribute("uv",new za(t.arrays.uv,2))};So.prototype.addShape=function(e,t){var i=t.arrays?t.arrays:this.getArrays();var r=i.position;var n=i.index;var a=i.uv;var s=[];var o=t.amount!==undefined?t.amount:100;var h=t.bevelThickness!==undefined?t.bevelThickness:6;var l=t.bevelSize!==undefined?t.bevelSize:h-2;var c=t.bevelSegments!==undefined?t.bevelSegments:3;var u=t.bevelEnabled!==undefined?t.bevelEnabled:true;var f=t.curveSegments!==undefined?t.curveSegments:12;var d=t.steps!==undefined?t.steps:1;var p=t.extrudePath;var v,m=false;var g=t.UVGenerator!==undefined?t.UVGenerator:Eo.WorldUVGenerator;var y,_,x,w;if(p){v=p.getSpacedPoints(d);m=true;u=false;y=t.frames!==undefined?t.frames:p.computeFrenetFrames(d,false);_=new ti;x=new ti;w=new ti}if(!u){c=0;h=0;l=0}var b,M,T;var E=this;var S=e.extractPoints(f);var A=S.shape;var L=S.holes;var C=!To.isClockWise(A);if(C){A=A.reverse();for(M=0,T=L.length;M<T;M++){b=L[M];if(To.isClockWise(b)){L[M]=b.reverse()}}}var R=To.triangulateShape(A,L);var I=A;for(M=0,T=L.length;M<T;M++){b=L[M];A=A.concat(b)}function P(e,t,i){if(!t)console.error("THREE.ExtrudeGeometry: vec does not exist");return t.clone().multiplyScalar(i).add(e)}var O,k,N,z,B,U=A.length,D,F=R.length;function j(e,t,i){var r,n,a;var s=e.x-t.x,o=e.y-t.y;var h=i.x-e.x,l=i.y-e.y;var c=s*s+o*o;var u=s*l-o*h;if(Math.abs(u)>Number.EPSILON){var f=Math.sqrt(c);var d=Math.sqrt(h*h+l*l);var p=t.x-o/f;var v=t.y+s/f;var m=i.x-l/d;var g=i.y+h/d;var y=((m-p)*l-(g-v)*h)/(s*l-o*h);r=p+s*y-e.x;n=v+o*y-e.y;var _=r*r+n*n;if(_<=2){return new Kt(r,n)}else{a=Math.sqrt(_/2)}}else{var x=false;if(s>Number.EPSILON){if(h>Number.EPSILON){x=true}}else{if(s<-Number.EPSILON){if(h<-Number.EPSILON){x=true}}else{if(Math.sign(o)===Math.sign(l)){x=true}}}if(x){r=-o;n=s;a=Math.sqrt(c)}else{r=s;n=o;a=Math.sqrt(c/2)}}return new Kt(r/a,n/a)}var G=[];for(var H=0,V=I.length,W=V-1,X=H+1;H<V;H++,W++,X++){if(W===V)W=0;if(X===V)X=0;G[H]=j(I[H],I[W],I[X])}var Y=[],q,Z=G.concat();for(M=0,T=L.length;M<T;M++){b=L[M];q=[];for(H=0,V=b.length,W=V-1,X=H+1;H<V;H++,W++,X++){if(W===V)W=0;if(X===V)X=0;q[H]=j(b[H],b[W],b[X])}Y.push(q);Z=Z.concat(q)}for(O=0;O<c;O++){N=O/c;z=h*Math.cos(N*Math.PI/2);k=l*Math.sin(N*Math.PI/2);for(H=0,V=I.length;H<V;H++){B=P(I[H],G[H],k);ee(B.x,B.y,-z)}for(M=0,T=L.length;M<T;M++){b=L[M];q=Y[M];for(H=0,V=b.length;H<V;H++){B=P(b[H],q[H],k);ee(B.x,B.y,-z)}}}k=l;for(H=0;H<U;H++){B=u?P(A[H],Z[H],k):A[H];if(!m){ee(B.x,B.y,0)}else{x.copy(y.normals[0]).multiplyScalar(B.x);_.copy(y.binormals[0]).multiplyScalar(B.y);w.copy(v[0]).add(x).add(_);ee(w.x,w.y,w.z)}}var J;for(J=1;J<=d;J++){for(H=0;H<U;H++){B=u?P(A[H],Z[H],k):A[H];if(!m){ee(B.x,B.y,o/d*J)}else{x.copy(y.normals[J]).multiplyScalar(B.x);_.copy(y.binormals[J]).multiplyScalar(B.y);w.copy(v[J]).add(x).add(_);ee(w.x,w.y,w.z)}}}for(O=c-1;O>=0;O--){N=O/c;z=h*Math.cos(N*Math.PI/2);k=l*Math.sin(N*Math.PI/2);for(H=0,V=I.length;H<V;H++){B=P(I[H],G[H],k);ee(B.x,B.y,o+z)}for(M=0,T=L.length;M<T;M++){b=L[M];q=Y[M];for(H=0,V=b.length;H<V;H++){B=P(b[H],q[H],k);if(!m){ee(B.x,B.y,o+z)}else{ee(B.x,B.y+v[d-1].y,v[d-1].x+z)}}}}Q();K();function Q(){var e=r.length/3;if(u){var i=0;var n=U*i;for(H=0;H<F;H++){D=R[H];te(D[2]+n,D[1]+n,D[0]+n)}i=d+c*2;n=U*i;for(H=0;H<F;H++){D=R[H];te(D[0]+n,D[1]+n,D[2]+n)}}else{for(H=0;H<F;H++){D=R[H];te(D[2],D[1],D[0])}for(H=0;H<F;H++){D=R[H];te(D[0]+U*d,D[1]+U*d,D[2]+U*d)}}E.addGroup(e,r.length/3-e,t.material!==undefined?t.material:0)}function K(){var e=r.length/3;var i=0;$(I,i);i+=I.length;for(M=0,T=L.length;M<T;M++){b=L[M];$(b,i);i+=b.length}E.addGroup(e,r.length/3-e,t.extrudeMaterial!==undefined?t.extrudeMaterial:1)}function $(e,t){var i,r;H=e.length;while(--H>=0){i=H;r=H-1;if(r<0)r=e.length-1;var n=0,a=d+c*2;for(n=0;n<a;n++){var s=U*n;var o=U*(n+1);var h=t+i+s,l=t+r+s,u=t+r+o,f=t+i+o;ie(h,l,u,f)}}}function ee(e,t,i){s.push(e);s.push(t);s.push(i)}function te(e,t,i){re(e);re(t);re(i);var n=r.length/3;var a=g.generateTopUV(E,r,n-3,n-2,n-1);ne(a[0]);ne(a[1]);ne(a[2])}function ie(e,t,i,n){re(e);re(t);re(n);re(t);re(i);re(n);var a=r.length/3;var s=g.generateSideWallUV(E,r,a-6,a-3,a-2,a-1);ne(s[0]);ne(s[1]);ne(s[3]);ne(s[1]);ne(s[2]);ne(s[3])}function re(e){n.push(r.length/3);r.push(s[e*3+0]);r.push(s[e*3+1]);r.push(s[e*3+2])}function ne(e){a.push(e.x);a.push(e.y)}if(!t.arrays){this.setIndex(n);this.addAttribute("position",new za(r,3));this.addAttribute("uv",new za(t.arrays.uv,2))}};Eo.WorldUVGenerator={generateTopUV:function e(t,i,r,n,a){var s=i[r*3];var o=i[r*3+1];var h=i[n*3];var l=i[n*3+1];var c=i[a*3];var u=i[a*3+1];return[new Kt(s,o),new Kt(h,l),new Kt(c,u)]},generateSideWallUV:function e(t,i,r,n,a,s){var o=i[r*3];var h=i[r*3+1];var l=i[r*3+2];var c=i[n*3];var u=i[n*3+1];var f=i[n*3+2];var d=i[a*3];var p=i[a*3+1];var v=i[a*3+2];var m=i[s*3];var g=i[s*3+1];var y=i[s*3+2];if(Math.abs(h-u)<.01){return[new Kt(o,1-l),new Kt(c,1-f),new Kt(d,1-v),new Kt(m,1-y)]}else{return[new Kt(h,1-l),new Kt(u,1-f),new Kt(p,1-v),new Kt(g,1-y)]}}};function Ao(e,t){Aa.call(this);this.type="TextGeometry";this.parameters={text:e,parameters:t};this.fromBufferGeometry(new Lo(e,t));this.mergeVertices()}Ao.prototype=Object.create(Aa.prototype);Ao.prototype.constructor=Ao;function Lo(e,t){t=t||{};var i=t.font;if(!(i&&i.isFont)){console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font.");return new Aa}var r=i.generateShapes(e,t.size,t.curveSegments);t.amount=t.height!==undefined?t.height:50;if(t.bevelThickness===undefined)t.bevelThickness=10;if(t.bevelSize===undefined)t.bevelSize=8;if(t.bevelEnabled===undefined)t.bevelEnabled=false;So.call(this,r,t);this.type="TextBufferGeometry"}Lo.prototype=Object.create(So.prototype);Lo.prototype.constructor=Lo;function Co(e,t,i,r,n,a,s){Aa.call(this);this.type="SphereGeometry";this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:a,thetaLength:s};this.fromBufferGeometry(new Ro(e,t,i,r,n,a,s));this.mergeVertices()}Co.prototype=Object.create(Aa.prototype);Co.prototype.constructor=Co;function Ro(e,t,i,r,n,a,s){ja.call(this);this.type="SphereBufferGeometry";this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:a,thetaLength:s};e=e||1;t=Math.max(3,Math.floor(t)||8);i=Math.max(2,Math.floor(i)||6);r=r!==undefined?r:0;n=n!==undefined?n:Math.PI*2;a=a!==undefined?a:0;s=s!==undefined?s:Math.PI;var o=a+s;var h,l;var c=0;var u=[];var f=new ti;var d=new ti;var p=[];var v=[];var m=[];var g=[];for(l=0;l<=i;l++){var y=[];var _=l/i;for(h=0;h<=t;h++){var x=h/t;f.x=-e*Math.cos(r+x*n)*Math.sin(a+_*s);f.y=e*Math.cos(a+_*s);f.z=e*Math.sin(r+x*n)*Math.sin(a+_*s);v.push(f.x,f.y,f.z);d.set(f.x,f.y,f.z).normalize();m.push(d.x,d.y,d.z);g.push(x,1-_);y.push(c++)}u.push(y)}for(l=0;l<i;l++){for(h=0;h<t;h++){var w=u[l][h+1];var b=u[l][h];var M=u[l+1][h];var T=u[l+1][h+1];if(l!==0||a>0)p.push(w,b,T);if(l!==i-1||o<Math.PI)p.push(b,M,T)}}this.setIndex(p);this.addAttribute("position",new za(v,3));this.addAttribute("normal",new za(m,3));this.addAttribute("uv",new za(g,2))}Ro.prototype=Object.create(ja.prototype);Ro.prototype.constructor=Ro;function Io(e,t,i,r,n,a){Aa.call(this);this.type="RingGeometry";this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:n,thetaLength:a};this.fromBufferGeometry(new Po(e,t,i,r,n,a));this.mergeVertices()}Io.prototype=Object.create(Aa.prototype);Io.prototype.constructor=Io;function Po(e,t,i,r,n,a){ja.call(this);this.type="RingBufferGeometry";this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:n,thetaLength:a};e=e||.5;t=t||1;n=n!==undefined?n:0;a=a!==undefined?a:Math.PI*2;i=i!==undefined?Math.max(3,i):8;r=r!==undefined?Math.max(1,r):1;var s=[];var o=[];var h=[];var l=[];var c;var u=e;var f=(t-e)/r;var d=new ti;var p=new Kt;var v,m;for(v=0;v<=r;v++){for(m=0;m<=i;m++){c=n+m/i*a;d.x=u*Math.cos(c);d.y=u*Math.sin(c);o.push(d.x,d.y,d.z);h.push(0,0,1);p.x=(d.x/t+1)/2;p.y=(d.y/t+1)/2;l.push(p.x,p.y)}u+=f}for(v=0;v<r;v++){var g=v*(i+1);for(m=0;m<i;m++){c=m+g;var y=c;var _=c+i+1;var x=c+i+2;var w=c+1;s.push(y,_,w);s.push(_,x,w)}}this.setIndex(s);this.addAttribute("position",new za(o,3));this.addAttribute("normal",new za(h,3));this.addAttribute("uv",new za(l,2))}Po.prototype=Object.create(ja.prototype);Po.prototype.constructor=Po;function Oo(e,t,i,r){Aa.call(this);this.type="LatheGeometry";this.parameters={points:e,segments:t,phiStart:i,phiLength:r};this.fromBufferGeometry(new ko(e,t,i,r));this.mergeVertices()}Oo.prototype=Object.create(Aa.prototype);Oo.prototype.constructor=Oo;function ko(e,t,i,r){ja.call(this);this.type="LatheBufferGeometry";this.parameters={points:e,segments:t,phiStart:i,phiLength:r};t=Math.floor(t)||12;i=i||0;r=r||Math.PI*2;r=Qt.clamp(r,0,Math.PI*2);var n=[];var a=[];var s=[];var o;var h=1/t;var l=new ti;var c=new Kt;var u,f;for(u=0;u<=t;u++){var d=i+u*h*r;var p=Math.sin(d);var v=Math.cos(d);for(f=0;f<=e.length-1;f++){l.x=e[f].x*p;l.y=e[f].y;l.z=e[f].x*v;a.push(l.x,l.y,l.z);c.x=u/t;c.y=f/(e.length-1);s.push(c.x,c.y)}}for(u=0;u<t;u++){for(f=0;f<e.length-1;f++){o=f+u*e.length;var m=o;var g=o+e.length;var y=o+e.length+1;var _=o+1;n.push(m,g,_);n.push(g,y,_)}}this.setIndex(n);this.addAttribute("position",new za(a,3));this.addAttribute("uv",new za(s,2));this.computeVertexNormals();if(r===Math.PI*2){var x=this.attributes.normal.array;var w=new ti;var b=new ti;var M=new ti;o=t*e.length*3;for(u=0,f=0;u<e.length;u++,f+=3){w.x=x[f+0];w.y=x[f+1];w.z=x[f+2];b.x=x[o+f+0];b.y=x[o+f+1];b.z=x[o+f+2];M.addVectors(w,b).normalize();x[f+0]=x[o+f+0]=M.x;x[f+1]=x[o+f+1]=M.y;x[f+2]=x[o+f+2]=M.z}}}ko.prototype=Object.create(ja.prototype);ko.prototype.constructor=ko;function No(e,t){Aa.call(this);this.type="ShapeGeometry";if((typeof t==="undefined"?"undefined":m(t))==="object"){t=t.curveSegments}this.parameters={shapes:e,curveSegments:t};this.fromBufferGeometry(new zo(e,t));this.mergeVertices()}No.prototype=Object.create(Aa.prototype);No.prototype.constructor=No;function zo(e,t){ja.call(this);this.type="ShapeBufferGeometry";this.parameters={shapes:e,curveSegments:t};t=t||12;var i=[];var r=[];var n=[];var a=[];var s=0;var o=0;if(Array.isArray(e)===false){l(e)}else{for(var h=0;h<e.length;h++){l(e[h]);this.addGroup(s,o,h);s+=o;o=0}}this.setIndex(i);this.addAttribute("position",new za(r,3));this.addAttribute("normal",new za(n,3));this.addAttribute("uv",new za(a,2));function l(e){var s,h,l;var c=r.length/3;var u=e.extractPoints(t);var f=u.shape;var d=u.holes;if(To.isClockWise(f)===false){f=f.reverse();for(s=0,h=d.length;s<h;s++){l=d[s];if(To.isClockWise(l)===true){d[s]=l.reverse()}}}var p=To.triangulateShape(f,d);for(s=0,h=d.length;s<h;s++){l=d[s];f=f.concat(l)}for(s=0,h=f.length;s<h;s++){var v=f[s];r.push(v.x,v.y,0);n.push(0,0,1);a.push(v.x,v.y)}for(s=0,h=p.length;s<h;s++){var m=p[s];var g=m[0]+c;var y=m[1]+c;var _=m[2]+c;i.push(g,y,_);o+=3}}}zo.prototype=Object.create(ja.prototype);zo.prototype.constructor=zo;function Bo(e,t){ja.call(this);this.type="EdgesGeometry";this.parameters={thresholdAngle:t};t=t!==undefined?t:1;var i=[];var r=Math.cos(Qt.DEG2RAD*t);var n=[0,0],a={},s,o;var h,l=["a","b","c"];var c;if(e.isBufferGeometry){c=new Aa;c.fromBufferGeometry(e)}else{c=e.clone()}c.mergeVertices();c.computeFaceNormals();var u=c.vertices;var f=c.faces;for(var d=0,p=f.length;d<p;d++){var v=f[d];for(var m=0;m<3;m++){s=v[l[m]];o=v[l[(m+1)%3]];n[0]=Math.min(s,o);n[1]=Math.max(s,o);h=n[0]+","+n[1];if(a[h]===undefined){a[h]={index1:n[0],index2:n[1],face1:d,face2:undefined}}else{a[h].face2=d}}}for(h in a){var g=a[h];if(g.face2===undefined||f[g.face1].normal.dot(f[g.face2].normal)<=r){var y=u[g.index1];i.push(y.x,y.y,y.z);y=u[g.index2];i.push(y.x,y.y,y.z)}}this.addAttribute("position",new za(i,3))}Bo.prototype=Object.create(ja.prototype);Bo.prototype.constructor=Bo;function Uo(e,t,i,r,n,a,s,o){Aa.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:a,thetaStart:s,thetaLength:o};this.fromBufferGeometry(new Do(e,t,i,r,n,a,s,o));this.mergeVertices()}Uo.prototype=Object.create(Aa.prototype);Uo.prototype.constructor=Uo;function Do(e,t,i,r,n,a,s,o){ja.call(this);this.type="CylinderBufferGeometry";this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:a,thetaStart:s,thetaLength:o};var h=this;e=e!==undefined?e:1;t=t!==undefined?t:1;i=i||1;r=Math.floor(r)||8;n=Math.floor(n)||1;a=a!==undefined?a:false;s=s!==undefined?s:0;o=o!==undefined?o:Math.PI*2;var l=[];var c=[];var u=[];var f=[];var d=0;var p=[];var v=i/2;var m=0;g();if(a===false){if(e>0)y(true);if(t>0)y(false)}this.setIndex(l);this.addAttribute("position",new za(c,3));this.addAttribute("normal",new za(u,3));this.addAttribute("uv",new za(f,2));function g(){var a,g;var y=new ti;var _=new ti;var x=0;var w=(t-e)/i;for(g=0;g<=n;g++){var b=[];var M=g/n;var T=M*(t-e)+e;for(a=0;a<=r;a++){var E=a/r;var S=E*o+s;var A=Math.sin(S);var L=Math.cos(S);_.x=T*A;_.y=-M*i+v;_.z=T*L;c.push(_.x,_.y,_.z);y.set(A,w,L).normalize();u.push(y.x,y.y,y.z);f.push(E,1-M);b.push(d++)}p.push(b)}for(a=0;a<r;a++){for(g=0;g<n;g++){var C=p[g][a];var R=p[g+1][a];var I=p[g+1][a+1];var P=p[g][a+1];l.push(C,R,P);l.push(R,I,P);x+=6}}h.addGroup(m,x,0);m+=x}function y(i){var n,a,p;var g=new Kt;var y=new ti;var _=0;var x=i===true?e:t;var w=i===true?1:-1;a=d;for(n=1;n<=r;n++){c.push(0,v*w,0);u.push(0,w,0);f.push(.5,.5);d++}p=d;for(n=0;n<=r;n++){var b=n/r;var M=b*o+s;var T=Math.cos(M);var E=Math.sin(M);y.x=x*E;y.y=v*w;y.z=x*T;c.push(y.x,y.y,y.z);u.push(0,w,0);g.x=T*.5+.5;g.y=E*.5*w+.5;f.push(g.x,g.y);d++}for(n=0;n<r;n++){var S=a+n;var A=p+n;if(i===true){l.push(A,A+1,S)}else{l.push(A+1,A,S)}_+=3}h.addGroup(m,_,i===true?1:2);m+=_}}Do.prototype=Object.create(ja.prototype);Do.prototype.constructor=Do;function Fo(e,t,i,r,n,a,s){Uo.call(this,0,e,t,i,r,n,a,s);this.type="ConeGeometry";this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:a,thetaLength:s}}Fo.prototype=Object.create(Uo.prototype);Fo.prototype.constructor=Fo;function jo(e,t,i,r,n,a,s){Do.call(this,0,e,t,i,r,n,a,s);this.type="ConeBufferGeometry";this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:a,thetaLength:s}}jo.prototype=Object.create(Do.prototype);jo.prototype.constructor=jo;function Go(e,t,i,r){Aa.call(this);this.type="CircleGeometry";this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r};this.fromBufferGeometry(new Ho(e,t,i,r));this.mergeVertices()}Go.prototype=Object.create(Aa.prototype);Go.prototype.constructor=Go;function Ho(e,t,i,r){ja.call(this);this.type="CircleBufferGeometry";this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r};e=e||1;t=t!==undefined?Math.max(3,t):8;i=i!==undefined?i:0;r=r!==undefined?r:Math.PI*2;var n=[];var a=[];var s=[];var o=[];var h,l;var c=new ti;var u=new Kt;a.push(0,0,0);s.push(0,0,1);o.push(.5,.5);for(l=0,h=3;l<=t;l++,h+=3){var f=i+l/t*r;c.x=e*Math.cos(f);c.y=e*Math.sin(f);a.push(c.x,c.y,c.z);s.push(0,0,1);u.x=(a[h]/e+1)/2;u.y=(a[h+1]/e+1)/2;o.push(u.x,u.y)}for(h=1;h<=t;h++){n.push(h,h+1,0)}this.setIndex(n);this.addAttribute("position",new za(a,3));this.addAttribute("normal",new za(s,3));this.addAttribute("uv",new za(o,2))}Ho.prototype=Object.create(ja.prototype);Ho.prototype.constructor=Ho;var Vo=Object.freeze({WireframeGeometry:no,ParametricGeometry:ao,ParametricBufferGeometry:so,TetrahedronGeometry:lo,TetrahedronBufferGeometry:co,OctahedronGeometry:uo,OctahedronBufferGeometry:fo,IcosahedronGeometry:po,IcosahedronBufferGeometry:vo,DodecahedronGeometry:mo,DodecahedronBufferGeometry:go,PolyhedronGeometry:oo,PolyhedronBufferGeometry:ho,TubeGeometry:yo,TubeBufferGeometry:_o,TorusKnotGeometry:xo,TorusKnotBufferGeometry:wo,TorusGeometry:bo,TorusBufferGeometry:Mo,TextGeometry:Ao,TextBufferGeometry:Lo,SphereGeometry:Co,SphereBufferGeometry:Ro,RingGeometry:Io,RingBufferGeometry:Po,PlaneGeometry:Va,PlaneBufferGeometry:Wa,LatheGeometry:Oo,LatheBufferGeometry:ko,ShapeGeometry:No,ShapeBufferGeometry:zo,ExtrudeGeometry:Eo,ExtrudeBufferGeometry:So,EdgesGeometry:Bo,ConeGeometry:Fo,ConeBufferGeometry:jo,CylinderGeometry:Uo,CylinderBufferGeometry:Do,CircleGeometry:Go,CircleBufferGeometry:Ho,BoxGeometry:Ga,BoxBufferGeometry:Ha});function Wo(e){ca.call(this);this.type="ShadowMaterial";this.color=new Ki(0);this.opacity=1;this.lights=true;this.transparent=true;this.setValues(e)}Wo.prototype=Object.create(ca.prototype);Wo.prototype.constructor=Wo;Wo.prototype.isShadowMaterial=true;function Xo(e){Ya.call(this,e);this.type="RawShaderMaterial"}Xo.prototype=Object.create(Ya.prototype);Xo.prototype.constructor=Xo;Xo.prototype.isRawShaderMaterial=true;function Yo(e){ca.call(this);this.defines={STANDARD:""};this.type="MeshStandardMaterial";this.color=new Ki(16777215);this.roughness=.5;this.metalness=.5;this.map=null;this.lightMap=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new Ki(0);this.emissiveIntensity=1;this.emissiveMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new Kt(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.roughnessMap=null;this.metalnessMap=null;this.alphaMap=null;this.envMap=null;this.envMapIntensity=1;this.refractionRatio=.98;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)}Yo.prototype=Object.create(ca.prototype);Yo.prototype.constructor=Yo;Yo.prototype.isMeshStandardMaterial=true;Yo.prototype.copy=function(e){ca.prototype.copy.call(this,e);this.defines={STANDARD:""};this.color.copy(e.color);this.roughness=e.roughness;this.metalness=e.metalness;this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.emissive.copy(e.emissive);this.emissiveMap=e.emissiveMap;this.emissiveIntensity=e.emissiveIntensity;this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.roughnessMap=e.roughnessMap;this.metalnessMap=e.metalnessMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.envMapIntensity=e.envMapIntensity;this.refractionRatio=e.refractionRatio;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.morphNormals=e.morphNormals;return this};function qo(e){Yo.call(this);this.defines={PHYSICAL:""};this.type="MeshPhysicalMaterial";this.reflectivity=.5;this.clearCoat=0;this.clearCoatRoughness=0;this.setValues(e)}qo.prototype=Object.create(Yo.prototype);qo.prototype.constructor=qo;qo.prototype.isMeshPhysicalMaterial=true;qo.prototype.copy=function(e){Yo.prototype.copy.call(this,e);this.defines={PHYSICAL:""};this.reflectivity=e.reflectivity;this.clearCoat=e.clearCoat;this.clearCoatRoughness=e.clearCoatRoughness;return this};function Zo(e){ca.call(this);this.type="MeshPhongMaterial";this.color=new Ki(16777215);this.specular=new Ki(1118481);this.shininess=30;this.map=null;this.lightMap=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new Ki(0);this.emissiveIntensity=1;this.emissiveMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new Kt(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=Ce;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)}Zo.prototype=Object.create(ca.prototype);Zo.prototype.constructor=Zo;Zo.prototype.isMeshPhongMaterial=true;Zo.prototype.copy=function(e){ca.prototype.copy.call(this,e);this.color.copy(e.color);this.specular.copy(e.specular);this.shininess=e.shininess;this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.emissive.copy(e.emissive);this.emissiveMap=e.emissiveMap;this.emissiveIntensity=e.emissiveIntensity;this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.specularMap=e.specularMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.combine=e.combine;this.reflectivity=e.reflectivity;this.refractionRatio=e.refractionRatio;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.morphNormals=e.morphNormals;return this};function Jo(e){Zo.call(this);this.defines={TOON:""};this.type="MeshToonMaterial";this.gradientMap=null;this.setValues(e)}Jo.prototype=Object.create(Zo.prototype);Jo.prototype.constructor=Jo;Jo.prototype.isMeshToonMaterial=true;Jo.prototype.copy=function(e){Zo.prototype.copy.call(this,e);this.gradientMap=e.gradientMap;return this};function Qo(e){ca.call(this);this.type="MeshNormalMaterial";this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new Kt(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;this.lights=false;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)}Qo.prototype=Object.create(ca.prototype);Qo.prototype.constructor=Qo;Qo.prototype.isMeshNormalMaterial=true;Qo.prototype.copy=function(e){ca.prototype.copy.call(this,e);this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.morphNormals=e.morphNormals;return this};function Ko(e){ca.call(this);this.type="MeshLambertMaterial";this.color=new Ki(16777215);this.map=null;this.lightMap=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new Ki(0);this.emissiveIntensity=1;this.emissiveMap=null;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=Ce;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)}Ko.prototype=Object.create(ca.prototype);Ko.prototype.constructor=Ko;Ko.prototype.isMeshLambertMaterial=true;Ko.prototype.copy=function(e){ca.prototype.copy.call(this,e);this.color.copy(e.color);this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.emissive.copy(e.emissive);this.emissiveMap=e.emissiveMap;this.emissiveIntensity=e.emissiveIntensity;this.specularMap=e.specularMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.combine=e.combine;this.reflectivity=e.reflectivity;this.refractionRatio=e.refractionRatio;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.morphNormals=e.morphNormals;return this};function $o(e){qs.call(this);this.type="LineDashedMaterial";this.scale=1;this.dashSize=3;this.gapSize=1;this.setValues(e)}$o.prototype=Object.create(qs.prototype);$o.prototype.constructor=$o;$o.prototype.isLineDashedMaterial=true;$o.prototype.copy=function(e){qs.prototype.copy.call(this,e);this.scale=e.scale;this.dashSize=e.dashSize;this.gapSize=e.gapSize;return this};var eh=Object.freeze({ShadowMaterial:Wo,SpriteMaterial:Gs,RawShaderMaterial:Xo,ShaderMaterial:Ya,PointsMaterial:Ks,MeshPhysicalMaterial:qo,MeshStandardMaterial:Yo,MeshPhongMaterial:Zo,MeshToonMaterial:Jo,MeshNormalMaterial:Qo,MeshLambertMaterial:Ko,MeshDepthMaterial:ua,MeshDistanceMaterial:fa,MeshBasicMaterial:Xa,LineDashedMaterial:$o,LineBasicMaterial:qs,Material:ca});var th={enabled:false,files:{},add:function e(t,i){if(this.enabled===false)return;this.files[t]=i},get:function e(t){if(this.enabled===false)return;return this.files[t]},remove:function e(t){delete this.files[t]},clear:function e(){this.files={}}};function ih(e,t,i){var r=this;var n=false;var a=0;var s=0;var o=undefined;this.onStart=undefined;this.onLoad=e;this.onProgress=t;this.onError=i;this.itemStart=function(e){s++;if(n===false){if(r.onStart!==undefined){r.onStart(e,a,s)}}n=true};this.itemEnd=function(e){a++;if(r.onProgress!==undefined){r.onProgress(e,a,s)}if(a===s){n=false;if(r.onLoad!==undefined){r.onLoad()}}};this.itemError=function(e){if(r.onError!==undefined){r.onError(e)}};this.resolveURL=function(e){if(o){return o(e)}return e};this.setURLModifier=function(e){o=e}}var rh=new ih;var nh={};function ah(e){this.manager=e!==undefined?e:rh}Object.assign(ah.prototype,{load:function e(t,i,r,n){if(t===undefined)t="";if(this.path!==undefined)t=this.path+t;t=this.manager.resolveURL(t);var a=this;var s=th.get(t);if(s!==undefined){a.manager.itemStart(t);setTimeout(function(){if(i)i(s);a.manager.itemEnd(t)},0);return s}if(nh[t]!==undefined){nh[t].push({onLoad:i,onProgress:r,onError:n});return}var o=/^data:(.*?)(;base64)?,(.*)$/;var h=t.match(o);if(h){var l=h[1];var c=!!h[2];var u=h[3];u=window.decodeURIComponent(u);if(c)u=window.atob(u);try{var f;var d=(this.responseType||"").toLowerCase();switch(d){case"arraybuffer":case"blob":var p=new Uint8Array(u.length);for(var v=0;v<u.length;v++){p[v]=u.charCodeAt(v)}if(d==="blob"){f=new Blob([p.buffer],{type:l})}else{f=p.buffer}break;case"document":var m=new DOMParser;f=m.parseFromString(u,l);break;case"json":f=JSON.parse(u);break;default:f=u;break}window.setTimeout(function(){if(i)i(f);a.manager.itemEnd(t)},0)}catch(e){window.setTimeout(function(){if(n)n(e);a.manager.itemEnd(t);a.manager.itemError(t)},0)}}else{nh[t]=[];nh[t].push({onLoad:i,onProgress:r,onError:n});var g=new XMLHttpRequest;g.open("GET",t,true);g.addEventListener("load",function(e){var i=e.target.response;th.add(t,i);var r=nh[t];delete nh[t];if(this.status===200){for(var n=0,s=r.length;n<s;n++){var o=r[n];if(o.onLoad)o.onLoad(i)}a.manager.itemEnd(t)}else if(this.status===0){for(var n=0,s=r.length;n<s;n++){var o=r[n];if(o.onLoad)o.onLoad(i)}a.manager.itemEnd(t)}else{for(var n=0,s=r.length;n<s;n++){var o=r[n];if(o.onError)o.onError(e)}a.manager.itemEnd(t);a.manager.itemError(t)}},false);g.addEventListener("progress",function(e){var i=nh[t];for(var r=0,n=i.length;r<n;r++){var a=i[r];if(a.onProgress)a.onProgress(e)}},false);g.addEventListener("error",function(e){var i=nh[t];delete nh[t];for(var r=0,n=i.length;r<n;r++){var s=i[r];if(s.onError)s.onError(e)}a.manager.itemEnd(t);a.manager.itemError(t)},false);if(this.responseType!==undefined)g.responseType=this.responseType;if(this.withCredentials!==undefined)g.withCredentials=this.withCredentials;if(g.overrideMimeType)g.overrideMimeType(this.mimeType!==undefined?this.mimeType:"text/plain");for(var y in this.requestHeader){g.setRequestHeader(y,this.requestHeader[y])}g.send(null)}a.manager.itemStart(t);return g},setPath:function e(t){this.path=t;return this},setResponseType:function e(t){this.responseType=t;return this},setWithCredentials:function e(t){this.withCredentials=t;return this},setMimeType:function e(t){this.mimeType=t;return this},setRequestHeader:function e(t){this.requestHeader=t;return this}});function sh(e){this.manager=e!==undefined?e:rh;this._parser=null}Object.assign(sh.prototype,{load:function e(t,i,r,n){var a=this;var s=[];var o=new io;o.image=s;var h=new ah(this.manager);h.setPath(this.path);h.setResponseType("arraybuffer");function l(e){h.load(t[e],function(t){var r=a._parser(t,true);s[e]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps};c+=1;if(c===6){if(r.mipmapCount===1)o.minFilter=Qe;o.format=r.format;o.needsUpdate=true;if(i)i(o)}},r,n)}if(Array.isArray(t)){var c=0;for(var u=0,f=t.length;u<f;++u){l(u)}}else{h.load(t,function(e){var t=a._parser(e,true);if(t.isCubemap){var r=t.mipmaps.length/t.mipmapCount;for(var n=0;n<r;n++){s[n]={mipmaps:[]};for(var h=0;h<t.mipmapCount;h++){s[n].mipmaps.push(t.mipmaps[n*t.mipmapCount+h]);s[n].format=t.format;s[n].width=t.width;s[n].height=t.height}}}else{o.image.width=t.width;o.image.height=t.height;o.mipmaps=t.mipmaps}if(t.mipmapCount===1){o.minFilter=Qe}o.format=t.format;o.needsUpdate=true;if(i)i(o)},r,n)}return o},setPath:function e(t){this.path=t;return this}});function oh(e){this.manager=e!==undefined?e:rh;this._parser=null}Object.assign(oh.prototype,{load:function e(t,i,r,n){var a=this;var s=new hi;var o=new ah(this.manager);o.setResponseType("arraybuffer");o.load(t,function(e){var t=a._parser(e);if(!t)return;if(undefined!==t.image){s.image=t.image}else if(undefined!==t.data){s.image.width=t.width;s.image.height=t.height;s.image.data=t.data}s.wrapS=undefined!==t.wrapS?t.wrapS:Xe;s.wrapT=undefined!==t.wrapT?t.wrapT:Xe;s.magFilter=undefined!==t.magFilter?t.magFilter:Qe;s.minFilter=undefined!==t.minFilter?t.minFilter:$e;s.anisotropy=undefined!==t.anisotropy?t.anisotropy:1;if(undefined!==t.format){s.format=t.format}if(undefined!==t.type){s.type=t.type}if(undefined!==t.mipmaps){s.mipmaps=t.mipmaps}if(1===t.mipmapCount){s.minFilter=Qe}s.needsUpdate=true;if(i)i(s,t)},r,n);return s}});function hh(e){this.manager=e!==undefined?e:rh}Object.assign(hh.prototype,{crossOrigin:"Anonymous",load:function e(t,i,r,n){if(t===undefined)t="";if(this.path!==undefined)t=this.path+t;t=this.manager.resolveURL(t);var a=this;var s=th.get(t);if(s!==undefined){a.manager.itemStart(t);setTimeout(function(){if(i)i(s);a.manager.itemEnd(t)},0);return s}var o=wx.createImage();o.addEventListener("load",function(){th.add(t,this);if(i)i(this);a.manager.itemEnd(t)},false);o.addEventListener("error",function(e){if(n)n(e);a.manager.itemEnd(t);a.manager.itemError(t)},false);if(t.substr(0,5)!=="data:"){if(this.crossOrigin!==undefined)o.crossOrigin=this.crossOrigin}a.manager.itemStart(t);o.src=t;return o},setCrossOrigin:function e(t){this.crossOrigin=t;return this},setPath:function e(t){this.path=t;return this}});function lh(e){this.manager=e!==undefined?e:rh}Object.assign(lh.prototype,{crossOrigin:"Anonymous",load:function e(t,i,r,n){var a=new li;var s=new hh(this.manager);s.setCrossOrigin(this.crossOrigin);s.setPath(this.path);var o=0;function h(e){s.load(t[e],function(t){a.images[e]=t;o++;if(o===6){a.needsUpdate=true;if(i)i(a)}},undefined,n)}for(var l=0;l<t.length;++l){h(l)}return a},setCrossOrigin:function e(t){this.crossOrigin=t;return this},setPath:function e(t){this.path=t;return this}});function ch(e){this.manager=e!==undefined?e:rh}Object.assign(ch.prototype,{crossOrigin:"Anonymous",load:function e(t,i,r,n){var a=new hh(this.manager);a.setCrossOrigin(this.crossOrigin);a.setPath(this.path);var s=new ni;s.image=a.load(t,function(){var e=t.search(/\.(jpg|jpeg)$/)>0||t.search(/^data\:image\/jpeg/)===0;s.format=e?dt:pt;s.needsUpdate=true;if(i!==undefined){i(s)}},r,n);return s},setCrossOrigin:function e(t){this.crossOrigin=t;return this},setPath:function e(t){this.path=t;return this}});function uh(e,t){ba.call(this);this.type="Light";this.color=new Ki(e);this.intensity=t!==undefined?t:1;this.receiveShadow=undefined}uh.prototype=Object.assign(Object.create(ba.prototype),{constructor:uh,isLight:true,copy:function e(t){ba.prototype.copy.call(this,t);this.color.copy(t.color);this.intensity=t.intensity;return this},toJSON:function e(t){var i=ba.prototype.toJSON.call(this,t);i.object.color=this.color.getHex();i.object.intensity=this.intensity;if(this.groundColor!==undefined)i.object.groundColor=this.groundColor.getHex();if(this.distance!==undefined)i.object.distance=this.distance;if(this.angle!==undefined)i.object.angle=this.angle;if(this.decay!==undefined)i.object.decay=this.decay;if(this.penumbra!==undefined)i.object.penumbra=this.penumbra;if(this.shadow!==undefined)i.object.shadow=this.shadow.toJSON();return i}});function fh(e,t,i){uh.call(this,e,i);this.type="HemisphereLight";this.castShadow=undefined;this.position.copy(ba.DefaultUp);this.updateMatrix();this.groundColor=new Ki(t)}fh.prototype=Object.assign(Object.create(uh.prototype),{constructor:fh,isHemisphereLight:true,copy:function e(t){uh.prototype.copy.call(this,t);this.groundColor.copy(t.groundColor);return this}});function dh(e){this.camera=e;this.bias=0;this.radius=1;this.mapSize=new Kt(512,512);this.map=null;this.matrix=new $t}Object.assign(dh.prototype,{copy:function e(t){this.camera=t.camera.clone();this.bias=t.bias;this.radius=t.radius;this.mapSize.copy(t.mapSize);return this},clone:function e(){return(new this.constructor).copy(this)},toJSON:function e(){var t={};if(this.bias!==0)t.bias=this.bias;if(this.radius!==1)t.radius=this.radius;if(this.mapSize.x!==512||this.mapSize.y!==512)t.mapSize=this.mapSize.toArray();t.camera=this.camera.toJSON(false).object;delete t.camera.matrix;return t}});function ph(){dh.call(this,new Is(50,1,.5,500))}ph.prototype=Object.assign(Object.create(dh.prototype),{constructor:ph,isSpotLightShadow:true,update:function e(t){var i=this.camera;var r=Qt.RAD2DEG*2*t.angle;var n=this.mapSize.width/this.mapSize.height;var a=t.distance||i.far;if(r!==i.fov||n!==i.aspect||a!==i.far){i.fov=r;i.aspect=n;i.far=a;i.updateProjectionMatrix()}}});function vh(e,t,i,r,n,a){uh.call(this,e,t);this.type="SpotLight";this.position.copy(ba.DefaultUp);this.updateMatrix();this.target=new ba;Object.defineProperty(this,"power",{get:function e(){return this.intensity*Math.PI},set:function e(t){this.intensity=t/Math.PI}});this.distance=i!==undefined?i:0;this.angle=r!==undefined?r:Math.PI/3;this.penumbra=n!==undefined?n:0;this.decay=a!==undefined?a:1;this.shadow=new ph}vh.prototype=Object.assign(Object.create(uh.prototype),{constructor:vh,isSpotLight:true,copy:function e(t){uh.prototype.copy.call(this,t);this.distance=t.distance;this.angle=t.angle;this.penumbra=t.penumbra;this.decay=t.decay;this.target=t.target.clone();this.shadow=t.shadow.clone();return this}});function mh(e,t,i,r){uh.call(this,e,t);this.type="PointLight";Object.defineProperty(this,"power",{get:function e(){return this.intensity*4*Math.PI},set:function e(t){this.intensity=t/(4*Math.PI)}});this.distance=i!==undefined?i:0;this.decay=r!==undefined?r:1;this.shadow=new dh(new Is(90,1,.5,500))}mh.prototype=Object.assign(Object.create(uh.prototype),{constructor:mh,isPointLight:true,copy:function e(t){uh.prototype.copy.call(this,t);this.distance=t.distance;this.decay=t.decay;this.shadow=t.shadow.clone();return this}});function gh(){dh.call(this,new Ta(-5,5,5,-5,.5,500))}gh.prototype=Object.assign(Object.create(dh.prototype),{constructor:gh});function yh(e,t){uh.call(this,e,t);this.type="DirectionalLight";this.position.copy(ba.DefaultUp);this.updateMatrix();this.target=new ba;this.shadow=new gh}yh.prototype=Object.assign(Object.create(uh.prototype),{constructor:yh,isDirectionalLight:true,copy:function e(t){uh.prototype.copy.call(this,t);this.target=t.target.clone();this.shadow=t.shadow.clone();return this}});function _h(e,t){uh.call(this,e,t);this.type="AmbientLight";this.castShadow=undefined}_h.prototype=Object.assign(Object.create(uh.prototype),{constructor:_h,isAmbientLight:true});function xh(e,t,i,r){uh.call(this,e,t);this.type="RectAreaLight";this.position.set(0,1,0);this.updateMatrix();this.width=i!==undefined?i:10;this.height=r!==undefined?r:10}xh.prototype=Object.assign(Object.create(uh.prototype),{constructor:xh,isRectAreaLight:true,copy:function e(t){uh.prototype.copy.call(this,t);this.width=t.width;this.height=t.height;return this},toJSON:function e(t){var i=uh.prototype.toJSON.call(this,t);i.object.width=this.width;i.object.height=this.height;return i}});var wh={arraySlice:function e(t,i,r){if(wh.isTypedArray(t)){return new t.constructor(t.subarray(i,r!==undefined?r:t.length))}return t.slice(i,r)},convertArray:function e(t,i,r){if(!t||!r&&t.constructor===i)return t;if(typeof i.BYTES_PER_ELEMENT==="number"){return new i(t)}return Array.prototype.slice.call(t)},isTypedArray:function e(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function e(t){function i(e,i){return t[e]-t[i]}var r=t.length;var n=new Array(r);for(var a=0;a!==r;++a){n[a]=a}n.sort(i);return n},sortedArray:function e(t,i,r){var n=t.length;var a=new t.constructor(n);for(var s=0,o=0;o!==n;++s){var h=r[s]*i;for(var l=0;l!==i;++l){a[o++]=t[h+l]}}return a},flattenJSON:function e(t,i,r,n){var a=1,s=t[0];while(s!==undefined&&s[n]===undefined){s=t[a++]}if(s===undefined)return;var o=s[n];if(o===undefined)return;if(Array.isArray(o)){do{o=s[n];if(o!==undefined){i.push(s.time);r.push.apply(r,o)}s=t[a++]}while(s!==undefined)}else if(o.toArray!==undefined){do{o=s[n];if(o!==undefined){i.push(s.time);o.toArray(r,r.length)}s=t[a++]}while(s!==undefined)}else{do{o=s[n];if(o!==undefined){i.push(s.time);r.push(o)}s=t[a++]}while(s!==undefined)}}};function bh(e,t,i,r){this.parameterPositions=e;this._cachedIndex=0;this.resultBuffer=r!==undefined?r:new t.constructor(i);this.sampleValues=t;this.valueSize=i}Object.assign(bh.prototype,{evaluate:function e(t){var i=this.parameterPositions,r=this._cachedIndex,n=i[r],a=i[r-1];e:{t:{var s;i:{r:if(!(t<n)){for(var o=r+2;;){if(n===undefined){if(t<a)break r;r=i.length;this._cachedIndex=r;return this.afterEnd_(r-1,t,a)}if(r===o)break;a=n;n=i[++r];if(t<n){break t}}s=i.length;break i}if(!(t>=a)){var h=i[1];if(t<h){r=2;a=h}for(var o=r-2;;){if(a===undefined){this._cachedIndex=0;return this.beforeStart_(0,t,n)}if(r===o)break;n=a;a=i[--r-1];if(t>=a){break t}}s=r;r=0;break i}break e}while(r<s){var l=r+s>>>1;if(t<i[l]){s=l}else{r=l+1}}n=i[r];a=i[r-1];if(a===undefined){this._cachedIndex=0;return this.beforeStart_(0,t,n)}if(n===undefined){r=i.length;this._cachedIndex=r;return this.afterEnd_(r-1,a,t)}}this._cachedIndex=r;this.intervalChanged_(r,a,n)}return this.interpolate_(r,a,t,n)},settings:null,DefaultSettings_:{},getSettings_:function e(){return this.settings||this.DefaultSettings_},copySampleValue_:function e(t){var i=this.resultBuffer,r=this.sampleValues,n=this.valueSize,a=t*n;for(var s=0;s!==n;++s){i[s]=r[a+s]}return i},interpolate_:function e(){throw new Error("call to abstract method")},intervalChanged_:function e(){}});Object.assign(bh.prototype,{beforeStart_:bh.prototype.copySampleValue_,afterEnd_:bh.prototype.copySampleValue_});function Mh(e,t,i,r){bh.call(this,e,t,i,r);this._weightPrev=-0;this._offsetPrev=-0;this._weightNext=-0;this._offsetNext=-0}Mh.prototype=Object.assign(Object.create(bh.prototype),{constructor:Mh,DefaultSettings_:{endingStart:Nt,endingEnd:Nt},intervalChanged_:function e(t,i,r){var n=this.parameterPositions,a=t-2,s=t+1,o=n[a],h=n[s];if(o===undefined){switch(this.getSettings_().endingStart){case zt:a=t;o=2*i-r;break;case Bt:a=n.length-2;o=i+n[a]-n[a+1];break;default:a=t;o=r}}if(h===undefined){switch(this.getSettings_().endingEnd){case zt:s=t;h=2*r-i;break;case Bt:s=1;h=r+n[1]-n[0];break;default:s=t-1;h=i}}var l=(r-i)*.5,c=this.valueSize;this._weightPrev=l/(i-o);this._weightNext=l/(h-r);this._offsetPrev=a*c;this._offsetNext=s*c},interpolate_:function e(t,i,r,n){var a=this.resultBuffer,s=this.sampleValues,o=this.valueSize,h=t*o,l=h-o,c=this._offsetPrev,u=this._offsetNext,f=this._weightPrev,d=this._weightNext,p=(r-i)/(n-i),v=p*p,m=v*p;var g=-f*m+2*f*v-f*p;var y=(1+f)*m+(-1.5-2*f)*v+(-.5+f)*p+1;var _=(-1-d)*m+(1.5+d)*v+.5*p;var x=d*m-d*v;for(var w=0;w!==o;++w){a[w]=g*s[c+w]+y*s[l+w]+_*s[h+w]+x*s[u+w]}return a}});function Th(e,t,i,r){bh.call(this,e,t,i,r)}Th.prototype=Object.assign(Object.create(bh.prototype),{constructor:Th,interpolate_:function e(t,i,r,n){var a=this.resultBuffer,s=this.sampleValues,o=this.valueSize,h=t*o,l=h-o,c=(r-i)/(n-i),u=1-c;for(var f=0;f!==o;++f){a[f]=s[l+f]*u+s[h+f]*c}return a}});function Eh(e,t,i,r){bh.call(this,e,t,i,r)}Eh.prototype=Object.assign(Object.create(bh.prototype),{constructor:Eh,interpolate_:function e(t){return this.copySampleValue_(t-1)}});var Sh;Sh={TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Ot,InterpolantFactoryMethodDiscrete:function e(t){return new Eh(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function e(t){return new Th(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function e(t){return new Mh(this.times,this.values,this.getValueSize(),t)},setInterpolation:function e(t){var i;switch(t){case Pt:i=this.InterpolantFactoryMethodDiscrete;break;case Ot:i=this.InterpolantFactoryMethodLinear;break;case kt:i=this.InterpolantFactoryMethodSmooth;break}if(i===undefined){var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===undefined){if(t!==this.DefaultInterpolation){this.setInterpolation(this.DefaultInterpolation)}else{throw new Error(r)}}return}this.createInterpolant=i},getInterpolation:function e(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Pt;case this.InterpolantFactoryMethodLinear:return Ot;case this.InterpolantFactoryMethodSmooth:return kt}},getValueSize:function e(){return this.values.length/this.times.length},shift:function e(t){if(t!==0){var i=this.times;for(var r=0,n=i.length;r!==n;++r){i[r]+=t}}return this},scale:function e(t){if(t!==1){var i=this.times;for(var r=0,n=i.length;r!==n;++r){i[r]*=t}}return this},trim:function e(t,i){var r=this.times,n=r.length,a=0,s=n-1;while(a!==n&&r[a]<t){++a}while(s!==-1&&r[s]>i){--s}++s;if(a!==0||s!==n){if(a>=s)s=Math.max(s,1),a=s-1;var o=this.getValueSize();this.times=wh.arraySlice(r,a,s);this.values=wh.arraySlice(this.values,a*o,s*o)}return this},validate:function e(){var t=true;var i=this.getValueSize();if(i-Math.floor(i)!==0){console.error("THREE.KeyframeTrackPrototype: Invalid value size in track.",this);t=false}var r=this.times,n=this.values,a=r.length;if(a===0){console.error("THREE.KeyframeTrackPrototype: Track is empty.",this);t=false}var s=null;for(var o=0;o!==a;o++){var h=r[o];if(typeof h==="number"&&isNaN(h)){console.error("THREE.KeyframeTrackPrototype: Time is not a valid number.",this,o,h);t=false;break}if(s!==null&&s>h){console.error("THREE.KeyframeTrackPrototype: Out of order keys.",this,o,h,s);t=false;break}s=h}if(n!==undefined){if(wh.isTypedArray(n)){for(var o=0,l=n.length;o!==l;++o){var c=n[o];if(isNaN(c)){console.error("THREE.KeyframeTrackPrototype: Value is not a valid number.",this,o,c);t=false;break}}}}return t},optimize:function e(){var t=this.times,i=this.values,r=this.getValueSize(),n=this.getInterpolation()===kt,a=1,s=t.length-1;for(var o=1;o<s;++o){var h=false;var l=t[o];var c=t[o+1];if(l!==c&&(o!==1||l!==l[0])){if(!n){var u=o*r,f=u-r,d=u+r;for(var p=0;p!==r;++p){var v=i[u+p];if(v!==i[f+p]||v!==i[d+p]){h=true;break}}}else h=true}if(h){if(o!==a){t[a]=t[o];var m=o*r,g=a*r;for(var p=0;p!==r;++p){i[g+p]=i[m+p]}}++a}}if(s>0){t[a]=t[s];for(var m=s*r,g=a*r,p=0;p!==r;++p){i[g+p]=i[m+p]}++a}if(a!==t.length){this.times=wh.arraySlice(t,0,a);this.values=wh.arraySlice(i,0,a*r)}return this}};function Ah(e,t,i,r){if(e===undefined)throw new Error("track name is undefined");if(t===undefined||t.length===0){throw new Error("no keyframes in track named "+e)}this.name=e;this.times=wh.convertArray(t,this.TimeBufferType);this.values=wh.convertArray(i,this.ValueBufferType);this.setInterpolation(r||this.DefaultInterpolation);this.validate();this.optimize()}function Lh(e,t,i,r){Ah.call(this,e,t,i,r)}Lh.prototype=Object.assign(Object.create(Sh),{constructor:Lh,ValueTypeName:"vector"});function Ch(e,t,i,r){bh.call(this,e,t,i,r)}Ch.prototype=Object.assign(Object.create(bh.prototype),{constructor:Ch,interpolate_:function e(t,i,r,n){var a=this.resultBuffer,s=this.sampleValues,o=this.valueSize,h=t*o,l=(r-i)/(n-i);for(var c=h+o;h!==c;h+=4){ei.slerpFlat(a,0,s,h-o,s,h,l)}return a}});function Rh(e,t,i,r){Ah.call(this,e,t,i,r)}Rh.prototype=Object.assign(Object.create(Sh),{constructor:Rh,ValueTypeName:"quaternion",DefaultInterpolation:Ot,InterpolantFactoryMethodLinear:function e(t){return new Ch(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:undefined});function Ih(e,t,i,r){Ah.call(this,e,t,i,r)}Ih.prototype=Object.assign(Object.create(Sh),{constructor:Ih,ValueTypeName:"number"});function Ph(e,t,i,r){Ah.call(this,e,t,i,r)}Ph.prototype=Object.assign(Object.create(Sh),{constructor:Ph,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Pt,InterpolantFactoryMethodLinear:undefined,InterpolantFactoryMethodSmooth:undefined});function Oh(e,t,i){Ah.call(this,e,t,i)}Oh.prototype=Object.assign(Object.create(Sh),{constructor:Oh,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Pt,InterpolantFactoryMethodLinear:undefined,InterpolantFactoryMethodSmooth:undefined});function kh(e,t,i,r){Ah.call(this,e,t,i,r)}kh.prototype=Object.assign(Object.create(Sh),{constructor:kh,ValueTypeName:"color"});function Nh(e,t,i,r){Ah.apply(this,e,t,i,r)}Nh.prototype=Sh;Sh.constructor=Nh;Object.assign(Nh,{parse:function e(t){if(t.type===undefined){throw new Error("track type undefined, can not parse")}var i=Nh._getTrackTypeForValueTypeName(t.type);if(t.times===undefined){var r=[],n=[];wh.flattenJSON(t.keys,r,n,"value");t.times=r;t.values=n}if(i.parse!==undefined){return i.parse(t)}else{return new i(t.name,t.times,t.values,t.interpolation)}},toJSON:function e(t){var i=t.constructor;var r;if(i.toJSON!==undefined){r=i.toJSON(t)}else{r={name:t.name,times:wh.convertArray(t.times,Array),values:wh.convertArray(t.values,Array)};var n=t.getInterpolation();if(n!==t.DefaultInterpolation){r.interpolation=n}}r.type=t.ValueTypeName;return r},_getTrackTypeForValueTypeName:function e(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ih;case"vector":case"vector2":case"vector3":case"vector4":return Lh;case"color":return kh;case"quaternion":return Rh;case"bool":case"boolean":return Oh;case"string":return Ph}throw new Error("Unsupported typeName: "+t)}});function zh(e,t,i){this.name=e;this.tracks=i;this.duration=t!==undefined?t:-1;this.uuid=Qt.generateUUID();if(this.duration<0){this.resetDuration()}this.optimize()}Object.assign(zh,{parse:function e(t){var i=[],r=t.tracks,n=1/(t.fps||1);for(var a=0,s=r.length;a!==s;++a){i.push(Nh.parse(r[a]).scale(n))}return new zh(t.name,t.duration,i)},toJSON:function e(t){var i=[],r=t.tracks;var n={name:t.name,duration:t.duration,tracks:i};for(var a=0,s=r.length;a!==s;++a){i.push(Nh.toJSON(r[a]))}return n},CreateFromMorphTargetSequence:function e(t,i,r,n){var a=i.length;var s=[];for(var o=0;o<a;o++){var h=[];var l=[];h.push((o+a-1)%a,o,(o+1)%a);l.push(0,1,0);var c=wh.getKeyframeOrder(h);h=wh.sortedArray(h,1,c);l=wh.sortedArray(l,1,c);if(!n&&h[0]===0){h.push(a);l.push(l[0])}s.push(new Ih(".morphTargetInfluences["+i[o].name+"]",h,l).scale(1/r))}return new zh(t,-1,s)},findByName:function e(t,i){var r=t;if(!Array.isArray(t)){var n=t;r=n.geometry&&n.geometry.animations||n.animations}for(var a=0;a<r.length;a++){if(r[a].name===i){return r[a]}}return null},CreateClipsFromMorphTargetSequences:function e(t,i,r){var n={};var a=/^([\w-]*?)([\d]+)$/;for(var s=0,o=t.length;s<o;s++){var h=t[s];var l=h.name.match(a);if(l&&l.length>1){var c=l[1];var u=n[c];if(!u){n[c]=u=[]}u.push(h)}}var f=[];for(var c in n){f.push(zh.CreateFromMorphTargetSequence(c,n[c],i,r))}return f},parseAnimation:function e(t,i){if(!t){console.error("THREE.AnimationClip: No animation in JSONLoader data.");return null}var r=function e(t,i,r,n,a){if(r.length!==0){var s=[];var o=[];wh.flattenJSON(r,s,o,n);if(s.length!==0){a.push(new t(i,s,o))}}};var n=[];var a=t.name||"default";var s=t.length||-1;var o=t.fps||30;var h=t.hierarchy||[];for(var l=0;l<h.length;l++){var c=h[l].keys;if(!c||c.length===0)continue;if(c[0].morphTargets){var u={};for(var f=0;f<c.length;f++){if(c[f].morphTargets){for(var d=0;d<c[f].morphTargets.length;d++){u[c[f].morphTargets[d]]=-1}}}for(var p in u){var v=[];var m=[];for(var d=0;d!==c[f].morphTargets.length;++d){var g=c[f];v.push(g.time);m.push(g.morphTarget===p?1:0)}n.push(new Ih(".morphTargetInfluence["+p+"]",v,m))}s=u.length*(o||1)}else{var y=".bones["+i[l].name+"]";r(Lh,y+".position",c,"pos",n);r(Rh,y+".quaternion",c,"rot",n);r(Lh,y+".scale",c,"scl",n)}}if(n.length===0){return null}var _=new zh(a,s,n);return _}});Object.assign(zh.prototype,{resetDuration:function e(){var t=this.tracks,i=0;for(var r=0,n=t.length;r!==n;++r){var a=this.tracks[r];i=Math.max(i,a.times[a.times.length-1])}this.duration=i},trim:function e(){for(var t=0;t<this.tracks.length;t++){this.tracks[t].trim(0,this.duration)}return this},optimize:function e(){for(var t=0;t<this.tracks.length;t++){this.tracks[t].optimize()}return this}});function Bh(e){this.manager=e!==undefined?e:rh;this.textures={}}Object.assign(Bh.prototype,{load:function e(t,i,r,n){var a=this;var s=new ah(a.manager);s.load(t,function(e){i(a.parse(JSON.parse(e)))},r,n)},setTextures:function e(t){this.textures=t},parse:function e(t){var i=this.textures;function r(e){if(i[e]===undefined){}return i[e]}var n=new eh[t.type];if(t.uuid!==undefined)n.uuid=t.uuid;if(t.name!==undefined)n.name=t.name;if(t.color!==undefined)n.color.setHex(t.color);if(t.roughness!==undefined)n.roughness=t.roughness;if(t.metalness!==undefined)n.metalness=t.metalness;if(t.emissive!==undefined)n.emissive.setHex(t.emissive);if(t.specular!==undefined)n.specular.setHex(t.specular);if(t.shininess!==undefined)n.shininess=t.shininess;if(t.clearCoat!==undefined)n.clearCoat=t.clearCoat;if(t.clearCoatRoughness!==undefined)n.clearCoatRoughness=t.clearCoatRoughness;if(t.uniforms!==undefined)n.uniforms=t.uniforms;if(t.vertexShader!==undefined)n.vertexShader=t.vertexShader;if(t.fragmentShader!==undefined)n.fragmentShader=t.fragmentShader;if(t.vertexColors!==undefined)n.vertexColors=t.vertexColors;if(t.fog!==undefined)n.fog=t.fog;if(t.flatShading!==undefined)n.flatShading=t.flatShading;if(t.blending!==undefined)n.blending=t.blending;if(t.side!==undefined)n.side=t.side;if(t.opacity!==undefined)n.opacity=t.opacity;if(t.transparent!==undefined)n.transparent=t.transparent;if(t.alphaTest!==undefined)n.alphaTest=t.alphaTest;if(t.depthTest!==undefined)n.depthTest=t.depthTest;if(t.depthWrite!==undefined)n.depthWrite=t.depthWrite;if(t.colorWrite!==undefined)n.colorWrite=t.colorWrite;if(t.wireframe!==undefined)n.wireframe=t.wireframe;if(t.wireframeLinewidth!==undefined)n.wireframeLinewidth=t.wireframeLinewidth;if(t.wireframeLinecap!==undefined)n.wireframeLinecap=t.wireframeLinecap;if(t.wireframeLinejoin!==undefined)n.wireframeLinejoin=t.wireframeLinejoin;if(t.rotation!==undefined)n.rotation=t.rotation;if(t.linewidth!==1)n.linewidth=t.linewidth;if(t.dashSize!==undefined)n.dashSize=t.dashSize;if(t.gapSize!==undefined)n.gapSize=t.gapSize;if(t.scale!==undefined)n.scale=t.scale;if(t.skinning!==undefined)n.skinning=t.skinning;if(t.morphTargets!==undefined)n.morphTargets=t.morphTargets;if(t.dithering!==undefined)n.dithering=t.dithering;if(t.visible!==undefined)n.visible=t.visible;if(t.userData!==undefined)n.userData=t.userData;if(t.shading!==undefined)n.flatShading=t.shading===1;if(t.size!==undefined)n.size=t.size;if(t.sizeAttenuation!==undefined)n.sizeAttenuation=t.sizeAttenuation;if(t.map!==undefined)n.map=r(t.map);if(t.alphaMap!==undefined){n.alphaMap=r(t.alphaMap);n.transparent=true}if(t.bumpMap!==undefined)n.bumpMap=r(t.bumpMap);if(t.bumpScale!==undefined)n.bumpScale=t.bumpScale;if(t.normalMap!==undefined)n.normalMap=r(t.normalMap);if(t.normalScale!==undefined){var a=t.normalScale;if(Array.isArray(a)===false){a=[a,a]}n.normalScale=(new Kt).fromArray(a)}if(t.displacementMap!==undefined)n.displacementMap=r(t.displacementMap);if(t.displacementScale!==undefined)n.displacementScale=t.displacementScale;if(t.displacementBias!==undefined)n.displacementBias=t.displacementBias;if(t.roughnessMap!==undefined)n.roughnessMap=r(t.roughnessMap);if(t.metalnessMap!==undefined)n.metalnessMap=r(t.metalnessMap);if(t.emissiveMap!==undefined)n.emissiveMap=r(t.emissiveMap);if(t.emissiveIntensity!==undefined)n.emissiveIntensity=t.emissiveIntensity;if(t.specularMap!==undefined)n.specularMap=r(t.specularMap);if(t.envMap!==undefined)n.envMap=r(t.envMap);if(t.reflectivity!==undefined)n.reflectivity=t.reflectivity;if(t.lightMap!==undefined)n.lightMap=r(t.lightMap);if(t.lightMapIntensity!==undefined)n.lightMapIntensity=t.lightMapIntensity;if(t.aoMap!==undefined)n.aoMap=r(t.aoMap);if(t.aoMapIntensity!==undefined)n.aoMapIntensity=t.aoMapIntensity;if(t.gradientMap!==undefined)n.gradientMap=r(t.gradientMap);return n}});function Uh(e){this.manager=e!==undefined?e:rh}Object.assign(Uh.prototype,{load:function e(t,i,r,n){var a=this;var s=new ah(a.manager);s.load(t,function(e){i(a.parse(JSON.parse(e)))},r,n)},parse:function e(t){var i=new ja;var r=t.data.index;if(r!==undefined){var n=new Dh[r.type](r.array);i.setIndex(new La(n,1))}var a=t.data.attributes;for(var s in a){var o=a[s];var n=new Dh[o.type](o.array);i.addAttribute(s,new La(n,o.itemSize,o.normalized))}var h=t.data.groups||t.data.drawcalls||t.data.offsets;if(h!==undefined){for(var l=0,c=h.length;l!==c;++l){var u=h[l];i.addGroup(u.start,u.count,u.materialIndex)}}var f=t.data.boundingSphere;if(f!==undefined){var d=new ti;if(f.center!==undefined){d.fromArray(f.center)}i.boundingSphere=new pa(d,f.radius)}return i}});var Dh={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:typeof Uint8ClampedArray!=="undefined"?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Fh(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}}Fh.Handlers={handlers:[],add:function e(t,i){this.handlers.push(t,i)},get:function e(t){var i=this.handlers;for(var r=0,n=i.length;r<n;r+=2){var a=i[r];var s=i[r+1];if(a.test(t)){return s}}return null}};Object.assign(Fh.prototype,{crossOrigin:undefined,extractUrlBase:function e(t){var i=t.split("/");if(i.length===1)return"./";i.pop();return i.join("/")+"/"},initMaterials:function e(t,i,r){var n=[];for(var a=0;a<t.length;++a){n[a]=this.createMaterial(t[a],i,r)}return n},createMaterial:function(){var e={NoBlending:$,NormalBlending:ee,AdditiveBlending:te,SubtractiveBlending:ie,MultiplyBlending:re,CustomBlending:ne};var t=new Ki;var i=new ch;var r=new Bh;return function n(a,s,o){var h={};function l(e,t,r,n,a){var l=s+e;var c=Fh.Handlers.get(l);var u;if(c!==null){u=c.load(l)}else{i.setCrossOrigin(o);u=i.load(l)}if(t!==undefined){u.repeat.fromArray(t);if(t[0]!==1)u.wrapS=We;if(t[1]!==1)u.wrapT=We}if(r!==undefined){u.offset.fromArray(r)}if(n!==undefined){if(n[0]==="repeat")u.wrapS=We;if(n[0]==="mirror")u.wrapS=Ye;if(n[1]==="repeat")u.wrapT=We;if(n[1]==="mirror")u.wrapT=Ye}if(a!==undefined){u.anisotropy=a}var f=Qt.generateUUID();h[f]=u;return f}var c={uuid:Qt.generateUUID(),type:"MeshLambertMaterial"};for(var u in a){var f=a[u];switch(u){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":c.name=f;break;case"blending":c.blending=e[f];break;case"colorAmbient":case"mapAmbient":break;case"colorDiffuse":c.color=t.fromArray(f).getHex();break;case"colorSpecular":c.specular=t.fromArray(f).getHex();break;case"colorEmissive":c.emissive=t.fromArray(f).getHex();break;case"specularCoef":c.shininess=f;break;case"shading":if(f.toLowerCase()==="basic")c.type="MeshBasicMaterial";if(f.toLowerCase()==="phong")c.type="MeshPhongMaterial";if(f.toLowerCase()==="standard")c.type="MeshStandardMaterial";break;case"mapDiffuse":c.map=l(f,a.mapDiffuseRepeat,a.mapDiffuseOffset,a.mapDiffuseWrap,a.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":c.emissiveMap=l(f,a.mapEmissiveRepeat,a.mapEmissiveOffset,a.mapEmissiveWrap,a.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":c.lightMap=l(f,a.mapLightRepeat,a.mapLightOffset,a.mapLightWrap,a.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":c.aoMap=l(f,a.mapAORepeat,a.mapAOOffset,a.mapAOWrap,a.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":c.bumpMap=l(f,a.mapBumpRepeat,a.mapBumpOffset,a.mapBumpWrap,a.mapBumpAnisotropy);break;case"mapBumpScale":c.bumpScale=f;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":c.normalMap=l(f,a.mapNormalRepeat,a.mapNormalOffset,a.mapNormalWrap,a.mapNormalAnisotropy);break;case"mapNormalFactor":c.normalScale=[f,f];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":c.specularMap=l(f,a.mapSpecularRepeat,a.mapSpecularOffset,a.mapSpecularWrap,a.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":c.metalnessMap=l(f,a.mapMetalnessRepeat,a.mapMetalnessOffset,a.mapMetalnessWrap,a.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":c.roughnessMap=l(f,a.mapRoughnessRepeat,a.mapRoughnessOffset,a.mapRoughnessWrap,a.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":c.alphaMap=l(f,a.mapAlphaRepeat,a.mapAlphaOffset,a.mapAlphaWrap,a.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":c.side=X;break;case"doubleSided":c.side=Y;break;case"transparency":c.opacity=f;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":c[u]=f;break;case"vertexColors":if(f===true)c.vertexColors=K;if(f==="face")c.vertexColors=Q;break;default:console.error("THREE.Loader.createMaterial: Unsupported",u,f);break}}if(c.type==="MeshBasicMaterial")delete c.emissive;if(c.type!=="MeshPhongMaterial")delete c.specular;if(c.opacity<1)c.transparent=true;r.setTextures(h);return r.parse(c)}}()});function jh(e){if(typeof e==="boolean"){e=undefined}this.manager=e!==undefined?e:rh;this.withCredentials=false}Object.assign(jh.prototype,{load:function e(t,i,r,n){var a=this;var s=this.texturePath&&typeof this.texturePath==="string"?this.texturePath:Fh.prototype.extractUrlBase(t);var o=new ah(this.manager);o.setWithCredentials(this.withCredentials);o.load(t,function(e){var r=JSON.parse(e);var n=r.metadata;if(n!==undefined){var o=n.type;if(o!==undefined){if(o.toLowerCase()==="object"){console.error("THREE.JSONLoader: "+t+" should be loaded with THREE.ObjectLoader instead.");return}if(o.toLowerCase()==="scene"){console.error("THREE.JSONLoader: "+t+" should be loaded with THREE.SceneLoader instead.");return}}}var h=a.parse(r,s);i(h.geometry,h.materials)},r,n)},setTexturePath:function e(t){this.texturePath=t},parse:function(){function e(e,t){function i(e,t){return e&1<<t}var r,n,a,s,o,h,l,c,u,f,d,p,v,m,g,y,_,x,w,b,M,T,E,S,A,L,C,R=e.faces,I=e.vertices,P=e.normals,O=e.colors,k=e.scale,N=0;if(e.uvs!==undefined){for(r=0;r<e.uvs.length;r++){if(e.uvs[r].length)N++}for(r=0;r<N;r++){t.faceVertexUvs[r]=[]}}s=0;o=I.length;while(s<o){x=new ti;x.x=I[s++]*k;x.y=I[s++]*k;x.z=I[s++]*k;t.vertices.push(x)}s=0;o=R.length;while(s<o){f=R[s++];d=i(f,0);p=i(f,1);v=i(f,3);m=i(f,4);g=i(f,5);y=i(f,6);_=i(f,7);if(d){b=new Ea;b.a=R[s];b.b=R[s+1];b.c=R[s+3];M=new Ea;M.a=R[s+1];M.b=R[s+2];M.c=R[s+3];s+=4;if(p){u=R[s++];b.materialIndex=u;M.materialIndex=u}a=t.faces.length;if(v){for(r=0;r<N;r++){S=e.uvs[r];t.faceVertexUvs[r][a]=[];t.faceVertexUvs[r][a+1]=[];for(n=0;n<4;n++){c=R[s++];L=S[c*2];C=S[c*2+1];A=new Kt(L,C);if(n!==2)t.faceVertexUvs[r][a].push(A);if(n!==0)t.faceVertexUvs[r][a+1].push(A)}}}if(m){l=R[s++]*3;b.normal.set(P[l++],P[l++],P[l]);M.normal.copy(b.normal)}if(g){for(r=0;r<4;r++){l=R[s++]*3;E=new ti(P[l++],P[l++],P[l]);if(r!==2)b.vertexNormals.push(E);if(r!==0)M.vertexNormals.push(E)}}if(y){h=R[s++];T=O[h];b.color.setHex(T);M.color.setHex(T)}if(_){for(r=0;r<4;r++){h=R[s++];T=O[h];if(r!==2)b.vertexColors.push(new Ki(T));if(r!==0)M.vertexColors.push(new Ki(T))}}t.faces.push(b);t.faces.push(M)}else{w=new Ea;w.a=R[s++];w.b=R[s++];w.c=R[s++];if(p){u=R[s++];w.materialIndex=u}a=t.faces.length;if(v){for(r=0;r<N;r++){S=e.uvs[r];t.faceVertexUvs[r][a]=[];for(n=0;n<3;n++){c=R[s++];L=S[c*2];C=S[c*2+1];A=new Kt(L,C);t.faceVertexUvs[r][a].push(A)}}}if(m){l=R[s++]*3;w.normal.set(P[l++],P[l++],P[l])}if(g){for(r=0;r<3;r++){l=R[s++]*3;E=new ti(P[l++],P[l++],P[l]);w.vertexNormals.push(E)}}if(y){h=R[s++];w.color.setHex(O[h])}if(_){for(r=0;r<3;r++){h=R[s++];w.vertexColors.push(new Ki(O[h]))}}t.faces.push(w)}}}function t(e,t){var i=e.influencesPerVertex!==undefined?e.influencesPerVertex:2;if(e.skinWeights){for(var r=0,n=e.skinWeights.length;r<n;r+=i){var a=e.skinWeights[r];var s=i>1?e.skinWeights[r+1]:0;var o=i>2?e.skinWeights[r+2]:0;var h=i>3?e.skinWeights[r+3]:0;t.skinWeights.push(new ai(a,s,o,h))}}if(e.skinIndices){for(var r=0,n=e.skinIndices.length;r<n;r+=i){var l=e.skinIndices[r];var c=i>1?e.skinIndices[r+1]:0;var u=i>2?e.skinIndices[r+2]:0;var f=i>3?e.skinIndices[r+3]:0;t.skinIndices.push(new ai(l,c,u,f))}}t.bones=e.bones;if(t.bones&&t.bones.length>0&&(t.skinWeights.length!==t.skinIndices.length||t.skinIndices.length!==t.vertices.length)){}}function i(e,t){var i=e.scale;if(e.morphTargets!==undefined){for(var r=0,n=e.morphTargets.length;r<n;r++){t.morphTargets[r]={};t.morphTargets[r].name=e.morphTargets[r].name;t.morphTargets[r].vertices=[];var a=t.morphTargets[r].vertices;var s=e.morphTargets[r].vertices;for(var o=0,h=s.length;o<h;o+=3){var l=new ti;l.x=s[o]*i;l.y=s[o+1]*i;l.z=s[o+2]*i;a.push(l)}}}if(e.morphColors!==undefined&&e.morphColors.length>0){var c=t.faces;var u=e.morphColors[0].colors;for(var r=0,n=c.length;r<n;r++){c[r].color.fromArray(u,r*3)}}}function r(e,t){var i=[];var r=[];if(e.animation!==undefined){r.push(e.animation)}if(e.animations!==undefined){if(e.animations.length){r=r.concat(e.animations)}else{r.push(e.animations)}}for(var n=0;n<r.length;n++){var a=zh.parseAnimation(r[n],t.bones);if(a)i.push(a)}if(t.morphTargets){var s=zh.CreateClipsFromMorphTargetSequences(t.morphTargets,10);i=i.concat(s)}if(i.length>0)t.animations=i}return function(n,a){if(n.data!==undefined){n=n.data}if(n.scale!==undefined){n.scale=1/n.scale}else{n.scale=1}var s=new Aa;e(n,s);t(n,s);i(n,s);r(n,s);s.computeFaceNormals();s.computeBoundingSphere();if(n.materials===undefined||n.materials.length===0){return{geometry:s}}else{var o=Fh.prototype.initMaterials(n.materials,a,this.crossOrigin);return{geometry:s,materials:o}}}}()});function Gh(e){this.manager=e!==undefined?e:rh;this.texturePath=""}Object.assign(Gh.prototype,{load:function e(t,i,r,n){if(this.texturePath===""){this.texturePath=t.substring(0,t.lastIndexOf("/")+1)}var a=this;var s=new ah(a.manager);s.load(t,function(e){var r=null;try{r=JSON.parse(e)}catch(e){if(n!==undefined)n(e);console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message);return}var s=r.metadata;if(s===undefined||s.type===undefined||s.type.toLowerCase()==="geometry"){console.error("THREE.ObjectLoader: Can't load "+t+". Use THREE.JSONLoader instead.");return}a.parse(r,i)},r,n)},setTexturePath:function e(t){this.texturePath=t},setCrossOrigin:function e(t){this.crossOrigin=t},parse:function e(t,i){var r=this.parseGeometries(t.geometries);var n=this.parseImages(t.images,function(){if(i!==undefined)i(o)});var a=this.parseTextures(t.textures,n);var s=this.parseMaterials(t.materials,a);var o=this.parseObject(t.object,r,s);if(t.animations){o.animations=this.parseAnimations(t.animations)}if(t.images===undefined||t.images.length===0){if(i!==undefined)i(o)}return o},parseGeometries:function e(t){var i={};if(t!==undefined){var r=new jh;var n=new Uh;for(var a=0,s=t.length;a<s;a++){var o;var h=t[a];switch(h.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new Vo[h.type](h.width,h.height,h.widthSegments,h.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":o=new Vo[h.type](h.width,h.height,h.depth,h.widthSegments,h.heightSegments,h.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new Vo[h.type](h.radius,h.segments,h.thetaStart,h.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new Vo[h.type](h.radiusTop,h.radiusBottom,h.height,h.radialSegments,h.heightSegments,h.openEnded,h.thetaStart,h.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new Vo[h.type](h.radius,h.height,h.radialSegments,h.heightSegments,h.openEnded,h.thetaStart,h.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new Vo[h.type](h.radius,h.widthSegments,h.heightSegments,h.phiStart,h.phiLength,h.thetaStart,h.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":o=new Vo[h.type](h.radius,h.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new Vo[h.type](h.innerRadius,h.outerRadius,h.thetaSegments,h.phiSegments,h.thetaStart,h.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new Vo[h.type](h.radius,h.tube,h.radialSegments,h.tubularSegments,h.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new Vo[h.type](h.radius,h.tube,h.tubularSegments,h.radialSegments,h.p,h.q);break;case"LatheGeometry":case"LatheBufferGeometry":o=new Vo[h.type](h.points,h.segments,h.phiStart,h.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":o=new Vo[h.type](h.vertices,h.indices,h.radius,h.details);break;case"BufferGeometry":o=n.parse(h);break;case"Geometry":o=r.parse(h,this.texturePath).geometry;break;default:continue}o.uuid=h.uuid;if(h.name!==undefined)o.name=h.name;i[h.uuid]=o}}return i},parseMaterials:function e(t,i){var r={};if(t!==undefined){var n=new Bh;n.setTextures(i);for(var a=0,s=t.length;a<s;a++){var o=t[a];if(o.type==="MultiMaterial"){var h=[];for(var l=0;l<o.materials.length;l++){h.push(n.parse(o.materials[l]))}r[o.uuid]=h}else{r[o.uuid]=n.parse(o)}}}return r},parseAnimations:function e(t){var i=[];for(var r=0;r<t.length;r++){var n=zh.parse(t[r]);i.push(n)}return i},parseImages:function e(t,i){var r=this;var n={};function a(e){r.manager.itemStart(e);return o.load(e,function(){r.manager.itemEnd(e)},undefined,function(){r.manager.itemEnd(e);r.manager.itemError(e)})}if(t!==undefined&&t.length>0){var s=new ih(i);var o=new hh(s);o.setCrossOrigin(this.crossOrigin);for(var h=0,l=t.length;h<l;h++){var c=t[h];var u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c.url)?c.url:r.texturePath+c.url;n[c.uuid]=a(u)}}return n},parseTextures:function e(t,i){function r(e,t){if(typeof e==="number")return e;return t[e]}var n={};if(t!==undefined){for(var a=0,s=t.length;a<s;a++){var o=t[a];if(o.image===undefined){}if(i[o.image]===undefined){}var h=new ni(i[o.image]);h.needsUpdate=true;h.uuid=o.uuid;if(o.name!==undefined)h.name=o.name;if(o.mapping!==undefined)h.mapping=r(o.mapping,Hh);if(o.offset!==undefined)h.offset.fromArray(o.offset);if(o.repeat!==undefined)h.repeat.fromArray(o.repeat);if(o.center!==undefined)h.center.fromArray(o.center);if(o.rotation!==undefined)h.rotation=o.rotation;if(o.wrap!==undefined){h.wrapS=r(o.wrap[0],Vh);h.wrapT=r(o.wrap[1],Vh)}if(o.minFilter!==undefined)h.minFilter=r(o.minFilter,Wh);if(o.magFilter!==undefined)h.magFilter=r(o.magFilter,Wh);if(o.anisotropy!==undefined)h.anisotropy=o.anisotropy;if(o.flipY!==undefined)h.flipY=o.flipY;n[o.uuid]=h}}return n},parseObject:function(){var e=new $t;return function t(i,r,n){var a;function s(e){if(r[e]===undefined){}return r[e]}function o(e){if(e===undefined)return undefined;if(Array.isArray(e)){var t=[];for(var i=0,r=e.length;i<r;i++){var a=e[i];if(n[a]===undefined){}t.push(n[a])}return t}if(n[e]===undefined){}return n[e]}switch(i.type){case"Scene":a=new Fs;if(i.background!==undefined){if(Number.isInteger(i.background)){a.background=new Ki(i.background)}}if(i.fog!==undefined){if(i.fog.type==="Fog"){a.fog=new Ds(i.fog.color,i.fog.near,i.fog.far)}else if(i.fog.type==="FogExp2"){a.fog=new Us(i.fog.color,i.fog.density)}}break;case"PerspectiveCamera":a=new Is(i.fov,i.aspect,i.near,i.far);if(i.focus!==undefined)a.focus=i.focus;if(i.zoom!==undefined)a.zoom=i.zoom;if(i.filmGauge!==undefined)a.filmGauge=i.filmGauge;if(i.filmOffset!==undefined)a.filmOffset=i.filmOffset;if(i.view!==undefined)a.view=Object.assign({},i.view);break;case"OrthographicCamera":a=new Ta(i.left,i.right,i.top,i.bottom,i.near,i.far);break;case"AmbientLight":a=new _h(i.color,i.intensity);break;case"DirectionalLight":a=new yh(i.color,i.intensity);break;case"PointLight":a=new mh(i.color,i.intensity,i.distance,i.decay);break;case"RectAreaLight":a=new xh(i.color,i.intensity,i.width,i.height);break;case"SpotLight":a=new vh(i.color,i.intensity,i.distance,i.angle,i.penumbra,i.decay);break;case"HemisphereLight":a=new fh(i.color,i.groundColor,i.intensity);break;case"SkinnedMesh":case"Mesh":var h=s(i.geometry);var l=o(i.material);if(h.bones&&h.bones.length>0){a=new Ys(h,l)}else{a=new Qa(h,l)}break;case"LOD":a=new Vs;break;case"Line":a=new Zs(s(i.geometry),o(i.material),i.mode);break;case"LineLoop":a=new Qs(s(i.geometry),o(i.material));break;case"LineSegments":a=new Js(s(i.geometry),o(i.material));break;case"PointCloud":case"Points":a=new $s(s(i.geometry),o(i.material));break;case"Sprite":a=new Hs(o(i.material));break;case"Group":a=new eo;break;default:a=new ba}a.uuid=i.uuid;if(i.name!==undefined)a.name=i.name;if(i.matrix!==undefined){e.fromArray(i.matrix);e.decompose(a.position,a.quaternion,a.scale)}else{if(i.position!==undefined)a.position.fromArray(i.position);if(i.rotation!==undefined)a.rotation.fromArray(i.rotation);if(i.quaternion!==undefined)a.quaternion.fromArray(i.quaternion);if(i.scale!==undefined)a.scale.fromArray(i.scale)}if(i.castShadow!==undefined)a.castShadow=i.castShadow;if(i.receiveShadow!==undefined)a.receiveShadow=i.receiveShadow;if(i.shadow){if(i.shadow.bias!==undefined)a.shadow.bias=i.shadow.bias;if(i.shadow.radius!==undefined)a.shadow.radius=i.shadow.radius;if(i.shadow.mapSize!==undefined)a.shadow.mapSize.fromArray(i.shadow.mapSize);if(i.shadow.camera!==undefined)a.shadow.camera=this.parseObject(i.shadow.camera)}if(i.visible!==undefined)a.visible=i.visible;if(i.userData!==undefined)a.userData=i.userData;if(i.children!==undefined){var c=i.children;for(var u=0;u<c.length;u++){a.add(this.parseObject(c[u],r,n))}}if(i.type==="LOD"){var f=i.levels;for(var d=0;d<f.length;d++){var p=f[d];var v=a.getObjectByProperty("uuid",p.object);if(v!==undefined){a.addLevel(v,p.distance)}}}return a}}()});var Hh={UVMapping:Be,CubeReflectionMapping:Ue,CubeRefractionMapping:De,EquirectangularReflectionMapping:Fe,EquirectangularRefractionMapping:je,SphericalReflectionMapping:Ge,CubeUVReflectionMapping:He,CubeUVRefractionMapping:Ve};var Vh={RepeatWrapping:We,ClampToEdgeWrapping:Xe,MirroredRepeatWrapping:Ye};var Wh={NearestFilter:qe,NearestMipMapNearestFilter:Ze,NearestMipMapLinearFilter:Je,LinearFilter:Qe,LinearMipMapNearestFilter:Ke,LinearMipMapLinearFilter:$e};function Xh(e,t,i,r,n){var a=(r-t)*.5;var s=(n-i)*.5;var o=e*e;var h=e*o;return(2*i-2*r+a+s)*h+(-3*i+3*r-2*a-s)*o+a*e+i}function Yh(e,t){var i=1-e;return i*i*t}function qh(e,t){return 2*(1-e)*e*t}function Zh(e,t){return e*e*t}function Jh(e,t,i,r){return Yh(e,t)+qh(e,i)+Zh(e,r)}function Qh(e,t){var i=1-e;return i*i*i*t}function Kh(e,t){var i=1-e;return 3*i*i*e*t}function $h(e,t){return 3*(1-e)*e*e*t}function el(e,t){return e*e*e*t}function tl(e,t,i,r,n){return Qh(e,t)+Kh(e,i)+$h(e,r)+el(e,n)}function il(){this.type="Curve";this.arcLengthDivisions=200}Object.assign(il.prototype,{getPoint:function e(){return null},getPointAt:function e(t,i){var r=this.getUtoTmapping(t);return this.getPoint(r,i)},getPoints:function e(t){if(t===undefined)t=5;var i=[];for(var r=0;r<=t;r++){i.push(this.getPoint(r/t))}return i},getSpacedPoints:function e(t){if(t===undefined)t=5;var i=[];for(var r=0;r<=t;r++){i.push(this.getPointAt(r/t))}return i},getLength:function e(){var t=this.getLengths();return t[t.length-1]},getLengths:function e(t){if(t===undefined)t=this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate){return this.cacheArcLengths}this.needsUpdate=false;var i=[];var r,n=this.getPoint(0);var a,s=0;i.push(0);for(a=1;a<=t;a++){r=this.getPoint(a/t);s+=r.distanceTo(n);i.push(s);n=r}this.cacheArcLengths=i;return i},updateArcLengths:function e(){this.needsUpdate=true;this.getLengths()},getUtoTmapping:function e(t,i){var r=this.getLengths();var n=0,a=r.length;var s;if(i){s=i}else{s=t*r[a-1]}var o=0,h=a-1,l;while(o<=h){n=Math.floor(o+(h-o)/2);l=r[n]-s;if(l<0){o=n+1}else if(l>0){h=n-1}else{h=n;break}}n=h;if(r[n]===s){return n/(a-1)}var c=r[n];var u=r[n+1];var f=u-c;var d=(s-c)/f;var p=(n+d)/(a-1);return p},getTangent:function e(t){var i=1e-4;var r=t-i;var n=t+i;if(r<0)r=0;if(n>1)n=1;var a=this.getPoint(r);var s=this.getPoint(n);var o=s.clone().sub(a);return o.normalize()},getTangentAt:function e(t){var i=this.getUtoTmapping(t);return this.getTangent(i)},computeFrenetFrames:function e(t,i){var r=new ti;var n=[];var a=[];var s=[];var o=new ti;var h=new $t;var l,c,u;for(l=0;l<=t;l++){c=l/t;n[l]=this.getTangentAt(c);n[l].normalize()}a[0]=new ti;s[0]=new ti;var f=Number.MAX_VALUE;var d=Math.abs(n[0].x);var p=Math.abs(n[0].y);var v=Math.abs(n[0].z);if(d<=f){f=d;r.set(1,0,0)}if(p<=f){f=p;r.set(0,1,0)}if(v<=f){r.set(0,0,1)}o.crossVectors(n[0],r).normalize();a[0].crossVectors(n[0],o);s[0].crossVectors(n[0],a[0]);for(l=1;l<=t;l++){a[l]=a[l-1].clone();s[l]=s[l-1].clone();o.crossVectors(n[l-1],n[l]);if(o.length()>Number.EPSILON){o.normalize();u=Math.acos(Qt.clamp(n[l-1].dot(n[l]),-1,1));a[l].applyMatrix4(h.makeRotationAxis(o,u))}s[l].crossVectors(n[l],a[l])}if(i===true){u=Math.acos(Qt.clamp(a[0].dot(a[t]),-1,1));u/=t;if(n[0].dot(o.crossVectors(a[0],a[t]))>0){u=-u}for(l=1;l<=t;l++){a[l].applyMatrix4(h.makeRotationAxis(n[l],u*l));s[l].crossVectors(n[l],a[l])}}return{tangents:n,normals:a,binormals:s}},clone:function e(){return(new this.constructor).copy(this)},copy:function e(t){this.arcLengthDivisions=t.arcLengthDivisions;return this}});function rl(e,t){il.call(this);this.type="LineCurve";this.v1=e||new Kt;this.v2=t||new Kt}rl.prototype=Object.create(il.prototype);rl.prototype.constructor=rl;rl.prototype.isLineCurve=true;rl.prototype.getPoint=function(e,t){var i=t||new Kt;if(e===1){i.copy(this.v2)}else{i.copy(this.v2).sub(this.v1);i.multiplyScalar(e).add(this.v1)}return i};rl.prototype.getPointAt=function(e,t){return this.getPoint(e,t)};rl.prototype.getTangent=function(){var e=this.v2.clone().sub(this.v1);return e.normalize()};rl.prototype.copy=function(e){il.prototype.copy.call(this,e);this.v1.copy(e.v1);this.v2.copy(e.v2);return this};function nl(){il.call(this);this.type="CurvePath";this.curves=[];this.autoClose=false}nl.prototype=Object.assign(Object.create(il.prototype),{constructor:nl,add:function e(t){this.curves.push(t)},closePath:function e(){var t=this.curves[0].getPoint(0);var i=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(i)){this.curves.push(new rl(i,t))}},getPoint:function e(t){var i=t*this.getLength();var r=this.getCurveLengths();var n=0;while(n<r.length){if(r[n]>=i){var a=r[n]-i;var s=this.curves[n];var o=s.getLength();var h=o===0?0:1-a/o;return s.getPointAt(h)}n++}return null},getLength:function e(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function e(){this.needsUpdate=true;this.cacheLengths=null;this.getCurveLengths()},getCurveLengths:function e(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length){return this.cacheLengths}var t=[],i=0;for(var r=0,n=this.curves.length;r<n;r++){i+=this.curves[r].getLength();t.push(i)}this.cacheLengths=t;return t},getSpacedPoints:function e(t){if(t===undefined)t=40;var i=[];for(var r=0;r<=t;r++){i.push(this.getPoint(r/t))}if(this.autoClose){i.push(i[0])}return i},getPoints:function e(t){t=t||12;var i=[],r;for(var n=0,a=this.curves;n<a.length;n++){var s=a[n];var o=s&&s.isEllipseCurve?t*2:s&&s.isLineCurve?1:s&&s.isSplineCurve?t*s.points.length:t;var h=s.getPoints(o);for(var l=0;l<h.length;l++){var c=h[l];if(r&&r.equals(c))continue;i.push(c);r=c}}if(this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])){i.push(i[0])}return i},copy:function e(t){il.prototype.copy.call(this,t);this.curves=[];for(var i=0,r=t.curves.length;i<r;i++){var n=t.curves[i];this.curves.push(n.clone())}this.autoClose=t.autoClose;return this}});function al(e,t,i,r,n,a,s,o){il.call(this);this.type="EllipseCurve";this.aX=e||0;this.aY=t||0;this.xRadius=i||1;this.yRadius=r||1;this.aStartAngle=n||0;this.aEndAngle=a||2*Math.PI;this.aClockwise=s||false;this.aRotation=o||0}al.prototype=Object.create(il.prototype);al.prototype.constructor=al;al.prototype.isEllipseCurve=true;al.prototype.getPoint=function(e,t){var i=t||new Kt;var r=Math.PI*2;var n=this.aEndAngle-this.aStartAngle;var a=Math.abs(n)<Number.EPSILON;while(n<0){n+=r}while(n>r){n-=r}if(n<Number.EPSILON){if(a){n=0}else{n=r}}if(this.aClockwise===true&&!a){if(n===r){n=-r}else{n=n-r}}var s=this.aStartAngle+e*n;var o=this.aX+this.xRadius*Math.cos(s);var h=this.aY+this.yRadius*Math.sin(s);if(this.aRotation!==0){var l=Math.cos(this.aRotation);var c=Math.sin(this.aRotation);var u=o-this.aX;var f=h-this.aY;o=u*l-f*c+this.aX;h=u*c+f*l+this.aY}return i.set(o,h)};al.prototype.copy=function(e){il.prototype.copy.call(this,e);this.aX=e.aX;this.aY=e.aY;this.xRadius=e.xRadius;this.yRadius=e.yRadius;this.aStartAngle=e.aStartAngle;this.aEndAngle=e.aEndAngle;this.aClockwise=e.aClockwise;this.aRotation=e.aRotation;return this};function sl(e){il.call(this);this.type="SplineCurve";this.points=e||[]}sl.prototype=Object.create(il.prototype);sl.prototype.constructor=sl;sl.prototype.isSplineCurve=true;sl.prototype.getPoint=function(e,t){var i=t||new Kt;var r=this.points;var n=(r.length-1)*e;var a=Math.floor(n);var s=n-a;var o=r[a===0?a:a-1];var h=r[a];var l=r[a>r.length-2?r.length-1:a+1];var c=r[a>r.length-3?r.length-1:a+2];i.set(Xh(s,o.x,h.x,l.x,c.x),Xh(s,o.y,h.y,l.y,c.y));return i};sl.prototype.copy=function(e){il.prototype.copy.call(this,e);this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push(r.clone())}return this};function ol(e,t,i,r){il.call(this);this.type="CubicBezierCurve";this.v0=e||new Kt;this.v1=t||new Kt;this.v2=i||new Kt;this.v3=r||new Kt}ol.prototype=Object.create(il.prototype);ol.prototype.constructor=ol;ol.prototype.isCubicBezierCurve=true;ol.prototype.getPoint=function(e,t){var i=t||new Kt;var r=this.v0,n=this.v1,a=this.v2,s=this.v3;i.set(tl(e,r.x,n.x,a.x,s.x),tl(e,r.y,n.y,a.y,s.y));return i};ol.prototype.copy=function(e){il.prototype.copy.call(this,e);this.v0.copy(e.v0);this.v1.copy(e.v1);this.v2.copy(e.v2);this.v3.copy(e.v3);return this};function hl(e,t,i){il.call(this);this.type="QuadraticBezierCurve";this.v0=e||new Kt;this.v1=t||new Kt;this.v2=i||new Kt}hl.prototype=Object.create(il.prototype);hl.prototype.constructor=hl;hl.prototype.isQuadraticBezierCurve=true;hl.prototype.getPoint=function(e,t){var i=t||new Kt;var r=this.v0,n=this.v1,a=this.v2;i.set(Jh(e,r.x,n.x,a.x),Jh(e,r.y,n.y,a.y));return i};hl.prototype.copy=function(e){il.prototype.copy.call(this,e);this.v0.copy(e.v0);this.v1.copy(e.v1);this.v2.copy(e.v2);return this};var ll=Object.assign(Object.create(nl.prototype),{setFromPoints:function e(t){this.moveTo(t[0].x,t[0].y);for(var i=1,r=t.length;i<r;i++){this.lineTo(t[i].x,t[i].y)}},moveTo:function e(t,i){this.currentPoint.set(t,i)},lineTo:function e(t,i){var r=new rl(this.currentPoint.clone(),new Kt(t,i));this.curves.push(r);this.currentPoint.set(t,i)},quadraticCurveTo:function e(t,i,r,n){var a=new hl(this.currentPoint.clone(),new Kt(t,i),new Kt(r,n));this.curves.push(a);this.currentPoint.set(r,n)},bezierCurveTo:function e(t,i,r,n,a,s){var o=new ol(this.currentPoint.clone(),new Kt(t,i),new Kt(r,n),new Kt(a,s));this.curves.push(o);this.currentPoint.set(a,s)},splineThru:function e(t){var i=[this.currentPoint.clone()].concat(t);var r=new sl(i);this.curves.push(r);this.currentPoint.copy(t[t.length-1])},arc:function e(t,i,r,n,a,s){var o=this.currentPoint.x;var h=this.currentPoint.y;this.absarc(t+o,i+h,r,n,a,s)},absarc:function e(t,i,r,n,a,s){this.absellipse(t,i,r,r,n,a,s)},ellipse:function e(t,i,r,n,a,s,o,h){var l=this.currentPoint.x;var c=this.currentPoint.y;this.absellipse(t+l,i+c,r,n,a,s,o,h)},absellipse:function e(t,i,r,n,a,s,o,h){var l=new al(t,i,r,n,a,s,o,h);if(this.curves.length>0){var c=l.getPoint(0);if(!c.equals(this.currentPoint)){this.lineTo(c.x,c.y)}}this.curves.push(l);var u=l.getPoint(1);this.currentPoint.copy(u)},copy:function e(t){nl.prototype.copy.call(this,t);this.currentPoint.copy(t.currentPoint);return this}});function cl(e){nl.call(this);this.type="Path";this.currentPoint=new Kt;if(e){this.setFromPoints(e)}}cl.prototype=ll;ll.constructor=cl;function ul(e){cl.call(this,e);this.type="Shape";this.holes=[]}ul.prototype=Object.assign(Object.create(ll),{constructor:ul,getPointsHoles:function e(t){var i=[];for(var r=0,n=this.holes.length;r<n;r++){i[r]=this.holes[r].getPoints(t)}return i},extractPoints:function e(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function e(t){cl.prototype.copy.call(this,t);this.holes=[];for(var i=0,r=t.holes.length;i<r;i++){var n=t.holes[i];this.holes.push(n.clone())}return this}});function fl(){this.type="ShapePath";this.subPaths=[];this.currentPath=null}Object.assign(fl.prototype,{moveTo:function e(t,i){this.currentPath=new cl;this.subPaths.push(this.currentPath);this.currentPath.moveTo(t,i)},lineTo:function e(t,i){this.currentPath.lineTo(t,i)},quadraticCurveTo:function e(t,i,r,n){this.currentPath.quadraticCurveTo(t,i,r,n)},bezierCurveTo:function e(t,i,r,n,a,s){this.currentPath.bezierCurveTo(t,i,r,n,a,s)},splineThru:function e(t){this.currentPath.splineThru(t)},toShapes:function e(t,i){function r(e){var t=[];for(var i=0,r=e.length;i<r;i++){var n=e[i];var a=new ul;a.curves=n.curves;t.push(a)}return t}function n(e,t){var i=t.length;var r=false;for(var n=i-1,a=0;a<i;n=a++){var s=t[n];var o=t[a];var h=o.x-s.x;var l=o.y-s.y;if(Math.abs(l)>Number.EPSILON){if(l<0){s=t[a];h=-h;o=t[n];l=-l}if(e.y<s.y||e.y>o.y)continue;if(e.y===s.y){if(e.x===s.x)return true}else{var c=l*(e.x-s.x)-h*(e.y-s.y);if(c===0)return true;if(c<0)continue;r=!r}}else{if(e.y!==s.y)continue;if(o.x<=e.x&&e.x<=s.x||s.x<=e.x&&e.x<=o.x)return true}}return r}var a=To.isClockWise;var s=this.subPaths;if(s.length===0)return[];if(i===true)return r(s);var o,h,l,c=[];if(s.length===1){h=s[0];l=new ul;l.curves=h.curves;c.push(l);return c}var u=!a(s[0].getPoints());u=t?!u:u;var f=[];var d=[];var p=[];var v=0;var m;d[v]=undefined;p[v]=[];for(var g=0,y=s.length;g<y;g++){h=s[g];m=h.getPoints();o=a(m);o=t?!o:o;if(o){if(!u&&d[v])v++;d[v]={s:new ul,p:m};d[v].s.curves=h.curves;if(u)v++;p[v]=[]}else{p[v].push({h:h,p:m[0]})}}if(!d[0])return r(s);if(d.length>1){var _=false;var x=[];for(var w=0,b=d.length;w<b;w++){f[w]=[]}for(var w=0,b=d.length;w<b;w++){var M=p[w];for(var T=0;T<M.length;T++){var E=M[T];var S=true;for(var A=0;A<d.length;A++){if(n(E.p,d[A].p)){if(w!==A)x.push({froms:w,tos:A,hole:T});if(S){S=false;f[A].push(E)}else{_=true}}}if(S){f[w].push(E)}}}if(x.length>0){if(!_)p=f}}var L;for(var g=0,C=d.length;g<C;g++){l=d[g].s;c.push(l);L=p[g];for(var R=0,I=L.length;R<I;R++){l.holes.push(L[R].h)}}return c}});function dl(e){this.type="Font";this.data=e}Object.assign(dl.prototype,{isFont:true,generateShapes:function e(t,i,r){function n(e){var t=String(e).split("");var r=i/s.resolution;var n=(s.boundingBox.yMax-s.boundingBox.yMin+s.underlineThickness)*r;var o=0,h=0;var l=[];for(var c=0;c<t.length;c++){var u=t[c];if(u==="\n"){o=0;h-=n}else{var f=a(u,r,o,h);o+=f.offsetX;l.push(f.path)}}return l}function a(e,t,i,n){var a=s.glyphs[e]||s.glyphs["?"];if(!a)return;var o=new fl;var h=[];var l,c,u,f,d,p,v,m,g,y,_;if(a.o){var x=a._cachedOutline||(a._cachedOutline=a.o.split(" "));for(var w=0,b=x.length;w<b;){var M=x[w++];switch(M){case"m":l=x[w++]*t+i;c=x[w++]*t+n;o.moveTo(l,c);break;case"l":l=x[w++]*t+i;c=x[w++]*t+n;o.lineTo(l,c);break;case"q":u=x[w++]*t+i;f=x[w++]*t+n;v=x[w++]*t+i;m=x[w++]*t+n;o.quadraticCurveTo(v,m,u,f);_=h[h.length-1];if(_){d=_.x;p=_.y;for(var T=1;T<=r;T++){var E=T/r;Jh(E,d,v,u);Jh(E,p,m,f)}}break;case"b":u=x[w++]*t+i;f=x[w++]*t+n;v=x[w++]*t+i;m=x[w++]*t+n;g=x[w++]*t+i;y=x[w++]*t+n;o.bezierCurveTo(v,m,g,y,u,f);_=h[h.length-1];if(_){d=_.x;p=_.y;for(var T=1;T<=r;T++){var E=T/r;tl(E,d,v,g,u);tl(E,p,m,y,f)}}break}}}return{offsetX:a.ha*t,path:o}}if(i===undefined)i=100;if(r===undefined)r=4;var s=this.data;var o=n(t);var h=[];for(var l=0,c=o.length;l<c;l++){Array.prototype.push.apply(h,o[l].toShapes())}return h}});function pl(e){this.manager=e!==undefined?e:rh}Object.assign(pl.prototype,{load:function e(t,i,r,n){var a=this;var s=new ah(this.manager);s.setPath(this.path);s.load(t,function(e){var t;try{t=JSON.parse(e)}catch(i){t=JSON.parse(e.substring(65,e.length-2))}var r=a.parse(t);if(i)i(r)},r,n)},parse:function e(t){return new dl(t)},setPath:function e(t){this.path=t;return this}});var vl;var ml={getContext:function e(){if(vl===undefined){vl=new(window.AudioContext||window.webkitAudioContext)}return vl},setContext:function e(t){vl=t}};function gl(e){this.manager=e!==undefined?e:rh}Object.assign(gl.prototype,{load:function e(t,i,r,n){var a=new ah(this.manager);a.setResponseType("arraybuffer");a.load(t,function(e){var t=ml.getContext();t.decodeAudioData(e,function(e){i(e)})},r,n)}});function yl(){this.type="StereoCamera";this.aspect=1;this.eyeSep=.064;this.cameraL=new Is;this.cameraL.layers.enable(1);this.cameraL.matrixAutoUpdate=false;this.cameraR=new Is;this.cameraR.layers.enable(2);this.cameraR.matrixAutoUpdate=false}Object.assign(yl.prototype,{update:function(){var e,t,i,r,n,a,s,o;var h=new $t;var l=new $t;return function c(u){var f=e!==this||t!==u.focus||i!==u.fov||r!==u.aspect*this.aspect||n!==u.near||a!==u.far||s!==u.zoom||o!==this.eyeSep;if(f){e=this;t=u.focus;i=u.fov;r=u.aspect*this.aspect;n=u.near;a=u.far;s=u.zoom;var d=u.projectionMatrix.clone();o=this.eyeSep/2;var p=o*n/t;var v=n*Math.tan(Qt.DEG2RAD*i*.5)/s;var m,g;l.elements[12]=-o;h.elements[12]=o;m=-v*r+p;g=v*r+p;d.elements[0]=2*n/(g-m);d.elements[8]=(g+m)/(g-m);this.cameraL.projectionMatrix.copy(d);m=-v*r-p;g=v*r-p;d.elements[0]=2*n/(g-m);d.elements[8]=(g+m)/(g-m);this.cameraR.projectionMatrix.copy(d)}this.cameraL.matrixWorld.copy(u.matrixWorld).multiply(l);this.cameraR.matrixWorld.copy(u.matrixWorld).multiply(h)}}()});function _l(e,t,i){ba.call(this);this.type="CubeCamera";var r=90,n=1;var a=new Is(r,n,e,t);a.up.set(0,-1,0);a.lookAt(new ti(1,0,0));this.add(a);var s=new Is(r,n,e,t);s.up.set(0,-1,0);s.lookAt(new ti(-1,0,0));this.add(s);var o=new Is(r,n,e,t);o.up.set(0,0,1);o.lookAt(new ti(0,1,0));this.add(o);var h=new Is(r,n,e,t);h.up.set(0,0,-1);h.lookAt(new ti(0,-1,0));this.add(h);var l=new Is(r,n,e,t);l.up.set(0,-1,0);l.lookAt(new ti(0,0,1));this.add(l);var c=new Is(r,n,e,t);c.up.set(0,-1,0);c.lookAt(new ti(0,0,-1));this.add(c);var u={format:dt,magFilter:Qe,minFilter:Qe};this.renderTarget=new oi(i,i,u);this.renderTarget.texture.name="CubeCamera";this.update=function(e,t){if(this.parent===null)this.updateMatrixWorld();var i=this.renderTarget;var r=i.texture.generateMipmaps;i.texture.generateMipmaps=false;i.activeCubeFace=0;e.render(t,a,i);i.activeCubeFace=1;e.render(t,s,i);i.activeCubeFace=2;e.render(t,o,i);i.activeCubeFace=3;e.render(t,h,i);i.activeCubeFace=4;e.render(t,l,i);i.texture.generateMipmaps=r;i.activeCubeFace=5;e.render(t,c,i);e.setRenderTarget(null)};this.clear=function(e,t,i,r){var n=this.renderTarget;for(var a=0;a<6;a++){n.activeCubeFace=a;e.setRenderTarget(n);e.clear(t,i,r)}e.setRenderTarget(null)}}_l.prototype=Object.create(ba.prototype);_l.prototype.constructor=_l;function xl(){ba.call(this);this.type="AudioListener";this.context=ml.getContext();this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.filter=null}xl.prototype=Object.assign(Object.create(ba.prototype),{constructor:xl,getInput:function e(){return this.gain},removeFilter:function e(){if(this.filter!==null){this.gain.disconnect(this.filter);this.filter.disconnect(this.context.destination);this.gain.connect(this.context.destination);this.filter=null}},getFilter:function e(){return this.filter},setFilter:function e(t){if(this.filter!==null){this.gain.disconnect(this.filter);this.filter.disconnect(this.context.destination)}else{this.gain.disconnect(this.context.destination)}this.filter=t;this.gain.connect(this.filter);this.filter.connect(this.context.destination)},getMasterVolume:function e(){return this.gain.gain.value},setMasterVolume:function e(t){this.gain.gain.value=t},updateMatrixWorld:function(){var e=new ti;var t=new ei;var i=new ti;var r=new ti;return function n(a){ba.prototype.updateMatrixWorld.call(this,a);var s=this.context.listener;var o=this.up;this.matrixWorld.decompose(e,t,i);r.set(0,0,-1).applyQuaternion(t);if(s.positionX){s.positionX.setValueAtTime(e.x,this.context.currentTime);s.positionY.setValueAtTime(e.y,this.context.currentTime);s.positionZ.setValueAtTime(e.z,this.context.currentTime);s.forwardX.setValueAtTime(r.x,this.context.currentTime);s.forwardY.setValueAtTime(r.y,this.context.currentTime);s.forwardZ.setValueAtTime(r.z,this.context.currentTime);s.upX.setValueAtTime(o.x,this.context.currentTime);s.upY.setValueAtTime(o.y,this.context.currentTime);s.upZ.setValueAtTime(o.z,this.context.currentTime)}else{s.setPosition(e.x,e.y,e.z);s.setOrientation(r.x,r.y,r.z,o.x,o.y,o.z)}}}()});function wl(e){ba.call(this);this.type="Audio";this.context=e.context;this.gain=this.context.createGain();this.gain.connect(e.getInput());this.autoplay=false;this.buffer=null;this.loop=false;this.startTime=0;this.offset=0;this.playbackRate=1;this.isPlaying=false;this.hasPlaybackControl=true;this.sourceType="empty";this.filters=[]}wl.prototype=Object.assign(Object.create(ba.prototype),{constructor:wl,getOutput:function e(){return this.gain},setNodeSource:function e(t){this.hasPlaybackControl=false;this.sourceType="audioNode";this.source=t;this.connect();return this},setBuffer:function e(t){this.buffer=t;this.sourceType="buffer";if(this.autoplay)this.play();return this},play:function e(){if(this.isPlaying===true){return}if(this.hasPlaybackControl===false){return}var t=this.context.createBufferSource();t.buffer=this.buffer;t.loop=this.loop;t.onended=this.onEnded.bind(this);t.playbackRate.setValueAtTime(this.playbackRate,this.startTime);this.startTime=this.context.currentTime;t.start(this.startTime,this.offset);this.isPlaying=true;this.source=t;return this.connect()},pause:function e(){if(this.hasPlaybackControl===false){return}if(this.isPlaying===true){this.source.stop();this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate;this.isPlaying=false}return this},stop:function e(){if(this.hasPlaybackControl===false){return}this.source.stop();this.offset=0;this.isPlaying=false;return this},connect:function e(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,i=this.filters.length;t<i;t++){this.filters[t-1].connect(this.filters[t])}this.filters[this.filters.length-1].connect(this.getOutput())}else{this.source.connect(this.getOutput())}return this},disconnect:function e(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,i=this.filters.length;t<i;t++){this.filters[t-1].disconnect(this.filters[t])}this.filters[this.filters.length-1].disconnect(this.getOutput())}else{this.source.disconnect(this.getOutput())}return this},getFilters:function e(){return this.filters},setFilters:function e(t){if(!t)t=[];if(this.isPlaying===true){this.disconnect();this.filters=t;this.connect()}else{this.filters=t}return this},getFilter:function e(){return this.getFilters()[0]},setFilter:function e(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function e(t){if(this.hasPlaybackControl===false){return}this.playbackRate=t;if(this.isPlaying===true){this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime)}return this},getPlaybackRate:function e(){return this.playbackRate},onEnded:function e(){this.isPlaying=false},getLoop:function e(){if(this.hasPlaybackControl===false){return false}return this.loop},setLoop:function e(t){if(this.hasPlaybackControl===false){return}this.loop=t;if(this.isPlaying===true){this.source.loop=this.loop}return this},getVolume:function e(){return this.gain.gain.value},setVolume:function e(t){this.gain.gain.value=t;return this}});function bl(e){wl.call(this,e);this.panner=this.context.createPanner();this.panner.connect(this.gain)}bl.prototype=Object.assign(Object.create(wl.prototype),{constructor:bl,getOutput:function e(){return this.panner},getRefDistance:function e(){return this.panner.refDistance},setRefDistance:function e(t){this.panner.refDistance=t},getRolloffFactor:function e(){return this.panner.rolloffFactor},setRolloffFactor:function e(t){this.panner.rolloffFactor=t},getDistanceModel:function e(){return this.panner.distanceModel},setDistanceModel:function e(t){this.panner.distanceModel=t},getMaxDistance:function e(){return this.panner.maxDistance},setMaxDistance:function e(t){this.panner.maxDistance=t},updateMatrixWorld:function(){var e=new ti;return function t(i){ba.prototype.updateMatrixWorld.call(this,i);e.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(e.x,e.y,e.z)}}()});function Ml(e,t){this.analyser=e.context.createAnalyser();this.analyser.fftSize=t!==undefined?t:2048;this.data=new Uint8Array(this.analyser.frequencyBinCount);e.getOutput().connect(this.analyser)}Object.assign(Ml.prototype,{getFrequencyData:function e(){this.analyser.getByteFrequencyData(this.data);return this.data},getAverageFrequency:function e(){var t=0,i=this.getFrequencyData();for(var r=0;r<i.length;r++){t+=i[r]}return t/i.length}});function Tl(e,t,i){this.binding=e;this.valueSize=i;var r=Float64Array,n;switch(t){case"quaternion":n=this._slerp;break;case"string":case"bool":r=Array;n=this._select;break;default:n=this._lerp}this.buffer=new r(i*4);this._mixBufferRegion=n;this.cumulativeWeight=0;this.useCount=0;this.referenceCount=0}Object.assign(Tl.prototype,{accumulate:function e(t,i){var r=this.buffer,n=this.valueSize,a=t*n+n,s=this.cumulativeWeight;if(s===0){for(var o=0;o!==n;++o){r[a+o]=r[o]}s=i}else{s+=i;var h=i/s;this._mixBufferRegion(r,a,0,h,n)}this.cumulativeWeight=s},apply:function e(t){var i=this.valueSize,r=this.buffer,n=t*i+i,a=this.cumulativeWeight,s=this.binding;this.cumulativeWeight=0;if(a<1){var o=i*3;this._mixBufferRegion(r,n,o,1-a,i)}for(var h=i,l=i+i;h!==l;++h){if(r[h]!==r[h+i]){s.setValue(r,n);break}}},saveOriginalState:function e(){var t=this.binding;var i=this.buffer,r=this.valueSize,n=r*3;t.getValue(i,n);for(var a=r,s=n;a!==s;++a){i[a]=i[n+a%r]}this.cumulativeWeight=0},restoreOriginalState:function e(){var t=this.valueSize*3;this.binding.setValue(this.buffer,t)},_select:function e(t,i,r,n,a){if(n>=.5){for(var s=0;s!==a;++s){t[i+s]=t[r+s]}}},_slerp:function e(t,i,r,n){ei.slerpFlat(t,i,t,i,t,r,n)},_lerp:function e(t,i,r,n,a){var s=1-n;for(var o=0;o!==a;++o){var h=i+o;t[h]=t[h]*s+t[r+o]*n}}});function El(e,t,i){var r=i||Sl.parseTrackName(t);this._targetGroup=e;this._bindings=e.subscribe_(t,r)}Object.assign(El.prototype,{getValue:function e(t,i){this.bind();var r=this._targetGroup.nCachedObjects_,n=this._bindings[r];if(n!==undefined)n.getValue(t,i)},setValue:function e(t,i){var r=this._bindings;for(var n=this._targetGroup.nCachedObjects_,a=r.length;n!==a;++n){r[n].setValue(t,i)}},bind:function e(){var t=this._bindings;for(var i=this._targetGroup.nCachedObjects_,r=t.length;i!==r;++i){t[i].bind()}},unbind:function e(){var t=this._bindings;for(var i=this._targetGroup.nCachedObjects_,r=t.length;i!==r;++i){t[i].unbind()}}});function Sl(e,t,i){this.path=t;this.parsedPath=i||Sl.parseTrackName(t);this.node=Sl.findNode(e,this.parsedPath.nodeName)||e;this.rootNode=e}Object.assign(Sl,{Composite:El,create:function e(t,i,r){if(!(t&&t.isAnimationObjectGroup)){return new Sl(t,i,r)}else{return new Sl.Composite(t,i,r)}},sanitizeNodeName:function e(t){return t.replace(/\s/g,"_").replace(/[^\w-]/g,"")},parseTrackName:function(){var e=/((?:[\w-]+[\/:])*)/;var t=/([\w-\.]+)?/;var i=/(?:\.([\w-]+)(?:\[(.+)\])?)?/;var r=/\.([\w-]+)(?:\[(.+)\])?/;var n=new RegExp(""+"^"+e.source+t.source+i.source+r.source+"$");var a=["material","materials","bones"];return function(e){var t=n.exec(e);if(!t){throw new Error("PropertyBinding: Cannot parse trackName: "+e)}var i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]};var r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==undefined&&r!==-1){var s=i.nodeName.substring(r+1);if(a.indexOf(s)!==-1){i.nodeName=i.nodeName.substring(0,r);i.objectName=s}}if(i.propertyName===null||i.propertyName.length===0){throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e)}return i}}(),findNode:function e(t,i){if(!i||i===""||i==="root"||i==="."||i===-1||i===t.name||i===t.uuid){return t}if(t.skeleton){var r=function e(t){for(var r=0;r<t.bones.length;r++){var n=t.bones[r];if(n.name===i){return n}}return null};var n=r(t.skeleton);if(n){return n}}if(t.children){var a=function e(t){for(var r=0;r<t.length;r++){var n=t[r];if(n.name===i||n.uuid===i){return n}var a=e(n.children);if(a)return a}return null};var s=a(t.children);if(s){return s}}return null}});Object.assign(Sl.prototype,{_getValue_unavailable:function e(){},_setValue_unavailable:function e(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function e(t,i){t[i]=this.node[this.propertyName]},function e(t,i){var r=this.resolvedProperty;for(var n=0,a=r.length;n!==a;++n){t[i++]=r[n]}},function e(t,i){t[i]=this.resolvedProperty[this.propertyIndex]},function e(t,i){this.resolvedProperty.toArray(t,i)}],SetterByBindingTypeAndVersioning:[[function e(t,i){this.targetObject[this.propertyName]=t[i]},function e(t,i){this.targetObject[this.propertyName]=t[i];this.targetObject.needsUpdate=true},function e(t,i){this.targetObject[this.propertyName]=t[i];this.targetObject.matrixWorldNeedsUpdate=true}],[function e(t,i){var r=this.resolvedProperty;for(var n=0,a=r.length;n!==a;++n){r[n]=t[i++]}},function e(t,i){var r=this.resolvedProperty;for(var n=0,a=r.length;n!==a;++n){r[n]=t[i++]}this.targetObject.needsUpdate=true},function e(t,i){var r=this.resolvedProperty;for(var n=0,a=r.length;n!==a;++n){r[n]=t[i++]}this.targetObject.matrixWorldNeedsUpdate=true}],[function e(t,i){this.resolvedProperty[this.propertyIndex]=t[i]},function e(t,i){this.resolvedProperty[this.propertyIndex]=t[i];this.targetObject.needsUpdate=true},function e(t,i){this.resolvedProperty[this.propertyIndex]=t[i];this.targetObject.matrixWorldNeedsUpdate=true}],[function e(t,i){this.resolvedProperty.fromArray(t,i)},function e(t,i){this.resolvedProperty.fromArray(t,i);this.targetObject.needsUpdate=true},function e(t,i){this.resolvedProperty.fromArray(t,i);this.targetObject.matrixWorldNeedsUpdate=true}]],getValue:function e(t,i){this.bind();this.getValue(t,i)},setValue:function e(t,i){this.bind();this.setValue(t,i)},bind:function e(){var t=this.node,i=this.parsedPath,r=i.objectName,n=i.propertyName,a=i.propertyIndex;if(!t){t=Sl.findNode(this.rootNode,i.nodeName)||this.rootNode;this.node=t}this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;if(!t){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(r){var s=i.objectIndex;switch(r){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(var o=0;o<t.length;o++){if(t[o].name===s){s=o;break}}break;default:if(t[r]===undefined){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[r]}if(s!==undefined){if(t[s]===undefined){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[s]}}var h=t[n];if(h===undefined){var l=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+n+" but it wasn't found.",t);return}var c=this.Versioning.None;if(t.needsUpdate!==undefined){c=this.Versioning.NeedsUpdate;this.targetObject=t}else if(t.matrixWorldNeedsUpdate!==undefined){c=this.Versioning.MatrixWorldNeedsUpdate;this.targetObject=t}var u=this.BindingType.Direct;if(a!==undefined){if(n==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}for(var o=0;o<this.node.geometry.morphAttributes.position.length;o++){if(t.geometry.morphAttributes.position[o].name===a){a=o;break}}}else{if(!t.geometry.morphTargets){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);return}for(var o=0;o<this.node.geometry.morphTargets.length;o++){if(t.geometry.morphTargets[o].name===a){a=o;break}}}}u=this.BindingType.ArrayElement;this.resolvedProperty=h;this.propertyIndex=a}else if(h.fromArray!==undefined&&h.toArray!==undefined){u=this.BindingType.HasFromToArray;this.resolvedProperty=h}else if(Array.isArray(h)){u=this.BindingType.EntireArray;this.resolvedProperty=h}else{this.propertyName=n}this.getValue=this.GetterByBindingType[u];this.setValue=this.SetterByBindingTypeAndVersioning[u][c]},unbind:function e(){this.node=null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}});Object.assign(Sl.prototype,{_getValue_unbound:Sl.prototype.getValue,_setValue_unbound:Sl.prototype.setValue});function Al(){this.uuid=Qt.generateUUID();this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,i=arguments.length;t!==i;++t){e[arguments[t].uuid]=t}this._paths=[];this._parsedPaths=[];this._bindings=[];this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}Object.assign(Al.prototype,{isAnimationObjectGroup:true,add:function e(){var t=this._objects,i=t.length,r=this.nCachedObjects_,n=this._indicesByUUID,a=this._paths,s=this._parsedPaths,o=this._bindings,h=o.length;for(var l=0,c=arguments.length;l!==c;++l){var u=arguments[l],f=u.uuid,d=n[f],p=undefined;if(d===undefined){d=i++;n[f]=d;t.push(u);for(var v=0,m=h;v!==m;++v){o[v].push(new Sl(u,a[v],s[v]))}}else if(d<r){p=t[d];var g=--r,y=t[g];n[y.uuid]=d;t[d]=y;n[f]=g;t[g]=u;for(var v=0,m=h;v!==m;++v){var _=o[v],x=_[g],w=_[d];_[d]=x;if(w===undefined){w=new Sl(u,a[v],s[v])}_[g]=w}}else if(t[d]!==p){console.error("THREE.AnimationObjectGroup: Different objects with the same UUID "+"detected. Clean the caches or recreate your infrastructure when reloading scenes.")}}this.nCachedObjects_=r},remove:function e(){var t=this._objects,i=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,a=n.length;for(var s=0,o=arguments.length;s!==o;++s){var h=arguments[s],l=h.uuid,c=r[l];if(c!==undefined&&c>=i){var u=i++,f=t[u];r[f.uuid]=c;t[c]=f;r[l]=u;t[u]=h;for(var d=0,p=a;d!==p;++d){var v=n[d],m=v[u],g=v[c];v[c]=m;v[u]=g}}}this.nCachedObjects_=i},uncache:function e(){var t=this._objects,i=t.length,r=this.nCachedObjects_,n=this._indicesByUUID,a=this._bindings,s=a.length;for(var o=0,h=arguments.length;o!==h;++o){var l=arguments[o],c=l.uuid,u=n[c];if(u!==undefined){delete n[c];if(u<r){var f=--r,d=t[f],p=--i,v=t[p];n[d.uuid]=u;t[u]=d;n[v.uuid]=f;t[f]=v;t.pop();for(var m=0,g=s;m!==g;++m){var y=a[m],_=y[f],x=y[p];y[u]=_;y[f]=x;y.pop()}}else{var p=--i,v=t[p];n[v.uuid]=u;t[u]=v;t.pop();for(var m=0,g=s;m!==g;++m){var y=a[m];y[u]=y[p];y.pop()}}}}this.nCachedObjects_=r},subscribe_:function e(t,i){var r=this._bindingsIndicesByPath,n=r[t],a=this._bindings;if(n!==undefined)return a[n];var s=this._paths,o=this._parsedPaths,h=this._objects,l=h.length,c=this.nCachedObjects_,u=new Array(l);n=a.length;r[t]=n;s.push(t);o.push(i);a.push(u);for(var f=c,d=h.length;f!==d;++f){var p=h[f];u[f]=new Sl(p,t,i)}return u},unsubscribe_:function e(t){var i=this._bindingsIndicesByPath,r=i[t];if(r!==undefined){var n=this._paths,a=this._parsedPaths,s=this._bindings,o=s.length-1,h=s[o],l=t[o];i[l]=r;s[r]=h;s.pop();a[r]=a[o];a.pop();n[r]=n[o];n.pop()}}});function Ll(e,t,i){this._mixer=e;this._clip=t;this._localRoot=i||null;var r=t.tracks,n=r.length,a=new Array(n);var s={endingStart:Nt,endingEnd:Nt};for(var o=0;o!==n;++o){var h=r[o].createInterpolant(null);a[o]=h;h.settings=s}this._interpolantSettings=s;this._interpolants=a;this._propertyBindings=new Array(n);this._cacheIndex=null;this._byClipCacheIndex=null;this._timeScaleInterpolant=null;this._weightInterpolant=null;this.loop=Rt;this._loopCount=-1;this._startTime=null;this.time=0;this.timeScale=1;this._effectiveTimeScale=1;this.weight=1;this._effectiveWeight=1;this.repetitions=Infinity;this.paused=false;this.enabled=true;this.clampWhenFinished=false;this.zeroSlopeAtStart=true;this.zeroSlopeAtEnd=true}Object.assign(Ll.prototype,{play:function e(){this._mixer._activateAction(this);return this},stop:function e(){this._mixer._deactivateAction(this);return this.reset()},reset:function e(){this.paused=false;this.enabled=true;this.time=0;this._loopCount=-1;this._startTime=null;return this.stopFading().stopWarping()},isRunning:function e(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)},isScheduled:function e(){return this._mixer._isActiveAction(this)},startAt:function e(t){this._startTime=t;return this},setLoop:function e(t,i){this.loop=t;this.repetitions=i;return this},setEffectiveWeight:function e(t){this.weight=t;this._effectiveWeight=this.enabled?t:0;return this.stopFading()},getEffectiveWeight:function e(){return this._effectiveWeight},fadeIn:function e(t){return this._scheduleFading(t,0,1)},fadeOut:function e(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function e(t,i,r){t.fadeOut(i);this.fadeIn(i);if(r){var n=this._clip.duration,a=t._clip.duration,s=a/n,o=n/a;t.warp(1,s,i);this.warp(o,1,i)}return this},crossFadeTo:function e(t,i,r){return t.crossFadeFrom(this,i,r)},stopFading:function e(){var t=this._weightInterpolant;if(t!==null){this._weightInterpolant=null;this._mixer._takeBackControlInterpolant(t)}return this},setEffectiveTimeScale:function e(t){this.timeScale=t;this._effectiveTimeScale=this.paused?0:t;return this.stopWarping()},getEffectiveTimeScale:function e(){return this._effectiveTimeScale},setDuration:function e(t){this.timeScale=this._clip.duration/t;return this.stopWarping()},syncWith:function e(t){this.time=t.time;this.timeScale=t.timeScale;return this.stopWarping()},halt:function e(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function e(t,i,r){var n=this._mixer,a=n.time,s=this._timeScaleInterpolant,o=this.timeScale;if(s===null){s=n._lendControlInterpolant();this._timeScaleInterpolant=s}var h=s.parameterPositions,l=s.sampleValues;h[0]=a;h[1]=a+r;l[0]=t/o;l[1]=i/o;return this},stopWarping:function e(){var t=this._timeScaleInterpolant;if(t!==null){this._timeScaleInterpolant=null;this._mixer._takeBackControlInterpolant(t)}return this},getMixer:function e(){return this._mixer},getClip:function e(){return this._clip},getRoot:function e(){return this._localRoot||this._mixer._root},_update:function e(t,i,r,n){if(!this.enabled){this._updateWeight(t);return}var a=this._startTime;if(a!==null){var s=(t-a)*r;if(s<0||r===0){return}this._startTime=null;i=r*s}i*=this._updateTimeScale(t);var o=this._updateTime(i);var h=this._updateWeight(t);if(h>0){var l=this._interpolants;var c=this._propertyBindings;for(var u=0,f=l.length;u!==f;++u){l[u].evaluate(o);c[u].accumulate(n,h)}}},_updateWeight:function e(t){var i=0;if(this.enabled){i=this.weight;var r=this._weightInterpolant;if(r!==null){var n=r.evaluate(t)[0];i*=n;if(t>r.parameterPositions[1]){this.stopFading();if(n===0){this.enabled=false}}}}this._effectiveWeight=i;return i},_updateTimeScale:function e(t){var i=0;if(!this.paused){i=this.timeScale;var r=this._timeScaleInterpolant;if(r!==null){var n=r.evaluate(t)[0];i*=n;if(t>r.parameterPositions[1]){this.stopWarping();if(i===0){this.paused=true}else{this.timeScale=i}}}}this._effectiveTimeScale=i;return i},_updateTime:function e(t){var i=this.time+t;if(t===0)return i;var r=this._clip.duration,n=this.loop,a=this._loopCount;if(n===Ct){if(a===-1){this._loopCount=0;this._setEndings(true,true,false)}e:{if(i>=r){i=r}else if(i<0){i=0}else break e;if(this.clampWhenFinished)this.paused=true;else this.enabled=false;this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{var s=n===It;if(a===-1){if(t>=0){a=0;this._setEndings(true,this.repetitions===0,s)}else{this._setEndings(this.repetitions===0,true,s)}}if(i>=r||i<0){var o=Math.floor(i/r);i-=r*o;a+=Math.abs(o);var h=this.repetitions-a;if(h<0){if(this.clampWhenFinished)this.paused=true;else this.enabled=false;i=t>0?r:0;this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1})}else{if(h===0){var l=t<0;this._setEndings(l,!l,s)}else{this._setEndings(false,false,s)}this._loopCount=a;this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}if(s&&(a&1)===1){this.time=i;return r-i}}this.time=i;return i},_setEndings:function e(t,i,r){var n=this._interpolantSettings;if(r){n.endingStart=zt;n.endingEnd=zt}else{if(t){n.endingStart=this.zeroSlopeAtStart?zt:Nt}else{n.endingStart=Bt}if(i){n.endingEnd=this.zeroSlopeAtEnd?zt:Nt}else{n.endingEnd=Bt}}},_scheduleFading:function e(t,i,r){var n=this._mixer,a=n.time,s=this._weightInterpolant;if(s===null){s=n._lendControlInterpolant();this._weightInterpolant=s}var o=s.parameterPositions,h=s.sampleValues;o[0]=a;h[0]=i;o[1]=a+t;h[1]=r;return this}});function Cl(e){this._root=e;this._initMemoryManager();this._accuIndex=0;this.time=0;this.timeScale=1}Object.assign(Cl.prototype,O.prototype,{_bindAction:function e(t,i){var r=t._localRoot||this._root,n=t._clip.tracks,a=n.length,s=t._propertyBindings,o=t._interpolants,h=r.uuid,l=this._bindingsByRootAndName,c=l[h];if(c===undefined){c={};l[h]=c}for(var u=0;u!==a;++u){var f=n[u],d=f.name,p=c[d];if(p!==undefined){s[u]=p}else{p=s[u];if(p!==undefined){if(p._cacheIndex===null){++p.referenceCount;this._addInactiveBinding(p,h,d)}continue}var v=i&&i._propertyBindings[u].binding.parsedPath;p=new Tl(Sl.create(r,d,v),f.ValueTypeName,f.getValueSize());++p.referenceCount;this._addInactiveBinding(p,h,d);s[u]=p}o[u].resultBuffer=p.buffer}},_activateAction:function e(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){var i=(t._localRoot||this._root).uuid,r=t._clip.uuid,n=this._actionsByClip[r];this._bindAction(t,n&&n.knownActions[0]);this._addInactiveAction(t,r,i)}var a=t._propertyBindings;for(var s=0,o=a.length;s!==o;++s){var h=a[s];if(h.useCount++===0){this._lendBinding(h);h.saveOriginalState()}}this._lendAction(t)}},_deactivateAction:function e(t){if(this._isActiveAction(t)){var i=t._propertyBindings;for(var r=0,n=i.length;r!==n;++r){var a=i[r];if(--a.useCount===0){a.restoreOriginalState();this._takeBackBinding(a)}}this._takeBackAction(t)}},_initMemoryManager:function e(){this._actions=[];this._nActiveActions=0;this._actionsByClip={};this._bindings=[];this._nActiveBindings=0;this._bindingsByRootAndName={};this._controlInterpolants=[];this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function e(t){var i=t._cacheIndex;return i!==null&&i<this._nActiveActions},_addInactiveAction:function e(t,i,r){var n=this._actions,a=this._actionsByClip,s=a[i];if(s===undefined){s={knownActions:[t],actionByRoot:{}};t._byClipCacheIndex=0;a[i]=s}else{var o=s.knownActions;t._byClipCacheIndex=o.length;o.push(t)}t._cacheIndex=n.length;n.push(t);s.actionByRoot[r]=t},_removeInactiveAction:function e(t){var i=this._actions,r=i[i.length-1],n=t._cacheIndex;r._cacheIndex=n;i[n]=r;i.pop();t._cacheIndex=null;var a=t._clip.uuid,s=this._actionsByClip,o=s[a],h=o.knownActions,l=h[h.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c;h[c]=l;h.pop();t._byClipCacheIndex=null;var u=o.actionByRoot,f=(t._localRoot||this._root).uuid;delete u[f];if(h.length===0){delete s[a]}this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function e(t){var i=t._propertyBindings;for(var r=0,n=i.length;r!==n;++r){var a=i[r];if(--a.referenceCount===0){this._removeInactiveBinding(a)}}},_lendAction:function e(t){var i=this._actions,r=t._cacheIndex,n=this._nActiveActions++,a=i[n];t._cacheIndex=n;i[n]=t;a._cacheIndex=r;i[r]=a},_takeBackAction:function e(t){var i=this._actions,r=t._cacheIndex,n=--this._nActiveActions,a=i[n];t._cacheIndex=n;i[n]=t;a._cacheIndex=r;i[r]=a},_addInactiveBinding:function e(t,i,r){var n=this._bindingsByRootAndName,a=n[i],s=this._bindings;if(a===undefined){a={};n[i]=a}a[r]=t;t._cacheIndex=s.length;s.push(t)},_removeInactiveBinding:function e(t){var i=this._bindings,r=t.binding,n=r.rootNode.uuid,a=r.path,s=this._bindingsByRootAndName,o=s[n],h=i[i.length-1],l=t._cacheIndex;h._cacheIndex=l;i[l]=h;i.pop();delete o[a];e:{for(var c in o){break e}delete s[n]}},_lendBinding:function e(t){var i=this._bindings,r=t._cacheIndex,n=this._nActiveBindings++,a=i[n];t._cacheIndex=n;i[n]=t;a._cacheIndex=r;i[r]=a},_takeBackBinding:function e(t){var i=this._bindings,r=t._cacheIndex,n=--this._nActiveBindings,a=i[n];t._cacheIndex=n;i[n]=t;a._cacheIndex=r;i[r]=a},_lendControlInterpolant:function e(){var t=this._controlInterpolants,i=this._nActiveControlInterpolants++,r=t[i];if(r===undefined){r=new Th(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer);r.__cacheIndex=i;t[i]=r}return r},_takeBackControlInterpolant:function e(t){var i=this._controlInterpolants,r=t.__cacheIndex,n=--this._nActiveControlInterpolants,a=i[n];t.__cacheIndex=n;i[n]=t;a.__cacheIndex=r;i[r]=a},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function e(t,i){var r=i||this._root,n=r.uuid,a=typeof t==="string"?zh.findByName(r,t):t,s=a!==null?a.uuid:t,o=this._actionsByClip[s],h=null;if(o!==undefined){var l=o.actionByRoot[n];if(l!==undefined){return l}h=o.knownActions[0];if(a===null)a=h._clip}if(a===null)return null;var c=new Ll(this,a,i);this._bindAction(c,h);this._addInactiveAction(c,s,n);return c},existingAction:function e(t,i){var r=i||this._root,n=r.uuid,a=typeof t==="string"?zh.findByName(r,t):t,s=a?a.uuid:t,o=this._actionsByClip[s];if(o!==undefined){return o.actionByRoot[n]||null}return null},stopAllAction:function e(){var t=this._actions,i=this._nActiveActions,r=this._bindings,n=this._nActiveBindings;this._nActiveActions=0;this._nActiveBindings=0;for(var a=0;a!==i;++a){t[a].reset()}for(var a=0;a!==n;++a){r[a].useCount=0}return this},update:function e(t){t*=this.timeScale;var i=this._actions,r=this._nActiveActions,n=this.time+=t,a=Math.sign(t),s=this._accuIndex^=1;for(var o=0;o!==r;++o){var h=i[o];h._update(n,t,a,s)}var l=this._bindings,c=this._nActiveBindings;for(var o=0;o!==c;++o){l[o].apply(s)}return this},getRoot:function e(){return this._root},uncacheClip:function e(t){var i=this._actions,r=t.uuid,n=this._actionsByClip,a=n[r];if(a!==undefined){var s=a.knownActions;for(var o=0,h=s.length;o!==h;++o){var l=s[o];this._deactivateAction(l);var c=l._cacheIndex,u=i[i.length-1];l._cacheIndex=null;l._byClipCacheIndex=null;u._cacheIndex=c;i[c]=u;i.pop();this._removeInactiveBindingsForAction(l)}delete n[r]}},uncacheRoot:function e(t){var i=t.uuid,r=this._actionsByClip;for(var n in r){var a=r[n].actionByRoot,s=a[i];if(s!==undefined){this._deactivateAction(s);this._removeInactiveAction(s)}}var o=this._bindingsByRootAndName,h=o[i];if(h!==undefined){for(var l in h){var c=h[l];c.restoreOriginalState();this._removeInactiveBinding(c)}}},uncacheAction:function e(t,i){var r=this.existingAction(t,i);if(r!==null){this._deactivateAction(r);this._removeInactiveAction(r)}}});function Rl(e){if(typeof e==="string"){e=arguments[1]}this.value=e}Rl.prototype.clone=function(){return new Rl(this.value.clone===undefined?this.value:this.value.clone())};function Il(){ja.call(this);this.type="InstancedBufferGeometry";this.maxInstancedCount=undefined}Il.prototype=Object.assign(Object.create(ja.prototype),{constructor:Il,isInstancedBufferGeometry:true,copy:function e(t){ja.prototype.copy.call(this,t);this.maxInstancedCount=t.maxInstancedCount;return this},clone:function e(){return(new this.constructor).copy(this)}});function Pl(e,t,i,r){this.uuid=Qt.generateUUID();this.data=e;this.itemSize=t;this.offset=i;this.normalized=r===true}Object.defineProperties(Pl.prototype,{count:{get:function e(){return this.data.count}},array:{get:function e(){return this.data.array}}});Object.assign(Pl.prototype,{isInterleavedBufferAttribute:true,setX:function e(t,i){this.data.array[t*this.data.stride+this.offset]=i;return this},setY:function e(t,i){this.data.array[t*this.data.stride+this.offset+1]=i;return this},setZ:function e(t,i){this.data.array[t*this.data.stride+this.offset+2]=i;return this},setW:function e(t,i){this.data.array[t*this.data.stride+this.offset+3]=i;return this},getX:function e(t){return this.data.array[t*this.data.stride+this.offset]},getY:function e(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function e(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function e(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function e(t,i,r){t=t*this.data.stride+this.offset;this.data.array[t+0]=i;this.data.array[t+1]=r;return this},setXYZ:function e(t,i,r,n){t=t*this.data.stride+this.offset;this.data.array[t+0]=i;this.data.array[t+1]=r;this.data.array[t+2]=n;return this},setXYZW:function e(t,i,r,n,a){t=t*this.data.stride+this.offset;this.data.array[t+0]=i;this.data.array[t+1]=r;this.data.array[t+2]=n;this.data.array[t+3]=a;return this}});function Ol(e,t){this.uuid=Qt.generateUUID();this.array=e;this.stride=t;this.count=e!==undefined?e.length/t:0;this.dynamic=false;this.updateRange={offset:0,count:-1};this.onUploadCallback=function(){};this.version=0}Object.defineProperty(Ol.prototype,"needsUpdate",{set:function e(t){if(t===true)this.version++}});Object.assign(Ol.prototype,{isInterleavedBuffer:true,setArray:function e(t){if(Array.isArray(t)){throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.")}this.count=t!==undefined?t.length/this.stride:0;this.array=t},setDynamic:function e(t){this.dynamic=t;return this},copy:function e(t){this.array=new t.array.constructor(t.array);this.count=t.count;this.stride=t.stride;this.dynamic=t.dynamic;return this},copyAt:function e(t,i,r){t*=this.stride;r*=i.stride;for(var n=0,a=this.stride;n<a;n++){this.array[t+n]=i.array[r+n]}return this},set:function e(t,i){if(i===undefined)i=0;this.array.set(t,i);return this},clone:function e(){return(new this.constructor).copy(this)},onUpload:function e(t){this.onUploadCallback=t;return this}});function kl(e,t,i){Ol.call(this,e,t);this.meshPerAttribute=i||1}kl.prototype=Object.assign(Object.create(Ol.prototype),{constructor:kl,isInstancedInterleavedBuffer:true,copy:function e(t){Ol.prototype.copy.call(this,t);this.meshPerAttribute=t.meshPerAttribute;return this}});function Nl(e,t,i){La.call(this,e,t);this.meshPerAttribute=i||1}Nl.prototype=Object.assign(Object.create(La.prototype),{constructor:Nl,isInstancedBufferAttribute:true,copy:function e(t){La.prototype.copy.call(this,t);this.meshPerAttribute=t.meshPerAttribute;return this}});function zl(e,t,i,r){this.ray=new qa(e,t);this.near=i||0;this.far=r||Infinity;this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function e(){return this.Points}}})}function Bl(e,t){return e.distance-t.distance}function Ul(e,t,i,r){if(e.visible===false)return;e.raycast(t,i);if(r===true){var n=e.children;for(var a=0,s=n.length;a<s;a++){Ul(n[a],t,i,true)}}}Object.assign(zl.prototype,{linePrecision:1,set:function e(t,i){this.ray.set(t,i)},setFromCamera:function e(t,i){if(i&&i.isPerspectiveCamera){this.ray.origin.setFromMatrixPosition(i.matrixWorld);this.ray.direction.set(t.x,t.y,.5).unproject(i).sub(this.ray.origin).normalize()}else if(i&&i.isOrthographicCamera){this.ray.origin.set(t.x,t.y,(i.near+i.far)/(i.near-i.far)).unproject(i);this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld)}else{console.error("THREE.Raycaster: Unsupported camera type.")}},intersectObject:function e(t,i){var r=[];Ul(t,this,r,i);r.sort(Bl);return r},intersectObjects:function e(t,i){var r=[];if(Array.isArray(t)===false){return r}for(var n=0,a=t.length;n<a;n++){Ul(t[n],this,r,i)}r.sort(Bl);return r}});function Dl(e){this.autoStart=e!==undefined?e:true;this.startTime=0;this.oldTime=0;this.elapsedTime=0;this.running=false}Object.assign(Dl.prototype,{start:function e(){this.startTime=(typeof performance==="undefined"?Date:performance).now();this.oldTime=this.startTime;this.elapsedTime=0;this.running=true},stop:function e(){this.getElapsedTime();this.running=false;this.autoStart=false},getElapsedTime:function e(){this.getDelta();return this.elapsedTime},getDelta:function e(){var t=0;if(this.autoStart&&!this.running){this.start();return 0}if(this.running){var i=(typeof performance==="undefined"?Date:performance).now();t=(i-this.oldTime)/1e3;this.oldTime=i;this.elapsedTime+=t}return t}});function Fl(e,t,i){this.radius=e!==undefined?e:1;this.phi=t!==undefined?t:0;this.theta=i!==undefined?i:0;return this}Object.assign(Fl.prototype,{set:function e(t,i,r){this.radius=t;this.phi=i;this.theta=r;return this},clone:function e(){return(new this.constructor).copy(this)},copy:function e(t){this.radius=t.radius;this.phi=t.phi;this.theta=t.theta;return this},makeSafe:function e(){var t=1e-6;this.phi=Math.max(t,Math.min(Math.PI-t,this.phi));return this},setFromVector3:function e(t){this.radius=t.length();if(this.radius===0){this.theta=0;this.phi=0}else{this.theta=Math.atan2(t.x,t.z);this.phi=Math.acos(Qt.clamp(t.y/this.radius,-1,1))}return this}});function jl(e,t,i){this.radius=e!==undefined?e:1;this.theta=t!==undefined?t:0;this.y=i!==undefined?i:0;return this}Object.assign(jl.prototype,{set:function e(t,i,r){this.radius=t;this.theta=i;this.y=r;return this},clone:function e(){return(new this.constructor).copy(this)},copy:function e(t){this.radius=t.radius;this.theta=t.theta;this.y=t.y;return this},setFromVector3:function e(t){this.radius=Math.sqrt(t.x*t.x+t.z*t.z);this.theta=Math.atan2(t.x,t.z);this.y=t.y;return this}});function Gl(e){ba.call(this);this.material=e;this.render=function(){}}Gl.prototype=Object.create(ba.prototype);Gl.prototype.constructor=Gl;Gl.prototype.isImmediateRenderObject=true;function Hl(e,t,i,r){this.object=e;this.size=t!==undefined?t:1;var n=i!==undefined?i:16711680;var a=r!==undefined?r:1;var s=0;var o=this.object.geometry;if(o&&o.isGeometry){s=o.faces.length*3}else if(o&&o.isBufferGeometry){s=o.attributes.normal.count}var h=new ja;var l=new za(s*2*3,3);h.addAttribute("position",l);Js.call(this,h,new qs({color:n,linewidth:a}));this.matrixAutoUpdate=false;this.update()}Hl.prototype=Object.create(Js.prototype);Hl.prototype.constructor=Hl;Hl.prototype.update=function(){var e=new ti;var t=new ti;var i=new ii;return function r(){var n=["a","b","c"];this.object.updateMatrixWorld(true);i.getNormalMatrix(this.object.matrixWorld);var a=this.object.matrixWorld;var s=this.geometry.attributes.position;var o=this.object.geometry;if(o&&o.isGeometry){var h=o.vertices;var l=o.faces;var c=0;for(var u=0,f=l.length;u<f;u++){var d=l[u];for(var p=0,v=d.vertexNormals.length;p<v;p++){var m=h[d[n[p]]];var g=d.vertexNormals[p];e.copy(m).applyMatrix4(a);t.copy(g).applyMatrix3(i).normalize().multiplyScalar(this.size).add(e);s.setXYZ(c,e.x,e.y,e.z);c=c+1;s.setXYZ(c,t.x,t.y,t.z);c=c+1}}}else if(o&&o.isBufferGeometry){var y=o.attributes.position;var _=o.attributes.normal;var c=0;for(var p=0,v=y.count;p<v;p++){e.set(y.getX(p),y.getY(p),y.getZ(p)).applyMatrix4(a);t.set(_.getX(p),_.getY(p),_.getZ(p));t.applyMatrix3(i).normalize().multiplyScalar(this.size).add(e);s.setXYZ(c,e.x,e.y,e.z);c=c+1;s.setXYZ(c,t.x,t.y,t.z);c=c+1}}s.needsUpdate=true}}();function Vl(e,t){ba.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.color=t;var i=new ja;var r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(var n=0,a=1,s=32;n<s;n++,a++){var o=n/s*Math.PI*2;var h=a/s*Math.PI*2;r.push(Math.cos(o),Math.sin(o),1,Math.cos(h),Math.sin(h),1)}i.addAttribute("position",new za(r,3));var l=new qs({fog:false});this.cone=new Js(i,l);this.add(this.cone);this.update()}Vl.prototype=Object.create(ba.prototype);Vl.prototype.constructor=Vl;Vl.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};Vl.prototype.update=function(){var e=new ti;var t=new ti;return function i(){this.light.updateMatrixWorld();var r=this.light.distance?this.light.distance:1e3;var n=r*Math.tan(this.light.angle);this.cone.scale.set(n,n,r);e.setFromMatrixPosition(this.light.matrixWorld);t.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(t.sub(e));if(this.color!==undefined){this.cone.material.color.set(this.color)}else{this.cone.material.color.copy(this.light.color)}}}();function Wl(e){var t=[];if(e&&e.isBone){t.push(e)}for(var i=0;i<e.children.length;i++){t.push.apply(t,Wl(e.children[i]))}return t}function Xl(e){var t=Wl(e);var i=new ja;var r=[];var n=[];var a=new Ki(0,0,1);var s=new Ki(0,1,0);for(var o=0;o<t.length;o++){var h=t[o];if(h.parent&&h.parent.isBone){r.push(0,0,0);r.push(0,0,0);n.push(a.r,a.g,a.b);n.push(s.r,s.g,s.b)}}i.addAttribute("position",new za(r,3));i.addAttribute("color",new za(n,3));var l=new qs({vertexColors:K,depthTest:false,depthWrite:false,transparent:true});Js.call(this,i,l);this.root=e;this.bones=t;this.matrix=e.matrixWorld;this.matrixAutoUpdate=false}Xl.prototype=Object.create(Js.prototype);Xl.prototype.constructor=Xl;Xl.prototype.updateMatrixWorld=function(){var e=new ti;var t=new $t;var i=new $t;return function r(n){var a=this.bones;var s=this.geometry;var o=s.getAttribute("position");i.getInverse(this.root.matrixWorld);for(var h=0,l=0;h<a.length;h++){var c=a[h];if(c.parent&&c.parent.isBone){t.multiplyMatrices(i,c.matrixWorld);e.setFromMatrixPosition(t);o.setXYZ(l,e.x,e.y,e.z);t.multiplyMatrices(i,c.parent.matrixWorld);e.setFromMatrixPosition(t);o.setXYZ(l+1,e.x,e.y,e.z);l+=2}}s.getAttribute("position").needsUpdate=true;ba.prototype.updateMatrixWorld.call(this,n)}}();function Yl(e,t,i){this.light=e;this.light.updateMatrixWorld();this.color=i;var r=new Ro(t,4,2);var n=new Xa({wireframe:true,fog:false});Qa.call(this,r,n);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=false;this.update()}Yl.prototype=Object.create(Qa.prototype);Yl.prototype.constructor=Yl;Yl.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};Yl.prototype.update=function(){if(this.color!==undefined){this.material.color.set(this.color)}else{this.material.color.copy(this.light.color)}};function ql(e,t){ba.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.color=t;var i=new qs({fog:false});var r=new ja;r.addAttribute("position",new La(new Float32Array(5*3),3));this.line=new Zs(r,i);this.add(this.line);this.update()}ql.prototype=Object.create(ba.prototype);ql.prototype.constructor=ql;ql.prototype.dispose=function(){this.children[0].geometry.dispose();this.children[0].material.dispose()};ql.prototype.update=function(){var e=this.light.width*.5;var t=this.light.height*.5;var i=this.line.geometry.attributes.position;var r=i.array;r[0]=e;r[1]=-t;r[2]=0;r[3]=e;r[4]=t;r[5]=0;r[6]=-e;r[7]=t;r[8]=0;r[9]=-e;r[10]=-t;r[11]=0;r[12]=e;r[13]=-t;r[14]=0;i.needsUpdate=true;if(this.color!==undefined){this.line.material.color.set(this.color)}else{this.line.material.color.copy(this.light.color)}};function Zl(e,t,i){ba.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.color=i;var r=new fo(t);r.rotateY(Math.PI*.5);this.material=new Xa({wireframe:true,fog:false});if(this.color===undefined)this.material.vertexColors=K;var n=r.getAttribute("position");var a=new Float32Array(n.count*3);r.addAttribute("color",new La(a,3));this.add(new Qa(r,this.material));this.update()}Zl.prototype=Object.create(ba.prototype);Zl.prototype.constructor=Zl;Zl.prototype.dispose=function(){this.children[0].geometry.dispose();this.children[0].material.dispose()};Zl.prototype.update=function(){var e=new ti;var t=new Ki;var i=new Ki;return function r(){var n=this.children[0];if(this.color!==undefined){this.material.color.set(this.color)}else{var a=n.geometry.getAttribute("color");t.copy(this.light.color);i.copy(this.light.groundColor);for(var s=0,o=a.count;s<o;s++){var h=s<o/2?t:i;a.setXYZ(s,h.r,h.g,h.b)}a.needsUpdate=true}n.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate())}}();function Jl(e,t,i,r){e=e||10;t=t||10;i=new Ki(i!==undefined?i:4473924);r=new Ki(r!==undefined?r:8947848);var n=t/2;var a=e/t;var s=e/2;var o=[],h=[];for(var l=0,c=0,u=-s;l<=t;l++,u+=a){o.push(-s,0,u,s,0,u);o.push(u,0,-s,u,0,s);var f=l===n?i:r;f.toArray(h,c);c+=3;f.toArray(h,c);c+=3;f.toArray(h,c);c+=3;f.toArray(h,c);c+=3}var d=new ja;d.addAttribute("position",new za(o,3));d.addAttribute("color",new za(h,3));var p=new qs({vertexColors:K});Js.call(this,d,p)}Jl.prototype=Object.create(Js.prototype);Jl.prototype.constructor=Jl;function Ql(e,t,i,r,n,a){e=e||10;t=t||16;i=i||8;r=r||64;n=new Ki(n!==undefined?n:4473924);a=new Ki(a!==undefined?a:8947848);var s=[];var o=[];var h,l;var c,u,f,d,p;for(u=0;u<=t;u++){c=u/t*(Math.PI*2);h=Math.sin(c)*e;l=Math.cos(c)*e;s.push(0,0,0);s.push(h,0,l);p=u&1?n:a;o.push(p.r,p.g,p.b);o.push(p.r,p.g,p.b)}for(u=0;u<=i;u++){p=u&1?n:a;d=e-e/i*u;for(f=0;f<r;f++){c=f/r*(Math.PI*2);h=Math.sin(c)*d;l=Math.cos(c)*d;s.push(h,0,l);o.push(p.r,p.g,p.b);c=(f+1)/r*(Math.PI*2);h=Math.sin(c)*d;l=Math.cos(c)*d;s.push(h,0,l);o.push(p.r,p.g,p.b)}}var v=new ja;v.addAttribute("position",new za(s,3));v.addAttribute("color",new za(o,3));var m=new qs({vertexColors:K});Js.call(this,v,m)}Ql.prototype=Object.create(Js.prototype);Ql.prototype.constructor=Ql;function Kl(e,t,i,r){this.object=e;this.size=t!==undefined?t:1;var n=i!==undefined?i:16776960;var a=r!==undefined?r:1;var s=0;var o=this.object.geometry;if(o&&o.isGeometry){s=o.faces.length}else{}var h=new ja;var l=new za(s*2*3,3);h.addAttribute("position",l);Js.call(this,h,new qs({color:n,linewidth:a}));this.matrixAutoUpdate=false;this.update()}Kl.prototype=Object.create(Js.prototype);Kl.prototype.constructor=Kl;Kl.prototype.update=function(){var e=new ti;var t=new ti;var i=new ii;return function r(){this.object.updateMatrixWorld(true);i.getNormalMatrix(this.object.matrixWorld);var n=this.object.matrixWorld;var a=this.geometry.attributes.position;var s=this.object.geometry;var o=s.vertices;var h=s.faces;var l=0;for(var c=0,u=h.length;c<u;c++){var f=h[c];var d=f.normal;e.copy(o[f.a]).add(o[f.b]).add(o[f.c]).divideScalar(3).applyMatrix4(n);t.copy(d).applyMatrix3(i).normalize().multiplyScalar(this.size).add(e);a.setXYZ(l,e.x,e.y,e.z);l=l+1;a.setXYZ(l,t.x,t.y,t.z);l=l+1}a.needsUpdate=true}}();function $l(e,t,i){ba.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.color=i;if(t===undefined)t=1;var r=new ja;r.addAttribute("position",new za([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var n=new qs({fog:false});this.lightPlane=new Zs(r,n);this.add(this.lightPlane);r=new ja;r.addAttribute("position",new za([0,0,0,0,0,1],3));this.targetLine=new Zs(r,n);this.add(this.targetLine);this.update()}$l.prototype=Object.create(ba.prototype);$l.prototype.constructor=$l;$l.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};$l.prototype.update=function(){var e=new ti;var t=new ti;var i=new ti;return function r(){e.setFromMatrixPosition(this.light.matrixWorld);t.setFromMatrixPosition(this.light.target.matrixWorld);i.subVectors(t,e);this.lightPlane.lookAt(i);if(this.color!==undefined){this.lightPlane.material.color.set(this.color);this.targetLine.material.color.set(this.color)}else{this.lightPlane.material.color.copy(this.light.color);this.targetLine.material.color.copy(this.light.color)}this.targetLine.lookAt(i);this.targetLine.scale.z=i.length()}}();function ec(e){var t=new ja;var i=new qs({color:16777215,vertexColors:Q});var r=[];var n=[];var a={};var s=new Ki(16755200);var o=new Ki(16711680);var h=new Ki(43775);var l=new Ki(16777215);var c=new Ki(3355443);u("n1","n2",s);u("n2","n4",s);u("n4","n3",s);u("n3","n1",s);u("f1","f2",s);u("f2","f4",s);u("f4","f3",s);u("f3","f1",s);u("n1","f1",s);u("n2","f2",s);u("n3","f3",s);u("n4","f4",s);u("p","n1",o);u("p","n2",o);u("p","n3",o);u("p","n4",o);u("u1","u2",h);u("u2","u3",h);u("u3","u1",h);u("c","t",l);u("p","c",c);u("cn1","cn2",c);u("cn3","cn4",c);u("cf1","cf2",c);u("cf3","cf4",c);function u(e,t,i){f(e,i);f(t,i)}function f(e,t){r.push(0,0,0);n.push(t.r,t.g,t.b);if(a[e]===undefined){a[e]=[]}a[e].push(r.length/3-1)}t.addAttribute("position",new za(r,3));t.addAttribute("color",new za(n,3));Js.call(this,t,i);this.camera=e;if(this.camera.updateProjectionMatrix)this.camera.updateProjectionMatrix();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.pointMap=a;this.update()}ec.prototype=Object.create(Js.prototype);ec.prototype.constructor=ec;ec.prototype.update=function(){var e,t;var i=new ti;var r=new Ma;function n(n,a,s,o){i.set(a,s,o).unproject(r);var h=t[n];if(h!==undefined){var l=e.getAttribute("position");for(var c=0,u=h.length;c<u;c++){l.setXYZ(h[c],i.x,i.y,i.z)}}}return function i(){e=this.geometry;t=this.pointMap;var a=1,s=1;r.projectionMatrix.copy(this.camera.projectionMatrix);n("c",0,0,-1);n("t",0,0,1);n("n1",-a,-s,-1);n("n2",a,-s,-1);n("n3",-a,s,-1);n("n4",a,s,-1);n("f1",-a,-s,1);n("f2",a,-s,1);n("f3",-a,s,1);n("f4",a,s,1);n("u1",a*.7,s*1.1,-1);n("u2",-a*.7,s*1.1,-1);n("u3",0,s*2,-1);n("cf1",-a,0,1);n("cf2",a,0,1);n("cf3",0,-s,1);n("cf4",0,s,1);n("cn1",-a,0,-1);n("cn2",a,0,-1);n("cn3",0,-s,-1);n("cn4",0,s,-1);e.getAttribute("position").needsUpdate=true}}();function tc(e,t){this.object=e;if(t===undefined)t=16776960;var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var r=new Float32Array(8*3);var n=new ja;n.setIndex(new La(i,1));n.addAttribute("position",new La(r,3));Js.call(this,n,new qs({color:t}));this.matrixAutoUpdate=false;this.update()}tc.prototype=Object.create(Js.prototype);tc.prototype.constructor=tc;tc.prototype.update=function(){var e=new da;return function t(i){if(i!==undefined){}if(this.object!==undefined){e.setFromObject(this.object)}if(e.isEmpty())return;var r=e.min;var n=e.max;var a=this.geometry.attributes.position;var s=a.array;s[0]=n.x;s[1]=n.y;s[2]=n.z;s[3]=r.x;s[4]=n.y;s[5]=n.z;s[6]=r.x;s[7]=r.y;s[8]=n.z;s[9]=n.x;s[10]=r.y;s[11]=n.z;s[12]=n.x;s[13]=n.y;s[14]=r.z;s[15]=r.x;s[16]=n.y;s[17]=r.z;s[18]=r.x;s[19]=r.y;s[20]=r.z;s[21]=n.x;s[22]=r.y;s[23]=r.z;a.needsUpdate=true;this.geometry.computeBoundingSphere()}}();tc.prototype.setFromObject=function(e){this.object=e;this.update();return this};function ic(e,t){this.type="Box3Helper";this.box=e;var i=t!==undefined?t:16776960;var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var n=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1];var a=new ja;a.setIndex(new La(r,1));a.addAttribute("position",new za(n,3));Js.call(this,a,new qs({color:i}));this.geometry.computeBoundingSphere()}ic.prototype=Object.create(Js.prototype);ic.prototype.constructor=ic;ic.prototype.updateMatrixWorld=function(e){var t=this.box;if(t.isEmpty())return;t.getCenter(this.position);t.getSize(this.scale);this.scale.multiplyScalar(.5);ba.prototype.updateMatrixWorld.call(this,e)};function rc(e,t,i){this.type="PlaneHelper";this.plane=e;this.size=t===undefined?1:t;var r=i!==undefined?i:16776960;var n=[1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0];var a=new ja;a.addAttribute("position",new za(n,3));a.computeBoundingSphere();Zs.call(this,a,new qs({color:r}));var s=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1];var o=new ja;o.addAttribute("position",new za(s,3));o.computeBoundingSphere();this.add(new Qa(o,new Xa({color:r,opacity:.2,transparent:true,depthWrite:false})))}rc.prototype=Object.create(Zs.prototype);rc.prototype.constructor=rc;rc.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;if(Math.abs(t)<1e-8)t=1e-8;this.scale.set(.5*this.size,.5*this.size,t);this.lookAt(this.plane.normal);ba.prototype.updateMatrixWorld.call(this,e)};var nc;var ac;function sc(e,t,i,r,n,a){ba.call(this);if(r===undefined)r=16776960;if(i===undefined)i=1;if(n===undefined)n=.2*i;if(a===undefined)a=.2*n;if(nc===undefined){nc=new ja;nc.addAttribute("position",new za([0,0,0,0,1,0],3));ac=new Do(0,.5,1,5,1);ac.translate(0,-.5,0)}this.position.copy(t);this.line=new Zs(nc,new qs({color:r}));this.line.matrixAutoUpdate=false;this.add(this.line);this.cone=new Qa(ac,new Xa({color:r}));this.cone.matrixAutoUpdate=false;this.add(this.cone);this.setDirection(e);this.setLength(i,n,a)}sc.prototype=Object.create(ba.prototype);sc.prototype.constructor=sc;sc.prototype.setDirection=function(){var e=new ti;var t;return function i(r){if(r.y>.99999){this.quaternion.set(0,0,0,1)}else if(r.y<-.99999){this.quaternion.set(1,0,0,0)}else{e.set(r.z,0,-r.x).normalize();t=Math.acos(r.y);this.quaternion.setFromAxisAngle(e,t)}}}();sc.prototype.setLength=function(e,t,i){if(t===undefined)t=.2*e;if(i===undefined)i=.2*t;this.line.scale.set(1,Math.max(0,e-t),1);this.line.updateMatrix();this.cone.scale.set(i,t,i);this.cone.position.y=e;this.cone.updateMatrix()};sc.prototype.setColor=function(e){this.line.material.color.copy(e);this.cone.material.color.copy(e)};function oc(e){e=e||1;var t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e];var i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1];var r=new ja;r.addAttribute("position",new za(t,3));r.addAttribute("color",new za(i,3));var n=new qs({vertexColors:K});Js.call(this,r,n)}oc.prototype=Object.create(Js.prototype);oc.prototype.constructor=oc;function hc(){var e=0,t=0,i=0,r=0;function n(n,a,s,o){e=n;t=s;i=-3*n+3*a-2*s-o;r=2*n-2*a+s+o}return{initCatmullRom:function e(t,i,r,a,s){n(i,r,s*(r-t),s*(a-i))},initNonuniformCatmullRom:function e(t,i,r,a,s,o,h){var l=(i-t)/s-(r-t)/(s+o)+(r-i)/o;var c=(r-i)/o-(a-i)/(o+h)+(a-r)/h;l*=o;c*=o;n(i,r,l,c)},calc:function n(a){var s=a*a;var o=s*a;return e+t*a+i*s+r*o}}}var lc=new ti;var cc=new hc;var uc=new hc;var fc=new hc;function dc(e,t,i,r){il.call(this);this.type="CatmullRomCurve3";this.points=e||[];this.closed=t||false;this.curveType=i||"centripetal";this.tension=r||.5}dc.prototype=Object.create(il.prototype);dc.prototype.constructor=dc;dc.prototype.isCatmullRomCurve3=true;dc.prototype.getPoint=function(e,t){var i=t||new ti;var r=this.points;var n=r.length;var a=(n-(this.closed?0:1))*e;var s=Math.floor(a);var o=a-s;if(this.closed){s+=s>0?0:(Math.floor(Math.abs(s)/r.length)+1)*r.length}else if(o===0&&s===n-1){s=n-2;o=1}var h,l,c,u;if(this.closed||s>0){h=r[(s-1)%n]}else{lc.subVectors(r[0],r[1]).add(r[0]);h=lc}l=r[s%n];c=r[(s+1)%n];if(this.closed||s+2<n){u=r[(s+2)%n]}else{lc.subVectors(r[n-1],r[n-2]).add(r[n-1]);u=lc}if(this.curveType==="centripetal"||this.curveType==="chordal"){var f=this.curveType==="chordal"?.5:.25;var d=Math.pow(h.distanceToSquared(l),f);var p=Math.pow(l.distanceToSquared(c),f);var v=Math.pow(c.distanceToSquared(u),f);if(p<1e-4)p=1;if(d<1e-4)d=p;if(v<1e-4)v=p;cc.initNonuniformCatmullRom(h.x,l.x,c.x,u.x,d,p,v);uc.initNonuniformCatmullRom(h.y,l.y,c.y,u.y,d,p,v);fc.initNonuniformCatmullRom(h.z,l.z,c.z,u.z,d,p,v)}else if(this.curveType==="catmullrom"){cc.initCatmullRom(h.x,l.x,c.x,u.x,this.tension);uc.initCatmullRom(h.y,l.y,c.y,u.y,this.tension);fc.initCatmullRom(h.z,l.z,c.z,u.z,this.tension)}i.set(cc.calc(o),uc.calc(o),fc.calc(o));return i};dc.prototype.copy=function(e){il.prototype.copy.call(this,e);this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push(r.clone())}this.closed=e.closed;this.curveType=e.curveType;this.tension=e.tension;return this};function pc(e,t,i,r){il.call(this);this.type="CubicBezierCurve3";this.v0=e||new ti;this.v1=t||new ti;this.v2=i||new ti;this.v3=r||new ti}pc.prototype=Object.create(il.prototype);pc.prototype.constructor=pc;pc.prototype.isCubicBezierCurve3=true;pc.prototype.getPoint=function(e,t){var i=t||new ti;var r=this.v0,n=this.v1,a=this.v2,s=this.v3;i.set(tl(e,r.x,n.x,a.x,s.x),tl(e,r.y,n.y,a.y,s.y),tl(e,r.z,n.z,a.z,s.z));return i};pc.prototype.copy=function(e){il.prototype.copy.call(this,e);this.v0.copy(e.v0);this.v1.copy(e.v1);this.v2.copy(e.v2);this.v3.copy(e.v3);return this};function vc(e,t,i){il.call(this);this.type="QuadraticBezierCurve3";this.v0=e||new ti;this.v1=t||new ti;this.v2=i||new ti}vc.prototype=Object.create(il.prototype);vc.prototype.constructor=vc;vc.prototype.isQuadraticBezierCurve3=true;vc.prototype.getPoint=function(e,t){var i=t||new ti;var r=this.v0,n=this.v1,a=this.v2;i.set(Jh(e,r.x,n.x,a.x),Jh(e,r.y,n.y,a.y),Jh(e,r.z,n.z,a.z));return i};vc.prototype.copy=function(e){il.prototype.copy.call(this,e);this.v0.copy(e.v0);this.v1.copy(e.v1);this.v2.copy(e.v2);return this};function mc(e,t){il.call(this);this.type="LineCurve3";this.v1=e||new ti;this.v2=t||new ti}mc.prototype=Object.create(il.prototype);mc.prototype.constructor=mc;mc.prototype.isLineCurve3=true;mc.prototype.getPoint=function(e,t){var i=t||new ti;if(e===1){i.copy(this.v2)}else{i.copy(this.v2).sub(this.v1);i.multiplyScalar(e).add(this.v1)}return i};mc.prototype.getPointAt=function(e,t){return this.getPoint(e,t)};mc.prototype.copy=function(e){il.prototype.copy.call(this,e);this.v1.copy(e.v1);this.v2.copy(e.v2);return this};function gc(e,t,i,r,n,a){al.call(this,e,t,i,i,r,n,a);this.type="ArcCurve"}gc.prototype=Object.create(al.prototype);gc.prototype.constructor=gc;gc.prototype.isArcCurve=true;var yc={createMultiMaterialObject:function e(t,i){var r=new eo;for(var n=0,a=i.length;n<a;n++){r.add(new Qa(t,i[n]))}return r},detach:function e(t,i,r){t.applyMatrix(i.matrixWorld);i.remove(t);r.add(t)},attach:function e(t,i,r){t.applyMatrix((new $t).getInverse(r.matrixWorld));i.remove(t);r.add(t)}};function _c(e,t,i,r,n,a,s){return new Ea(e,t,i,n,a,s)}var xc=0;var wc=1;function bc(e){return e}function Mc(e){if(e===undefined)e=[];e.isMultiMaterial=true;e.materials=e;e.clone=function(){return e.slice()};return e}function Tc(e,t){console.warn("THREE.PointCloud has been renamed to THREE.Points.");return new $s(e,t)}function Ec(e){console.warn("THREE.Particle has been renamed to THREE.Sprite.");return new Hs(e)}function Sc(e,t){console.warn("THREE.ParticleSystem has been renamed to THREE.Points.");return new $s(e,t)}function Ac(e){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.");return new Ks(e)}function Lc(e){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.");return new Ks(e)}function Cc(e){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.");return new Ks(e)}function Rc(e,t,i){console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead.");return new ti(e,t,i)}function Ic(e,t){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.");return new La(e,t).setDynamic(true)}function Pc(e,t){console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead.");return new Ca(e,t)}function Oc(e,t){console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead.");return new Ra(e,t)}function kc(e,t){console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead.");return new Ia(e,t)}function Nc(e,t){console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead.");return new Pa(e,t)}function zc(e,t){console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead.");return new Oa(e,t)}function Bc(e,t){console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead.");return new ka(e,t)}function Uc(e,t){console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead.");return new Na(e,t)}function Dc(e,t){console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead.");return new za(e,t)}function Fc(e,t){console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead.");return new Ba(e,t)}il.create=function(e,t){console.log("THREE.Curve.create() has been deprecated");e.prototype=Object.create(il.prototype);e.prototype.constructor=e;e.prototype.getPoint=t;return e};Object.assign(nl.prototype,{createPointsGeometry:function e(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var i=this.getPoints(t);return this.createGeometry(i)},createSpacedPointsGeometry:function e(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var i=this.getSpacedPoints(t);return this.createGeometry(i)},createGeometry:function e(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var i=new Aa;for(var r=0,n=t.length;r<n;r++){var a=t[r];i.vertices.push(new ti(a.x,a.y,a.z||0))}return i}});Object.assign(cl.prototype,{fromPoints:function e(t){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints().");this.setFromPoints(t)}});function jc(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead.");dc.call(this,e);this.type="catmullrom";this.closed=true}jc.prototype=Object.create(dc.prototype);function Gc(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead.");dc.call(this,e);this.type="catmullrom"}Gc.prototype=Object.create(dc.prototype);function Hc(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead.");dc.call(this,e);this.type="catmullrom"}Hc.prototype=Object.create(dc.prototype);Object.assign(Hc.prototype,{initFromArray:function e(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function e(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function e(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}});function Vc(e){console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper.");return new oc(e)}function Wc(e,t){console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead.");return new tc(e,t)}function Xc(e,t){console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead.");return new Js(new Bo(e.geometry),new qs({color:t!==undefined?t:16777215}))}Jl.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};Xl.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};function Yc(e,t){console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead.");return new Js(new no(e.geometry),new qs({color:t!==undefined?t:16777215}))}function qc(e){console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader.");return new ah(e)}function Zc(e){console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader.");return new oh(e)}Object.assign(aa.prototype,{center:function e(t){console.warn("THREE.Box2: .center() has been renamed to .getCenter().");return this.getCenter(t)},empty:function e(){console.warn("THREE.Box2: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function e(t){console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(t)},size:function e(t){console.warn("THREE.Box2: .size() has been renamed to .getSize().");return this.getSize(t)}});Object.assign(da.prototype,{center:function e(t){console.warn("THREE.Box3: .center() has been renamed to .getCenter().");return this.getCenter(t)},empty:function e(){console.warn("THREE.Box3: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function e(t){console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(t)},isIntersectionSphere:function e(t){console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(t)},size:function e(t){console.warn("THREE.Box3: .size() has been renamed to .getSize().");return this.getSize(t)}});Za.prototype.center=function(e){console.warn("THREE.Line3: .center() has been renamed to .getCenter().");return this.getCenter(e)};Object.assign(Qt,{random16:function e(){console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead.");return Math.random()},nearestPowerOfTwo:function e(t){console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo().");return Qt.floorPowerOfTwo(t)},nextPowerOfTwo:function e(t){console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo().");return Qt.ceilPowerOfTwo(t)}});Object.assign(ii.prototype,{flattenToArrayOffset:function e(t,i){console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(t,i)},multiplyVector3:function e(t){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return t.applyMatrix3(this)},multiplyVector3Array:function e(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function e(t){console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead.");return this.applyToBufferAttribute(t)},applyToVector3Array:function e(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}});Object.assign($t.prototype,{extractPosition:function e(t){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(t)},flattenToArrayOffset:function e(t,i){console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(t,i)},getPosition:function(){var e;return function t(){if(e===undefined)e=new ti;console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");return e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function e(t){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(t)},multiplyToArray:function e(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function e(t){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead.");return t.applyMatrix4(this)},multiplyVector4:function e(t){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return t.applyMatrix4(this)},multiplyVector3Array:function e(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function e(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");t.transformDirection(this)},crossVector:function e(t){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return t.applyMatrix4(this)},translate:function e(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function e(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function e(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function e(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function e(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function e(t){console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead.");return this.applyToBufferAttribute(t)},applyToVector3Array:function e(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function e(t,i,r,n,a,s){console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead.");return this.makePerspective(t,i,n,r,a,s)}});va.prototype.isIntersectionLine=function(e){console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().");return this.intersectsLine(e)};ei.prototype.multiplyVector3=function(e){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return e.applyQuaternion(this)};Object.assign(qa.prototype,{isIntersectionBox:function e(t){console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(t)},isIntersectionPlane:function e(t){console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().");return this.intersectsPlane(t)},isIntersectionSphere:function e(t){console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(t)}});Object.assign(ul.prototype,{extractAllPoints:function e(t){console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead.");return this.extractPoints(t)},extrude:function e(t){console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead.");return new Eo(this,t)},makeGeometry:function e(t){console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead.");return new No(this,t)}});Object.assign(Kt.prototype,{fromAttribute:function e(t,i,r){console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(t,i,r)},distanceToManhattan:function e(t){console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo().");return this.manhattanDistanceTo(t)},lengthManhattan:function e(){console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()}});Object.assign(ti.prototype,{setEulerFromRotationMatrix:function e(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function e(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function e(t){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(t)},getScaleFromMatrix:function e(t){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(t)},getColumnFromMatrix:function e(t,i){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(i,t)},applyProjection:function e(t){console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead.");return this.applyMatrix4(t)},fromAttribute:function e(t,i,r){console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(t,i,r)},distanceToManhattan:function e(t){console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo().");return this.manhattanDistanceTo(t)},lengthManhattan:function e(){console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()}});Object.assign(ai.prototype,{fromAttribute:function e(t,i,r){console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(t,i,r)},lengthManhattan:function e(){console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()}});Aa.prototype.computeTangents=function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")};Object.assign(ba.prototype,{getChildByName:function e(t){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(t)},renderDepth:function e(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function e(t,i){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(i,t)}});Object.defineProperties(ba.prototype,{eulerOrder:{get:function e(){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");return this.rotation.order},set:function e(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");this.rotation.order=t}},useQuaternion:{get:function e(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function e(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Object.defineProperties(Vs.prototype,{objects:{get:function e(){console.warn("THREE.LOD: .objects has been renamed to .levels.");return this.levels}}});Object.defineProperty(Ws.prototype,"useVertexTexture",{get:function e(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function e(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}});Object.defineProperty(il.prototype,"__arcLengthDivisions",{get:function e(){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions.");return this.arcLengthDivisions},set:function e(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions.");this.arcLengthDivisions=t}});Is.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. "+"Use .setFocalLength and .filmGauge for a photographic setup.");if(t!==undefined)this.filmGauge=t;this.setFocalLength(e)};Object.defineProperties(uh.prototype,{onlyShadow:{set:function e(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function e(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov.");this.shadow.camera.fov=t}},shadowCameraLeft:{set:function e(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left.");this.shadow.camera.left=t}},shadowCameraRight:{set:function e(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right.");this.shadow.camera.right=t}},shadowCameraTop:{set:function e(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top.");this.shadow.camera.top=t}},shadowCameraBottom:{set:function e(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.");this.shadow.camera.bottom=t}},shadowCameraNear:{set:function e(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near.");this.shadow.camera.near=t}},shadowCameraFar:{set:function e(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far.");this.shadow.camera.far=t}},shadowCameraVisible:{set:function e(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function e(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias.");this.shadow.bias=t}},shadowDarkness:{set:function e(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function e(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.");this.shadow.mapSize.width=t}},shadowMapHeight:{set:function e(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.");this.shadow.mapSize.height=t}}});Object.defineProperties(La.prototype,{length:{get:function e(){console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead.");return this.array.length}}});Object.assign(ja.prototype,{addIndex:function e(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().");this.setIndex(t)},addDrawCall:function e(t,i,r){if(r!==undefined){console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.")}console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup().");this.addGroup(t,i)},clearDrawCalls:function e(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().");this.clearGroups()},computeTangents:function e(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function e(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}});Object.defineProperties(ja.prototype,{drawcalls:{get:function e(){console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups.");return this.groups}},offsets:{get:function e(){console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups.");return this.groups}}});Object.defineProperties(Rl.prototype,{dynamic:{set:function e(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function e(){console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead.");return this}}});Object.defineProperties(ca.prototype,{wrapAround:{get:function e(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function e(){console.warn("THREE.Material: .wrapAround has been removed.")}},wrapRGB:{get:function e(){console.warn("THREE.Material: .wrapRGB has been removed.");return new Ki}},shading:{get:function e(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function e(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.");this.flatShading=t===q}}});Object.defineProperties(Zo.prototype,{metal:{get:function e(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead.");return false},set:function e(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});Object.defineProperties(Ya.prototype,{derivatives:{get:function e(){console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");return this.extensions.derivatives},set:function e(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");this.extensions.derivatives=t}}});Object.assign(Bs.prototype,{getCurrentRenderTarget:function e(){console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget().");return this.getRenderTarget()},getMaxAnisotropy:function e(){console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy().");return this.capabilities.getMaxAnisotropy()},getPrecision:function e(){console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision.");return this.capabilities.precision},resetGLState:function e(){console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset().");return this.state.reset()},supportsFloatTextures:function e(){console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).");return this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function e(){console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).");return this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function e(){console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).");return this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function e(){console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).");return this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function e(){console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).");return this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function e(){console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).");return this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function e(){console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures.");return this.capabilities.vertexTextures},supportsInstancedArrays:function e(){console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).");return this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function e(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().");this.setScissorTest(t)},initMaterial:function e(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function e(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function e(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function e(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}});Object.defineProperties(Bs.prototype,{shadowMapEnabled:{get:function e(){return this.shadowMap.enabled},set:function e(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.");this.shadowMap.enabled=t}},shadowMapType:{get:function e(){return this.shadowMap.type},set:function e(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.");this.shadowMap.type=t}},shadowMapCullFace:{get:function e(){return this.shadowMap.cullFace},set:function e(t){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace.");this.shadowMap.cullFace=t}}});Object.defineProperties(ga.prototype,{cullFace:{get:function e(){return this.renderReverseSided?U:B},set:function e(t){var i=t!==B;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+i+".");this.renderReverseSided=i}}});Object.defineProperties(si.prototype,{wrapS:{get:function e(){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");return this.texture.wrapS},set:function e(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");this.texture.wrapS=t}},wrapT:{get:function e(){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");return this.texture.wrapT},set:function e(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");this.texture.wrapT=t}},magFilter:{get:function e(){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");return this.texture.magFilter},set:function e(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");this.texture.magFilter=t}},minFilter:{get:function e(){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");return this.texture.minFilter},set:function e(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");this.texture.minFilter=t}},anisotropy:{get:function e(){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");return this.texture.anisotropy},set:function e(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");this.texture.anisotropy=t}},offset:{get:function e(){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");return this.texture.offset},set:function e(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");this.texture.offset=t}},repeat:{get:function e(){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");return this.texture.repeat},set:function e(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");this.texture.repeat=t}},format:{get:function e(){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");return this.texture.format},set:function e(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");this.texture.format=t}},type:{get:function e(){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");return this.texture.type},set:function e(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");this.texture.type=t}},generateMipmaps:{get:function e(){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");return this.texture.generateMipmaps},set:function e(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");this.texture.generateMipmaps=t}}});wl.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;var i=new gl;i.load(e,function(e){t.setBuffer(e)});return this};Ml.prototype.getData=function(){console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData().");return this.getFrequencyData()};_l.prototype.updateCubeMap=function(e,t){console.warn("THREE.CubeCamera: .updateCubeMap() is now .update().");return this.update(e,t)};var Jc={merge:function e(t,i,r){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var n;if(i.isMesh){i.matrixAutoUpdate&&i.updateMatrix();n=i.matrix;i=i.geometry}t.merge(i,n,r)},center:function e(t){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return t.center()}};var Qc={crossOrigin:undefined,loadTexture:function e(t,i,r,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var a=new ch;a.setCrossOrigin(this.crossOrigin);var s=a.load(t,r,undefined,n);if(i)s.mapping=i;return s},loadTextureCube:function e(t,i,r,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var a=new lh;a.setCrossOrigin(this.crossOrigin);var s=a.load(t,r,undefined,n);if(i)s.mapping=i;return s},loadCompressedTexture:function e(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function e(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};function Kc(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project().");e.project(t)};this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");e.unproject(t)};this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}}function $c(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");this.domElement=new wx.createCanvas;this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}}var eu=Object.freeze({WebGLRenderTargetCube:oi,WebGLRenderTarget:si,WebGLRenderer:Bs,ShaderLib:na,UniformsLib:$i,UniformsUtils:er,ShaderChunk:ra,FogExp2:Us,Fog:Ds,Scene:Fs,LensFlare:js,Sprite:Hs,LOD:Vs,SkinnedMesh:Ys,Skeleton:Ws,Bone:Xs,Mesh:Qa,LineSegments:Js,LineLoop:Qs,Line:Zs,Points:$s,Group:eo,VideoTexture:to,DataTexture:hi,CompressedTexture:io,CubeTexture:li,CanvasTexture:oa,DepthTexture:ro,Texture:ni,CompressedTextureLoader:sh,DataTextureLoader:oh,CubeTextureLoader:lh,TextureLoader:ch,ObjectLoader:Gh,MaterialLoader:Bh,BufferGeometryLoader:Uh,DefaultLoadingManager:rh,LoadingManager:ih,JSONLoader:jh,ImageLoader:hh,FontLoader:pl,FileLoader:ah,Loader:Fh,Cache:th,AudioLoader:gl,SpotLightShadow:ph,SpotLight:vh,PointLight:mh,RectAreaLight:xh,HemisphereLight:fh,DirectionalLightShadow:gh,DirectionalLight:yh,AmbientLight:_h,LightShadow:dh,Light:uh,StereoCamera:yl,PerspectiveCamera:Is,OrthographicCamera:Ta,CubeCamera:_l,ArrayCamera:Ps,Camera:Ma,AudioListener:xl,PositionalAudio:bl,AudioContext:ml,AudioAnalyser:Ml,Audio:wl,VectorKeyframeTrack:Lh,StringKeyframeTrack:Ph,QuaternionKeyframeTrack:Rh,NumberKeyframeTrack:Ih,ColorKeyframeTrack:kh,BooleanKeyframeTrack:Oh,PropertyMixer:Tl,PropertyBinding:Sl,KeyframeTrack:Nh,AnimationUtils:wh,AnimationObjectGroup:Al,AnimationMixer:Cl,AnimationClip:zh,Uniform:Rl,InstancedBufferGeometry:Il,BufferGeometry:ja,Geometry:Aa,InterleavedBufferAttribute:Pl,InstancedInterleavedBuffer:kl,InterleavedBuffer:Ol,InstancedBufferAttribute:Nl,Face3:Ea,Object3D:ba,Raycaster:zl,Layers:xa,EventDispatcher:O,Clock:Dl,QuaternionLinearInterpolant:Ch,LinearInterpolant:Th,DiscreteInterpolant:Eh,CubicInterpolant:Mh,Interpolant:bh,Triangle:Ja,Math:Qt,Spherical:Fl,Cylindrical:jl,Plane:va,Frustum:ma,Sphere:pa,Ray:qa,Matrix4:$t,Matrix3:ii,Box3:da,Box2:aa,Line3:Za,Euler:_a,Vector4:ai,Vector3:ti,Vector2:Kt,Quaternion:ei,Color:Ki,ImmediateRenderObject:Gl,VertexNormalsHelper:Hl,SpotLightHelper:Vl,SkeletonHelper:Xl,PointLightHelper:Yl,RectAreaLightHelper:ql,HemisphereLightHelper:Zl,GridHelper:Jl,PolarGridHelper:Ql,FaceNormalsHelper:Kl,DirectionalLightHelper:$l,CameraHelper:ec,BoxHelper:tc,Box3Helper:ic,PlaneHelper:rc,ArrowHelper:sc,AxesHelper:oc,CatmullRomCurve3:dc,CubicBezierCurve3:pc,QuadraticBezierCurve3:vc,LineCurve3:mc,ArcCurve:gc,EllipseCurve:al,SplineCurve:sl,CubicBezierCurve:ol,QuadraticBezierCurve:hl,LineCurve:rl,Shape:ul,Path:cl,ShapePath:fl,Font:dl,CurvePath:nl,Curve:il,ShapeUtils:To,SceneUtils:yc,WebGLUtils:zs,WireframeGeometry:no,ParametricGeometry:ao,ParametricBufferGeometry:so,TetrahedronGeometry:lo,TetrahedronBufferGeometry:co,OctahedronGeometry:uo,OctahedronBufferGeometry:fo,IcosahedronGeometry:po,IcosahedronBufferGeometry:vo,DodecahedronGeometry:mo,DodecahedronBufferGeometry:go,PolyhedronGeometry:oo,PolyhedronBufferGeometry:ho,TubeGeometry:yo,TubeBufferGeometry:_o,TorusKnotGeometry:xo,TorusKnotBufferGeometry:wo,TorusGeometry:bo,TorusBufferGeometry:Mo,TextGeometry:Ao,TextBufferGeometry:Lo,SphereGeometry:Co,SphereBufferGeometry:Ro,RingGeometry:Io,RingBufferGeometry:Po,PlaneGeometry:Va,PlaneBufferGeometry:Wa,LatheGeometry:Oo,LatheBufferGeometry:ko,ShapeGeometry:No,ShapeBufferGeometry:zo,ExtrudeGeometry:Eo,ExtrudeBufferGeometry:So,EdgesGeometry:Bo,ConeGeometry:Fo,ConeBufferGeometry:jo,CylinderGeometry:Uo,CylinderBufferGeometry:Do,CircleGeometry:Go,CircleBufferGeometry:Ho,BoxGeometry:Ga,BoxBufferGeometry:Ha,ShadowMaterial:Wo,SpriteMaterial:Gs,RawShaderMaterial:Xo,ShaderMaterial:Ya,PointsMaterial:Ks,MeshPhysicalMaterial:qo,MeshStandardMaterial:Yo,MeshPhongMaterial:Zo,MeshToonMaterial:Jo,MeshNormalMaterial:Qo,MeshLambertMaterial:Ko,MeshDepthMaterial:ua,MeshDistanceMaterial:fa,MeshBasicMaterial:Xa,LineDashedMaterial:$o,LineBasicMaterial:qs,Material:ca,Float64BufferAttribute:Ba,Float32BufferAttribute:za,Uint32BufferAttribute:Na,Int32BufferAttribute:ka,Uint16BufferAttribute:Oa,Int16BufferAttribute:Pa,Uint8ClampedBufferAttribute:Ia,Uint8BufferAttribute:Ra,Int8BufferAttribute:Ca,BufferAttribute:La,REVISION:k,MOUSE:N,CullFaceNone:z,CullFaceBack:B,CullFaceFront:U,CullFaceFrontBack:D,FrontFaceDirectionCW:F,FrontFaceDirectionCCW:j,BasicShadowMap:G,PCFShadowMap:H,PCFSoftShadowMap:V,FrontSide:W,BackSide:X,DoubleSide:Y,FlatShading:q,SmoothShading:Z,NoColors:J,FaceColors:Q,VertexColors:K,NoBlending:$,NormalBlending:ee,AdditiveBlending:te,SubtractiveBlending:ie,MultiplyBlending:re,CustomBlending:ne,AddEquation:ae,SubtractEquation:se,ReverseSubtractEquation:oe,MinEquation:he,MaxEquation:le,ZeroFactor:ce,OneFactor:ue,SrcColorFactor:fe,OneMinusSrcColorFactor:de,SrcAlphaFactor:pe,OneMinusSrcAlphaFactor:ve,DstAlphaFactor:me,OneMinusDstAlphaFactor:ge,DstColorFactor:ye,OneMinusDstColorFactor:_e,SrcAlphaSaturateFactor:xe,NeverDepth:we,AlwaysDepth:be,LessDepth:Me,LessEqualDepth:Te,EqualDepth:Ee,GreaterEqualDepth:Se,GreaterDepth:Ae,NotEqualDepth:Le,MultiplyOperation:Ce,MixOperation:Re,AddOperation:Ie,NoToneMapping:Pe,LinearToneMapping:Oe,ReinhardToneMapping:ke,Uncharted2ToneMapping:Ne,CineonToneMapping:ze,UVMapping:Be,CubeReflectionMapping:Ue,CubeRefractionMapping:De,EquirectangularReflectionMapping:Fe,EquirectangularRefractionMapping:je,SphericalReflectionMapping:Ge,CubeUVReflectionMapping:He,CubeUVRefractionMapping:Ve,RepeatWrapping:We,ClampToEdgeWrapping:Xe,MirroredRepeatWrapping:Ye,NearestFilter:qe,NearestMipMapNearestFilter:Ze,NearestMipMapLinearFilter:Je,LinearFilter:Qe,LinearMipMapNearestFilter:Ke,LinearMipMapLinearFilter:$e,UnsignedByteType:et,ByteType:tt,ShortType:it,UnsignedShortType:rt,IntType:nt,UnsignedIntType:at,FloatType:st,HalfFloatType:ot,UnsignedShort4444Type:ht,UnsignedShort5551Type:lt,UnsignedShort565Type:ct,UnsignedInt248Type:ut,AlphaFormat:ft,RGBFormat:dt,RGBAFormat:pt,LuminanceFormat:vt,LuminanceAlphaFormat:mt,RGBEFormat:gt,DepthFormat:yt,DepthStencilFormat:_t,RGB_S3TC_DXT1_Format:xt,RGBA_S3TC_DXT1_Format:wt,RGBA_S3TC_DXT3_Format:bt,RGBA_S3TC_DXT5_Format:Mt,RGB_PVRTC_4BPPV1_Format:Tt,RGB_PVRTC_2BPPV1_Format:Et,RGBA_PVRTC_4BPPV1_Format:St,RGBA_PVRTC_2BPPV1_Format:At,RGB_ETC1_Format:Lt,LoopOnce:Ct,LoopRepeat:Rt,LoopPingPong:It,InterpolateDiscrete:Pt,InterpolateLinear:Ot,InterpolateSmooth:kt,ZeroCurvatureEnding:Nt,ZeroSlopeEnding:zt,WrapAroundEnding:Bt,TrianglesDrawMode:Ut,TriangleStripDrawMode:Dt,TriangleFanDrawMode:Ft,LinearEncoding:jt,sRGBEncoding:Gt,GammaEncoding:Ht,RGBEEncoding:Vt,LogLuvEncoding:Wt,RGBM7Encoding:Xt,RGBM16Encoding:Yt,RGBDEncoding:qt,BasicDepthPacking:Zt,RGBADepthPacking:Jt,CubeGeometry:Ga,Face4:_c,LineStrip:xc,LinePieces:wc,MeshFaceMaterial:bc,MultiMaterial:Mc,PointCloud:Tc,Particle:Ec,ParticleSystem:Sc,PointCloudMaterial:Ac,ParticleBasicMaterial:Lc,ParticleSystemMaterial:Cc,Vertex:Rc,DynamicBufferAttribute:Ic,Int8Attribute:Pc,Uint8Attribute:Oc,Uint8ClampedAttribute:kc,Int16Attribute:Nc,Uint16Attribute:zc,Int32Attribute:Bc,Uint32Attribute:Uc,Float32Attribute:Dc,Float64Attribute:Fc,ClosedSplineCurve3:jc,SplineCurve3:Gc,Spline:Hc,AxisHelper:Vc,BoundingBoxHelper:Wc,EdgesHelper:Xc,WireframeHelper:Yc,XHRLoader:qc,BinaryTextureLoader:Zc,GeometryUtils:Jc,ImageUtils:Qc,Projector:Kc,CanvasRenderer:$c});var tu=function(e){w(t,e);function t(e,i){g(this,t);var r=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r.facade=jd.getInstance();r.name=e;r.data=i;return r}y(t,[{key:"onRegister",value:function e(){}},{key:"onRemove",value:function e(){}},{key:"handleNotification",value:function e(t){}},{key:"listNotificationInterests",value:function e(){return[]}},{key:"sendNotification",value:function e(t,i,r){this.facade.sendNotification(t,i,r)}}]);return t}(ba);var iu=function e(t,i){var r=new ni;r.image=i.getFile(t).file;r.repeat.copy(new Kt(1,1));r.offset.copy(new Kt(0,0));r.wrapS=We;r.wrapT=We;r.needsUpdate=true;return r};var ru=function e(t,i){var r=Math.PI*2;var n=(i-t)%r;if(n!=n%Math.PI){n=n<0?n+r:n-r}return n};var nu=function e(t){var i=Math.PI*2;if(t!=t%Math.PI){t=t<0?t+i:t-i}return t};var au=function e(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))};var su=function e(t){var i=t.width,r=i===undefined?32:i,n=t.height,a=n===undefined?32:n,s=t.text,o=s===undefined?"":s,h=t.size,l=h===undefined?12:h,c=t.font,u=c===undefined?"Arial":c;var f=new wx.createCanvas;var d=f.getContext("2d");var p=au(r);var v=au(a);f.width=p;f.height=v;d.font=l+"px "+u;d.clearRect(0,0,p,v);d.fillStyle="#ffffff";d.fillText(o,0,l);return f};var ou=function e(t){return zh.parse(t)};var hu={Assest:{zip:{sound:{}}}};var lu=function(){var e={};var t={};var i=0;return{getAll:function t(){return Object.keys(e).map(function(t){return e[t]})},removeAll:function t(){e={}},add:function i(r){e[r.getId()]=r;t[r.getId()]=r},remove:function i(r){delete e[r.getId()];delete t[r.getId()]},update:function i(r,n){var a=Object.keys(e);if(a.length===0){return false}r=r!==undefined?r:lu.now();while(a.length>0){t={};for(var s=0;s<a.length;s++){if(e[a[s]].update(r)===false&&!n){delete e[a[s]]}}a=Object.keys(t)}return true},nextId:function e(){return i++}}}();if(typeof window==="undefined"&&typeof process!=="undefined"){lu.now=function(){var e=process.hrtime();return e[0]*1e3+e[1]/1e6}}else if(typeof window!=="undefined"&&window.performance!==undefined&&window.performance.now!==undefined){lu.now=window.performance.now.bind(window.performance)}else if(Date.now!==undefined){lu.now=Date.now}else{lu.now=function(){return(new Date).getTime()}}lu.now=function(){return Date.now()};function cu(e,t){var i=Object.keys(t);var r=i.length;for(var n=0;n<r;n+=1){e[i[n]]=t[i[n]]}return e}lu.Tween=function(e){this._object=e;this._valuesStart={};this._valuesEnd={};this._valuesStartRepeat={};this._duration=1e3;this._repeat=0;this._repeatDelayTime=undefined;this._yoyo=false;this._isPlaying=false;this._reversed=false;this._delayTime=0;this._startTime=null;this._easingFunction=lu.Easing.Linear.None;this._interpolationFunction=lu.Interpolation.Linear;this._chainedTweens=[];this._onStartCallback=null;this._onStartCallbackFired=false;this._onUpdateCallback=null;this._onCompleteCallback=null;this._onStopCallback=null;this._id=lu.nextId()};lu.Tween.prototype=cu(Object.create(Object.prototype),{getId:function e(){return this._id},to:function e(t,i){this._valuesEnd=t;if(i!==undefined){this._duration=i}return this},start:function e(t){lu.add(this);this._isPlaying=true;this._onStartCallbackFired=false;this._startTime=t!==undefined?t:lu.now();this._startTime+=this._delayTime;for(var i in this._valuesEnd){if(this._valuesEnd[i]instanceof Array){if(this._valuesEnd[i].length===0){continue}this._valuesEnd[i]=[this._object[i]].concat(this._valuesEnd[i])}if(this._object[i]===undefined){continue}this._valuesStart[i]=this._object[i];if(this._valuesStart[i]instanceof Array===false){this._valuesStart[i]*=1}this._valuesStartRepeat[i]=this._valuesStart[i]||0}return this},stop:function e(){if(!this._isPlaying){return this}lu.remove(this);this._isPlaying=false;if(this._onStopCallback!==null){this._onStopCallback.call(this._object,this._object)}this.stopChainedTweens();return this},end:function e(){this.update(this._startTime+this._duration);return this},stopChainedTweens:function e(){for(var t=0,i=this._chainedTweens.length;t<i;t++){this._chainedTweens[t].stop()}},delay:function e(t){this._delayTime=t;return this},repeat:function e(t){this._repeat=t;return this},repeatDelay:function e(t){this._repeatDelayTime=t;return this},yoyo:function e(t){this._yoyo=t;return this},easing:function e(t){this._easingFunction=t;return this},interpolation:function e(t){this._interpolationFunction=t;return this},chain:function e(){this._chainedTweens=arguments;return this},onStart:function e(t){this._onStartCallback=t;return this},onUpdate:function e(t){this._onUpdateCallback=t;return this},onComplete:function e(t){this._onCompleteCallback=t;return this},onStop:function e(t){this._onStopCallback=t;return this},update:function e(t){var i;var r;var n;if(t<this._startTime){return true}if(this._onStartCallbackFired===false){if(this._onStartCallback!==null){this._onStartCallback.call(this._object,this._object)}this._onStartCallbackFired=true}r=(t-this._startTime)/this._duration;r=r>1?1:r;n=this._easingFunction(r);for(i in this._valuesEnd){if(this._valuesStart[i]===undefined){continue}var a=this._valuesStart[i]||0;var s=this._valuesEnd[i];if(s instanceof Array){this._object[i]=this._interpolationFunction(s,n)}else{if(typeof s==="string"){if(s.charAt(0)==="+"||s.charAt(0)==="-"){s=a+parseFloat(s)}else{s=parseFloat(s)}}if(typeof s==="number"){this._object[i]=a+(s-a)*n}}}if(this._onUpdateCallback!==null){this._onUpdateCallback.call(this._object,n)}if(r===1){if(this._repeat>0){if(isFinite(this._repeat)){this._repeat--}for(i in this._valuesStartRepeat){if(typeof this._valuesEnd[i]==="string"){this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])}if(this._yoyo){var o=this._valuesStartRepeat[i];this._valuesStartRepeat[i]=this._valuesEnd[i];this._valuesEnd[i]=o}this._valuesStart[i]=this._valuesStartRepeat[i]}if(this._yoyo){this._reversed=!this._reversed}if(this._repeatDelayTime!==undefined){this._startTime=t+this._repeatDelayTime}else{this._startTime=t+this._delayTime}return true}else{if(this._onCompleteCallback!==null){this._onCompleteCallback.call(this._object,this._object)}for(var h=0,l=this._chainedTweens.length;h<l;h++){this._chainedTweens[h].start(this._startTime+this._duration)}return false}}return true}});lu.Easing={Linear:{None:function e(t){return t}},Quadratic:{In:function e(t){return t*t},Out:function e(t){return t*(2-t)},InOut:function e(t){if((t*=2)<1){return.5*t*t}return-.5*(--t*(t-2)-1)}},Cubic:{In:function e(t){return t*t*t},Out:function e(t){return--t*t*t+1},InOut:function e(t){if((t*=2)<1){return.5*t*t*t}return.5*((t-=2)*t*t+2)}},Quartic:{In:function e(t){return t*t*t*t},Out:function e(t){return 1- --t*t*t*t},InOut:function e(t){if((t*=2)<1){return.5*t*t*t*t}return-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function e(t){return t*t*t*t*t},Out:function e(t){return--t*t*t*t*t+1},InOut:function e(t){if((t*=2)<1){return.5*t*t*t*t*t}return.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function e(t){return 1-Math.cos(t*Math.PI/2)},Out:function e(t){return Math.sin(t*Math.PI/2)},InOut:function e(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function e(t){return t===0?0:Math.pow(1024,t-1)},Out:function e(t){return t===1?1:1-Math.pow(2,-10*t)},InOut:function e(t){if(t===0){return 0}if(t===1){return 1}if((t*=2)<1){return.5*Math.pow(1024,t-1)}return.5*(-Math.pow(2,-10*(t-1))+2)}},Circular:{In:function e(t){return 1-Math.sqrt(1-t*t)},Out:function e(t){return Math.sqrt(1- --t*t)},InOut:function e(t){if((t*=2)<1){return-.5*(Math.sqrt(1-t*t)-1)}return.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function e(t){if(t===0){return 0}if(t===1){return 1}return-Math.pow(2,10*(t-1))*Math.sin((t-1.1)*5*Math.PI)},Out:function e(t){if(t===0){return 0}if(t===1){return 1}return Math.pow(2,-10*t)*Math.sin((t-.1)*5*Math.PI)+1},InOut:function e(t){if(t===0){return 0}if(t===1){return 1}t*=2;if(t<1){return-.5*Math.pow(2,10*(t-1))*Math.sin((t-1.1)*5*Math.PI)}return.5*Math.pow(2,-10*(t-1))*Math.sin((t-1.1)*5*Math.PI)+1}},Back:{In:function e(t){var i=1.70158;return t*t*((i+1)*t-i)},Out:function e(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},InOut:function e(t){var i=1.70158*1.525;if((t*=2)<1){return.5*(t*t*((i+1)*t-i))}return.5*((t-=2)*t*((i+1)*t+i)+2)}},Bounce:{In:function e(t){return 1-lu.Easing.Bounce.Out(1-t)},Out:function e(t){if(t<1/2.75){return 7.5625*t*t}else if(t<2/2.75){return 7.5625*(t-=1.5/2.75)*t+.75}else if(t<2.5/2.75){return 7.5625*(t-=2.25/2.75)*t+.9375}else{return 7.5625*(t-=2.625/2.75)*t+.984375}},InOut:function e(t){if(t<.5){return lu.Easing.Bounce.In(t*2)*.5}return lu.Easing.Bounce.Out(t*2-1)*.5+.5}}};lu.Interpolation={Linear:function e(t,i){var r=t.length-1;var n=r*i;var a=Math.floor(n);var s=lu.Interpolation.Utils.Linear;if(i<0){return s(t[0],t[1],n)}if(i>1){return s(t[r],t[r-1],r-n)}return s(t[a],t[a+1>r?r:a+1],n-a)},Bezier:function e(t,i){var r=0;var n=t.length-1;var a=Math.pow;var s=lu.Interpolation.Utils.Bernstein;for(var o=0;o<=n;o++){r+=a(1-i,n-o)*a(i,o)*t[o]*s(n,o)}return r},CatmullRom:function e(t,i){var r=t.length-1;var n=r*i;var a=Math.floor(n);var s=lu.Interpolation.Utils.CatmullRom;if(t[0]===t[r]){if(i<0){a=Math.floor(n=r*(1+i))}return s(t[(a-1+r)%r],t[a],t[(a+1)%r],t[(a+2)%r],n-a)}else{if(i<0){return t[0]-(s(t[0],t[0],t[1],t[1],-n)-t[0])}if(i>1){return t[r]-(s(t[r],t[r],t[r-1],t[r-1],n-r)-t[r])}return s(t[a?a-1:0],t[a],t[r<a+1?r:a+1],t[r<a+2?r:a+2],n-a)}},Utils:{Linear:function e(t,i,r){return(i-t)*r+t},Bernstein:function e(t,i){var r=lu.Interpolation.Utils.Factorial;return r(t)/r(i)/r(t-i)},Factorial:function(){var e=[1];return function(t){var i=1;if(e[t]){return e[t]}for(var r=t;r>1;r--){i*=r}e[t]=i;return i}}(),CatmullRom:function e(t,i,r,n,a){var s=(r-t)*.5;var o=(n-i)*.5;var h=a*a;var l=a*h;return(2*i-2*r+s+o)*l+(-3*i+3*r-2*s-o)*h+s*a+i}}};var uu=function(e){w(t,e);function t(e,i){g(this,t);return b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i))}y(t,[{key:"onRegister",value:function e(){this._update=this._update.bind(this);this._enging=this.facade.retrieveProxy("engine");this._enging.addLayer(this);var i=new Xa({color:65280});this._res=hu.Assest.zip.loader;var r=this._mask=new Hs(new Gs({map:iu("mask.jpg",this._res),color:16777215}));r.material.transparent=true;r.scale.set(64,64,1);r.position.z=20;this.add(r);this._mask.visible=false;this.sendNotification(t.INIT)}},{key:"onRemove",value:function e(){this._enging.removeLayer(this)}},{key:"handleNotification",value:function e(i){var r=this;switch(i.name){case P.STAGE_RESIZE:this._mask.scale.set(i.body.width,i.body.height,1);break;case t.INIT:this._mask.material.opacity=1;this._mask.material.needsUpdate=true;this._mask.visible=false;break;case t.START:this._mask.material.opacity=1;this._mask.material.needsUpdate=true;this._mask.visible=true;createjs.Tween.get(this._mask.material).to({opacity:0},i.body).call(function(){r.sendNotification(t.COMMPLETE,t.START);r._mask.visible=false;r.remove(r._mask)}).on("change",this._update);break;case t.END:this._mask.material.opacity=0;this._mask.material.needsUpdate=true;this._mask.visible=true;createjs.Tween.get(this._mask.material).to({opacity:1},i.body).call(function(){r.sendNotification(t.COMMPLETE,t.END)}).on("change",this._update);break}}},{key:"_update",value:function e(){this._mask.material.needsUpdate=true}},{key:"listNotificationInterests",value:function e(){return[P.STAGE_RESIZE,t.INIT,t.START,t.END]}}]);return t}(tu);uu.INIT="mask_init";uu.START="mask_start";uu.END="mask_end";uu.COMMPLETE="mask_complete";var fu={NoBlending:$,NormalBlending:ee,AdditiveBlending:te,SubtractiveBlending:ie,MultiplyBlending:re,CustomBlending:ne};function du(e,t,i,r,n,a,s){s=s||"";var o=new ni;if(a){var h=a.getFile(s+e);if(h){o.image=h.file}}if(t)o.repeat.fromArray(t);if(i)o.offset.fromArray(i);if(r!==undefined){if(r[0]==="repeat")o.wrapS=We;if(r[0]==="mirror")o.wrapS=Ye;if(r[1]==="repeat")o.wrapT=We;if(r[1]==="mirror")o.wrapT=Ye}if(n!==undefined){o.anisotropy=n}o.needsUpdate=true;return o}var pu={};var vu=function e(t,i,r){var n=eu[t.type];var a=new n;if(t.uuid!==undefined)a.uuid=t.uuid;if(t.name!==undefined)a.name=t.name;if(t.color!==undefined)a.color.setHex(t.color);if(t.roughness!==undefined)a.roughness=t.roughness;if(t.metalness!==undefined)a.metalness=t.metalness;if(t.emissive!==undefined)a.emissive.setHex(t.emissive);if(t.specular!==undefined)a.specular.setHex(t.specular);if(t.shininess!==undefined)a.shininess=t.shininess;if(t.clearCoat!==undefined)a.clearCoat=t.clearCoat;if(t.clearCoatRoughness!==undefined)a.clearCoatRoughness=t.clearCoatRoughness;if(t.uniforms!==undefined)a.uniforms=t.uniforms;if(t.vertexShader!==undefined)a.vertexShader=t.vertexShader;if(t.fragmentShader!==undefined)a.fragmentShader=t.fragmentShader;if(t.vertexColors!==undefined)a.vertexColors=t.vertexColors;if(t.fog!==undefined)a.fog=t.fog;if(t.shading!==undefined)a.shading=t.shading;if(t.blending!==undefined)a.blending=t.blending;if(t.side!==undefined)a.side=t.side;if(t.opacity!==undefined)a.opacity=t.opacity;if(t.transparent!==undefined)a.transparent=t.transparent;if(t.alphaTest!==undefined)a.alphaTest=t.alphaTest;if(t.depthTest!==undefined)a.depthTest=t.depthTest;if(t.depthWrite!==undefined)a.depthWrite=t.depthWrite;if(t.colorWrite!==undefined)a.colorWrite=t.colorWrite;if(t.wireframe!==undefined)a.wireframe=t.wireframe;if(t.wireframeLinewidth!==undefined)a.wireframeLinewidth=t.wireframeLinewidth;if(t.wireframeLinecap!==undefined)a.wireframeLinecap=t.wireframeLinecap;if(t.wireframeLinejoin!==undefined)a.wireframeLinejoin=t.wireframeLinejoin;if(t.skinning!==undefined)a.skinning=t.skinning;if(t.morphTargets!==undefined)a.morphTargets=t.morphTargets;if(t.size!==undefined)a.size=t.size;if(t.sizeAttenuation!==undefined)a.sizeAttenuation=t.sizeAttenuation;if(t.map!==undefined)a.map=t.map;if(t.alphaMap!==undefined){a.alphaMap=t.alphaMap;a.transparent=true}if(t.bumpMap!==undefined)a.bumpMap=t.bumpMap;if(t.bumpScale!==undefined)a.bumpScale=t.bumpScale;if(t.normalMap!==undefined)a.normalMap=t.normalMap;if(t.normalScale!==undefined){var s=t.normalScale;if(Array.isArray(s)===false){s=[s,s]}a.normalScale=(new Vector2).fromArray(s)}if(t.displacementMap!==undefined)a.displacementMap=t.displacementMap;if(t.displacementScale!==undefined)a.displacementScale=t.displacementScale;if(t.displacementBias!==undefined)a.displacementBias=t.displacementBias;if(t.roughnessMap!==undefined)a.roughnessMap=t.roughnessMap;if(t.metalnessMap!==undefined)a.metalnessMap=t.metalnessMap;if(t.emissiveMap!==undefined)a.emissiveMap=t.emissiveMap;if(t.emissiveIntensity!==undefined)a.emissiveIntensity=t.emissiveIntensity;if(t.specularMap!==undefined)a.specularMap=t.specularMap;if(t.envMap!==undefined)a.envMap=t.envMap;if(t.reflectivity!==undefined)a.reflectivity=t.reflectivity;if(t.lightMap!==undefined)a.lightMap=t.lightMap;if(t.lightMapIntensity!==undefined)a.lightMapIntensity=t.lightMapIntensity;if(t.aoMap!==undefined)a.aoMap=t.aoMap;if(t.aoMapIntensity!==undefined)a.aoMapIntensity=t.aoMapIntensity;if(t.gradientMap!==undefined)a.gradientMap=t.gradientMap;if(t.materials!==undefined){for(var o=0,h=t.materials.length;o<h;o++){a.materials.push(pu.createMaterial(t.materials[o],i,r))}}return a};pu.createMaterial=function(e,t,i){var r={uuid:Qt.generateUUID(),type:"MeshLambertMaterial"};var n=new Ki;for(var a in e){var s=e[a];switch(a){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":r.name=s;break;case"blending":r.blending=fu[s];break;case"colorAmbient":case"mapAmbient":break;case"colorDiffuse":r.color=n.fromArray(s).getHex();break;case"colorSpecular":r.specular=n.fromArray(s).getHex();break;case"colorEmissive":r.emissive=n.fromArray(s).getHex();break;case"specularCoef":r.shininess=s;break;case"shading":if(s.toLowerCase()==="basic")r.type="MeshBasicMaterial";if(s.toLowerCase()==="phong")r.type="MeshPhongMaterial";if(s.toLowerCase()==="standard")r.type="MeshStandardMaterial";break;case"mapDiffuse":r.map=du(s,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy,t,i);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":r.emissiveMap=du(s,e.mapEmissiveRepeat,e.mapEmissiveOffset,e.mapEmissiveWrap,e.mapEmissiveAnisotropy,t,i);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":r.lightMap=du(s,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy,t,i);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":r.aoMap=du(s,e.mapAORepeat,e.mapAOOffset,e.mapAOWrap,e.mapAOAnisotropy,t,i);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":r.bumpMap=du(s,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy,t,i);break;case"mapBumpScale":r.bumpScale=s;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":r.normalMap=du(s,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy,t,i);break;case"mapNormalFactor":r.normalScale=[s,s];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":r.specularMap=du(s,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy,t,i);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":r.metalnessMap=du(s,e.mapMetalnessRepeat,e.mapMetalnessOffset,e.mapMetalnessWrap,e.mapMetalnessAnisotropy,t,i);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":r.roughnessMap=du(s,e.mapRoughnessRepeat,e.mapRoughnessOffset,e.mapRoughnessWrap,e.mapRoughnessAnisotropy,t,i);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":r.alphaMap=du(s,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy,t,i);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":r.side=X;break;case"doubleSided":r.side=Y;break;case"transparency":r.opacity=s;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":r[a]=s;break;case"vertexColors":if(s===true)r.vertexColors=K;if(s==="face")r.vertexColors=Q;break;default:break}}if(r.type==="MeshBasicMaterial")delete r.emissive;if(r.type!=="MeshPhongMaterial")delete r.specular;if(r.opacity<1)r.transparent=true;return vu(r,t,i)};pu.createMaterial1=function(e,t){var i={uuid:Qt.generateUUID(),type:"MeshLambertMaterial"};var r=new Ki;for(var n in e){var a=e[n];switch(n){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":i.name=a;break;case"blending":i.blending=fu[a];break;case"colorAmbient":case"mapAmbient":break;case"colorDiffuse":i.color=r.fromArray(a).getHex();break;case"colorSpecular":i.specular=r.fromArray(a).getHex();break;case"colorEmissive":i.emissive=r.fromArray(a).getHex();break;case"specularCoef":i.shininess=a;break;case"shading":if(a.toLowerCase()==="basic")i.type="MeshBasicMaterial";if(a.toLowerCase()==="phong")i.type="MeshPhongMaterial";if(a.toLowerCase()==="standard")i.type="MeshStandardMaterial";break;case"mapDiffuse":i.map=du(a,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy,t,path);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":i.emissiveMap=du(a,e.mapEmissiveRepeat,e.mapEmissiveOffset,e.mapEmissiveWrap,e.mapEmissiveAnisotropy,t,path);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":i.lightMap=du(a,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy,t,path);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":i.aoMap=du(a,e.mapAORepeat,e.mapAOOffset,e.mapAOWrap,e.mapAOAnisotropy,t,path);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":i.bumpMap=du(a,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy,t,path);break;case"mapBumpScale":i.bumpScale=a;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":i.normalMap=du(a,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy,t,path);break;case"mapNormalFactor":i.normalScale=[a,a];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":i.specularMap=du(a,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy,t,path);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":i.metalnessMap=du(a,e.mapMetalnessRepeat,e.mapMetalnessOffset,e.mapMetalnessWrap,e.mapMetalnessAnisotropy,t,path);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":i.roughnessMap=du(a,e.mapRoughnessRepeat,e.mapRoughnessOffset,e.mapRoughnessWrap,e.mapRoughnessAnisotropy,t,path);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":i.alphaMap=du(a,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy,t,path);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":i.side=X;break;case"doubleSided":i.side=Y;break;case"transparency":i.opacity=a;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":i[n]=a;break;case"vertexColors":if(a===true)i.vertexColors=K;if(a==="face")i.vertexColors=Q;break;default:break}}if(i.type==="MeshBasicMaterial")delete i.emissive;if(i.type!=="MeshPhongMaterial")delete i.specular;if(i.opacity<1)i.transparent=true;return vu(i,t,path)};var mu={};var gu=function e(t,i){return t&1<<i};var yu=function e(t,i,r){var n,a,s,o,h,l,c,u,f,d,p,v,m,g,y,_,x,w,b,M,T,E,S,A,L,C,R,I=t.faces,P=t.vertices,O=t.normals,k=t.colors,N=0;if(t.uvs!==undefined){for(n=0;n<t.uvs.length;n++){if(t.uvs[n].length)N++}for(n=0;n<N;n++){i.faceVertexUvs[n]=[]}}o=0;h=P.length;while(o<h){w=new ti;w.x=P[o++]*r;w.y=P[o++]*r;w.z=P[o++]*r;i.vertices.push(w)}o=0;h=I.length;while(o<h){d=I[o++];p=gu(d,0);v=gu(d,1);m=gu(d,3);g=gu(d,4);y=gu(d,5);_=gu(d,6);x=gu(d,7);if(p){M=new Ea;M.a=I[o];M.b=I[o+1];M.c=I[o+3];T=new Ea;T.a=I[o+1];T.b=I[o+2];T.c=I[o+3];o+=4;if(v){f=I[o++];M.materialIndex=f;T.materialIndex=f}s=i.faces.length;if(m){for(n=0;n<N;n++){A=t.uvs[n];i.faceVertexUvs[n][s]=[];i.faceVertexUvs[n][s+1]=[];for(a=0;a<4;a++){u=I[o++];C=A[u*2];R=A[u*2+1];L=new Kt(C,R);if(a!==2)i.faceVertexUvs[n][s].push(L);if(a!==0)i.faceVertexUvs[n][s+1].push(L)}}}if(g){c=I[o++]*3;M.normal.set(O[c++],O[c++],O[c]);T.normal.copy(M.normal)}if(y){for(n=0;n<4;n++){c=I[o++]*3;S=new ti(O[c++],O[c++],O[c]);if(n!==2)M.vertexNormals.push(S);if(n!==0)T.vertexNormals.push(S)}}if(_){l=I[o++];E=k[l];M.color.setHex(E);T.color.setHex()}if(x){for(n=0;n<4;n++){l=I[o++];E=k[l];if(n!==2)M.vertexColors.push(new Ki(E));if(n!==0)T.vertexColors.push(new Ki(E))}}i.faces.push(M);i.faces.push(T)}else{b=new Ea;b.a=I[o++];b.b=I[o++];b.c=I[o++];if(v){f=I[o++];b.materialIndex=f}s=i.faces.length;if(m){for(n=0;n<N;n++){A=t.uvs[n];i.faceVertexUvs[n][s]=[];for(a=0;a<3;a++){u=I[o++];C=A[u*2];R=A[u*2+1];L=new Kt(C,R);i.faceVertexUvs[n][s].push(L)}}}if(g){c=I[o++]*3;b.normal.set(O[c++],O[c++],O[c])}if(y){for(n=0;n<3;n++){c=I[o++]*3;S=new ti(O[c++],O[c++],O[c]);b.vertexNormals.push(S)}}if(_){l=I[o++];b.color.setHex(k[l])}if(x){for(n=0;n<3;n++){l=I[o++];b.vertexColors.push(new Ki(k[l]))}}i.faces.push(b)}}};var _u=function e(t,i){var r=t.influencesPerVertex!==undefined?t.influencesPerVertex:2;if(t.skinWeights){for(var n=0,a=t.skinWeights.length;n<a;n+=r){var s=t.skinWeights[n];var o=r>1?t.skinWeights[n+1]:0;var h=r>2?t.skinWeights[n+2]:0;var l=r>3?t.skinWeights[n+3]:0;i.skinWeights.push(new ai(s,o,h,l))}}if(t.skinIndices){for(var n=0,a=t.skinIndices.length;n<a;n+=r){var c=t.skinIndices[n];var u=r>1?t.skinIndices[n+1]:0;var f=r>2?t.skinIndices[n+2]:0;var d=r>3?t.skinIndices[n+3]:0;i.skinIndices.push(new ai(c,u,f,d))}}i.bones=t.bones;if(i.bones&&i.bones.length>0&&(i.skinWeights.length!==i.skinIndices.length||i.skinIndices.length!==i.vertices.length)){console.warn("When skinning, number of vertices ("+i.vertices.length+"), skinIndices ("+i.skinIndices.length+"), and skinWeights ("+i.skinWeights.length+") should match.")}};var xu=function e(t,i,r){if(t.morphTargets!==undefined){for(var n=0,a=t.morphTargets.length;n<a;n++){i.morphTargets[n]={};i.morphTargets[n].name=t.morphTargets[n].name;i.morphTargets[n].vertices=[];var s=i.morphTargets[n].vertices;var o=t.morphTargets[n].vertices;for(var h=0,l=o.length;h<l;h+=3){var c=new ti;c.x=o[h]*r;c.y=o[h+1]*r;c.z=o[h+2]*r;s.push(c)}}}if(t.morphColors!==undefined&&t.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');var u=i.faces;var f=t.morphColors[0].colors;for(var n=0,a=u.length;n<a;n++){u[n].color.fromArray(f,n*3)}}};var wu=function e(t,i){var r=[];var n=[];if(t.animation!==undefined){n.push(t.animation)}if(t.animations!==undefined){if(t.animations.length){n=n.concat(t.animations)}else{n.push(t.animations)}}for(var a=0;a<n.length;a++){var s=zh.parseAnimation(n[a],i.bones);if(s)r.push(s)}if(i.morphTargets){var o=zh.CreateClipsFromMorphTargetSequences(i.morphTargets,t.FPS===undefined?10:t.FPS);r=r.concat(o)}if(r.length>0)i.animations=r};mu.parseSync=function(e,t){var i=new Promise(function(e,t){run.start()});return i};mu.getGeometry=function(e){var t=new Aa,i=e.scale!==undefined?1/e.scale:1;yu(e,t,i);_u(e,t);xu(e,t,i);wu(e,t);t.computeFaceNormals();t.computeBoundingSphere();return t};mu.parse=function(e,t,i){var r=new Aa,n=e.scale!==undefined?1/e.scale:1;yu(e,r,n);_u(e,r);xu(e,r,n);wu(e,r);r.computeFaceNormals();r.computeBoundingSphere();if(e.materials===undefined||e.materials.length===0){return{geometry:r}}else{var a=[];for(var s=0;s<e.materials.length;++s){a[s]=pu.createMaterial(e.materials[s],t,i)}return{geometry:r,materials:a}}};var bu=function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";var n={};for(var a=0;a<t.length;a++){n[t[a].uuid]=i.getFile(r+t[a].url).file}return n};function Mu(e,t){if(typeof e==="number")return e;console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e);return t[e]}var Tu={RepeatWrapping:We,ClampToEdgeWrapping:Xe,MirroredRepeatWrapping:Ye};var Eu={UVMapping:Be,CubeReflectionMapping:Ue,CubeRefractionMapping:De,EquirectangularReflectionMapping:Fe,EquirectangularRefractionMapping:je,SphericalReflectionMapping:Ge,CubeUVReflectionMapping:He,CubeUVRefractionMapping:Ve};var Su={NearestFilter:qe,NearestMipMapNearestFilter:Ze,NearestMipMapLinearFilter:Je,LinearFilter:Qe,LinearMipMapNearestFilter:Ke,LinearMipMapLinearFilter:$e};var Au=function e(t,i){var r={};for(var n=0;n<t.length;n++){var a=t[n];var s=t[n]=new ni(i[a.image]);s.needsUpdate=true;s.uuid=a.uuid;if(a.name!==undefined)s.name=a.name;if(a.mapping!==undefined)s.mapping=Mu(a.mapping,Eu);if(a.offset!==undefined)s.offset.fromArray(a.offset);if(a.repeat!==undefined)s.repeat.fromArray(a.repeat);if(a.wrap!==undefined){s.wrapS=Mu(a.wrap[0],Tu);s.wrapT=Mu(a.wrap[1],Tu)}if(a.minFilter!==undefined)s.minFilter=Mu(a.minFilter,Su);if(a.magFilter!==undefined)s.magFilter=Mu(a.magFilter,Su);if(a.anisotropy!==undefined)s.anisotropy=a.anisotropy;if(a.flipY!==undefined)s.flipY=a.flipY;r[a.uuid]=s}return r};var Lu=function e(t){var i={};var r=eu;if(t!==undefined){for(var n=0,a=t.length;n<a;n++){var s;var o=t[n];switch(o.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new r[o.type](o.width,o.height,o.widthSegments,o.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":s=new r[o.type](o.width,o.height,o.depth,o.widthSegments,o.heightSegments,o.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new r[o.type](o.radius,o.segments,o.thetaStart,o.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new r[o.type](o.radiusTop,o.radiusBottom,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new r[o.type](o.radius,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new r[o.type](o.radius,o.widthSegments,o.heightSegments,o.phiStart,o.phiLength,o.thetaStart,o.thetaLength);break;case"DodecahedronGeometry":case"IcosahedronGeometry":case"OctahedronGeometry":case"TetrahedronGeometry":s=new r[o.type](o.radius,o.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new r[o.type](o.innerRadius,o.outerRadius,o.thetaSegments,o.phiSegments,o.thetaStart,o.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new r[o.type](o.radius,o.tube,o.radialSegments,o.tubularSegments,o.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new r[o.type](o.radius,o.tube,o.tubularSegments,o.radialSegments,o.p,o.q);break;case"LatheGeometry":case"LatheBufferGeometry":s=new r[o.type](o.points,o.segments,o.phiStart,o.phiLength);break;case"BufferGeometry":s=Pu(o);break;case"Geometry":s=mu.getGeometry(o.data);break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+o.type+'"');continue}s.uuid=o.uuid;if(o.name!==undefined)s.name=o.name;i[o.uuid]=s}}return i};var Cu=function e(t,i,r){var n=new $t;function a(e){if(i[e]===undefined){console.warn("THREE.ObjectLoader: Undefined geometry",e)}return i[e]}function s(e){if(e===undefined)return undefined;if(Array.isArray(e)){var t=[];for(var i=0,n=e.length;i<n;i++){var a=e[i];if(r[a]===undefined){console.warn("THREE.ObjectLoader: Undefined material",a)}t.push(r[a])}return t}if(r[e]===undefined){console.warn("THREE.ObjectLoader: Undefined material",e)}return r[e]}var o;switch(t.type){case"Scene":o=new Fs;if(t.background!==undefined){if(Number.isInteger(t.background)){o.background=new Color(t.background)}}if(t.fog!==undefined){if(t.fog.type==="Fog"){o.fog=new Ds(t.fog.color,t.fog.near,t.fog.far)}else if(t.fog.type==="FogExp2"){o.fog=new Us(t.fog.color,t.fog.density)}}break;case"PerspectiveCamera":o=new Is(t.fov,t.aspect,t.near,t.far);if(t.focus!==undefined)o.focus=t.focus;if(t.zoom!==undefined)o.zoom=t.zoom;if(t.filmGauge!==undefined)o.filmGauge=t.filmGauge;if(t.filmOffset!==undefined)o.filmOffset=t.filmOffset;if(t.view!==undefined)o.view=Object.assign({},t.view);break;case"OrthographicCamera":o=new Ta(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":o=new _h(t.color,t.intensity);break;case"DirectionalLight":o=new yh(t.color,t.intensity);break;case"PointLight":o=new mh(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":o=new xh(t.color,t.intensity,t.width,t.height);break;case"SpotLight":o=new vh(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":o=new fh(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var h=a(t.geometry);var l=s(t.material);if(h.bones&&h.bones.length>0){o=new Ys(h,l)}else{o=new Qa(h,l)}break;case"LOD":o=new Vs;break;case"Line":o=new Zs(a(t.geometry),s(t.material),t.mode);break;case"LineLoop":o=new Qs(a(t.geometry),s(t.material));break;case"LineSegments":o=new Js(a(t.geometry),s(t.material));break;case"PointCloud":case"Points":o=new $s(a(t.geometry),s(t.material));break;case"Sprite":o=new Hs(s(t.material));break;case"Group":o=new eo;break;default:o=new ba}o.uuid=t.uuid;if(t.name!==undefined)o.name=t.name;if(t.matrix!==undefined){n.fromArray(t.matrix);n.decompose(o.position,o.quaternion,o.scale)}else{if(t.position!==undefined)o.position.fromArray(t.position);if(t.rotation!==undefined)o.rotation.fromArray(t.rotation);if(t.quaternion!==undefined)o.quaternion.fromArray(t.quaternion);if(t.scale!==undefined)o.scale.fromArray(t.scale)}if(t.castShadow!==undefined)o.castShadow=t.castShadow;if(t.receiveShadow!==undefined)o.receiveShadow=t.receiveShadow;if(t.shadow){if(t.shadow.bias!==undefined)o.shadow.bias=t.shadow.bias;if(t.shadow.radius!==undefined)o.shadow.radius=t.shadow.radius;if(t.shadow.mapSize!==undefined)o.shadow.mapSize.fromArray(t.shadow.mapSize);if(t.shadow.camera!==undefined)o.shadow.camera=e(t.shadow.camera)}if(t.visible!==undefined)o.visible=t.visible;if(t.userData!==undefined)o.userData=t.userData;if(t.children!==undefined){for(var c in t.children){o.add(e(t.children[c],i,r))}}if(t.type==="LOD"){var u=t.levels;for(var f=0;f<u.length;f++){var d=u[f];var c=o.getObjectByProperty("uuid",d.object);if(c!==undefined){o.addLevel(c,d.distance)}}}return o};var Ru=function e(t,i){var r={};function n(e){if(i[e]===undefined){console.warn("THREE.MaterialLoader: Undefined texture",e)}return i[e]}for(var a=0;a<t.length;a++){var s=t[a];var o=new eu[s.type];if(s.uuid!==undefined)o.uuid=s.uuid;if(s.name!==undefined)o.name=s.name;if(s.color!==undefined)o.color.setHex(s.color);if(s.roughness!==undefined)o.roughness=s.roughness;if(s.metalness!==undefined)o.metalness=s.metalness;if(s.emissive!==undefined)o.emissive.setHex(s.emissive);if(s.specular!==undefined)o.specular.setHex(s.specular);if(s.shininess!==undefined)o.shininess=s.shininess;if(s.clearCoat!==undefined)o.clearCoat=s.clearCoat;if(s.clearCoatRoughness!==undefined)o.clearCoatRoughness=s.clearCoatRoughness;if(s.uniforms!==undefined)o.uniforms=s.uniforms;if(s.vertexShader!==undefined)o.vertexShader=s.vertexShader;if(s.fragmentShader!==undefined)o.fragmentShader=s.fragmentShader;if(s.vertexColors!==undefined)o.vertexColors=s.vertexColors;if(s.fog!==undefined)o.fog=s.fog;if(s.shading!==undefined)o.shading=s.shading;if(s.blending!==undefined)o.blending=s.blending;if(s.side!==undefined)o.side=s.side;if(s.opacity!==undefined)o.opacity=s.opacity;if(s.transparent!==undefined)o.transparent=s.transparent;if(s.alphaTest!==undefined)o.alphaTest=s.alphaTest;if(s.depthTest!==undefined)o.depthTest=s.depthTest;if(s.depthWrite!==undefined)o.depthWrite=s.depthWrite;if(s.colorWrite!==undefined)o.colorWrite=s.colorWrite;if(s.wireframe!==undefined)o.wireframe=s.wireframe;if(s.wireframeLinewidth!==undefined)o.wireframeLinewidth=s.wireframeLinewidth;if(s.wireframeLinecap!==undefined)o.wireframeLinecap=s.wireframeLinecap;if(s.wireframeLinejoin!==undefined)o.wireframeLinejoin=s.wireframeLinejoin;if(s.skinning!==undefined)o.skinning=s.skinning;if(s.morphTargets!==undefined)o.morphTargets=s.morphTargets;if(s.size!==undefined)o.size=s.size;if(s.sizeAttenuation!==undefined)o.sizeAttenuation=s.sizeAttenuation;if(s.map!==undefined)o.map=n(s.map);if(s.alphaMap!==undefined){o.alphaMap=n(s.alphaMap);o.transparent=true}if(s.bumpMap!==undefined)o.bumpMap=n(s.bumpMap);if(s.bumpScale!==undefined)o.bumpScale=s.bumpScale;if(s.normalMap!==undefined)o.normalMap=n(s.normalMap);if(s.normalScale!==undefined){var h=s.normalScale;if(Array.isArray(h)===false){h=[h,h]}o.normalScale=(new Vector2).fromArray(h)}if(s.displacementMap!==undefined)o.displacementMap=n(s.displacementMap);if(s.displacementScale!==undefined)o.displacementScale=s.displacementScale;if(s.displacementBias!==undefined)o.displacementBias=s.displacementBias;if(s.roughnessMap!==undefined)o.roughnessMap=n(s.roughnessMap);if(s.metalnessMap!==undefined)o.metalnessMap=n(s.metalnessMap);if(s.emissiveMap!==undefined)o.emissiveMap=n(s.emissiveMap);if(s.emissiveIntensity!==undefined)o.emissiveIntensity=s.emissiveIntensity;if(s.specularMap!==undefined)o.specularMap=n(s.specularMap);if(s.envMap!==undefined)o.envMap=n(s.envMap);if(s.reflectivity!==undefined)o.reflectivity=s.reflectivity;if(s.lightMap!==undefined)o.lightMap=n(s.lightMap);if(s.lightMapIntensity!==undefined)o.lightMapIntensity=s.lightMapIntensity;if(s.aoMap!==undefined)o.aoMap=n(s.aoMap);if(s.aoMapIntensity!==undefined)o.aoMapIntensity=s.aoMapIntensity;if(s.gradientMap!==undefined)o.gradientMap=n(s.gradientMap);r[s.uuid]=o;o.side=Y;o.needsUpdate=true}return r};var Iu={Int8Array:Int8Array,Uint8Array:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};var Pu=function e(t){var i=new ja;var r=t.data.index;if(r!==undefined){var n=new Iu[r.type](r.array);i.setIndex(new La(n,1))}var a=t.data.attributes;for(var s in a){var o=a[s];var n=new Iu[o.type](o.array);i.addAttribute(s,new La(n,o.itemSize,o.normalized))}var h=t.data.groups||t.data.drawcalls||t.data.offsets;if(h!==undefined){for(var l=0,c=h.length;l!==c;++l){var u=h[l];i.addGroup(u.start,u.count,u.materialIndex)}}var f=t.data.boundingSphere;if(f!==undefined){var d=new ti;if(f.center!==undefined){d.fromArray(f.center)}i.boundingSphere=new pa(d,f.radius)}return i};var Ou=function(){function e(){g(this,e)}y(e,null,[{key:"paser",value:function e(t,i,r){if(t.images){var n=bu(t.images,i,r);var a=Au(t.textures,n)}var s=Ru(t.materials,a);var o=Lu(t.geometries);var h=Cu(t.object,o,s);return{scene:h,geometries:o,materials:s}}}]);return e}();var ku=function(e){w(t,e);function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"x";g(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));i._type=e;i.init();i.openAge=0;i.isOpen=false;i.isClose=false;i.isRotation=true;return i}y(t,[{key:"init",value:function e(){this._engine=jd.getInstance().retrieveProxy("engine");this.mouse=new Kt;this.tid=-1;this.lock=[0];this._point={x:0,y:0};this.age=0;this._res=hu.Assest.zip.loader;this._sprite=new Hs(new Gs({map:iu("mask.jpg",this._res),color:16777215}));this._sprite.material.transparent=true;this._sprite.material.opacity=0;this._sprite.scale.set(250,250,1);this.add(this._sprite);this.hitObject=this._sprite;this.identifier=-1;this._moveSound=hu.Assest.zip.sound["int_ending_landsend_finaldragger_rocks_01"];this._moveSound.loop=true}},{key:"onTouchEnd",value:function e(t){if(this.identifier!=t.changedTouches[0].identifier)return;this.point={x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY};this.update({rx:t.changedTouches[0].clientX,ry:t.changedTouches[0].clientY});this.identifier=-1;if(this.target){this.target.children[1].children[0].children[0].material.color;var i=new lu.Tween(this.target.children[1].children[0].children[0].material.color).to({r:.17647058823529413,g:.3137254901960784,b:.4470588235294118},500);i.start()}this.isEnabled=false}},{key:"onTouchStart",value:function e(t){if(!this.isRotation){this.isEnabled=false;return}if(this.identifier!=-1)return;var i=t.changedTouches[0];this.identifier=i.identifier;this.mouse.x=i.clientX/window.innerWidth*2-1;this.mouse.y=-(i.clientY/window.innerHeight)*2+1;var r=this._engine.getHitObject(this.mouse,[this._sprite]);if(r.length>0){this.isEnabled=true;this._scenePoint=this._engine.toScreenPosition(this);this.point={x:i.clientX,y:i.clientY};var n=Math.atan2(this.point.x,this.point.y);this.target.rotation[this._type]+=n>0?.05:-.05;this.age=n-this.target.rotation[this._type];if(this.target){this.target.children[1].children[0].children[0].material.color;var a=new lu.Tween(this.target.children[1].children[0].children[0].material.color).to({r:1,g:1,b:1},500);a.start()}}}},{key:"onTouchMove",value:function e(t){if(!this.isRotation){this.isEnabled=false;return}if(this.identifier!=t.changedTouches[0].identifier)return;if(this.isEnabled){var i=t.changedTouches[0];if(this.identifier!=i.identifier)return;if(this._moveSound.paused){this._moveSound.volume=0;this._moveSound.play();var r=new lu.Tween(this._moveSound).to({volume:1},2e3);r.onComplete(function(){});r.start()}this.update({rx:i.clientX,ry:i.clientY})}}},{key:"update",value:function e(t){var i=t.rx,r=t.ry;if(isNaN(i)||isNaN(r))return;this.target.rotation[this._type]=nu(Math.atan2(this._scenePoint.x-i,this._scenePoint.y-r)-this.age);var n=this.target.rotation[this._type];if(n>this.layerTarget.min&&n<this.layerTarget.max){this.layerTarget.target.position.set(this.layerTarget.n.x,this.layerTarget.n.y,this.layerTarget.n.z)}else{this.layerTarget.target.position.set(this.layerTarget.o.x,this.layerTarget.o.y,this.layerTarget.o.z)}var a=(new ti).applyMatrix4(this.player.currentItem.matrixWorld);this.layerTarget.target.updateMatrixWorld();this.player.upPos(a)}},{key:"target",set:function e(t){this._target=t},get:function e(){return this._target}},{key:"point",set:function e(t){this._scenePoint=this._engine.toScreenPosition(this.hitObject);this._point.x=this._scenePoint.x-t.x;this._point.y=this._scenePoint.y-t.y;this.age=Math.atan2(this._point.x,this._point.y)-this.target.rotation[this._type]},get:function e(){return this._point}},{key:"isEnabled",set:function e(t){var i=this;if(!t){var r=Math.PI;var n=0;for(var a=0;a<this.lock.length;a++){var s=this.lock[a];var o=this.target.rotation[this._type];var h=Math.abs(ru(o,s));if(r>Math.abs(h)){r=h;n=s}}if(this._tw){lu.remove(this._tw);this._tw.stop()}this._tw=new lu.Tween(this.target.rotation);this.target.rotation.count=1;var l={};var c=this.target.rotation[this._type];c+=ru(c,n);l[this._type]=c;var u=new lu.Tween(this._moveSound).to({volume:0},2e3);u.onComplete(function(){i._moveSound.pause()});u.start();l.count=0;this._tw.to(l,300);this._tw.start();this._moveSound.loop=false;this._tw.onUpdate(function(){});this._tw.onComplete(function(){i.target.rotation[i._type]=n;i._isEnabled=t;i.isOpen=i.openAge==n})}else{this._isEnabled=t}},get:function e(){return this._isEnabled}},{key:"isRotation",set:function e(t){if(t==this.isRotation)return;this._isRotation=t;if(this.target){var i=[this.target.children[1].children[0],this.target.children[1].children[1],this.target.children[1].children[4],this.target.children[1].children[5]];var r=[this.target.children[1].children[2],this.target.children[1].children[3]];for(var n=0;n<r.length;n++){if(!t){var a=new lu.Tween(r[n].scale).to({y:.3},300);a.start()}else{var a=new lu.Tween(r[n].scale).to({y:1},300);a.start()}}var s=[{x:0,y:0,z:70},{x:0,y:0,z:-70},{x:0,y:70,z:0},{x:0,y:-70,z:0}];for(var n=0;n<i.length;n++){var o=i[n];if(o.old===undefined){o.old=o.position.clone()}o.offs=o.old.clone();o.offs.x+=s[n].x;o.offs.y+=s[n].y;o.offs.z+=s[n].z;if(!t){var a=o.tw=new lu.Tween(o.position).to({x:o.offs.x,y:o.offs.y,z:o.offs.z},300);a.start()}else{var a=o.tw=new lu.Tween(o.position).to({x:o.old.x,y:o.old.y,z:o.old.z},300);a.start()}}}},get:function e(){return this._isRotation}}]);return t}(ba);var Nu=function(e){w(t,e);function t(e){g(this,t);return b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}y(t,[{key:"onRegister",value:function e(){this._width=0;this._height=0;this._scenes=[];this._render=this._render.bind(this);this._update=this._update.bind(this);this._isRender=false}},{key:"onRemove",value:function e(){}},{key:"initializeEngine",value:function e(){this._clock=new Dl;this._clock.start=function(){this.startTime=(new Date).getTime();this.oldTime=this.startTime;this.elapsedTime=0;this.running=true};this._clock.getDelta=function(){var e=0;if(this.autoStart&&!this.running){this.start();return 0}if(this.running){var t=(new Date).getTime();e=(t-this.oldTime)/1e3;this.oldTime=t;this.elapsedTime+=e}return e};this._renderer=new Bs({canvas:this.canvas,precision:"highp",alpha:false,antialias:true});this._renderer.setClearColor(16777215,0);this._ratio=1.5;this._renderer.setPixelRatio(this._ratio);var i=this._camera=new Ta(-window.innerWidth/2,window.innerWidth/2,window.innerHeight/2,-window.innerHeight/2,1,2e5);i.position.z=99999;this.raycaster=new zl;var r=new Gs({color:0});r.opacity=0;var n=new Hs(r);this._mask=n;this._mask.position.z=9e3;this._renderer.autoClear=false;var a=1334;var s=750;this._width=window.innerWidth;this._height=window.innerHeight;this._renderer.setSize(window.innerWidth,window.innerHeight);this.createLayer(2);this._scene.add(this._mask);this.createComposer();this._render();this.sendNotification(t.INITIALIZE,{camera:this._camera,scenes:this._scene})}},{key:"createComposer",value:function e(){return}},{key:"show",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:500;if(t==0){this._mask.material.opacity=1;return{onComplete:function e(t){t||t()}}}return new lu.Tween(this._mask.material).to({opacity:1},t).start()}},{key:"hide",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:500;if(t==0){this._mask.material.opacity=0;return}var i=new lu.Tween(this._mask.material).to({opacity:0},t);i.start();return i}},{key:"createLayer",value:function e(t){var i=this._width;var r=this._height;for(var n=0;n<t;n++){var a=new Fs;this._scene=a;this._scene.background=new Ki(0);this._scenes.push(a)}this.onResize({width:this._width,height:this._height})}},{key:"addPass",value:function e(t){}},{key:"addLayer",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;if(this._scenes[i]){this._scenes[i].add(t)}else{while(this._scenes.length-1!=i){this.createLayer(1)}this.addLayer(t,i)}}},{key:"removeLayer",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;this._scene.remove(t)}},{key:"onResize",value:function e(t){var i=t.width,r=t.height;this._width=i;this._height=r;var n=this._camera;if(n){n.left=-i/2;n.right=i/2;n.top=r/2;n.bottom=-r/2;n.updateProjectionMatrix();this._renderer.setSize(i,r)}if(this._mask){this._mask.scale.set(i,r,1)}}},{key:"getHitObject",value:function e(t,i){if(!(t instanceof Kt)){t=new Kt(t.x,t.y)}this.raycaster.setFromCamera(t,this._camera);var r=[];if(i instanceof Array){r=this.raycaster.intersectObjects(i,true)}else{r=this.raycaster.intersectObject(i,true)}return r}},{key:"toScreenPosition",value:function e(t){var i=new ti;var r=.5*window.innerWidth;var n=.5*window.innerHeight;t.updateMatrixWorld();i.setFromMatrixPosition(t.matrixWorld);i.project(this._camera);i.x=i.x*r+r;i.y=-(i.y*n)+n;return{x:i.x,y:i.y}}},{key:"start",value:function e(){this._isRender=true;this._update()}},{key:"stop",value:function e(){cancelAnimationFrame(this._tid);this._isRender=false}},{key:"addItem",value:function e(t){if(t instanceof tu){this._scene.add(t);this._render()}}},{key:"removeItem",value:function e(t){if(t instanceof tu){this._scene.remove(t);this._render()}}},{key:"addUI",value:function e(t){if(t instanceof tu){this._2dscene.add(t);this._render()}}},{key:"removeUI",value:function e(t){if(t instanceof tu){this._2dscene.remove(t);this._render()}}},{key:"_update",value:function e(){this._render();if(this._isRender){this._tid=requestAnimationFrame(this._update)}}},{key:"_render",value:function e(i){if(!this._isRender)return;this._renderer.clear();this._renderer.render(this._scene,this._camera);lu.update();if(!i)this.sendNotification(t.DRAW,{camera:this._camera})}},{key:"canvas",set:function e(t){this._canvas=t},get:function e(){return this._canvas}}]);return t}(R);Nu.INITIALIZE="engine_initialize";Nu.DRAW="engine_draw";var zu=function(e){w(t,e);function t(){g(this,t);var e=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e.init();return e}y(t,[{key:"init",value:function e(){this._obj1=this.createSprite();this._obj1.visible=false;this.add(this._obj1);this.show(this._obj1,2e3)}},{key:"createSprite",value:function e(){var t=new ba;var i=new Gs({map:iu("MusicNote.png",hu.Assest.zip.loader),color:16777215});i.transparent=true;var r=new Hs(i);r.scale.set(256*.15,256*.15,1);t.add(r);t.materialTarget=i;return t}},{key:"show",value:function e(t,i){var r=this;t.visible=true;t.scale.set(.3,.3,.3);var n=new lu.Tween(t.scale).to({x:1,y:1,z:1},i);n.onStart(function(){});n.start();var a=new lu.Tween(t.position).to({x:-70,y:70,z:0},i);a.onUpdate(function(){var e=70-10;if(t.position.y<e){t.materialTarget.opacity=1}else{t.materialTarget.opacity=1-(t.position.y-e)/10}});a.onComplete(function(){if(r.parent){r.parent.remove(r)}});a.start()}}]);return t}(ba);var Bu=function(e){w(t,e);function t(){g(this,t);var e=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e.init();return e}y(t,[{key:"init",value:function e(){}},{key:"start",value:function e(){var t=this;clearInterval(this._cid);this._cid=setInterval(function(){var e=new zu;t.add(e)},1800)}},{key:"stop",value:function e(){clearInterval(this._cid)}}]);return t}(ba);var Uu=function e(t){this.manager=t!==undefined?t:rh};Object.assign(Uu.prototype,{load:function e(t,i,r,n){var a=this;var s=Fh.prototype.extractUrlBase(t);var o=new ah(this.manager);o.setResponseType("arraybuffer");o.load(t,function(e){try{var t=a.parse(e,s);i(t)}catch(e){}},r,n)},parse:function e(t,i){var r;if(Of(t)){r=(new Rf).parse(t)}else{var n=Gf(t);if(!kf(n)){throw new Error("THREE.FBXLoader: Unknown format.")}if(Nf(n)<7e3){throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Nf(n))}r=(new Cf).parse(n)}var a=Du(r);var s=Fu(r);var o=Gu(r,new ch(this.manager).setPath(i),s,a);var h=Xu(r,o,a);var l=Zu(r,a);var c=Qu(r,a,l);var u=cf(r,a,l,c,h);return u},parseObject:function e(t,i){var r=Du(t);var n=Fu(t);var a=Hu(t,i,n,r);var s=Xu(t,a,r);var o=Zu(t,r);var h=Qu(t,r,o);var l=cf(t,r,o,h,s);return l},parseZip:function e(t,i){var r;if(Of(t)){r=(new Rf).parse(t)}else{var n=Gf(t);if(!kf(n)){throw new Error("THREE.FBXLoader: Unknown format.")}if(Nf(n)<7e3){throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Nf(n))}r=(new Cf).parse(n)}var a=Du(r);var s=Fu(r);var o=Hu(r,i,s,a);var h=Xu(r,o,a);var l=Zu(r,a);var c=Qu(r,a,l);var u=cf(r,a,l,c,h);return u}});function Du(e){var t=new Map;if("Connections"in e){var i=e.Connections.properties.connections;for(var r=0,n=i.length;r<n;++r){var a=i[r];if(!t.has(a[0])){t.set(a[0],{parents:[],children:[]})}var s={ID:a[1],relationship:a[2]};t.get(a[0]).parents.push(s);if(!t.has(a[1])){t.set(a[1],{parents:[],children:[]})}var o={ID:a[0],relationship:a[2]};t.get(a[1]).children.push(o)}}return t}function Fu(e){var t=new Map;if("Video"in e.Objects.subNodes){var i=e.Objects.subNodes.Video;for(var r in i){var n=i[r];if("Content"in n.properties){var a=ju(i[r]);t.set(parseInt(r),a)}}}return t}function ju(e){var t=e.properties.Content;var i=e.properties.RelativeFilename||e.properties.Filename;var r=i.slice(i.lastIndexOf(".")+1).toLowerCase();var n;switch(r){case"bmp":n="image/bmp";break;case"jpg":n="image/jpeg";break;case"png":n="image/png";break;case"tif":n="image/tiff";break;default:return}if(typeof t==="string"){return"data:"+n+";base64,"+t}else{var a=new Uint8Array(t)}}function Gu(e,t,i,r){var n=new Map;if("Texture"in e.Objects.subNodes){var a=e.Objects.subNodes.Texture;for(var s in a){var o=Wu(a[s],t,i,r);n.set(parseInt(s),o)}}return n}function Hu(e,t,i,r){var n=new Map;if("Texture"in e.Objects.subNodes){var a=e.Objects.subNodes.Texture;for(var s in a){var o=Vu(a[s],t,i,r);n.set(parseInt(s),o)}}return n}function Vu(e,t,i,r){var n=e.id;var a=e.name;var s;var o=e.properties.FileName;var h=e.properties.RelativeFilename;var l=r.get(n).children;if(l!==undefined&&l.length>0&&i.has(l[0].ID)){s=i.get(l[0].ID)}else if(h!==undefined&&h[0]!=="/"&&h.match(/^[a-zA-Z]:/)===null){s=h}else{var c=o.split(/[\\\/]/);if(c.length>0){s=c[c.length-1]}else{s=o}}var u=new ni;if(t.getFile(s))u.image=t.getFile(s).file;u.name=a;u.FBX_ID=n;u.repeat.copy(new Kt(1,1));u.offset.copy(new Kt(0,0));u.wrapS=We;u.wrapT=We;u.needsUpdate=true;u.needsUpdate=true;return u}function Wu(e,t,i,r){var n=e.id;var a=e.name;var s;var o=e.properties.FileName;var h=e.properties.RelativeFilename;var l=r.get(n).children;if(l!==undefined&&l.length>0&&i.has(l[0].ID)){s=i.get(l[0].ID)}else if(h!==undefined&&h[0]!=="/"&&h.match(/^[a-zA-Z]:/)===null){s=h}else{var c=o.split(/[\\\/]/);if(c.length>0){s=c[c.length-1]}else{s=o}}var u=t.path;if(s.indexOf("blob:")===0||s.indexOf("data:")===0){t.setPath(undefined)}var f=t.load(s);f.name=a;f.FBX_ID=n;var d=e.properties.WrapModeU;var p=e.properties.WrapModeV;var v=d!==undefined?d.value:0;var m=p!==undefined?p.value:0;f.wrapS=v===0?We:Xe;f.wrapT=m===0?We:Xe;t.setPath(u);return f}function Xu(e,t,i){var r=new Map;if("Material"in e.Objects.subNodes){var n=e.Objects.subNodes.Material;for(var a in n){var s=Yu(n[a],t,i);if(s!==null)r.set(parseInt(a),s)}}return r}function Yu(e,t,i){var r=e.id;var n=e.attrName;var a=e.properties.ShadingModel;if((typeof a==="undefined"?"undefined":m(a))==="object"){a=a.value}if(!i.has(r))return null;var s=i.get(r).children;var o=qu(e.properties,t,s);var h;switch(a.toLowerCase()){case"phong":h=new Xa;break;case"lambert":h=new Xa;break;default:h=new Yo({color:3342591});break}h.setValues(o);h.name=n;h.needsUpdate=true;return h}function qu(e,t,i){var r={};if(e.Diffuse){r.color=Ff(e.Diffuse)}if(e.Specular){r.specular=Ff(e.Specular)}if(e.Shininess){r.shininess=e.Shininess.value}if(e.Emissive){r.emissive=Ff(e.Emissive)}if(e.EmissiveFactor){r.emissiveIntensity=e.EmissiveFactor.value}if(e.Opacity){r.opacity=e.Opacity.value}if(r.opacity<1){r.transparent=true}for(var n=0,a=i.length;n<a;++n){var s=i[n];var o=s.relationship;switch(o){case"DiffuseColor":case' "DiffuseColor':r.map=t.get(s.ID);break;case"Bump":case' "Bump':r.bumpMap=t.get(s.ID);break;case"NormalMap":case' "NormalMap':r.normalMap=t.get(s.ID);break;case"AmbientColor":case"EmissiveColor":case' "AmbientColor':case' "EmissiveColor':default:break}}return r}function Zu(e,t){var i={};if("Deformer"in e.Objects.subNodes){var r=e.Objects.subNodes.Deformer;for(var n in r){var a=r[n];if(a.attrType==="Skin"){var s=t.get(parseInt(n));var o=Ju(s,r);o.FBX_ID=parseInt(n);i[n]=o}}}return i}function Ju(e,t){var i={};var r=e.children;for(var n=0,a=r.length;n<a;++n){var s=r[n];var o=t[s.ID];var h={FBX_ID:s.ID,index:n,indices:[],weights:[],transform:jf(o.subNodes.Transform.properties.a),transformLink:jf(o.subNodes.TransformLink.properties.a),linkMode:o.properties.Mode};if("Indexes"in o.subNodes){h.indices=Uf(o.subNodes.Indexes.properties.a);h.weights=Bf(o.subNodes.Weights.properties.a)}i[s.ID]=h}return{map:i,bones:[]}}function Qu(e,t,i){var r=new Map;if("Geometry"in e.Objects.subNodes){var n=e.Objects.subNodes.Geometry;for(var a in n){var s=t.get(parseInt(a));var o=Ku(n[a],s,i);r.set(parseInt(a),o)}}return r}function Ku(e,t,i){switch(e.attrType){case"Mesh":return $u(e,t,i);break;case"NurbsCurve":return lf(e);break}}function $u(e,t,i){for(var r=0;r<t.children.length;++r){var n=i[t.children[r].ID];if(n!==undefined)break}return ef(e,n)}function ef(e,t){var i=new Lf;var r=e.subNodes;var n=Bf(r.Vertices.properties.a);var a=Uf(r.PolygonVertexIndex.properties.a);if(r.LayerElementNormal){var s=tf(r.LayerElementNormal[0])}if(r.LayerElementUV){var o=rf(r.LayerElementUV[0])}if(r.LayerElementColor){var h=nf(r.LayerElementColor[0])}if(r.LayerElementMaterial){var l=af(r.LayerElementMaterial[0])}var c={};if(t){var u=t.map;for(var f in u){var d=u[f];var p=d.indices;for(var v=0;v<p.length;v++){var m=p[v];var g=d.weights[v];if(c[m]===undefined)c[m]=[];c[m].push({id:d.index,weight:g})}}}var y=[];var _=0;var x=false;for(var w=0;w<a.length;w++){var b=a[w];var M=false;if(b<0){b=b^-1;a[w]=b;M=true}var T=new Ef;var E=[];var S=[];T.position.fromArray(n,b*3);if(t){if(c[b]!==undefined){var A=c[b];for(var v=0,L=A.length;v<L;v++){S.push(A[v].weight);E.push(A[v].id)}}if(S.length>4){if(!x){x=true}var C=[0,0,0,0];var R=[0,0,0,0];S.forEach(function(e,t){var i=e;var r=E[t];R.forEach(function(e,t,n){if(i>e){n[t]=i;i=e;var a=C[t];C[t]=r;r=a}})});E=C;S=R}for(var I=S.length;I<4;++I){S[I]=0;E[I]=0}T.skinWeights.fromArray(S);T.skinIndices.fromArray(E)}if(s){T.normal.fromArray(hf(w,_,b,s))}if(o){T.uv.fromArray(hf(w,_,b,o))}if(h){T.color.fromArray(hf(w,_,b,h))}y.push(T);if(M){var P=new Af;P.genTrianglesFromVertices(y);if(l!==undefined){var O=hf(w,_,b,l);P.materialIndex=O[0]}else{P.materialIndex=0}i.faces.push(P);y=[];_++;M=false}}var k=i.flattenToBuffers();var N=new ja;N.name=e.name;N.addAttribute("position",new za(k.vertexBuffer,3));if(k.normalBuffer.length>0){N.addAttribute("normal",new za(k.normalBuffer,3))}if(k.uvBuffer.length>0){N.addAttribute("uv",new za(k.uvBuffer,2))}if(r.LayerElementColor){N.addAttribute("color",new za(k.colorBuffer,3))}if(t){N.addAttribute("skinIndex",new za(k.skinIndexBuffer,4));N.addAttribute("skinWeight",new za(k.skinWeightBuffer,4));N.FBX_Deformer=t}var z=k.materialIndexBuffer;var B=z[0];var U=0;for(var I=0;I<z.length;++I){if(z[I]!==B){N.addGroup(U,I-U,B);B=z[I];U=I}}return N}function tf(e){var t=e.properties.MappingInformationType;var i=e.properties.ReferenceInformationType;var r=Bf(e.subNodes.Normals.properties.a);var n=[];if(i==="IndexToDirect"){if("NormalIndex"in e.subNodes){n=Uf(e.subNodes.NormalIndex.properties.a)}else if("NormalsIndex"in e.subNodes){n=Uf(e.subNodes.NormalsIndex.properties.a)}}return{dataSize:3,buffer:r,indices:n,mappingType:t,referenceType:i}}function rf(e){var t=e.properties.MappingInformationType;var i=e.properties.ReferenceInformationType;var r=Bf(e.subNodes.UV.properties.a);var n=[];if(i==="IndexToDirect"){n=Uf(e.subNodes.UVIndex.properties.a)}return{dataSize:2,buffer:r,indices:n,mappingType:t,referenceType:i}}function nf(e){var t=e.properties.MappingInformationType;var i=e.properties.ReferenceInformationType;var r=Bf(e.subNodes.Colors.properties.a);var n=[];if(i==="IndexToDirect"){n=Bf(e.subNodes.ColorIndex.properties.a)}return{dataSize:4,buffer:r,indices:n,mappingType:t,referenceType:i}}function af(e){var t=e.properties.MappingInformationType;var i=e.properties.ReferenceInformationType;if(t==="NoMappingInformation"){return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i}}var r=Uf(e.subNodes.Materials.properties.a);var n=[];for(var a=0,s=r.length;a<s;++a){n.push(a)}return{dataSize:1,buffer:r,indices:n,mappingType:t,referenceType:i}}var sf=[];var of={ByPolygonVertex:{Direct:function e(t,i,r,n){var a=t*n.dataSize;var s=t*n.dataSize+n.dataSize;return Yf(sf,n.buffer,a,s)},IndexToDirect:function e(t,i,r,n){var a=n.indices[t];var s=a*n.dataSize;var o=a*n.dataSize+n.dataSize;return Yf(sf,n.buffer,s,o)}},ByPolygon:{Direct:function e(t,i,r,n){var a=i*n.dataSize;var s=i*n.dataSize+n.dataSize;return Yf(sf,n.buffer,a,s)},IndexToDirect:function e(t,i,r,n){var a=n.indices[i];var s=a*n.dataSize;var o=a*n.dataSize+n.dataSize;return Yf(sf,n.buffer,s,o)}},ByVertice:{Direct:function e(t,i,r,n){var a=r*n.dataSize;var s=r*n.dataSize+n.dataSize;return Yf(sf,n.buffer,a,s)}},AllSame:{IndexToDirect:function e(t,i,r,n){var a=n.indices[0]*n.dataSize;var s=n.indices[0]*n.dataSize+n.dataSize;return Yf(sf,n.buffer,a,s)}}};function hf(e,t,i,r){return of[r.mappingType][r.referenceType](e,t,i,r)}function lf(e){if(eu.NURBSCurve===undefined){console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry.");return new ja}var t=parseInt(e.properties.Order);if(isNaN(t)){console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.properties.Order,e.id);return new ja}var i=t-1;var r=Bf(e.subNodes.KnotVector.properties.a);var n=[];var a=Bf(e.subNodes.Points.properties.a);for(var s=0,o=a.length;s<o;s+=4){n.push((new ai).fromArray(a,s))}var h,l;if(e.properties.Form==="Closed"){n.push(n[0])}else if(e.properties.Form==="Periodic"){h=i;l=r.length-1-h;for(var s=0;s<i;++s){n.push(n[s])}}var c=new eu.NURBSCurve(i,r,n,h,l);var u=c.getPoints(n.length*7);var f=new Float32Array(u.length*3);for(var s=0,o=u.length;s<o;++s){u[s].toArray(f,s*3)}var d=new ja;d.addAttribute("position",new La(f,3));return d}function cf(e,t,i,r,n){var a=new eo;var s=e.Objects.subNodes.Model;var o=[];var h=new Map;for(var l in s){var c=parseInt(l);var u=s[l];var f=t.get(c);var d=null;for(var p=0;p<f.parents.length;++p){for(var v in i){var m=i[v];var g=m.map;var y=g[f.parents[p].ID];if(y){var _=d;d=new Xs;m.bones[y.index]=d;if(_!==null)d.add(_)}}}if(!d){switch(u.attrType){case"Mesh":var x=null;var w=null;var b=[];for(var M=0,T=f.children.length;M<T;++M){var E=f.children[M];if(r.has(E.ID)){x=r.get(E.ID)}if(n.has(E.ID)){b.push(n.get(E.ID))}}if(b.length>1){w=b}else if(b.length>0){w=b[0]}else{w=new Yo({color:3342591});b.push(w)}if("color"in x.attributes){for(var S=0,A=b.length;S<A;++S){b[S].vertexColors=K}}if(x.FBX_Deformer){for(var L=0,C=b.length;L<C;++L){b[L].skinning=true}d=new Ys(x,w);x.computeVertexNormals();d.normalizeSkinWeights();d.pose();d.side=Y;d.updateMatrixWorld(true)}else{d=new Qa(x,w)}break;case"NurbsCurve":var x=null;for(var M=0,T=f.children.length;M<T;++M){var E=f.children[M];if(r.has(E.ID)){x=r.get(E.ID)}}w=new qs({color:3342591,linewidth:5});d=new Zs(x,w);break;default:d=new ba;break}}d.name=u.attrName.replace(/:/,"").replace(/_/,"").replace(/-/,"");d.FBX_ID=c;o.push(d);h.set(c,d)}for(var R=0,I=o.length;R<I;++R){var d=o[R];var u=s[d.FBX_ID];if("Lcl_Translation"in u.properties){d.position.fromArray(Bf(u.properties.Lcl_Translation.value))}if("Lcl_Rotation"in u.properties){var P=Bf(u.properties.Lcl_Rotation.value).map(Hf);P.push("ZYX");d.rotation.fromArray(P)}if("Lcl_Scaling"in u.properties){d.scale.fromArray(Bf(u.properties.Lcl_Scaling.value))}if("PreRotation"in u.properties){var O=(new _a).setFromVector3(Df(u.properties.PreRotation).multiplyScalar(Vf),"ZYX");O=(new ei).setFromEuler(O);var k=(new ei).setFromEuler(d.rotation);O.multiply(k);d.rotation.setFromQuaternion(O,"ZYX")}var f=t.get(d.FBX_ID);for(var N=0;N<f.parents.length;N++){var z=Wf(o,function(e){return e.FBX_ID===f.parents[N].ID});if(z>-1){o[z].add(d);break}}if(d.parent===null){a.add(d)}}a.updateMatrixWorld(true);var B=e.Objects.subNodes.Pose;for(var l in B){if(B[l].attrType==="BindPose"){B=B[l];break}}if(B){var U=B.subNodes.PoseNode;var D=new Map;for(var F=0,j=U.length;F<j;++F){var u=U[F];var G=jf(u.subNodes.Matrix.properties.a);D.set(parseInt(u.id),G)}}for(var v in i){var m=i[v];var g=m.map;for(var H in g){var y=g[H];var V=y.index;var W=m.bones[V];if(!D.has(W.FBX_ID)){break}var X=D.get(W.FBX_ID);W.matrixWorld.copy(X)}m.skeleton=new Ws(m.bones);var f=t.get(m.FBX_ID);var q=f.parents;for(var Z=0,J=q.length;Z<J;++Z){var Q=q[Z];if(r.has(Q.ID)){var $=Q.ID;var ee=t.get($);for(var p=0;p<ee.parents.length;++p){if(h.has(ee.parents[p].ID)){var d=h.get(ee.parents[p].ID);d.bind(m.skeleton,d.matrixWorld);break}}}}}a.updateMatrixWorld(true);a.skeleton={bones:o};var te=uf(e,t,a);gf(a,te);return a}function uf(e,t,i){var r=e.Objects.subNodes.AnimationCurveNode;var n=e.Objects.subNodes.AnimationCurve;var a=e.Objects.subNodes.AnimationLayer;var s=e.Objects.subNodes.AnimationStack;var o={curves:new Map,layers:{},stacks:{},length:0,fps:60,frames:0};var h=[];for(var l in r){if(l.match(/\d+/)){var c=ff(e,r[l],t,i);h.push(c)}}var u=new Map;for(var f=0;f<h.length;++f){if(h[f]===null){continue}u.set(h[f].id,h[f])}var d=[];for(l in n){if(l.match(/\d+/)){var p=df(n[l]);if(!t.has(p.id))continue;d.push(p);var v=t.get(p.id).parents[0];var m=v.ID;var g=v.relationship;var y="";if(g.match(/X/)){y="x"}else if(g.match(/Y/)){y="y"}else if(g.match(/Z/)){y="z"}else{continue}u.get(m).curves[y]=p}}u.forEach(function(e){var t=e.containerBoneID;if(!o.curves.has(t)){o.curves.set(t,{T:null,R:null,S:null})}o.curves.get(t)[e.attr]=e;if(e.attr==="R"){var i=e.curves;if(i.x===null){i.x={version:null,times:[0],values:[0]}}if(i.y===null){i.y={version:null,times:[0],values:[0]}}if(i.z===null){i.z={version:null,times:[0],values:[0]}}i.x.values=i.x.values.map(Hf);i.y.values=i.y.values.map(Hf);i.z.values=i.z.values.map(Hf);if(e.preRotations!==null){var r=(new _a).setFromVector3(e.preRotations,"ZYX");r=(new ei).setFromEuler(r);var n=new _a;var a=new ei;for(var s=0;s<i.x.times.length;++s){n.set(i.x.values[s],i.y.values[s],i.z.values[s],"ZYX");a.setFromEuler(n).premultiply(r);n.setFromQuaternion(a,"ZYX");i.x.values[s]=n.x;i.y.values[s]=n.y;i.z.values[s]=n.z}}}});for(var l in a){var _=[];var x=t.get(parseInt(l)).children;for(var w=0;w<x.length;w++){if(u.has(x[w].ID)){var b=u.get(x[w].ID);var M=b.containerBoneID;if(_[M]===undefined){_[M]={T:null,R:null,S:null}}_[M][b.attr]=b}}o.layers[l]=_}for(var l in s){var T=[];var x=t.get(parseInt(l)).children;var E={max:0,min:Number.MAX_VALUE};for(var w=0;w<x.length;++w){var S=o.layers[x[w].ID];if(S!==undefined){T.push(S);for(var A=0,L=S.length;A<L;++A){var _=S[A];if(_){pf(_,E)}}}}if(E.max>E.min){o.stacks[l]={name:s[l].attrName,layers:T,length:E.max-E.min,frames:(E.max-E.min)*60}}}return o}function ff(e,t,i,r){var n=e.Objects.subNodes.Model;var a={id:t.id,attr:t.attrName,internalID:t.id,attrX:false,attrY:false,attrZ:false,containerBoneID:-1,containerID:-1,curves:{x:null,y:null,z:null},preRotations:null};if(a.attr.match(/S|R|T/)){for(var s in t.properties){if(s.match(/X/)){a.attrX=true}if(s.match(/Y/)){a.attrY=true}if(s.match(/Z/)){a.attrZ=true}}}else{return null}var o=i.get(a.id);var h=o.parents;for(var l=h.length-1;l>=0;--l){var c=Wf(r.skeleton.bones,function(e){return e.FBX_ID===h[l].ID});if(c>-1){a.containerBoneID=c;a.containerID=h[l].ID;var u=n[a.containerID.toString()];if("PreRotation"in u.properties){a.preRotations=Df(u.properties.PreRotation).multiplyScalar(Math.PI/180)}break}}return a}function df(e){return{version:null,id:e.id,internalID:e.id,times:Bf(e.subNodes.KeyTime.properties.a).map(zf),values:Bf(e.subNodes.KeyValueFloat.properties.a),attrFlag:Uf(e.subNodes.KeyAttrFlags.properties.a),attrData:Bf(e.subNodes.KeyAttrDataFloat.properties.a)}}function pf(e,t){if(e.R){vf(e.R.curves,t)}if(e.S){vf(e.S.curves,t)}if(e.T){vf(e.T.curves,t)}}function vf(e,t){if(e.x){mf(e.x,t)}if(e.y){mf(e.y,t)}if(e.z){mf(e.z,t)}}function mf(e,t){t.max=e.times[e.times.length-1]>t.max?e.times[e.times.length-1]:t.max;t.min=e.times[0]<t.min?e.times[0]:t.min}function gf(e,t){if(e.animations===undefined){e.animations=[]}var i=t.stacks;for(var r in i){var n=i[r];var a={name:n.name,fps:60,length:n.length,hierarchy:[]};var s=e.skeleton.bones;for(var o=0,h=s.length;o<h;++o){var l=s[o];var c=l.name.replace(/.*:/,"");var u=Wf(s,function(e){return l.parent===e});a.hierarchy.push({parent:u,name:c,keys:[]})}for(var f=0;f<=n.frames;f++){for(var o=0,h=s.length;o<h;++o){var l=s[o];var d=o;var p=n.layers[0][d];for(var v=0,m=a.hierarchy.length;v<m;++v){var g=a.hierarchy[v];if(g.name===l.name){g.keys.push(xf(t,p,l,f))}}}}e.animations.push(zh.parseAnimation(a,s))}}var yf=new _a;var _f=new ei;function xf(e,t,i,r){var n={time:r/e.fps,pos:i.position.toArray(),rot:i.quaternion.toArray(),scl:i.scale.toArray()};if(t===undefined)return n;try{if(bf(t,"T")&&Mf(t.T,r)){n.pos=[t.T.curves.x.values[r],t.T.curves.y.values[r],t.T.curves.z.values[r]]}if(bf(t,"R")&&Mf(t.R,r)){var a=t.R.curves.x.values[r];var s=t.R.curves.y.values[r];var o=t.R.curves.z.values[r];_f.setFromEuler(yf.set(a,s,o,"ZYX"));n.rot=_f.toArray()}if(bf(t,"S")&&Mf(t.S,r)){n.scl=[t.S.curves.x.values[r],t.S.curves.y.values[r],t.S.curves.z.values[r]]}}catch(e){console.log("THREE.FBXLoader: ",i);console.log("THREE.FBXLoader: ",e)}return n}var wf=["x","y","z"];function bf(e,t){if(e===undefined){return false}var i=e[t];if(!i){return false}return wf.every(function(e){return i.curves[e]!==null})}function Mf(e,t){return wf.every(function(i){return Tf(e.curves[i],t)})}function Tf(e,t){return e.values[t]!==undefined}function Ef(){this.position=new ti;this.normal=new ti;this.uv=new Kt;this.color=new ti;this.skinIndices=new ai(0,0,0,0);this.skinWeights=new ai(0,0,0,0)}Object.assign(Ef.prototype,{copy:function e(t){var i=t||new Ef;i.position.copy(this.position);i.normal.copy(this.normal);i.uv.copy(this.uv);i.skinIndices.copy(this.skinIndices);i.skinWeights.copy(this.skinWeights);return i},flattenToBuffers:function e(t,i,r,n,a,s){this.position.toArray(t,t.length);this.normal.toArray(i,i.length);this.uv.toArray(r,r.length);this.color.toArray(n,n.length);this.skinIndices.toArray(a,a.length);this.skinWeights.toArray(s,s.length)}});function Sf(){this.vertices=[]}Object.assign(Sf.prototype,{copy:function e(t){var i=t||new Sf;for(var r=0;r<this.vertices.length;++r){this.vertices[r].copy(i.vertices[r])}return i},flattenToBuffers:function e(t,i,r,n,a,s){var o=this.vertices;for(var h=0,l=o.length;h<l;++h){o[h].flattenToBuffers(t,i,r,n,a,s)}}});function Af(){this.triangles=[];this.materialIndex=0}Object.assign(Af.prototype,{copy:function e(t){var i=t||new Af;for(var r=0;r<this.triangles.length;++r){this.triangles[r].copy(i.triangles[r])}i.materialIndex=this.materialIndex;return i},genTrianglesFromVertices:function e(t){for(var i=2;i<t.length;++i){var r=new Sf;r.vertices[0]=t[0];r.vertices[1]=t[i-1];r.vertices[2]=t[i];this.triangles.push(r)}},flattenToBuffers:function e(t,i,r,n,a,s,o){var h=this.triangles;var l=this.materialIndex;for(var c=0,u=h.length;c<u;++c){h[c].flattenToBuffers(t,i,r,n,a,s);Xf(o,[l,l,l])}}});function Lf(){this.faces=[];this.skeleton=null}Object.assign(Lf.prototype,{flattenToBuffers:function e(){var t=[];var i=[];var r=[];var n=[];var a=[];var s=[];var o=[];var h=this.faces;for(var l=0,c=h.length;l<c;++l){h[l].flattenToBuffers(t,i,r,n,a,s,o)}return{vertexBuffer:t,normalBuffer:i,uvBuffer:r,colorBuffer:n,skinIndexBuffer:a,skinWeightBuffer:s,materialIndexBuffer:o}}});function Cf(){}Object.assign(Cf.prototype,{getPrevNode:function e(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function e(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function e(){return this.currentProp},pushStack:function e(t){this.nodeStack.push(t);this.currentIndent+=1},popStack:function e(){this.nodeStack.pop();this.currentIndent-=1},setCurrentProp:function e(t,i){this.currentProp=t;this.currentPropName=i},parse:function e(t){this.currentIndent=0;this.allNodes=new Pf;this.nodeStack=[];this.currentProp=[];this.currentPropName="";var i=t.split("\n");for(var r=0,n=i.length;r<n;r++){var a=i[r];if(a.match(/^[\s\t]*;/)){continue}if(a.match(/^[\s\t]*$/)){continue}var s=new RegExp("^\\t{"+this.currentIndent+"}(\\w+):(.*){","");var o=a.match(s);if(o){var h=o[1].trim().replace(/^"/,"").replace(/"$/,"");var l=o[2].split(",");for(var c=0,a=l.length;c<a;c++){l[c]=l[c].trim().replace(/^"/,"").replace(/"$/,"")}this.parseNodeBegin(a,h,l||null);continue}var u=new RegExp("^\\t{"+this.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)");var o=a.match(u);if(o){var f=o[1].replace(/^"/,"").replace(/"$/,"").trim();var d=o[2].replace(/^"/,"").replace(/"$/,"").trim();if(f==="Content"&&d===","){d=i[++r].replace(/"/g,"").trim()}this.parseNodeProperty(a,f,d);continue}var p=new RegExp("^\\t{"+(this.currentIndent-1)+"}}");if(a.match(p)){this.nodeEnd();continue}if(a.match(/^[^\s\t}]/)){this.parseNodePropertyContinued(a)}}return this.allNodes},parseNodeBegin:function e(t,i,r){var n={name:i,properties:{},subNodes:{}};var a=this.parseNodeAttr(r);var s=this.getCurrentNode();if(this.currentIndent===0){this.allNodes.add(i,n)}else{if(i in s.subNodes){var o=s.subNodes[i];if(this.isFlattenNode(s.subNodes[i])){if(a.id===""){s.subNodes[i]=[];s.subNodes[i].push(o)}else{s.subNodes[i]={};s.subNodes[i][o.id]=o}}if(a.id===""){s.subNodes[i].push(n)}else{s.subNodes[i][a.id]=n}}else if(typeof a.id==="number"||a.id.match(/^\d+$/)){s.subNodes[i]={};s.subNodes[i][a.id]=n}else{s.subNodes[i]=n}}if(r){n.id=a.id;n.attrName=a.name;n.attrType=a.type}this.pushStack(n)},parseNodeAttr:function e(t){var i=t[0];if(t[0]!==""){i=parseInt(t[0]);if(isNaN(i)){i=t[0]}}var r="",n="";if(t.length>1){r=t[1].replace(/^(\w+)::/,"");n=t[2]}return{id:i,name:r,type:n}},parseNodeProperty:function e(t,i,r){var n=this.getCurrentNode();var a=n.name;if(a!==undefined){var s=a.match(/Properties(\d)+/);if(s){this.parseNodeSpecialProperty(t,i,r);return}}if(i==="C"){var o=r.split(",").slice(1);var h=parseInt(o[0]);var l=parseInt(o[1]);var c=r.split(",").slice(3);i="connections";r=[h,l];Xf(r,c);if(n.properties[i]===undefined){n.properties[i]=[]}}if(i==="Node"){var u=parseInt(r);n.properties.id=u;n.id=u}if(i in n.properties){if(Array.isArray(n.properties[i])){n.properties[i].push(r)}else{n.properties[i]+=r}}else{if(Array.isArray(n.properties[i])){n.properties[i].push(r)}else{n.properties[i]=r}}this.setCurrentProp(n.properties,i)},parseNodePropertyContinued:function e(t){this.currentProp[this.currentPropName]+=t},parseNodeSpecialProperty:function e(t,i,r){var n=r.split('",');for(var a=0,s=n.length;a<s;a++){n[a]=n[a].trim().replace(/^\"/,"").replace(/\s/,"_")}var o=n[0];var h=n[1];var l=n[2];var c=n[3];var u=n[4];switch(h){case"int":u=parseInt(u);break;case"double":u=parseFloat(u);break;case"ColorRGB":case"Vector3D":u=Bf(u);break}this.getPrevNode().properties[o]={type:h,type2:l,flag:c,value:u};this.setCurrentProp(this.getPrevNode().properties,o)},nodeEnd:function e(){this.popStack()},isFlattenNode:function e(t){return"subNodes"in t&&"properties"in t?true:false}});function Rf(){}Object.assign(Rf.prototype,{parse:function e(t){var i=new If(t);i.skip(23);var r=i.getUint32();console.log("THREE.FBXLoader: FBX binary version: "+r);var n=new Pf;while(!this.endOfContent(i)){var a=this.parseNode(i,r);if(a!==null)n.add(a.name,a)}return n},endOfContent:function e(t){if(t.size()%16===0){return(t.getOffset()+160+16&~15)>=t.size()}else{return t.getOffset()+160+16>=t.size()}},parseNode:function e(t,i){var r=i>=7500?t.getUint64():t.getUint32();var n=i>=7500?t.getUint64():t.getUint32();var a=i>=7500?t.getUint64():t.getUint32();var s=t.getUint8();var o=t.getString(s);if(r===0)return null;var h=[];for(var l=0;l<n;l++){h.push(this.parseProperty(t))}var c=h.length>0?h[0]:"";var u=h.length>1?h[1]:"";var f=h.length>2?h[2]:"";var d={};var p={};var v=false;if(n===1&&t.getOffset()===r){v=true}while(r>t.getOffset()){var m=this.parseNode(t,i);if(m===null)continue;if(m.singleProperty===true){var g=m.propertyList[0];if(Array.isArray(g)){m.properties[m.name]=m.propertyList[0];d[m.name]=m;m.properties.a=g.toString()}else{p[m.name]=g}continue}if(o==="Connections"&&m.name==="C"){var y=[];for(var l=1,_=m.propertyList.length;l<_;l++){y[l-1]=m.propertyList[l]}if(p.connections===undefined){p.connections=[]}p.connections.push(y);continue}if(m.name.match(/^Properties\d+$/)){var x=Object.keys(m.properties);for(var l=0,_=x.length;l<_;l++){var w=x[l];p[w]=m.properties[w]}continue}if(o.match(/^Properties\d+$/)&&m.name==="P"){var b=m.propertyList[0];var M=m.propertyList[1];var T=m.propertyList[2];var E=m.propertyList[3];var S;if(b.indexOf("Lcl ")===0)b=b.replace("Lcl ","Lcl_");if(M.indexOf("Lcl ")===0)M=M.replace("Lcl ","Lcl_");if(M==="ColorRGB"||M==="Vector"||M==="Vector3D"||M.indexOf("Lcl_")===0){S=[m.propertyList[4],m.propertyList[5],m.propertyList[6]]}else{S=m.propertyList[4]}if(M.indexOf("Lcl_")===0){S=S.toString()}p[b]={type:M,type2:T,flag:E,value:S};continue}if(d[m.name]===undefined){if(typeof m.id==="number"){d[m.name]={};d[m.name][m.id]=m}else{d[m.name]=m}}else{if(m.id===""){if(!Array.isArray(d[m.name])){d[m.name]=[d[m.name]]}d[m.name].push(m)}else{if(d[m.name][m.id]===undefined){d[m.name][m.id]=m}else{if(!Array.isArray(d[m.name][m.id])){d[m.name][m.id]=[d[m.name][m.id]]}d[m.name][m.id].push(m)}}}}return{singleProperty:v,id:c,attrName:u,attrType:f,name:o,properties:p,propertyList:h,subNodes:d}},parseProperty:function e(t){var i=t.getChar();switch(i){case"F":return t.getFloat32();case"D":return t.getFloat64();case"L":return t.getInt64();case"I":return t.getInt32();case"Y":return t.getInt16();case"C":return t.getBoolean();case"f":case"d":case"l":case"i":case"b":var r=t.getUint32();var n=t.getUint32();var a=t.getUint32();if(n===0){switch(i){case"f":return t.getFloat32Array(r);case"d":return t.getFloat64Array(r);case"l":return t.getInt64Array(r);case"i":return t.getInt32Array(r);case"b":return t.getBooleanArray(r)}}var s=new Zlib.Inflate(new Uint8Array(t.getArrayBuffer(a)));var o=new If(s.decompress().buffer);switch(i){case"f":return o.getFloat32Array(r);case"d":return o.getFloat64Array(r);case"l":return o.getInt64Array(r);case"i":return o.getInt32Array(r);case"b":return o.getBooleanArray(r)}case"S":var h=t.getUint32();return t.getString(h);case"R":var h=t.getUint32();return t.getArrayBuffer(h);default:throw new Error("THREE.FBXLoader: Unknown property type "+i)}}});function If(e,t){this.dv=new DataView(e);this.offset=0;this.littleEndian=t!==undefined?t:true}Object.assign(If.prototype,{getOffset:function e(){return this.offset},size:function e(){return this.dv.buffer.byteLength},skip:function e(t){this.offset+=t},getBoolean:function e(){return(this.getUint8()&1)===1},getBooleanArray:function e(t){var i=[];for(var r=0;r<t;r++){i.push(this.getBoolean())}return i},getInt8:function e(){var t=this.dv.getInt8(this.offset);this.offset+=1;return t},getInt8Array:function e(t){var i=[];for(var r=0;r<t;r++){i.push(this.getInt8())}return i},getUint8:function e(){var t=this.dv.getUint8(this.offset);this.offset+=1;return t},getUint8Array:function e(t){var i=[];for(var r=0;r<t;r++){i.push(this.getUint8())}return i},getInt16:function e(){var t=this.dv.getInt16(this.offset,this.littleEndian);this.offset+=2;return t},getInt16Array:function e(t){var i=[];for(var r=0;r<t;r++){i.push(this.getInt16())}return i},getUint16:function e(){var t=this.dv.getUint16(this.offset,this.littleEndian);this.offset+=2;return t},getUint16Array:function e(t){var i=[];for(var r=0;r<t;r++){i.push(this.getUint16())}return i},getInt32:function e(){var t=this.dv.getInt32(this.offset,this.littleEndian);this.offset+=4;return t},getInt32Array:function e(t){var i=[];for(var r=0;r<t;r++){i.push(this.getInt32())}return i},getUint32:function e(){var t=this.dv.getUint32(this.offset,this.littleEndian);this.offset+=4;return t},getUint32Array:function e(t){var i=[];for(var r=0;r<t;r++){i.push(this.getUint32())}return i},getInt64:function e(){var t,i;if(this.littleEndian){t=this.getUint32();i=this.getUint32()}else{i=this.getUint32();t=this.getUint32()}if(i&2147483648){i=~i&4294967295;t=~t&4294967295;if(t===4294967295)i=i+1&4294967295;t=t+1&4294967295;return-(i*4294967296+t)}return i*4294967296+t},getInt64Array:function e(t){var i=[];for(var r=0;r<t;r++){i.push(this.getInt64())}return i},getUint64:function e(){var t,i;if(this.littleEndian){t=this.getUint32();i=this.getUint32()}else{i=this.getUint32();t=this.getUint32()}return i*4294967296+t},getUint64Array:function e(t){var i=[];for(var r=0;r<t;r++){i.push(this.getUint64())}return i},getFloat32:function e(){var t=this.dv.getFloat32(this.offset,this.littleEndian);this.offset+=4;return t},getFloat32Array:function e(t){var i=[];for(var r=0;r<t;r++){i.push(this.getFloat32())}return i},getFloat64:function e(){var t=this.dv.getFloat64(this.offset,this.littleEndian);this.offset+=8;return t},getFloat64Array:function e(t){var i=[];for(var r=0;r<t;r++){i.push(this.getFloat64())}return i},getArrayBuffer:function e(t){var i=this.dv.buffer.slice(this.offset,this.offset+t);this.offset+=t;return i},getChar:function e(){return String.fromCharCode(this.getUint8())},getString:function e(t){var i="";while(t>0){var r=this.getUint8();t--;if(r===0)break;i+=String.fromCharCode(r)}this.skip(t);return i}});function Pf(){}Object.assign(Pf.prototype,{add:function e(t,i){this[t]=i},searchConnectionParent:function e(t){if(this.__cache_search_connection_parent===undefined){this.__cache_search_connection_parent=[]}if(this.__cache_search_connection_parent[t]!==undefined){return this.__cache_search_connection_parent[t]}else{this.__cache_search_connection_parent[t]=[]}var i=this.Connections.properties.connections;var r=[];for(var n=0;n<i.length;++n){if(i[n][0]==t){var a=i[n][1]===0?-1:i[n][1];r.push(a)}}if(r.length>0){Xf(this.__cache_search_connection_parent[t],r);return r}else{this.__cache_search_connection_parent[t]=[-1];return[-1]}},searchConnectionChildren:function e(t){if(this.__cache_search_connection_children===undefined){this.__cache_search_connection_children=[]}if(this.__cache_search_connection_children[t]!==undefined){return this.__cache_search_connection_children[t]}else{this.__cache_search_connection_children[t]=[]}var i=this.Connections.properties.connections;var r=[];for(var n=0;n<i.length;++n){if(i[n][1]==t){r.push(i[n][0]===0?-1:i[n][0])}}if(r.length>0){Xf(this.__cache_search_connection_children[t],r);return r}else{this.__cache_search_connection_children[t]=[];return[]}},searchConnectionType:function e(t,i){var r=t+","+i;if(this.__cache_search_connection_type===undefined){this.__cache_search_connection_type={}}if(this.__cache_search_connection_type[r]!==undefined){return this.__cache_search_connection_type[r]}else{this.__cache_search_connection_type[r]=""}var n=this.Connections.properties.connections;for(var a=0;a<n.length;++a){if(n[a][0]==t&&n[a][1]==i){this.__cache_search_connection_type[r]=n[a][2];return n[a][2]}}this.__cache_search_connection_type[t]=null;return null}});function Of(e){var t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===Gf(e,0,t.length)}function kf(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];var i=0;function r(t){var r=e[t-1];e=e.slice(i+t);i++;return r}for(var n=0;n<t.length;++n){var a=r(1);if(a===t[n]){return false}}return true}function Nf(e){var t=/FBXVersion: (\d+)/;var i=e.match(t);if(i){var r=parseInt(i[1]);return r}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function zf(e){return e/46186158e3}function Bf(e){var t=e.split(",");for(var i=0,r=t.length;i<r;i++){t[i]=parseFloat(t[i])}return t}function Uf(e){var t=e.split(",");for(var i=0,r=t.length;i<r;i++){t[i]=parseInt(t[i])}return t}function Df(e){return(new ti).fromArray(e.value)}function Ff(e){return(new Ki).fromArray(e.value)}function jf(e){return(new $t).fromArray(Bf(e))}function Gf(e,t,i){if(t===undefined)t=0;if(i===undefined)i=e.byteLength;var r=new Uint8Array(e,t,i);var n="";for(var a=0,s=r.length;a<s;a++){n+=String.fromCharCode(r[a])}return n}function Hf(e){return e*Vf}var Vf=Math.PI/180;function Wf(e,t){for(var i=0,r=e.length;i<r;i++){if(t(e[i]))return i}return-1}function Xf(e,t){for(var i=0,r=e.length,n=t.length;i<n;i++,r++){e[r]=t[i]}}function Yf(e,t,i,r){for(var n=i,a=0;n<r;n++,a++){e[a]=t[n]}return e}var qf=function(e){w(t,e);function t(e){g(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));i.init();i._paths=[];i._moveType=0;i._depth=0;i._hitObjects=e;i.position.x=0;i._age=new ti(0,1,0).normalize();i.position.y=-0;return i}y(t,[{key:"initAnimation",value:function e(t){window.ppp=50;this.clock=new Dl;this.clock.start=function(){this.startTime=Date.now();this.oldTime=this.startTime;this.elapsedTime=0;this.running=true};this.clock.getDelta=function(){var e=0;if(this.autoStart&&!this.running){this.start();return 0}if(this.running){var t=Date.now();e=(t-this.oldTime)/1e3;this.oldTime=t;this.elapsedTime+=e}return e};this.mixer=new Cl(t);this._res=hu.Assest.zip.Mother;var i=this.mixer.clipAction(ou(this._res.getFile("Idle.json").file));i.play();i.enabled=false;i.weight=0;this._Idle=i;var i=this.mixer.clipAction(ou(this._res.getFile("Walk.json").file));i.play();i.weight=0;i.enabled=false;this._walk=i;i.weight=0;var i=this.mixer.clipAction(ou(this._res.getFile("StairClimb.json").file));i.play();i.weight=0;i.enabled=false;this._ladderup=i;var i=this.mixer.clipAction(ou(this._res.getFile("StairDwon.json").file));i.play();i.weight=0;i.enabled=false;this._ladderdown=i;var i=this.mixer.clipAction(ou(this._res.getFile("CallWave.json").file));i.play();i.weight=0;i.enabled=false;this._callwave=i;i.clampWhenFinished=true;var i=this.mixer.clipAction(ou(this._res.getFile("Hug.json").file));i.play();i.weight=0;i.enabled=false;this._hug=i;i.clampWhenFinished=true;var r=ou(this._res.getFile("LadderClimb.json").file);var n=ou(this._res.getFile("LadderDown.json").file);var i=this.mixer.clipAction(this.getAnimationClip("scIn",n,0,40));i.weight=0;i.enabled=false;this._scIn=i;this._scIn.loop=Ct;i.clampWhenFinished=true;var i=this.mixer.clipAction(this.getAnimationClip("scIn",r,41,60));i.weight=0;i.enabled=false;this._scLoop=i;this._scLoop.play();var i=this.mixer.clipAction(this.getAnimationClip("scout",r,40,80));i.weight=0;i.enabled=false;i.loop=Ct;i.clampWhenFinished=true;this._scOut=i;var i=this.mixer.clipAction(this.getAnimationClip("scout",r,0,20));i.weight=0;i.enabled=false;i.loop=Ct;i.clampWhenFinished=true;this._ssIn=i;var i=this.mixer.clipAction(this.getAnimationClip("scout",n,60,81));i.weight=0;i.enabled=false;i.loop=Ct;i.clampWhenFinished=true;this._ssOut=i}},{key:"callHug",value:function e(){var t=this;this.mixer.addEventListener("finished",function(e){if(e.action==t._hug){t._iscallwave=false;t._hug.enabled=false;t._hug.weight=0;t._callwave.enabled=false;t._Idle.weight=1;t._Idle.enabled=true;t.update();t.dispatchEvent({type:"HogComplete",message:t.currentItem})}});this._iscallwave=true;this._Idle.enabled=false;this._Idle.weight=0;this._callwave.enabled=false;this._hug.enabled=true;this._hug.loop=Ct;this._hug.weight=1;this._hug.time=0}},{key:"callWave",value:function e(){this._iscallwave=true;this._Idle.enabled=false;this._Idle.weight=0;this._callwave.enabled=true;this._callwave.loop=Ct;this._callwave.weight=1;this._callwave.time=0}},{key:"showSitting",value:function e(){this._walk.weight=0;var t=hu.Assest.zip.Mother;var i=t.getFile("SittingFluteLoop.json").file;var r=ou(i);var n=this.mixer.clipAction(r);n.play();n.weight=1;this._sitting=n}},{key:"hideSitting",value:function e(){var t=this;this._sitting.weight=0;var i=hu.Assest.zip.Mother;var r=i.getFile("SittingFluteOut.json").file;var n=ou(r);var a=this.mixer.clipAction(n);a.play();a.weight=1;a.loop=Ct;this._sittingOut=a;this._playerLayer.position.z=0;this.hideMusicNote();this.mixer.addEventListener("finished",function(e){if(e.action==a){new lu.Tween(t._mSw).to({opacity:.2},500).start().onComplete(function(){});t._Idle.weight=1;setTimeout(function(){a.weight=0},0);t.isStart=true;jd.getInstance().sendNotification("PlayerStart");t._playerLayer.children[0].children[3].visible=false}});a.clampWhenFinished=true}},{key:"showMusicNote",value:function e(){var t=this._music=new Bu;t.position.x=-70;t.position.y=70;t.start();this.add(t)}},{key:"hideMusicNote",value:function e(){this._music.stop();this.remove(this._music);this._music=null}},{key:"deleteAni",value:function e(t){var i=t.tracks;for(var r=i.length-1;r>=0;r--){if(i[r].name.indexOf("Hat1")!=-1||i[r].name.indexOf("RightMidRobe")!=-1||i[r].name.indexOf("RightBottomRobe")!=-1||i[r].name.indexOf("LeftTopRobe")!=-1||i[r].name.indexOf("LeftMidRobe")!=-1||i[r].name.indexOf("LeftBottomRobe")!=-1||i[r].name.indexOf("BackTopRobe")!=-1||i[r].name.indexOf("BackMidRobe")!=-1||i[r].name.indexOf("BackBottomRobe")!=-1||i[r].name.indexOf("RightTopRobe")!=-1){i.splice(r,1)}}}},{key:"getAnimationClip",value:function e(t,i,r,n){this.mixer.clipAction(i);var a=i.tracks.length;var s=i.duration;var o=s*60;var h=r/o*s;var l=n/o*s;this.deleteAni(i);var c=[];for(var u=0;u<i.tracks.length;u++){var f=Nh.toJSON(i.tracks[u]);c[u]=Nh.parse(f);c[u].trim(h,l);c[u].shift(-h+.01);c[u].optimize()}var d=new zh(t,-1,c);d.resetDuration();d.trim();return d}},{key:"getAnimation",value:function e(t){var i=new eu.FBXLoader;var r=i.parseZip(t,this._res);return r.animations[0]}},{key:"hideHat",value:function e(){var t=this;this._playerLayer.children[0].children[2].visible=false;this._playerLayer.children[0].children[3].visible=false;setTimeout(function(){t._playerLayer.children[0].children[3].visible=true},500)}},{key:"init",value:function e(){this.temp={};this._moveSound=hu.Assest.zip.sound["fs_walk_leaves_A_05"];this._moveSound.loop=true;this.childMove=function(){};try{var t=new Uu;this._playerLayer=new eo;var i=this._ff=this._playerLayer=t.parseObject(hu.Assest.zip.Mother.getFile("Mother.json").file,hu.Assest.zip.Mother);this._offset=new ti(0,50,0);i.position.y=this._offset.y;i.position.x=this._offset.x;i.position.z=this._offset.z;i.castShadow=true;this.initAnimation(i);this.add(this._playerLayer)}catch(e){}var r=new Va(60,60,1);var n=new Xa({color:0,side:Y,map:iu("pshadow.png",hu.Assest.zip.loader)});n.transparent=true;n.opacity=.2;var a=new Qa(r,n);a.rotation.x=Math.PI/2;a.position.y=49;this.add(a);this._mSw=n;this._mSw.opacity=0;this._playerLayer.rotation.y=-Math.PI/2;this.isMove=false;this.moveIndex=0;this.currentItem=null}},{key:"getByName",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};for(var r=0;r<t.children.length;r++){i[t.children[r].name]=t.children[r];if(t.children[r].children){this.getByName(t.children[r],i)}}return i}},{key:"enabledAll",value:function e(t){t.en;for(var i=0;i<this.mixer._actions.length;i++){this.mixer._actions[i].enabled=this.mixer._actions[i]==t}t.weight=1;this.mixer.update(0)}},{key:"setAnimationData",value:function e(t,i,r,n){var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:-Math.PI/2;var o=arguments[6];var h=arguments[7];var l=arguments[8];o=o||0;h=h||0;l=l||function(){};this._isSCC=true;if(!t.enabled){this.enabledAll(t);t.enabled=true;t.weight=1;t.time=0;t.paused=false;t.reset();t.play();this.position.copy(i);var c=this.currentItem.tw=new lu.Tween(this.position).to(r,r.time);var u=this.currentItem.tw1=new lu.Tween(this.position).to(n,n.time);c.chain(u);c.start();this._playerLayer.rotation.y=s}if(!t.isRunning()){this._playerLayer.rotation.y=s;this.isNodeRender=true;this.isMove=false;if(this.isChange){this.isMove=false;this.isChange=false;this.moveList=this.moveList;return}this.currentItem.tw.stop();this.currentItem.tw1.stop();lu.remove(this.currentItem.tw);lu.remove(this.currentItem.tw1);this.currentItem.tw=undefined;this.currentItem.tw1=undefined;if(a){var f=(new ti).applyMatrix4(this.currentItem.matrixWorld);var d=this.parent.worldToLocal(f);d.x+=o;d.y+=h;this.position.copy(d)}if(this.moveIndex<this.moveList.length-1){this.childMove(this.currentItem);this.isNodeRender=false;this._iscallwave=false;this._oldTarget=this.currentItem;t.enabled=false;t.weight=0;this._isSCC=false;var p=this._moveList[++this.moveIndex];if(!p.data.up&&!p.data.down){this.setRotation(p)}this.currentItem=p;this.isMove=true}else{this.isNodeRender=true;this._iscallwave=true;this.targetBox=this.currentItem;this._moveSound.pause();this._Idle.enabled=a;this._isSCC=true;l();this.dispatchEvent({type:"moveComplete",message:this.currentItem})}}}},{key:"update",value:function e(){var t=this.clock.getDelta();this.mixer.update(t);t=t>.02?.04:.02;if(!this.isStart){var i=(new ti).applyMatrix4(this.targetBox.matrixWorld);var r=this.parent.worldToLocal(i);this.position.copy(r);this._playerLayer.rotation.y=0;this._playerLayer.children[0].children[1].children[0].children[2].children[1].position.y+=46;return}if(this.isMove){if(this._moveSound.paused){this._moveSound.play()}this._isPause=false;var n=this.currentItem;var a=this.position.clone();this._Idle.weight=0;this._walk.weight=1;this.targetBox=n;var i=(new ti).applyMatrix4(n.matrixWorld);var r=this.parent.worldToLocal(i);var s=new ti;s=s.subVectors(a,r);var o=s.length();o=o<=0?.1:o;a.x-=t*250*(s.x/o);a.y-=t*250*(s.y/o);a.z-=t*250*(s.z/o);if(n.data.t==1){if(!this._ladderup.enabled)this.enabledAll(this._ladderup)}else{if(!this._walk.enabled)this.enabledAll(this._walk)}this.position.copy(a);if(o>300){this.position.copy(r)}var h=a.clone();var l=r.clone().sub(h);if(n.touch)n.touch.isRotation=false;if(o<7){var c=this._oldTarget=n;if(this.moveIndex<this.moveList.length-1){for(var u=0;u<this.touchs.length;u++){this.touchs[u].isRotation=true}var f=this._moveList[++this.moveIndex];var i=(new ti).applyMatrix4(f.matrixWorld);var r=this.parent.worldToLocal(i);s=new ti;s.subVectors(a,r);for(var u=0;u<this.hitObjects.length;u++){if(this.hitObjects[u]!=f){var d=(new ti).applyMatrix4(this.hitObjects[u].matrixWorld);var p=this.parent.worldToLocal(d);var v=i.y+90;if(d.distanceTo(new ti(i.x,v,i.z))<10){this.targetBox=n;this.isMove=false;if(!this._moveSound.paused){this._moveSound.stop()}return}}}if(s.length()>120||Math.abs(r.y-a.y)>80){this.targetBox=n;if(!this._moveSound.paused){this._moveSound.stop()}this.isMove=false;return}else{this.setRotation(f);this.currentItem=f}if(this.currentItem.touch){for(var u=0;u<this.touchs.length;u++){this.touchs[u].isRotation=false}}else{if(c.touch){this.touch=c.touch;c.touch.isRotation=true}}}else{this.targetBox=this.currentItem;this.isMove=false;this._Idle.time=0;this.dispatchEvent({type:"moveComplete",message:this.currentItem});console.log("moveComplete")}}else{}}else{this.isMove=false;var i=(new ti).applyMatrix4(this.targetBox.matrixWorld);var r=this.parent.worldToLocal(i);this.position.copy(r);if(this.targetBox.touch===undefined){for(var u=0;u<this.touchs.length;u++){this.touchs[u].isRotation=true}}if(!this._moveSound.paused){this._moveSound.stop()}if(!this._Idle.enabled)this.enabledAll(this._Idle)}}},{key:"setRotation",value:function e(t){if(this.currentItem&&this.currentItem==r)return;if(this.currentItem===undefined||t.data.down||t.data.up||this.currentItem.data.up||this.currentItem.data.down)return;var i=(new ti).applyMatrix4(t.matrixWorld);var r=this.parent.worldToLocal(i);var i=(new ti).applyMatrix4(this.currentItem.matrixWorld);var n=this.parent.worldToLocal(i);r.sub(n);var a=nu(Math.atan2(r.z,-r.x)-Math.PI/2);this._playerLayer.rotation.y=a}},{key:"upPos",value:function e(t){if(!this.currentItem||!this.parent)return;var i=this.parent.worldToLocal(t);this.updateMatrixWorld();this.currentItem.updateMatrixWorld();var r=this.position.clone().sub(i);var i=(new ti).applyMatrix4(this.currentItem.matrixWorld);var n=this.parent.worldToLocal(i);n.add(r);this.position.copy(n);this._playerLayer.position.set(this._offset.x,this._offset.y,this._offset.z);if(this.currentItem.data.depth){this._playerLayer.position.add(this.currentItem.data.depth)}}},{key:"hitObjects",set:function e(t){this._hitObjects=t},get:function e(){return this._hitObjects}},{key:"moveList",set:function e(t){this._moveList=t;if(this.isMove){this.isChange=true;return}this._oldTarget=this.currentItem;this.childMove(this.targetBox);this.moveIndex=0;this.setRotation(this.moveList[this.moveIndex]);this.currentItem=this.moveList[this.moveIndex];this.isMove=true},get:function e(){return this._moveList}}]);return t}(ba);var Zf=["","","attribute float opacity;","\t\t\tattribute float size;","\t\t\tattribute vec3 customColor;","","\t\t\tvarying vec3 vColor;","","varying float _opacity;","\t\t\tvoid main() {","","\t\t\t\tvColor = customColor;","","_opacity = opacity;","\t\t\t\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","","\t\t\t\tgl_PointSize = size;","","\t\t\t\tgl_Position = projectionMatrix * mvPosition;","","\t\t\t}","","\t\t"].join("\n");var Jf=["","","varying float _opacity;","\t\t\tuniform vec3 color;","\t\t\tuniform sampler2D texture;","","\t\t\tvarying vec3 vColor;","","\t\t\tvoid main() {","","vec4 tColor = vec4( color*vColor , 1.0 );","","gl_FragColor = vec4(tColor.xyz * _opacity,1.0);","\t\t\t//\tgl_FragColor = gl_FragColor * texture2D( texture, gl_PointCoord );","","if ( gl_FragColor.a < ALPHATEST ) discard;","\t\t\t}","","\t\t"].join("\n");var Qf=function(e){w(t,e);function t(){g(this,t);var e=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e.init();return e}y(t,[{key:"init",value:function e(){var t={color:{value:new Ki(16777215)}};var i=new Ya({uniforms:t,vertexShader:Zf,fragmentShader:Jf,alphaTest:.1,blending:te,transparent:true});var r=150;var n=400;var a=new ja;this._geometry=a;var s=new Float32Array(r*3);var o=new Float32Array(r*3);var h=new Float32Array(r);var l=new Float32Array(r);var c=new Ki(16777215);var u=this._pos=[];for(var f=0,d=0;f<r;f++,d+=3){s[d+0]=(Math.random()*2-1)*300;s[d+1]=(Math.random()*2-1)*800;s[d+2]=(Math.random()*2-1)*1700;o[d+0]=c.r;o[d+1]=c.g;o[d+2]=c.b;h[f]=(Math.random()*4+3)/2;l[f]=Math.random()*.6+.4;this._pos.push({opacity:l[f],age:Math.cos(Math.random()*Math.PI/6-Math.PI/1.7),speed:Math.random()*1.2+.5,x:s[d+0],y:s[d+1],z:s[d+2]})}a.addAttribute("position",new La(s,3));a.addAttribute("customColor",new La(o,3));a.addAttribute("size",new La(h,1));a.addAttribute("opacity",new La(l,1));var p=new $s(a,i);this.add(p)}},{key:"update",value:function e(){var t=150;if(this._pos){var i=this._geometry.attributes.position.array;var r=this._geometry.attributes.opacity.array;for(var n=0,a=0;n<t;n++,a+=3){i[a+1]-=this._pos[n].speed;i[a+0]+=this._pos[n].age;var s=i[a+1];s=800-s;s=s/50;s=s>1?1:s;if(s<1){r[n]=s*this._pos[n].opacity}else{r[n]=this._pos[n].opacity}if(!this.isComplete&&i[a+1]<-450){r[n]=.01;i[a+1]=800;i[a+0]=(Math.random()*2-1)*300;this._pos[n].speed=Math.random()*1.2+.5;this._pos[n].age=Math.cos(Math.random()*Math.PI/6-Math.PI/1.7)}}this._geometry.attributes.position.needsUpdate=true;this._geometry.attributes.opacity.needsUpdate=true}}}]);return t}(ba);var Kf=function(e){w(t,e);function t(){g(this,t);var e=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e.init();return e}y(t,[{key:"init",value:function e(){var t;var i=new Va(30,30,1);var r=new Xa({color:16777215,side:Y,map:iu("click1.png",hu.Assest.zip.loader)});r.transparent=true;this._m1=r;r.opacity=1;var n=new Qa(i,r);n.rotation.x=Math.PI/2;n.position.y=46;n.visible=false;this._s1=n;this.add(n);var a=new Gs((t={map:Y},_(t,"map",iu("click.png",hu.Assest.zip.loader)),_(t,"color",16777215),t));a.depthTest=false;a.transparent=true;var s=new Hs(a);s.scale.set(100,100,1);s.position.y=46;s.visible=false;this.add(s);this._m2=a;this._s2=s;this._x=50}},{key:"show",value:function e(){var t=this;var i=["ui_nav_ping_default_pentatonic_pos_02","ui_nav_ping_default_pentatonic_pos_03","ui_nav_ping_default_pentatonic_pos_04"];var r=i[Math.floor(Math.random()*i.length)];var n=this._s=hu.Assest.zip.sound[r];n.loop=false;n.play();this._s2.visible=this._s1.visible=true;this._m1.opacity=this._m2.opacity=1;this._s2.scale.set(100,100,1);this._s1.scale.set(1.3,1.3,1);var a=new lu.Tween(this._s1.scale).to({x:.8,y:.8},500).onUpdate(function(){});a.start();var a=new lu.Tween(this._m1).to({opacity:0},500).onUpdate(function(){t._m1.needsUpdate=true});a.start();var a=new lu.Tween(this._m2).to({opacity:0},400).onUpdate(function(){t._m2.needsUpdate=true});a.start();var a=new lu.Tween(this._s2.scale).to({x:300,y:300,z:1},500);a.start()}},{key:"iconHeight",set:function e(t){switch(t){case 1:this._s1.position.y=this._s2.position.y=this._x;this._s1.rotation.x=-Math.PI/4;this._s1.position.z=5;break;default:this._s1.position.y=this._s2.position.y=46;this._s1.rotation.x=Math.PI/2;this._s1.position.z=0;break}}}]);return t}(ba);var $f=function(e){w(t,e);function t(){g(this,t);var e=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e.init();return e}y(t,[{key:"init",value:function e(){this._res=hu.Assest.zip.loader;try{var t=Ou.paser(this._res.getFile("mask.json").file,this._res);this.add(t.scene);t.scene.material.color=new Ki(15398134);t.scene.material.needsUpdate=true;t.scene.rotation.x=Math.PI/2;t.scene.scale.set(2.2,2.2,2.2)}catch(e){}}}]);return t}(ba);var ed=function(e){w(t,e);function t(){g(this,t);var e=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e.init();return e}y(t,[{key:"init",value:function e(){var t=hu.Assest.zip.loader;var i=new Gs({map:iu("q2_00011.png",t),color:16777215});var r=new Hs(i);r.scale.set(16,16,1);this.add(r);var i=new Gs({map:iu("q1_00011.png",t),color:16777215});var r=new Hs(i);r.scale.set(16,16,1);i.transparency=true;i.opacity=0;this.spriteMaterial=i;this.add(r);var n=Math.random()*.3+.3;this.scale.set(n,n,n);this._opacity=0;this._d=.01;this._p=.5}},{key:"update",value:function e(){this._opacity+=this._d*this._p;if(this._opacity>1||this._opacity<0){this._p*=-1}this.spriteMaterial.opacity=this._opacity}}]);return t}(ba);var td=function(e){w(t,e);function t(){g(this,t);var e=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e.init();return e}y(t,[{key:"init",value:function e(){var t=hu.Assest.zip.loader;var i=new Gs({map:iu("W2.png",t),color:16777215});var r=new Hs(i);r.scale.set(128*.7,64*.7,1);this.add(r);i.transparency=true;i.opacity=0;r.position.x=-100;r.position.y=-150;this._spriteMaterial1=i;var i=new Gs({map:iu("W1.png",t),color:16777215});var r=new Hs(i);r.scale.set(128*.7,32*.7,1);this.add(r);i.transparency=true;i.opacity=0;r.position.x=100;r.position.y=80;this._spriteMaterial2=i}},{key:"start",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:8e3;this.isStart=true;this._moveID=setTimeout(this.showMoveTips.bind(this),t)}},{key:"clearMoveTips",value:function e(){var t=this;clearTimeout(this._moveID);if(this._tw){lu.remove(this._tw)}var i=new lu.Tween(this._spriteMaterial1).to({opacity:0},1e3);i.onComplete(function(){t._spriteMaterial1.visible=false});i.start()}},{key:"showMoveTips",value:function e(){this._spriteMaterial1.visible=true;this._tw=new lu.Tween(this._spriteMaterial1).to({opacity:1},1e3);this._tw.start()}},{key:"showRotationTips",value:function e(){this._spriteMaterial2.visible=true;this._tw1=new lu.Tween(this._spriteMaterial2).to({opacity:1},1e3);this._tw1.start()}},{key:"clearRotationTips",value:function e(){var t=this;if(this._tw1){lu.remove(this._tw1)}this._tw1=new lu.Tween(this._spriteMaterial2).to({opacity:0},1e3).onComplete(function(){t._spriteMaterial2.visible=false});this._tw1.start()}}]);return t}(ba);var id=function(e){w(t,e);function t(){g(this,t);var e=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e._frameCount=0;e.init();return e}y(t,[{key:"init",value:function e(){this._frames=[];var t=hu.Assest.zip.logo.files.length;for(var i=0;i<t;i++){var r=i+2;r=r<10?"0"+r:r;r=r<100?"0"+r:r;r="a_00"+r+".png";this._frames.push(iu(r,hu.Assest.zip.logo))}var n=this._spriteMaterial=new Gs({map:this._frames[0],color:16777215});n.transparent=true;n.blending=te;var a=new Hs(n);a.scale.set(256,256,1);this.scale.set(1.4,1.4,1.4);this.position.y=540;this.add(a)}},{key:"start",value:function e(){var t=this;var i=new lu.Tween(this).to({_frameCount:271},8e3).onUpdate(function(){var e=t._frames[Math.floor(t._frameCount)];if(t._spriteMaterial.map!=e){t._spriteMaterial.map=e;t._spriteMaterial.needsUpdate=true}});i.start()}}]);return t}(ba);var rd=function(e){w(t,e);function t(){g(this,t);var e=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e._frames=[];e._frameCount=0;var i=hu.Assest.zip.font.files.length-1;for(var r=0;r<i;r++){var n=r+25;n=n<100?"0"+n:n;n="a2_0"+n+".png";e._frames.push(iu(n,hu.Assest.zip.font))}var a=iu("a2_0025.png",hu.Assest.zip.font);var s=e._spriteMaterial=new Gs({map:a,color:16777215});var o=new Hs(s);o.scale.set(320*.078,83*.055,1);o.position.y=-1;e.add(o);e.scale.set(9,9,9);return e}y(t,[{key:"update",value:function e(){}},{key:"show",value:function e(){var t=this;var i=new lu.Tween(this).to({_frameCount:95},5e3).onComplete(function(){}).onUpdate(function(){var e=t._frames[Math.floor(t._frameCount)];if(t._spriteMaterial.map!=e){t._spriteMaterial.map=e;t._spriteMaterial.needsUpdate=true}});i.start()}},{key:"_dispose",value:function e(){}}]);return t}(ba);var nd=function(e){w(t,e);function t(){g(this,t);var e=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e.init();return e}y(t,[{key:"init",value:function e(){this._engine=jd.getInstance().retrieveProxy("engine");var t=hu.Assest.zip.loader;var i=new Gs({map:iu("z1.png",t),color:16777215});i.transparency=true;i.opacity=0;var r=new Hs(i);r.scale.set(128,128,1);this._start=r;this.add(r);this.mouse={x:0,y:0};var t=hu.Assest.zip.loader;var i=new Gs({map:iu("z2.png",t),color:16777215});i.transparency=true;i.opacity=0;var r=new Hs(i);r.scale.set(128,128,1);this.add(r);this._loop=r;this.scale.set(.5,.5,.5);this._click=true}},{key:"start",value:function e(){var t=this;this._loop.material.opacity=0;var i=new lu.Tween(this._start.material).to({opacity:1},2500).onComplete(function(){t._loop.material.opacity=1;t._click=false;t.loop()}).delay(3e3).start()}},{key:"loop",value:function e(){var t=this._loop;var i=new lu.Tween(t.scale).to({x:256,y:256,z:1},2500);i.repeat(Infinity);i.start();i.onUpdate(function(){var e=t.scale.x-128;e=e/100;e=e>1?1:e;t.material.opacity=1-e});i.delay(3e3)}},{key:"onTouchStart",value:function e(t){var i=this;if(!this._click){var r=t.changedTouches[0];this.mouse.x=r.clientX/window.innerWidth*2-1;this.mouse.y=-(r.clientY/window.innerHeight)*2+1;var n=this._engine.getHitObject(this.mouse,[this._start]);if(n.length>0){this._click=true;var a=new lu.Tween(this.scale).to({x:.4,y:.4,z:.4},100);var s=new lu.Tween(this.scale).to({x:.5,y:.5,z:.5},100);a.chain(s);a.start();a.onComplete(function(){i._engine.show(1e3).onComplete(function(){jd.getInstance().sendNotification("two")})})}}}}]);return t}(ba);var ad=function(e){w(t,e);function t(e,i){g(this,t);return b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i))}y(t,[{key:"getAge",value:function e(t){return Math.PI/180*t}},{key:"onRegister",value:function e(){var t=this;this.isStart=false;this.raycaster=new zl;this.mouse=new Kt;this._enging=this.facade.retrieveProxy("engine");this._enging.addItem(this);this._res=hu.Assest.zip.loader;this.add(this.createBackgroup());this._infotext=new td;this.add(this._infotext);this._snow=new Qf;this.add(this._snow);this._click=new Kf;this._infotext.position.z=1501;var i=new $f;i.position.z=1500;this._mask=i;this.add(i);var r=Ou.paser(this._res.getFile("model.json").file,this._res);var n=[];var a=new eo;var s=new eo;var o=this._snowG1=new eo;this.add(o);for(var h=0;h<30;h++){var l=new ed;l._d=Math.random()*.08+.001;l._opacity=Math.random();l.position.x=(Math.random()*2-1)*150;l.position.z=(Math.random()*2-1)*100;l.position.y=(Math.random()*2-1)*80;o.add(l)}for(var h=0;h<30;h++){var l=new ed;l._d=Math.random()*.08+.001;l._opacity=Math.random();l.position.x=(Math.random()*2-1)*150;l.position.z=(Math.random()*2-1)*100;l.position.y=(Math.random()*2-1)*80+1e3;o.add(l)}o.position.y=-200;var c=[];var u=[];for(var h=0;h<r.scene.children.length;h++){var f=r.scene.children[h];if(f.name.indexOf("灯光")>=0){f.children[0].target.position.x=-40;f.children[0].target.position.y=-135;r.scene.add(f.children[0].target)}else{}if(f.name=="平面"){f.children[0].material=new Xa({map:iu("shadow.png",this._res),color:16777215,transparent:true});f.children[0].material.transparent=true;f.children[0].position.y=2;f.children[0].material.needsUpdate=true}if(f.name=="楼梯部分"||f.name=="柱子2"||f.name=="单独1"||f.name=="转动部分"){if(f.name=="楼梯部分"){var d=f.children[0].material[0].clone();d.color=new Ki(14476519);f.children[0].material[0]=d}c.push(f)}else{u.push(f)}if(f.name.indexOf("柱子")!=-1){f.children[0].material.side=W;f.children[0].material.needsUpdate=true}}for(var h=0;h<c.length;h++){a.add(c[h])}for(var h=0;h<u.length;h++){s.add(u[h])}var p=this.gameLayer=new eo;p.position.y=600;p.position.x=0;p.position.z=-0;p.scale.set(1.5,1.5,1.5);p.typeID=true;p.add(a);p.add(s);r.scene.add(p);p.add(this._click);var v=this._player=new qf;v.hitObjects=[s.getObjectByName("底层").children[0]];v.layerTarget=p;p.add(v);this.add(r.scene);var m=this._td=new ku;m.position.x=950;m.position.y=450;m.position.z=200;m.lock=[0,-Math.PI/2,Math.PI/2,Math.PI];m.openAge=-Math.PI/2;m.layerTarget={target:a,o:{x:0,y:0,z:0},n:{x:-554.5,y:-569.5,z:-554.5},min:-(Math.PI-Math.PI/4),max:-Math.PI/4};m.target=a.getObjectByName("转动部分");a.add(m);r.scene.rotation.set(Math.PI/180*36,-Math.PI/4,0);r.scene.position.set(-100,0,800);r.scene.scale.set(.4,.4,.4);var g=90;var y=this.createBox([{x:0,y:-338,z:0,r:new _a},{x:g,y:-338,z:0,r:new _a},{x:g*2,y:-338,z:0,r:new _a},{x:g*3,y:-338,z:0,r:new _a},{x:g*4,y:-338,z:0,r:new _a},{x:g*5,y:-338,z:0,r:new _a},{x:0,y:-338,z:-g,r:new _a},{x:0,y:-338,z:-g*2+-20,r:new _a}]);var _=this.createBox([{x:g*4+10,y:0,z:0,r:new _a},{x:g*5+10,y:0,z:0,r:new _a},{x:g*6+10,y:0,z:0,r:new _a},{x:g*6+10,y:-g,z:0,r:new _a},{x:g*6+10,y:-g*2,z:0,r:new _a},{x:g*6+10,y:-g*3,z:0,r:new _a}],m);var x=this.createBox([{x:0,y:230,z:0,r:new _a},{x:g*.95,y:230,z:0,r:new _a},{x:g*2*.95,y:230,z:0,r:new _a},{x:g*3*.95,y:230,z:0,r:new _a}]);var w=this.createBox([{t:1,x:0,y:0,z:0,r:new _a},{t:1,x:0,y:0,z:-g*1.2,r:new _a},{t:1,x:0,y:0,z:-g*2.2,r:new _a},{t:0,x:0,y:-0,z:-g*3.2,r:new _a(Math.PI/4)},{end:true,t:0,x:60,y:0,z:-g*4,r:new _a(Math.PI/4)}]);s.add(y);w.rotation.x=Math.PI/4;w.position.y=270;w.position.z=-86;m.target.add(_);a.add(x);a.add(w);var b=y.children.concat(_.children).concat(x.children).concat(w.children);v.currentItem=v.targetBox=y.children[3];v.hitObjects=b;v.touchs=[m];v.hideHat();v.showMusicNote();v.showSitting();m.player=v;v.addEventListener("moveComplete",function(e){if(e.message.data.end){t.endGame();v._Idle.weight=1;v._walk.weight=0;t.isStart=false;v._playerLayer.rotation.y=-Math.PI}else{if(m.target.rotation.x!=-Math.PI/2){t._infotext.showRotationTips()}else{t._infotext.clearRotationTips()}}});this._touchList=[m];setTimeout(function(){t._enging.hide(2e3)},0);setTimeout(this.startGame.bind(this),4e3)}},{key:"endGame",value:function e(){var t=this;this._isEndStart=true;var i=new lu.Tween(this.position).to({y:-450},5e3);i.onUpdate(function(){var e=t.position.y/-450;var i=e;t._background.position.y=-180-e*-180;e=e-.5;e=e<0?0:e;e=e/.5;t.gameLayer.position.y=100+i*-180;t.gameLayer.position.x=70-i*70+e*20;t.gameLayer.position.z=-(70-i*70)+e*20;for(var r=0;r<t._mountList.length;r++){var n=t._mountList[r];n.target.position.y=n.old+n.now*e;if(r==0){n.target.material.opacity=e}}});i.onComplete(function(){var e=new lu.Tween(t._sow.material).to({opacity:.25},1e3).start()});i.easing(lu.Easing.Cubic.InOut);i.start();this._logo=new id;this.add(this._logo);var r=new rd;this.add(r);this._playButton=new nd;this.add(this._playButton);setTimeout(function(){t._logo.start();setTimeout(function(){r.show();t._playButton.start()},3e3);t._isEnd=true;r.position.y=326;t._playButton.position.y=240},2e3)}},{key:"startGame",value:function e(){var t=this;console.log("startGame");var i=new lu.Tween(this._mask.scale).to({x:10,y:10,z:10},8e3);i.easing(lu.Easing.Sinusoidal.InOut);i.onComplete(function(){t.remove(t._mask)});i.start();i.easing(lu.Easing.Cubic.InOut);var r=new lu.Tween(this.gameLayer.position).to({x:70,z:-70,y:100},8e3);r.easing(lu.Easing.Cubic.InOut);r.delay(1e3);r.start();var n=new lu.Tween(this.gameLayer.scale).to({x:.8,y:.8,z:.8},8e3);n.easing(lu.Easing.Cubic.InOut);n.delay(1e3);n.start();n.onComplete(function(){t._initMove=true})}},{key:"initMove",value:function e(){this._isInitMoveComplete=true;this._player.hideSitting();this._infotext.isStart=true;this._infotext.start(6e3)}},{key:"createBackgroup",value:function e(){var t=Ou.paser(this._res.getFile("background.json").file,this._res);this.add(t.scene);this._background=t.scene;t.scene.scale.set(24,24,24);var i=new Gs({map:iu("sun.png",this._res),color:16777215});i.transparent=true;i.opacity=0;var r=new Hs(i);r.scale.set(128*.05,128*.05,1);r.position.x=-1;r.position.y=25;t.scene.rotation.y=-Math.PI/2;t.scene.add(r);t.scene.updateMatrixWorld();t.scene.position.x=0;t.scene.position.y=-180;t.scene.position.z=-1600;this._geoList=[];this._mountList=[];this._mountList.push({target:r});var n=new Va(24,24,1);var a=new Xa({color:6536238,map:iu("sow.jpg",this._res),side:Y});a.alphaMap=iu("sow.jpg",this._res);a.transparent=true;a.opacity=0;a.depthTest=false;a.blending=te;var s=new Qa(n,a);s.rotation.y=Math.PI/2;s.position.y=25;s.position.x=.6;s.position.z=-1.5;t.scene.add(s);this._sow=s;var o=[];var h=0;var l=[{x:0,y:0,z:0},{x:0,y:0,z:0},{x:0,y:0,z:0},{x:0,y:0,z:-1},{x:0,y:0,z:-4},{x:0,y:0,z:0},{x:0,y:0,z:0}];var c=0;var u=[3,4,3];for(var f=0;f<t.scene.children[0].children.length;f++){if(t.scene.children[0].children[f].name=="c1"){t.scene.children[0].children[f].position.x=-1e3;t.scene.children[0].children[f].scale.set(.012,.012,.012)}if(c<3){c++;var n=new Va(20,7,64);var a=new Xa({map:iu("background/b.jpg",this._res),color:16777215,side:Y});a.transparent=true;a.opacity=.7;if(h==1){a.opacity=.45}var s=new Qa(n,a);s.rotation.y=Math.PI/2;s.rotation.x=-Math.PI;s.position.x=-1.1;s.position.y=h*3+32;o.push({target:s});var d=s.geometry.vertices;var p=[];for(var v=0;v<d.length;v++){p.push(d[v].clone())}t.scene.children[0].add(s);this._geoList.push({p:u[h],target:s,sep:100,ay:50,count:Math.floor(Math.random()*10),data:p,s:Math.random()*.001+5e-4});h++}if(t.scene.children[0].children[f].name.indexOf("prelude_Mountain")!=-1){if(t.scene.children[0].children[f].name=="prelude_Mountain_6"||t.scene.children[0].children[f].name=="prelude_Mountain_5"){}this._mountList.push({target:t.scene.children[0].children[f]})}t.scene.children[0].children[f].material.color=new Ki(16777215);t.scene.children[0].children[f].material.side=Y;t.scene.children[0].children[f].material.transparent=true;t.scene.children[0].children[f].material.opacity=1;t.scene.children[0].children[f].material.needsUpdate=true}this._mountList=this._mountList.concat(o);this._res=hu.Assest.zip.loader;var n=new Va(1024,1024,32);var a=new Xa({color:16777215,map:iu("q1.jpg",this._res),side:Y});var s=new Qa(n,a);s.visible=false;var m=[10,14,14,14,13,10,10,10,10,10,10];var g=[10,15,15,15,15,12,12,12,10,10,10];for(var f=0;f<this._mountList.length;f++){var y=this._mountList[f];y.target.position.y+=m[f];y.old=y.target.position.y;y.now=-g[f]}return s}},{key:"createBox",value:function e(t,i){var r=new eo;for(var n=0;n<t.length;n++){var a=t[n];var s=new Ga(100,100,100);var o=new Xa({color:16776960});o.transparent=true;o.opacity=0;o.depthTest=false;var h=new Qa(s,o);h.position.set(a.x,a.y,a.z);h.rotation.copy(a.r);h.data=a;if(i){h.touch=i}r.add(h)}return r}},{key:"onRemove",value:function e(){this.traverse(function(e){if(e instanceof Qa){e.geometry.dispose();if(e.material instanceof Array){for(var t=0;t<e.material.length;t++){if(e.material[t].map){e.material[t].map.dispose()}}}}if(e instanceof Hs){if(e.material.map){e.material.map.dispose()}}});this._enging.removeLayer(this)}},{key:"toScreenPosition",value:function e(t,i){var r=new ti;var n=.5*window.innerWidth;var a=.5*window.innerHeight;t.updateMatrixWorld();r.setFromMatrixPosition(t.matrixWorld);r.project(i);r.x=r.x*n+n;r.y=-(r.y*a)+a;return{x:r.x,y:r.y}}},{key:"getRotation",value:function e(t,i){var r=Math.PI*2;var n=(i-t)%r;if(n!=n%180){n=n<0?n+r:n-r}return n}},{key:"getWorld",value:function e(t){t.updateMatrixWorld();return(new ti).applyMatrix4(t.matrixWorld)}},{key:"getLocal",value:function e(t){}},{key:"getPath",value:function e(t,i,r,n){for(var a=0;a<r.length;a++){var s=[];var o=r[a];o.updateMatrixWorld();var h=(new ti).applyMatrix4(o.matrixWorld);h=i.worldToLocal(h);var l=t.distanceTo(h);var c=t.clone().sub(h).floor().normalize();if(n===undefined){if(l>10&&l<120){s.push({target:o,point:h,normal:c,parent:t})}}else if(n.equals(c)){if(l>10&&l<120){s.push({target:o,point:h,normal:c,parent:t})}}}return s}},{key:"getPathData",value:function e(t){}},{key:"getPlayerToPath",value:function e(t,i,r,n){var a=[];for(var s=0;s<r.length;s++){var o=r[s];o.updateMatrixWorld();var h=(new ti).applyMatrix4(o.matrixWorld);h=i.worldToLocal(h);var l=t.distanceTo(h);var c=t.clone().sub(h).floor().normalize();if(n===undefined){if(l>10&&l<120){a.push({target:o,point:h,normal:c,parent:t})}}else if(n.equals(c)){if(l>10&&l<120){a.push({target:o,point:h,onormal:c,parent:t})}}}return a}},{key:"getDep",value:function e(t){var i=[];for(var r=0;r<t.length;r++){var n=t[r];var a=this.getPath(n.point,this._player.parent,this._player.hitObjects,n.normal);if(a.length>0){this.getDep(a)}}return i}},{key:"getCurrent",value:function e(t,i,r){var n=null;var a=1e6;for(var s=0;s<r.length;s++){var o=r[s];o.pre=null;o.updateMatrixWorld();var h=(new ti).applyMatrix4(o.matrixWorld);h=this._player.layerTarget.worldToLocal(h);var l=t.distanceTo(h);if(a>l){n=o;a=l}}if(a<95){return n}else{return}}},{key:"getPaths",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var n=[{x:0,y:0,z:-1},{x:0,y:0,z:1},{x:1,y:0,z:0},{x:-1,y:0,z:0},{x:0,y:90,z:-1},{x:0,y:90,z:1},{x:1,y:90,z:0},{x:-1,y:90,z:0}];var a=this.getLocalPoint(t);var s=0;for(var o=0;o<this._player.hitObjects.length;o++){var h=this._player.hitObjects[o];if(h==t||t.pre==h){continue}var l=this.getLocalPoint(h);for(var c=0;c<n.length;c++){var u=a.clone();u.x+=n[c].x*90;u.z+=n[c].z*90;u.y+=n[c].y*90;var f=u.distanceTo(l);if(f<80){s++;r.push(h);h.pre=t;if(h!=i){this.getPaths(h,i,r)}else{return r}}}}if(s==0){r=[]}return r}},{key:"getLocalPoint",value:function e(t){t.updateMatrixWorld();var i=(new ti).applyMatrix4(t.matrixWorld);return this._player.layerTarget.worldToLocal(i)}},{key:"handleNotification",value:function e(t){switch(t.name){case Nu.DRAW:if(this._isEndStart){if(this._geoList){for(var i=0;i<this._geoList.length;i++){var r=this._geoList[i].target;var n=r.geometry.vertices;this._geoList[i].count+=this._geoList[i].s;var a=n.length/this._geoList[i].p;for(var s=0;s<n.length;s++){n[s].y=this._geoList[i].data[s].y+Math.sin((s/a+this._geoList[i].count)*2*Math.PI)*1}r.geometry.verticesNeedUpdate=true}}}else{}if(this._player){this._player.update();this._snow.update();this._snow.isComplete=this._isEnd;for(var i=0;i<this._snowG1.children.length;i++){this._snowG1.children[i].update()}}break;case"TOUCH_START":if(this._playButton){this._playButton.onTouchStart(t.body)}if(!this.isStart){if(this._initMove&&!this._isInitMoveComplete){console.log("_isInitMoveComplete");var o=hu.Assest.zip.sound["mother_flute_phrase_intro_sustain"];var h=new lu.Tween(o).to({volume:0},2e3);h.onComplete(function(){o.stop()});o.play();h.start();this.initMove()}return}for(var i=0;i<this._touchList.length;i++){this._touchList[i].onTouchStart(t.body)}var l=t.body.changedTouches[0];this.mouse.x=l.clientX/window.innerWidth*2-1;this.mouse.y=-(l.clientY/window.innerHeight)*2+1;this.raycaster.setFromCamera(this.mouse,this._enging._camera);var c=this.raycaster.intersectObjects(this._player.hitObjects,true);this._infotext.clearRotationTips();if(c.length>0){if(this._infotext.isStart){this._infotext.clearMoveTips();this._infotext.start()}c[0].object.updateMatrixWorld();if(c[0].object.data.t===undefined){this._click.iconHeight=0}else{this._click.iconHeight=c[0].object.data.t}var u=(new ii).getNormalMatrix(c[0].object.matrixWorld);var f=c[0].face.normal.clone().applyMatrix3(u).normalize();var d=(new ti).applyMatrix4(c[0].object.matrixWorld);d=this._click.parent.worldToLocal(d);this._click.position.copy(d);this._click.show();var p=this.getCurrent(this.getLocalPoint(this._player),this._player.parent,this._player.hitObjects);if(p===undefined&&this._player.position.clone().distanceTo(p.position)<10)return;var v=this.getPaths(p,c[0].object);if(v){for(var i=0;i<v.length;i++){if(v[i]==c[0].object){var m=[];var g=v[i];while(g.pre){m.push(g);g=g.pre}m.reverse();this._player.moveList=m;this._player.targetBox=p}}}}break;case"TOUCH_MOVE":if(!this.isStart)return;for(var i=0;i<this._touchList.length;i++){this._touchList[i].onTouchMove(t.body)}return;this._world.onTouchMove(t.body);break;case"TOUCH_END":if(!this.isStart)return;for(var i=0;i<this._touchList.length;i++){this._touchList[i].onTouchEnd(t.body)}return;this._world.onTouchEnd(t.body);break;case"PLAYER_MOVE":break;case"PlayerStart":this.isStart=true;console.log("PlayerStart");break}}},{key:"listNotificationInterests",value:function e(){return["PlayerStart","PLAYER_MOVE",Nu.DRAW,"TOUCH_START","TOUCH_MOVE","TOUCH_END"]}}]);return t}(tu);var sd=function(e){w(t,e);function t(e,i){g(this,t);return b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i))}y(t,[{key:"onRegister",value:function e(){var t=this;console.log("Logo");this._enging=this.facade.retrieveProxy("engine");this._enging.addItem(this);this.isSoundInit=false;this._enging._scene.background=new Ki(0);this._enging.hide(1e3);this._logo=this.createLogo();this._logo.material.opacity=0;this._soundtips=this.createSoundTips();this.add(this._logo);this.add(this._soundtips);this._txt=this.createTxt();this.add(this._txt);this._soundtips.material.opacity=0;var i=new lu.Tween(this._logo.material).to({opacity:1},1e3).onUpdate(function(){}).onComplete(function(){});var r=new lu.Tween(this._logo.material).to({opacity:0},1e3).delay(2e3);var n=new lu.Tween(this._soundtips.material).to({opacity:1},1e3);i.chain(r);r.chain(n);i.start();n.onComplete(function(){var e=hu.Assest.zip.sound["mother_flute_phrase_intro_sustain"];e.loop=true;e.play();setTimeout(function(){t._enging.show(1e3).onComplete(function(){var e=hu.Assest.zip.sound["amb_prelude_start"];e.loop=true;e.play();setTimeout(function(){t.sendNotification("INFO")},10)})},2e3)});this._txt.position.y=this._enging._camera.bottom+40}},{key:"createLogo",value:function e(){this._res=hu.Assest.zip.loader;var t=new Gs({map:iu("logotencent.jpg",this._res),color:16777215});var i=new Hs(t);i.scale.set(Math.floor(1024*.4),Math.floor(107*.4),1);return i}},{key:"createTxt",value:function e(){this._res=hu.Assest.zip.loader;var t=new Gs({map:iu("txt.png",this._res),color:16777215});var i=new Hs(t);i.scale.set(Math.floor(574*.5),Math.floor(44*.5),1);return i}},{key:"createTencent",value:function e(){this._res=hu.Assest.zip.loader;var t=new Gs({map:iu("tencent.png",this._res),color:16777215});t.transparent=true;var i=new Hs(t);i.scale.set(Math.floor(512*.4),Math.floor(128*.4),1);return i}},{key:"createSoundTips",value:function e(){this._res=hu.Assest.zip.loader;var t=new Gs({map:iu("sound.png",this._res),color:16777215});t.transparent=true;var i=new Hs(t);i.scale.set(Math.floor(512*.35),Math.floor(512*.35),1);return i}},{key:"onRemove",value:function e(){this.traverse(function(e){if(e instanceof Qa){e.geometry.dispose();if(e.material instanceof Array){for(var t=0;t<e.material.length;t++){if(e.material[t].map){e.material[t].map.dispose()}}}}if(e instanceof Hs){if(e.material.map){e.material.map.dispose()}}});this._enging._scene.remove(this)}},{key:"handleNotification",value:function e(t){if(uu.COMMPLETE==t.name){}if(t.name=="TOUCH_START"){if(this._button){var i=t.body.changedTouches[0];var r={};r.x=i.clientX/window.innerWidth*2-1;r.y=-(i.clientY/window.innerHeight)*2+1;var n=this._enging.getHitObject(r,[this._button]);if(n.length>0){this.remove(this._button);this.facade.sendNotification("GameStop",true)}}}}},{key:"listNotificationInterests",value:function e(){return[]}}]);return t}(tu);var od=function(e){w(t,e);function t(e){g(this,t);return b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}y(t,[{key:"onRegister",value:function e(){this._onTouchEnd=this._onTouchEnd.bind(this);this._onTouchStart=this._onTouchStart.bind(this);this._onTouchMove=this._onTouchMove.bind(this);this._onClick=this._onClick.bind(this);wx.onTouchStart(this._onTouchStart);wx.onTouchMove(this._onTouchMove);wx.onTouchEnd(this._onTouchEnd)}},{key:"_onClick",value:function e(t){t.pointerid=t.pointerid==undefined?0:t.pointerid;this.sendNotification("TOUCH_CLICK",t)}},{key:"_onTouchStart",value:function e(t){t.pointerid=t.pointerid==undefined?0:t.pointerid;this.sendNotification("TOUCH_START",t)}},{key:"_onTouchEnd",value:function e(t){t.pointerid=t.pointerid==undefined?0:t.pointerid;this.sendNotification("TOUCH_END",t)}},{key:"_onTouchMove",value:function e(t){t.pointerid=t.pointerid==undefined?0:t.pointerid;this.sendNotification("TOUCH_MOVE",t)}},{key:"onRemove",value:function e(){}},{key:"canvas",set:function e(t){this._canvas=t},get:function e(){return this._canvas}}]);return t}(R);var hd=function(){function e(){g(this,e);this.facade=C.getInstance()}y(e,[{key:"sendNotification",value:function e(t,i,r){this.facade.sendNotification(t,i,r)}},{key:"execute",value:function e(t){}}]);return e}();var ld=function(e){w(t,e);function t(e,i){g(this,t);return b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i))}y(t,[{key:"onRegister",value:function e(){this._enging=this.facade.retrieveProxy("engine");this._enging.addItem(this);this._enging._scene.background=new Ki(1638940);var t=new ni(su({width:256,height:128,text:"0%",size:48}));t.needsUpdate=true;var i=this._loading=new Gs({map:t,color:9722231});var r=new Hs(i);r.scale.set(128/1.6,64/1.6,1);this.add(r);this._loadP=r;r.position.x=35;r.position.y=-55;this._number=0;var n=this._progress=this.createSprite("assets/loading/u2_00000.png");n.scale.set(160,160,3);this.add(n);var n=this.createSprite("assets/loading/u1_00000.png");n.scale.set(160,160,1);this.add(n);this.createLoop();var a=this._loop=this.createSprite("assets/loading/load_00000.png");this._loop.scale.set(64,64,1);this.add(this._loop);var r=this.createSprite("assets/loading/loadingBG.png");r.scale.set(512,512,-1);this.add(r);this._currentFrame=0;this._loadingNum=0}},{key:"createSprite",value:function e(t){var i=new ni;var r=new Gs({map:i});var n=wx.createImage();n.src=t;n.onload=function(){i.image=n;i.repeat.copy(new Kt(1,1));i.offset.copy(new Kt(0,0));i.wrapS=We;i.wrapT=We;i.needsUpdate=true;r.transparent=true;r.needsUpdate=true};var a=new Hs(r);return a}},{key:"createLoop",value:function e(){var t=this;this._frame=[];var i=function e(){var i=new ni;var n=wx.createImage();n.src="assets/loading/load_000"+(r<10?"0"+r:r)+".png";n.onload=function(){i.image=n;i.repeat.copy(new Kt(1,1));i.offset.copy(new Kt(0,0));i.wrapS=We;i.wrapT=We;i.needsUpdate=true};n.onerror=function(){};t._frame.push(i)};for(var r=0;r<11;r++){i()}}},{key:"hide",value:function e(){this._enging.hide(0)}},{key:"show",value:function e(){this._enging.show(1e3)}},{key:"start",value:function e(t){this.sendNotification(t)}},{key:"showText",value:function e(t){}},{key:"onRemove",value:function e(){this.traverse(function(e){if(e instanceof Qa){e.geometry.dispose()}if(e instanceof Hs){if(e.material.map){e.material.map.dispose()}}});this._enging.removeLayer(this);for(var t=0;t<this._enging._scene.children.length;t++){if(this._enging._scene.children[t]==this){this._enging._scene.children.splice(t,1);return}}}},{key:"handleNotification",value:function e(t){var i=this;switch(t.name){case"engine_draw":if(this._progress)this._progress.material.rotation-=.03;if(this._loop){this._currentFrame+=.3;var r=this._frame[Math.floor(this._currentFrame)];if(this._loop.material.map!=r){this._loop.material.map=r;this._loop.material.needsUpdate=true}}if(this._currentFrame>10){this._currentFrame=0}break;case"loaderProgress":var n=Math.floor(t.body.totalProgress*95);this._loadP.position.x=n<10?35:25;if(this._number!=n){this._number=n;if(this._loading.map){this._loading.map.dispose()}var a=new ni(su({width:256,height:128,text:n+"%",size:48}));a.needsUpdate=true;this._loading.map=a}break;case"loaderComplete":var a=new ni(su({width:256,height:128,text:"100%",size:48}));this._loadP.position.x=25;a.needsUpdate=true;this._loading.map=a;this._enging.show(1e3).onComplete(function(){i.sendNotification("ShowLogo");var e=i.facade.retrieveProxy("stage").onResize()});break}}},{key:"listNotificationInterests",value:function e(){return["showtxt","engine_draw","loaderProgress","loaderComplete","localComplete"]}},{key:"sendNotification",value:function e(t,i,r){this.facade.sendNotification(t,i,r)}}]);return t}(tu);var cd=function(e){w(t,e);function t(e,i){g(this,t);return b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i))}y(t,[{key:"onRegister",value:function e(){this._enging=this.facade.retrieveProxy("engine");this._enging.addItem(this);var t=new ni(su({width:256,height:128,text:"载入中...",size:48}));t.needsUpdate=true;var i=new Gs({map:t,color:16777215});var r=new Hs(i);r.scale.set(128/1.6,64/1.6,1);this.add(r);r.position.y=this._enging._camera.bottom+24;r.position.x=10;this._sm=i;i.opacity=0}},{key:"hide",value:function e(){this._enging.hide(0)}},{key:"show",value:function e(){this._enging.show(1e3)}},{key:"start",value:function e(t){var i=this;var r=new lu.Tween(this._sm).to({opacity:1},1e3).onComplete(function(){i.sendNotification(t)}).start()}},{key:"showText",value:function e(t){}},{key:"onRemove",value:function e(){this.traverse(function(e){if(e instanceof Qa){e.geometry.dispose();if(e.material instanceof Array){for(var t=0;t<e.material.length;t++){if(e.material[t].map){e.material[t].map.dispose()}}}}if(e instanceof Hs){if(e.material.map){e.material.map.dispose()}}});this._enging.removeLayer(this)}},{key:"handleNotification",value:function e(t){this.showText(t.body)}},{key:"listNotificationInterests",value:function e(){return["showtxt"]}},{key:"sendNotification",value:function e(t,i,r){this.facade.sendNotification(t,i,r)}}]);return t}(tu);var ud=function(e){w(t,e);function t(e,i){g(this,t);return b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i))}y(t,[{key:"onRegister",value:function e(){this._enging=this.facade.retrieveProxy("engine");this._enging.addItem(this);this._enging.show(0);var t=new ni(su({width:128,height:64,text:"载入中...",size:24}));t.needsUpdate=true;var i=new Gs({map:t,color:16777215});var r=new Hs(i);r.scale.set(128/1.6,64/1.6,1);this.add(r);r.position.y=this._enging._camera.bottom+24;r.position.x=10;this.sm=i;i.opacity=0;new lu.Tween(i).to({opacity:1},1e3).onComplete(function(){}).start()}},{key:"onRemove",value:function e(){this._enging.removeLayer(this)}}]);return t}(tu);var fd=function(e){w(t,e);function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"x";g(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));i._type=e;i.init();i.openAge=0;i.isOpen=false;i.isClose=false;i.isRotation=true;return i}y(t,[{key:"init",value:function e(){this._engine=jd.getInstance().retrieveProxy("engine");this.mouse=new Kt;this.tid=-1;this.lock=[0];this._point={x:0,y:0};this.age=0;this._res=hu.Assest.zip.loader;this._sprite=new Hs(new Gs({map:iu("mask.jpg",this._res),color:16777215}));this._sprite.material.transparent=true;this._sprite.material.opacity=0;this._sprite.scale.set(350,350,1);this.add(this._sprite);this.hitObject=this._sprite;this.identifier=-1;this._moveSound=hu.Assest.zip.sound["int_ending_landsend_finaldragger_rocks_01"];this._moveSound.loop=true}},{key:"onTouchEnd",value:function e(t){if(!this.isDown)return;this.isDown=false;if(this.identifier!=t.changedTouches[0].identifier)return;this.point={x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY};this.update({rx:t.changedTouches[0].clientX,ry:t.changedTouches[0].clientY});this.identifier=-1;if(!this.isRotation)return;if(this.target&&this.target.getObjectByName("立方体_0_7_6.6_8.1_0.10").children[0].material.oldColor){var i=new lu.Tween(this.target.getObjectByName("立方体_0_7_6.6_8.1_0.10").children[0].material.color).to({r:this.target.getObjectByName("立方体_0_7_6.6_8.1_0.10").children[0].material.oldColor.r,g:this.target.getObjectByName("立方体_0_7_6.6_8.1_0.10").children[0].material.oldColor.g,b:this.target.getObjectByName("立方体_0_7_6.6_8.1_0.10").children[0].material.oldColor.b},500);i.start()}this.isEnabled=false}},{key:"onTouchStart",value:function e(t){if(this.isDown)return;this.isDown=true;if(!this.isRotation){this.isEnabled=false;return}if(this.identifier!=-1)return;var i=t.touches[0];this.identifier=i.identifier;this.mouse.x=i.clientX/window.innerWidth*2-1;this.mouse.y=-(i.clientY/window.innerHeight)*2+1;var r=this._engine.getHitObject(this.mouse,[this._sprite]);if(r.length>0){this.isEnabled=true;this._scenePoint=this._engine.toScreenPosition(this);this.point={x:i.clientX,y:i.clientY};var n=Math.atan2(this.point.y,this.point.x);this.target.rotation[this._type]+=n>0?.05:-.05;this.age=n-this.target.rotation[this._type];if(this.target){if(!this.target.getObjectByName("立方体_0_7_6.6_8.1_0.10").children[0].material.oldColor){this.target.getObjectByName("立方体_0_7_6.6_8.1_0.10").children[0].material.oldColor=this.target.getObjectByName("立方体_0_7_6.6_8.1_0.10").children[0].material.color.clone()}var a=new lu.Tween(this.target.getObjectByName("立方体_0_7_6.6_8.1_0.10").children[0].material.color).to({r:1,g:.82,b:.58},500);a.start()}}}},{key:"onTouchMove",value:function e(t){if(!this.isRotation){this.isEnabled=false;return}if(this.identifier!=t.touches[0].identifier)return;if(this.isEnabled){var i=t.changedTouches[0];if(this.identifier!=i.identifier)return;if(this._moveSound.paused){this._moveSound.volume=0;this._moveSound.play();var r=new lu.Tween(this._moveSound).to({volume:1},2e3);r.onComplete(function(){lu.remove(r)});r.start()}this.update({rx:i.clientX,ry:i.clientY})}}},{key:"update",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},i=t.rx,r=t.ry;if(isNaN(i)||isNaN(r)){var n=this.target.rotation[this._type];n=Math.abs(nu(n));if(n>.3&&n<2.88){this.callback(true)}else{this.callback(false)}return}this.target.rotation[this._type]=nu(Math.atan2(this._scenePoint.y-r,this._scenePoint.x-i)-this.age)+Math.PI;var n=this.target.rotation[this._type];n=Math.abs(nu(n));if(n>.3&&n<2.88){this.rType=true;this.callback(true)}else{this.rType=false;this.callback(false)}}},{key:"target",set:function e(t){this._target=t},get:function e(){return this._target}},{key:"point",set:function e(t){this._scenePoint=this._engine.toScreenPosition(this.hitObject);this._point.x=t.x-this._scenePoint.x;this._point.y=t.y-this._scenePoint.y;this.age=Math.atan2(this._point.y,this._point.x)-this.target.rotation[this._type]},get:function e(){return this._point}},{key:"isEnabled",set:function e(t){var i=this;if(!t){var r=Math.PI;var n=0;for(var a=0;a<this.lock.length;a++){var s=this.lock[a];var o=this.target.rotation[this._type];var h=Math.abs(ru(o,s));if(r>Math.abs(h)){r=h;n=s}}if(this._tw){lu.remove(this._tw);this._tw.stop()}this._tw=new lu.Tween(this.target.rotation);var l={};var c=this.target.rotation[this._type];c+=ru(c,n);l[this._type]=c;var u=new lu.Tween(this._moveSound).to({volume:0},2e3);u.onComplete(function(){i._moveSound.pause();lu.remove(u)});this._moveSound.loop=false;this._tw.to(l,300);this._tw.start();this._tw.onUpdate(function(){var e=i.target.rotation[i._type];e=Math.abs(nu(e));if(e>.3&&e<2.88){i.rType=true;i.callback(true)}else{i.rType=false;i.callback(false)}});this._tw.onComplete(function(){i.target.rotation[i._type]=n;i._isEnabled=t;i.isOpen=i.openAge==n})}else{this._isEnabled=t}},get:function e(){return this._isEnabled}},{key:"isRotation",set:function e(t){if(t==this.isRotation)return;this._isRotation=t;if(this.target){var i=[this.target.getObjectByName("立方体_0_7_6.6_8.1_0.10"),this.target.getObjectByName("立方体_0_7_6.6_8.1_0.11"),this.target.getObjectByName("立方体_0_7_6.6_8.1_0.12"),this.target.getObjectByName("立方体_0_7_6.6_8.1_0.13")];var r=[this.target.getObjectByName("立方体_0_7_6.6_8.1_0.8"),this.target.getObjectByName("立方体_0_7_6.6_8.1_0.9")];for(var n=0;n<r.length;n++){if(!t){(function(){var e=new lu.Tween(r[n].scale).to({x:.2},500).easing(lu.Easing.Back.Out);e.start();e.onComplete(function(){lu.remove(e)})})()}else{(function(){var e=new lu.Tween(r[n].scale).to({x:1},500).easing(lu.Easing.Back.Out);e.onComplete(function(){lu.remove(e)});e.start()})()}}var a=[{x:90,y:0,z:0},{x:-90,y:0,z:0},{x:0,y:0,z:-90},{x:0,y:0,z:90}];for(var n=0;n<i.length;n++){var s=i[n];if(s.old===undefined){s.old=s.position.clone()}s.offs=s.old.clone();s.offs.x+=a[n].x;s.offs.y+=a[n].y;s.offs.z+=a[n].z;if(!t){(function(){var e=new lu.Tween(s.position).to({x:s.offs.x,y:s.offs.y,z:s.offs.z},500).easing(lu.Easing.Back.Out);e.onComplete(function(){lu.remove(e)});e.start()})()}else{(function(){var e=s.tw=new lu.Tween(s.position).to({x:s.old.x,y:s.old.y,z:s.old.z},500).easing(lu.Easing.Back.Out);e.onComplete(function(){lu.remove(e)});e.start()})()}}}},get:function e(){return this._isRotation}}]);return t}(ba);var dd=function(e){w(t,e);function t(e){g(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));i.init();i._paths=[];i._moveType=0;i._depth=0;i._hitObjects=e;i.position.x=0;i._age=new ti(0,1,0).normalize();i.position.y=-0;return i}y(t,[{key:"initAnimation",value:function e(t){this.clock=new Dl;this.clock.start=function(){this.startTime=Date.now();this.oldTime=this.startTime;this.elapsedTime=0;this.running=true};this.clock.getDelta=function(){var e=0;if(this.autoStart&&!this.running){this.start();return 0}if(this.running){var t=Date.now();e=(t-this.oldTime)/1e3;this.oldTime=t;this.elapsedTime+=e}return e};this.mixer=new Cl(t);this._res=hu.Assest.zip.Mother;var i=this.mixer.clipAction(ou(this._res.getFile("Idle.json").file));i.play();i.enabled=false;i.weight=0;this._Idle=i;var i=this.mixer.clipAction(ou(this._res.getFile("Walk.json").file));i.play();i.weight=0;i.enabled=false;this._walk=i;i.weight=0;var i=this.mixer.clipAction(ou(this._res.getFile("StairClimb.json").file));i.play();i.weight=0;i.enabled=false;this._ladderup=i;var i=this.mixer.clipAction(ou(this._res.getFile("StairDwon.json").file));i.play();i.weight=0;i.enabled=false;this._ladderdown=i;var i=this.mixer.clipAction(ou(this._res.getFile("CallWave.json").file));i.play();i.weight=0;i.enabled=false;this._callwave=i;i.clampWhenFinished=true;var i=this.mixer.clipAction(ou(this._res.getFile("Hug.json").file));i.play();i.weight=0;i.enabled=false;this._hug=i;i.clampWhenFinished=true;var r=ou(this._res.getFile("LadderClimb.json").file);var n=ou(this._res.getFile("LadderDown.json").file);var i=this.mixer.clipAction(this.getAnimationClip("scIn",n,0,40));i.weight=0;i.enabled=false;this._scIn=i;this._scIn.loop=Ct;i.clampWhenFinished=true;var i=this.mixer.clipAction(this.getAnimationClip("scIn",r,41,60));i.weight=0;i.enabled=false;this._scLoop=i;this._scLoop.play();var i=this.mixer.clipAction(this.getAnimationClip("scout",r,40,80));i.weight=0;i.enabled=false;i.loop=Ct;i.clampWhenFinished=true;this._scOut=i;var i=this.mixer.clipAction(this.getAnimationClip("scout",r,0,20));i.weight=0;i.enabled=false;i.loop=Ct;i.clampWhenFinished=true;this._ssIn=i;var i=this.mixer.clipAction(this.getAnimationClip("scout",n,60,81));i.weight=0;i.enabled=false;i.loop=Ct;i.clampWhenFinished=true;this._ssOut=i}},{key:"callHug",value:function e(){var t=this;this.mixer.addEventListener("finished",function(e){if(e.action==t._hug){t._iscallwave=false;setTimeout(function(){t.enabledAll(t._Idle)},0);t.dispatchEvent({type:"HogComplete",message:t.currentItem})}});this._iscallwave=true;this._Idle.enabled=false;this._Idle.weight=0;this._callwave.enabled=false;this._hug.enabled=true;this._hug.loop=Ct;this._hug.weight=1;this._hug.time=0}},{key:"callWave",value:function e(){this._iscallwave=true;this._Idle.enabled=false;this._Idle.weight=0;this._callwave.enabled=true;this._callwave.loop=Ct;this._callwave.weight=1;this._callwave.time=0}},{key:"showSitting",value:function e(){this._walk.weight=0;var t=this._res.getFile("HatMother_SittingFluteLoop.fbx").buffer;var i=this.mixer.clipAction(this.getAnimation(t));i.play();i.weight=1;this._sitting=i}},{key:"hideSitting",value:function e(){var t=this;this._sitting.weight=0;var i=this._res.getFile("HatMother_SittingFluteOut.fbx").buffer;var r=this.mixer.clipAction(this.getAnimation(i));r.play();r.weight=1;r.loop=Ct;this._sittingOut=r;this._playerLayer.position.z=0;this.hideMusicNote();var n=function e(i){if(i.action==r){new lu.Tween(t._mSw).to({opacity:.2},500).start().onComplete(function(){});t._Idle.weight=1;setTimeout(function(){r.weight=0},0);t.mixer.removeEventListener("finished",e);t.isStart=true;jd.getInstance().sendNotification("PlayerStart");t._playerLayer.children[0].children[3].visible=false}};this.mixer.addEventListener("finished",n);r.clampWhenFinished=true}},{key:"showMusicNote",value:function e(){var t=this._music=new Bu;t.position.x=-70;t.position.y=70;t.start();this.add(t)}},{key:"hideMusicNote",value:function e(){this._music.stop();this.remove(this._music);this._music=null}},{key:"deleteAni",value:function e(t){var i=t.tracks;for(var r=i.length-1;r>=0;r--){if(i[r].name.indexOf("Hat1")!=-1||i[r].name.indexOf("RightMidRobe")!=-1||i[r].name.indexOf("RightBottomRobe")!=-1||i[r].name.indexOf("LeftTopRobe")!=-1||i[r].name.indexOf("LeftMidRobe")!=-1||i[r].name.indexOf("LeftBottomRobe")!=-1||i[r].name.indexOf("BackTopRobe")!=-1||i[r].name.indexOf("BackMidRobe")!=-1||i[r].name.indexOf("BackBottomRobe")!=-1||i[r].name.indexOf("RightTopRobe")!=-1){i.splice(r,1)}}}},{key:"getAnimationClip",value:function e(t,i,r,n){this.mixer.clipAction(i);var a=i.tracks.length;var s=i.duration;var o=s*60;var h=r/o*s;var l=n/o*s;this.deleteAni(i);var c=[];for(var u=0;u<i.tracks.length;u++){var f=Nh.toJSON(i.tracks[u]);c[u]=Nh.parse(f);c[u].trim(h,l);c[u].shift(-h+.01);c[u].optimize()}var d=new zh(t,-1,c);d.resetDuration();d.trim();return d}},{key:"getAnimation",value:function e(t){var i=new eu.FBXLoader;var r=i.parseZip(t,this._res);return r.animations[0]}},{key:"hideHat",value:function e(){this._playerLayer.children[0].children[2].visible=false;this._playerLayer.children[0].children[3].visible=false}},{key:"init",value:function e(){this.temp={};this._moveSound=hu.Assest.zip.sound["fs_walk_leaves_A_05"];this._moveSound.loop=true;this.childMove=function(){};try{var t=new Uu;this._playerLayer=new eo;var i=this._ff=this._playerLayer=t.parseObject(hu.Assest.zip.Mother.getFile("Mother.json").file,hu.Assest.zip.Mother);this._offset=new ti(0,50,0);i.position.y=this._offset.y;i.position.x=this._offset.x;i.position.z=this._offset.z;i.castShadow=true;this.initAnimation(i);this.add(this._playerLayer)}catch(e){}var r=new Va(60,60,1);var n=new Xa({color:0,side:Y,map:iu("pshadow.png",hu.Assest.zip.loader)});n.transparent=true;n.opacity=.2;var a=new Qa(r,n);a.rotation.x=Math.PI/2;a.position.y=49;this.add(a);this._mSw=n;this._mSw.opacity=0;this._playerLayer.rotation.y=-Math.PI/2;this.isMove=false;this.moveIndex=0;this.currentItem=null}},{key:"getByName",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};for(var r=0;r<t.children.length;r++){i[t.children[r].name]=t.children[r];if(t.children[r].children){this.getByName(t.children[r],i)}}return i}},{key:"enabledAll",value:function e(t){for(var i=0;i<this.mixer._actions.length;i++){this.mixer._actions[i].enabled=this.mixer._actions[i]==t}t.weight=1;this.mixer.update(0)}},{key:"setAnimationData",value:function e(t,i,r,n){var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:-Math.PI/2;var o=arguments[6];var h=arguments[7];var l=arguments[8];o=o||0;h=h||0;l=l||function(){};this._isSCC=true;if(!t.enabled){this.enabledAll(t);t.enabled=true;t.weight=1;t.time=0;t.paused=false;t.reset();t.play();this.position.copy(i);var c=this.currentItem.tw=new lu.Tween(this.position).to(r,r.time);var u=this.currentItem.tw1=new lu.Tween(this.position).to(n,n.time);c.chain(u);c.start();this._playerLayer.rotation.y=s}if(!t.isRunning()){this._playerLayer.rotation.y=s;this.isNodeRender=true;this.isMove=false;if(this.isChange){this.isMove=false;this.isChange=false;this.moveList=this.moveList;return}this.currentItem.tw.stop();this.currentItem.tw1.stop();lu.remove(this.currentItem.tw);lu.remove(this.currentItem.tw1);this.currentItem.tw=undefined;this.currentItem.tw1=undefined;if(a){var f=(new ti).applyMatrix4(this.currentItem.matrixWorld);var d=this.parent.worldToLocal(f);d.x+=o;d.y+=h;this.position.copy(d)}if(this.moveIndex<this.moveList.length-1){this.childMove(this.currentItem);this.isNodeRender=false;this._iscallwave=false;this._oldTarget=this.currentItem;t.enabled=false;t.weight=0;this._isSCC=false;var p=this._moveList[++this.moveIndex];if(!p.data.up&&!p.data.down){this.setRotation(p)}this.currentItem=p;this.isMove=true}else{this.isNodeRender=true;this._iscallwave=true;this.targetBox=this.currentItem;this._moveSound.pause();this._Idle.enabled=a;this._isSCC=true;l();this.dispatchEvent({type:"moveComplete",message:this.currentItem})}}}},{key:"update",value:function e(t){var i=this;var t=this.clock.getDelta();this.mixer.update(t);t=t>.02?.04:.02;this._delta=t;if(!this.isStart){if(this.isGameEnd)return;var r=(new ti).applyMatrix4(this.targetBox.matrixWorld);var n=this.parent.worldToLocal(r);this.position.copy(n);this._playerLayer.rotation.y=0;this._playerLayer.children[0].children[1].children[0].children[2].children[1].position.y+=46;return}if(this.isMove){if(this._moveSound.paused){this._moveSound.play()}var a=this.currentItem;var s=this.position.clone();this.targetBox=a;var r=(new ti).applyMatrix4(a.matrixWorld);var n=this.parent.worldToLocal(r);var o=new ti;if(a.data.up&&this._oldTarget.data.upOut){var h=n.y;var l=n.x;n.x+=75;n.y-=100;this.setAnimationData(this._ssIn,n,{x:l+50,y:n.y,time:160},{y:h-35,time:160},false,-Math.PI/2);return}else if(a.data.upOut&&this._oldTarget.data.up){var h=n.y;var l=n.x;n.x-=50;this.setAnimationData(this._ssOut,n,{x:l,y:h,time:300},{time:300},true,-Math.PI/2,0,0,function(){i.enabledAll(i._Idle);i._Idle.weight=1;i._playerLayer.rotation.y=Math.PI/2});return}else if(a.data.up&&this._oldTarget.data.down){var h=n.y;var l=n.x;if(!this._scLoop.enabled||this._scLoop.paused){this.enabledAll(this._scLoop);this._scLoop.paused=false;this._scLoop.reset();this._scLoop.play();this._playerLayer.rotation.y=-Math.PI/2;this.mixer.update(0)}this.position.x=l+50;this.position.z=n.z;n.y-=50;var s=this.position.clone();o=o.subVectors(s,n);var c=o.length();c=c<=0?.1:c;s.y-=t*300*(o.y/c);this.position.y=s.y;n.x+=50;o=o.subVectors(s,n);if(o.length()<7){this._scLoop.paused=true;if(this.isChange){this.isMove=false;this.isChange=false;this.moveList=this.moveList;return}if(this.moveIndex<this.moveList.length-1){this.childMove(this.currentItem);this.isNodeRender=true;this._iscallwave=true;this._oldTarget=this.currentItem;this._isSCC=false;var u=this._moveList[++this.moveIndex];this.currentItem=u}else{this.isNodeRender=true;this._iscallwave=true;this.targetBox=this.currentItem;this.isMove=false;this._isSCC=false;this._moveSound.pause();this.dispatchEvent({type:"moveComplete",message:this.currentItem})}}this._playerLayer.rotation.y=-Math.PI/2;this._playerLayer.updateMatrixWorld();return}else if(a.data.down&&this._oldTarget.data.up){var h=n.y;var l=n.x;if(!this._scLoop.enabled||this._scLoop.paused){this.enabledAll(this._scLoop);this._scLoop.paused=false;this._scLoop.reset();this._playerLayer.rotation.y=-Math.PI/2;this._scLoop.play();this.mixer.update(0)}this.position.x=l+50;this.position.z=n.z;n.y-=50;var s=this.position.clone();o=o.subVectors(s,n);var c=o.length();c=c<=0?.1:c;s.y-=t*300*(o.y/c);this.position.y=s.y;n.x+=50;o=o.subVectors(s,n);if(o.length()<10){this._scLoop.paused=true;if(this.isChange){this.isMove=false;this.isChange=false;this.moveList=this.moveList;return}if(this.moveIndex<this.moveList.length-1){this.isNodeRender=true;this._iscallwave=true;this._oldTarget=this.currentItem;this.childMove(this.currentItem);this._isSCC=false;var u=this._moveList[++this.moveIndex];this.currentItem=u}else{this.isNodeRender=true;this._iscallwave=true;this.targetBox=this.currentItem;this.isMove=false;this._isSCC=false;this._moveSound.pause();this.dispatchEvent({type:"moveComplete",message:this.currentItem})}}this._playerLayer.rotation.y=-Math.PI/2;this._playerLayer.updateMatrixWorld();return}else if(a.data.downOut&&this._oldTarget&&this._oldTarget.data.down){var h=n.y;var l=n.x;n.x+=50;n.y-=75;this.setAnimationData(this._scOut,n,{y:h,time:300},{x:l,y:h,time:300},true,-Math.PI/2,0,0,function(){i.enabledAll(i._Idle);i._playerLayer.rotation.y=-Math.PI/2;i._Idle.weight=1});return}else if(a.data.down&&this._oldTarget.data.downOut){this.setAnimationData(this._scIn,n,{x:n.x+50,time:330},{y:n.y-50,time:330},false,-Math.PI/2);return}else{this.isSC=false;this._isSCC=false;this._Idle.weight=0;this._Idle.enabled=false;this._walk.enabled=true;this._walk.weight=1;this._scIn.enabled=false;this._scIn.weight=0;this._iscallwave=false;this.isNodeRender=false}o=o.subVectors(s,n);var c=o.length();c=c<=0?.1:c;s.x-=t*300*(o.x/c);s.y-=t*300*(o.y/c);s.z-=t*300*(o.z/c);this._playerLayer.position.set(this._offset.x,this._offset.y,this._offset.z);if(c>50&&this._oldTarget&&this._oldTarget.data.depth){this._playerLayer.position.add(this._oldTarget.data.depth)}else if(c<50&&a.data.depth){this._playerLayer.position.add(a.data.depth)}else if(this._oldTarget===undefined&&a.data.depth){this._playerLayer.position.add(a.data.depth)}if(a.data.t==1){if(!this._ladderup.enabled)this.enabledAll(this._ladderup)}else{if(!this._walk.enabled)this.enabledAll(this._walk)}this.position.copy(s);var f=s.clone();var d=n.clone().sub(f);if(a.data.touch)a.data.touch.isRotation=false;if(c<10){this.currentItem=a;if(this.isChange){this.isMove=false;this.isChange=false;this.moveList=this.moveList;return}var p=this._oldTarget=a;var v=this.moveIndex;if(this.moveIndex<this.moveList.length-1){for(var m=0;m<this.touchs.length;m++){this.touchs[m].isRotation=true}this.isNodeRender=false;var u=this._moveList[++this.moveIndex];var r=(new ti).applyMatrix4(u.matrixWorld);var n=this.parent.worldToLocal(r);o=new ti;o.subVectors(s,n);if(o.length()>120){if(u.data.up||u.data.down||u.data.upOut||u.data.up||u.data.g){}else{this.targetBox=a;this.isMove=false;return}}if(this.currentItem.data.touch){for(var m=0;m<this.touchs.length;m++){this.touchs[m].isRotation=false}}else{if(p.touch){this.touch=p.touch;p.touch.isRotation=true}}if(a.data.openFun&&!a.data.save){a.data.save=true;a.data.openFun();if(a.data.isNext===undefined){this.isMove=false;return}else{this.childMove(a)}}else{this.childMove(a)}this.setRotation(u);this.currentItem=u}else{this.isNodeRender=false;if(this.currentItem.data.touch){for(var m=0;m<this.touchs.length;m++){this.touchs[m].isRotation=false}}else{if(p.touch){this.touch=p.touch;p.touch.isRotation=true}}if(this.isChange){this.isMove=false;this.isChange=false;this.moveList=this.moveList;return}this.targetBox=this.currentItem;this.isMove=false;this._Idle.time=0;this.dispatchEvent({type:"moveComplete",message:this.currentItem});if(this.currentItem.data.openFun&&!this.currentItem.data.save){this.currentItem.data.save=true;this.currentItem.data.openFun(this.targetBox)}if(a.data.gameEnd){this._moveSound.pause();this.isGameEnd=true;this.isStart=false;this.childMove(a);this._moveSound.stop();var g=new lu.Tween(this.position).to({x:this.position.x-75},1e3).onComplete(function(){i.dispatchEvent({type:"gameOver"});i.visible=false});g.start()}}}else{}}else{this.isMove=false;if(this.isNodeRender)return;var r=(new ti).applyMatrix4(this.targetBox.matrixWorld);var n=this.parent.worldToLocal(r);this.position.copy(n);if(this.currentItem.data.touch===undefined&&this.parent.parent.child.currentItem.data.touch===undefined){for(var m=0;m<this.touchs.length;m++){this.touchs[m].isRotation=true}}if(!this._moveSound.paused){this._moveSound.pause()}if(!this._iscallwave){if(!this._Idle.enabled)this.enabledAll(this._Idle)}this._playerLayer.position.set(this._offset.x,this._offset.y,this._offset.z);if(this.targetBox.data.depth){this._playerLayer.position.add(this.targetBox.data.depth)}}}},{key:"setRotation",value:function e(t){if(this.currentItem&&this.currentItem==r)return;if(this.currentItem===undefined||t.data.down||t.data.up||this.currentItem.data.up||this.currentItem.data.down)return;var i=(new ti).applyMatrix4(t.matrixWorld);var r=this.parent.worldToLocal(i);var i=(new ti).applyMatrix4(this.currentItem.matrixWorld);var n=this.parent.worldToLocal(i);r.sub(n);var a=nu(Math.atan2(r.z,-r.x)-Math.PI/2);this._playerLayer.rotation.y=a}},{key:"upPos",value:function e(t){if(!this.currentItem||!this.parent)return;var i=this.parent.worldToLocal(t);this.updateMatrixWorld();this.currentItem.updateMatrixWorld();var r=this.position.clone().sub(i);var i=(new ti).applyMatrix4(this.currentItem.matrixWorld);var n=this.parent.worldToLocal(i);n.add(r);this.position.copy(n);this._playerLayer.position.set(this._offset.x,this._offset.y,this._offset.z);if(this.currentItem.data.depth){this._playerLayer.position.add(this.currentItem.data.depth)}}},{key:"hitObjects",set:function e(t){this._hitObjects=t},get:function e(){return this._hitObjects}},{key:"moveList",set:function e(t){this._moveList=t;if(this.isMove){this.isChange=true;return}this._oldTarget=this.currentItem;this.childMove(this.targetBox);this.moveIndex=0;this.setRotation(this.moveList[this.moveIndex]);this.currentItem=this.moveList[this.moveIndex];this.isMove=true},get:function e(){return this._moveList}}]);return t}(ba);var pd=function(e){w(t,e);function t(e){g(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));i.init();i._paths=[];i._depth=0;i._hitObjects=e;i.position.x=0;i._age=new ti(0,1,0).normalize();i.position.y=-0;return i}y(t,[{key:"initAnimation",value:function e(t){this.clock=new Dl;this.clock.start=function(){this.startTime=(new Date).getTime();this.oldTime=this.startTime;this.elapsedTime=0;this.running=true};this.clock.getDelta=function(){var e=0;if(this.autoStart&&!this.running){this.start();return 0}if(this.running){var t=(new Date).getTime();e=(t-this.oldTime)/1e3;this.oldTime=t;this.elapsedTime+=e}return e};this.mixer=new Cl(t);var i=this.mixer.clipAction(ou(this._res.getFile("Idle.json").file));i.play();i.enabled=false;i.weight=0;this._Idle=i;var i=this.mixer.clipAction(ou(this._res.getFile("Walk.json").file));i.play();i.weight=0;i.enabled=false;this._walk=i;i.weight=0;var i=this.mixer.clipAction(ou(this._res.getFile("StairClimb.json").file));i.play();i.weight=0;i.enabled=false;this._ladderup=i;var i=this.mixer.clipAction(ou(this._res.getFile("StairsDown.json").file));i.play();i.weight=0;i.enabled=false;this._ladderdown=i;var i=this.mixer.clipAction(ou(this._res.getFile("HugLeft.json").file));i.play();i.weight=0;i.enabled=false;this._hug=i;i.clampWhenFinished=true;var r=ou(this._res.getFile("LadderDown.json").file);var n=ou(this._res.getFile("LadderClimb.json").file);var i=this.mixer.clipAction(this.getAnimationClip("scIn",r,0,40));i.weight=0;i.enabled=false;this._scIn=i;this._scIn.loop=Ct;i.clampWhenFinished=true;var i=this.mixer.clipAction(this.getAnimationClip("scIn",r,40,60));i.weight=0;i.enabled=false;this._scLoop=i;this._scLoop.play();var i=this.mixer.clipAction(this.getAnimationClip("scout",n,40,80));i.weight=0;i.enabled=false;i.loop=Ct;i.clampWhenFinished=true;this._scOut=i;var i=this.mixer.clipAction(this.getAnimationClip("scout",n,0,20));i.weight=0;i.enabled=false;i.loop=Ct;i.clampWhenFinished=true;this._ssIn=i;var i=this.mixer.clipAction(this.getAnimationClip("scout",r,60,81));i.weight=0;i.enabled=false;i.loop=Ct;i.clampWhenFinished=true;this._ssOut=i}},{key:"callHug",value:function e(){var t=this;this.mixer.addEventListener("finished",function(e){if(e.action==t._hug){t._iscallwave=false;t._hug.enabled=false}});this._iscallwave=true;this._Idle.enabled=false;this._Idle.weight=0;this._walk.weight=0;this._walk.enabled=false;this._hug.enabled=true;this._hug.loop=Ct;this._hug.weight=1;this._hug.time=0}},{key:"getAnimation",value:function e(t){var i=new eu.FBXLoader;var r=i.parseZip(t,this._res);return r.animations[0]}},{key:"getAnimationClip",value:function e(t,i,r){var n=t.duration*60;var a=i==0?0:i/60;var s=r==0?0:r/60;var o=t.tracks.length;var h=t.clone();h.tracks=t.tracks.slice(Math.floor(a*o),Math.floor(s*o));h.resetDuration();return h}},{key:"init",value:function e(){this._res=hu.Assest.zip.Child;try{var t=new Uu;this._playerLayer=new eo;var i=this._playerLayer=t.parseObject(this._res.getFile("Child.json").file,this._res);i.getObjectByName("ChildHat").visible=false;i.traverse(function(e){if(e instanceof Ys){e.material.color=new Ki(16777215)}});i.scale.set(1,1,1);this._offset=new ti(0,50,0);i.position.y=this._offset.y;i.position.x=this._offset.x;i.position.z=this._offset.z;this.initAnimation(i);this.add(this._playerLayer)}catch(e){}var r=new Va(60,60,1);var n=new Xa({color:0,side:Y,map:iu("pshadow.png",hu.Assest.zip.loader)});n.transparent=true;n.opacity=.2;var a=new Qa(r,n);a.rotation.x=Math.PI/2;a.position.y=49;this.add(a);this._mSw=n;this._mSw.opacity=0;this._playerLayer.rotation.y=-Math.PI/2;this.isMove=false;this.moveIndex=0;this.currentItem=null}},{key:"getByName",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};for(var r=0;r<t.children.length;r++){i[t.children[r].name]=t.children[r];if(t.children[r].children){this.getByName(t.children[r],i)}}return i}},{key:"deleteAni",value:function e(t){var i=t.tracks;for(var r=i.length-1;r>=0;r--){if(i[r].name.indexOf("Hat1")!=-1||i[r].name.indexOf("RightMidRobe")!=-1||i[r].name.indexOf("RightBottomRobe")!=-1||i[r].name.indexOf("LeftTopRobe")!=-1||i[r].name.indexOf("LeftMidRobe")!=-1||i[r].name.indexOf("LeftBottomRobe")!=-1||i[r].name.indexOf("BackTopRobe")!=-1||i[r].name.indexOf("BackMidRobe")!=-1||i[r].name.indexOf("BackBottomRobe")!=-1||i[r].name.indexOf("RightTopRobe")!=-1){i.splice(r,1)}}}},{key:"getAnimationClip",value:function e(t,i,r,n){var a=i.tracks.length;var s=i.duration;var o=s*60;var h=r/o*s;var l=n/o*s;this.deleteAni(i);var c=[];for(var u=0;u<i.tracks.length;u++){var f=Nh.toJSON(i.tracks[u]);c[u]=Nh.parse(f);c[u].trim(h,l);c[u].shift(-h+.01);c[u].optimize()}var d=new zh(t,-1,c);d.resetDuration();d.trim();return d}},{key:"setAnimationData",value:function e(t,i,r,n){var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:-Math.PI/2;var o=arguments[6];var h=arguments[7];var l=arguments[8];o=o||0;h=h||0;l=l||function(){};this._isSCC=true;if(!t.enabled){this.enabledAll(t);t.enabled=true;t.weight=1;t.time=0;t.paused=false;t.reset();if(this._ssI==t){this._ssIn.timeScale=.25}t.play();this.position.copy(i);var c=this.currentItem.tw=new lu.Tween(this.position).to(r,r.time);var u=this.currentItem.tw1=new lu.Tween(this.position).to(n,n.time);c.chain(u);c.start();this._playerLayer.rotation.y=s}if(!t.isRunning()){this._playerLayer.rotation.y=s;this.isNodeRender=true;this.isMove=false;if(this.isChange){this.isMove=false;this.isChange=false;this.moveList=this.moveList;return}this.currentItem.tw.stop();this.currentItem.tw1.stop();lu.remove(this.currentItem.tw);lu.remove(this.currentItem.tw1);this.currentItem.tw=undefined;this.currentItem.tw1=undefined;if(a){var f=(new ti).applyMatrix4(this.currentItem.matrixWorld);var d=this.parent.worldToLocal(f);d.x+=o;d.y+=h;this.position.copy(d)}if(this.moveIndex<this.moveList.length-1){this.isNodeRender=false;this._iscallwave=false;this._oldTarget=this.currentItem;t.enabled=false;t.weight=0;this._isSCC=false;var p=this._moveList[++this.moveIndex];if(!p.data.up&&!p.data.down){this.setRotation(p)}this.currentItem=p;this.isMove=true}else{l();this.isNodeRender=true;this._iscallwave=true;this.targetBox=this.currentItem;this._Idle.enabled=a;this._isSCC=true;this.dispatchEvent({type:"moveComplete",message:this.currentItem})}}}},{key:"update",value:function e(t){var i=this;if(!this.clock||!this.mixer)return;var r=this.clock.getDelta();this.mixer.update(r);r=r>.02?.04:.02;if(!this.isStart){if(this.isGameEnd)return;var n=(new ti).applyMatrix4(this.targetBox.matrixWorld);var a=this.parent.worldToLocal(n);this.position.copy(a);this._playerLayer.rotation.y=0;this._playerLayer.children[0].children[1].children[0].children[2].children[1].position.y+=46;return}if(this.isMove){var s=this.currentItem;var o=this.position.clone();this.targetBox=s;var n=(new ti).applyMatrix4(s.matrixWorld);var a=this.parent.worldToLocal(n);var h=new ti;if(s.data.up&&this._oldTarget.data.upOut){var l=a.y;var c=a.x;a.x+=75;a.y-=85;this.setAnimationData(this._ssIn,a,{x:c+50,y:a.y,time:160},{y:l-35,time:160});return}else if(s.data.upOut&&this._oldTarget.data.up){var l=a.y;var c=a.x;a.x-=50;this.setAnimationData(this._ssOut,a,{x:c+15,y:l+15,time:300},{time:300},true,-Math.PI/2,0,0,function(){i.enabledAll(i._Idle);i._Idle.weight=1;i._playerLayer.rotation.y=Math.PI/2});return}else if(s.data.up&&this._oldTarget.data.down){var l=a.y;var c=a.x;if(!this._scLoop.enabled||this._scLoop.paused){this.enabledAll(this._scLoop);this._scLoop.paused=false;this._scLoop.play()}this.position.x=c+50;this.position.z=a.z;a.y-=50;var o=this.position.clone();h=h.subVectors(o,a);var u=h.length();u=u<=0?.1:u;o.y-=r*300*(h.y/u);this.position.y=o.y;a.x+=50;h=h.subVectors(o,a);if(h.length()<10){this.position.copy(a);this._scLoop.paused=true;if(this.isChange){this.isMove=false;this.isChange=false;this.moveList=this.moveList;return}if(this.moveIndex<this.moveList.length-1){this.isNodeRender=false;this._oldTarget=this.currentItem;this._isSCC=false;this.currentItem=this._moveList[++this.moveIndex]}else{this.isNodeRender=true;this._iscallwave=true;this.targetBox=this.currentItem;this.isMove=false;this._isSCC=false;this.dispatchEvent({type:"moveComplete",message:this.currentItem})}}this._playerLayer.rotation.y=-Math.PI/2;return}else if(s.data.down&&this._oldTarget.data.up){this._playerLayer.rotation.y=-Math.PI/2;var l=a.y;var c=a.x;if(!this._scLoop.enabled||this._scLoop.paused){this.enabledAll(this._scLoop);this._scLoop.paused=false;this._scLoop.play()}this.position.x=c+50;this.position.z=a.z;a.y-=50;var o=this.position.clone();h=h.subVectors(o,a);var u=h.length();u=u<=0?.1:u;o.y-=r*300*(h.y/u);this.position.y=o.y;a.x+=50;h=h.subVectors(o,a);if(h.length()<10){this.position.copy(a);this._scLoop.paused=true;if(this.isChange){this.isMove=false;this.isChange=false;this.moveList=this.moveList;return}if(this.moveIndex<this.moveList.length-1){this.isNodeRender=false;this.isNodeRender=false;this._oldTarget=this.currentItem;this._isSCC=false;this.currentItem=this._moveList[++this.moveIndex]}else{this.isNodeRender=true;this._iscallwave=true;this.targetBox=this.currentItem;this.isMove=false;this._isSCC=false;this.dispatchEvent({type:"moveComplete",message:this.currentItem})}}return}else if(s.data.downOut&&this._oldTarget&&this._oldTarget.data.down){var l=a.y;var c=a.x;a.x+=50;a.y-=50;this.setAnimationData(this._scOut,a,{y:l,time:300},{x:c,y:l,time:300},true,-Math.PI/2,0,0,function(){i.enabledAll(i._Idle);i._playerLayer.rotation.y=-Math.PI/2;i._Idle.weight=1});return}else if(s.data.down&&this._oldTarget.data.downOut){this.setAnimationData(this._scIn,a,{x:a.x+50,time:330},{y:a.y-50,time:330},true,-Math.PI/2,50,-100);return}else{this.isSC=false;this._isSCC=false;this._Idle.weight=0;this._Idle.enabled=false;this._walk.enabled=true;this._walk.weight=1;this._scIn.enabled=false;this._scIn.weight=0;this._iscallwave=false}h=h.subVectors(o,a);var u=h.length();u=u<=0?.1:u;o.x-=r*300*(h.x/u);o.y-=r*300*(h.y/u);o.z-=r*300*(h.z/u);this._playerLayer.position.set(this._offset.x,this._offset.y,this._offset.z);if(u>50&&this._oldTarget&&this._oldTarget.data.depth){this._playerLayer.position.add(this._oldTarget.data.depth)}else if(u<50&&s.data.depth){this._playerLayer.position.add(s.data.depth)}else if(this._oldTarget===undefined&&s.data.depth){this._playerLayer.position.add(s.data.depth)}if(s.data.t==1){this.enabledAll(this._ladderup)}else{this.enabledAll(this._walk)}this.position.copy(o);var f=o.clone();var d=a.clone().sub(f);if(s.data.touch)s.data.touch.isRotation=false;if(u<10){this.currentItem=s;if(this.isChange){this.isMove=false;this.isChange=false;this.moveList=this.moveList;return}var p=this._oldTarget=s;var v=this.moveIndex;if(this.moveIndex<this.moveList.length-1){for(var m=0;m<this.touchs.length;m++){this.touchs[m].isRotation=true}this.isNodeRender=false;var g=this._moveList[++this.moveIndex];var n=(new ti).applyMatrix4(g.matrixWorld);var a=this.parent.worldToLocal(n);h=new ti;h.subVectors(o,a);if(h.length()>120){if(g.data.up||g.data.down||g.data.upOut||g.data.up||g.data.g){}else{this.targetBox=s;this.isMove=false;return}}this.setRotation(g);this.currentItem=g;if(this.currentItem.data.touch){for(var m=0;m<this.touchs.length;m++){this.touchs[m].isRotation=false}}else{if(p.touch){this.touch=p.touch;p.touch.isRotation=true}}}else{this.isNodeRender=false;if(this.currentItem.data.touch){for(var m=0;m<this.touchs.length;m++){this.touchs[m].isRotation=false}}else{if(p.touch){this.touch=p.touch;p.touch.isRotation=true}}if(this.isChange){this.isMove=false;this.isChange=false;this.moveList=this.moveList;return}this.targetBox=this.currentItem;this.isMove=false;this._Idle.time=0;this.dispatchEvent({type:"moveComplete",message:this.currentItem});if(s.data.gameEnd){this.isGameEnd=true;this.isStart=false;var y=new lu.Tween(this.position).to({x:this.position.x-75},1e3).onComplete(function(){i.dispatchEvent({type:"gameOver"});i.visible=false});y.start()}}}else{}}else{this.isMove=false;if(this.isNodeRender)return;var n=(new ti).applyMatrix4(this.targetBox.matrixWorld);var a=this.parent.worldToLocal(n);this.position.copy(a);if(!this._iscallwave){this.enabledAll(this._Idle)}this._playerLayer.position.set(this._offset.x,this._offset.y,this._offset.z);if(this.targetBox.data.depth){this._playerLayer.position.add(this.targetBox.data.depth)}}}},{key:"setRotation",value:function e(t){if(this.currentItem&&this.currentItem==r)return;if(this.currentItem===undefined||t.data.down||t.data.up||this.currentItem.data.up||this.currentItem.data.down)return;var i=(new ti).applyMatrix4(t.matrixWorld);var r=this.parent.worldToLocal(i);var i=(new ti).applyMatrix4(this.currentItem.matrixWorld);var n=this.parent.worldToLocal(i);r.sub(n);var a=nu(Math.atan2(r.z,-r.x)-Math.PI/2);this._playerLayer.rotation.y=a}},{key:"enabledAll",value:function e(t){for(var i=0;i<this.mixer._actions.length;i++){this.mixer._actions[i].enabled=this.mixer._actions[i]==t}t.weight=1;this.mixer.update(0)}},{key:"upPos",value:function e(t){if(!this.currentItem||!this.parent)return;var i=this.parent.worldToLocal(t);this.updateMatrixWorld();this.currentItem.updateMatrixWorld();var r=this.position.clone().sub(i);var i=(new ti).applyMatrix4(this.currentItem.matrixWorld);var n=this.parent.worldToLocal(i);n.add(r);this.position.copy(n);this._playerLayer.position.set(this._offset.x,this._offset.y,this._offset.z);if(this.currentItem.data.depth){this._playerLayer.position.add(this.currentItem.data.depth)}}},{key:"hitObjects",set:function e(t){this._hitObjects=t},get:function e(){return this._hitObjects}},{key:"moveList",set:function e(t){this._moveList=t;if(this.isMove){this.isChange=true;return}if(t.length==0)return;this._oldTarget=this.currentItem;this.moveIndex=0;this.setRotation(this.moveList[this.moveIndex]);this.currentItem=this.moveList[this.moveIndex];this.isMove=true},get:function e(){return this._moveList}}]);return t}(ba);var vd=function(e){w(t,e);function t(){g(this,t);var e=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e._frameCount=0;e.init();return e}y(t,[{key:"init",value:function e(){this._frames=t.FRAME_LIST;var i=this._spriteMaterial=new Xa({map:this._frames[4],color:16777215});i.transparent=true;i.side=2;i.depthWrite=false;var r=new Va(128,175,1);var n=new Qa(r,i);this.add(n)}},{key:"start",value:function e(){var t=this;var i=new lu.Tween(this).to({_frameCount:34},800).onUpdate(function(){var e=t._frames[Math.floor(t._frameCount)];if(t._spriteMaterial.map!=e){t._spriteMaterial.map=e;t._spriteMaterial.needsUpdate=true}}).onComplete(function(){if(t.parent){t.parent.remove(t)}lu.remove(i)});i.start()}}]);return t}(ba);vd.FRAME_LIST=[];vd.INIT=function(){var e=hu.Assest.zip.smoke;var t=e.files.length;var i=[];for(var r=0;r<t;r++){var n=r+949;n="smoke_00"+n+".png";i.push(iu(n,e))}vd.FRAME_LIST=i};var md=function(e){w(t,e);function t(e){g(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));i.init();i.data=e;return i}y(t,[{key:"init",value:function e(){this._time=0;this._duration=0;this._animations=[];this._map=null;var t=this._spriteMaterial=new Gs({color:16777215});t.depthTest=false;var i=new Hs(t);this._material=t;i.scale.set(60,60,1);this.add(i)}},{key:"remove",value:function e(){}},{key:"update",value:function e(){if(this._animations[this._time]){var t=this._animations[this._time].frame;if(this._material.map!=t)this._material.map=t}this._time++;if(this._time>=this._duration){this._time=0}}},{key:"data",set:function e(t){this._data=t;if(this.data){this._time=0;this._animations=[];this._duration=this.data.time;for(var i=0;i<this.data.animations.length;i++){var r=this.data.animations[i];this._animations[r.time]=r}this._material.map=this.data.animations[0].frame}},get:function e(){return this._data}}]);return t}(ba);md.INIT=function(){var e=[{f:"crow1",time:1e3,animations:[{name:"crow0.png",time:0},{name:"crow1.png",time:60},{name:"crow2.png",time:200},{name:"crow0.png",time:500}]},{f:"crow2",time:1e3,animations:[{name:"crow0.png",time:0},{name:"crow1.png",time:60},{name:"crow2.png",time:200},{name:"crow0.png",time:500}]},{f:"crow3",time:1e3,animations:[{name:"crow0.png",time:0},{name:"crow1.png",time:60},{name:"crow2.png",time:200},{name:"crow0.png",time:500}]},{f:"crow4",time:1500,animations:[{name:"crow0.png",time:0},{name:"crow1.png",time:60},{name:"crow2.png",time:200},{name:"crow3.png",time:500}]},{f:"crow5",time:40,animations:[{name:"crow0.png",time:0},{name:"crow1.png",time:10},{name:"crow2.png",time:20},{name:"crow0.png",time:30}]},{f:"crow6",time:40,animations:[{name:"crow0.png",time:0},{name:"crow1.png",time:10},{name:"crow2.png",time:20},{name:"crow0.png",time:30}]},{f:"crow7",time:40,animations:[{name:"crow0.png",time:0}]}];var t=hu.Assest.zip.crow;var i=t.files.length;var r={};for(var n=0;n<e.length;n++){var a=e[n];var s=a.f+"/";for(var o=0;o<a.animations.length;o++){var h=a.animations[o];if(r[s+h.name]){h.frame=r[s+h.name]}else{r[s+h.name]=h.frame=iu(s+h.name,t)}}md.ANIMATIONS["crow_"+n]=a}r=null};md.ANIMATIONS={};var gd=function(e){w(t,e);function t(){g(this,t);var e=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e.init();return e}y(t,[{key:"init",value:function e(){var t=[16728320,16774724,16755243,16738576];var i=[];var r=iu("leaf.png",hu.Assest.zip.two);for(var n=0;n<t.length;n++){var a=new Gs({map:r,color:t[n],depthWrite:false,transparent:true});i.push(a)}this._materials=i;for(var n=0;n<20;n++){var s=Math.floor(Math.random()*i.length);var o=new Hs(i[s].clone());o.material.rotation=Math.random()*Math.PI;o.scale.set(20,20,1);o.position.x=Qt.randFloatSpread(500);o.position.z=Qt.randFloatSpread(500);this.add(o);o.visible=false;this.effectObject(o)}}},{key:"effectObject",value:function e(t){var i=this;var r=t.position.clone();var n=Math.PI/2;var a=Math.random()*20+90;var s=Math.random()*.05;s*=Math.random()>.5?-1:1;var o=Math.random()*200+2e3;var h=Math.random()*100-150+500;r.y=h;var l=new lu.Tween(t.position).to({y:h},800).onStart(function(){t.visible=true});var c=new lu.Tween(t.position).to({y:-600},6e3).onUpdate(function(){t.position.x=r.x+Math.cos(n)*a;n+=s;a-=.01}).onStart(function(){r=t.position.clone()});c.onComplete(function(){lu.remove(l);lu.remove(c);i.visible=false});l.chain(c);l.easing(lu.Easing.Back.Out);l.start()}}]);return t}(ba);var yd=function(e){w(t,e);function t(e,i){g(this,t);return b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i))}y(t,[{key:"onRegister",value:function e(){vd.INIT();md.INIT();this._crows=[];this._smokes=[];for(var t=0;t<2;t++){var i=new vd;this.add(i);i.scale.set(4.9,4.9,4.9);if(t<1){i.rotation.y=t%2==0?Math.PI:0;i.position.set(-360,-926,370)}else{i.rotation.y=Math.PI/2+(t%2==0?Math.PI:0);i.position.set(-60,-1037,70)}i.visible=false;this._smokes.push(i)}var r=[{id:0,x:-330,y:-910,z:80},{id:1,x:-240,y:-1100,z:190},{id:2,x:-500,y:-1100,z:300},{id:3,x:-160,y:-1100,z:0},{id:6,x:-290,y:-1100,z:-100}];var n=[1.1,1.1,1.2,1,1.1,1.1,1.1];for(var t=0;t<r.length;t++){var a=r[t];var s=new md;s.data=md.ANIMATIONS["crow_"+a.id];s.position.set(a.x,a.y,a.z);s.scale.set(n[t],n[t],n[t]);this._crows.push(s);this.add(s)}}},{key:"rplay",value:function e(t,i){setTimeout(function(){t.start()},i)}},{key:"start",value:function e(){for(var t=0;t<this._smokes.length;t++){this._smokes[t].visible=true;this.rplay(this._smokes[t],t>0?Math.random()*100+100:0)}var i=[[{x:150,y:-910,z:80,time:800},{x:150,y:-400,z:-300,time:800}],[{x:-1800,time:1300}],[{x:150,y:-880,z:99,time:800},{x:150,y:-450,z:-350,time:800}],[{x:-500,y:-500,time:1300}],[{x:-1800,y:-500,time:1300}]];var r=[-1,1,-1,1,1,1,1,1];for(var t=0;t<this._crows.length;t++){this._crows[t].data=md.ANIMATIONS["crow_"+(t<4?4:5)];var n=i[t];var a=this._crows[t];this.crowFly(a,n,r[t])}this._leaf=new gd;this.add(this._leaf);this._leaf.position.y=-1100;this._leaf.position.x=-310;this._leaf.position.z=100}},{key:"crowFly",value:function e(t,i,r){if(i===undefined)return;var n,a;n=a=new lu.Tween(t.position).to(i[0],i[0].time);n.onUpdate(function(){});for(var s=1;s<i.length;s++){var o=new lu.Tween(t.position).to(i[s],i[s].time);n.chain(o);n=o;if(s==i.length-1){n.onComplete(function(){t.visible=false})}}if(i.length==1){n.onComplete(function(){t.visible=false})}a.start()}},{key:"onRemove",value:function e(){}},{key:"handleNotification",value:function e(t){switch(t.name){case Nu.DRAW:for(var i=0;i<this._crows.length;i++){this._crows[i].update()}break;case"START_EFFECT":this.start();break}}},{key:"listNotificationInterests",value:function e(){return[Nu.DRAW,"START_EFFECT"]}}]);return t}(tu);var _d=function(e){w(t,e);function t(e,i){g(this,t);return b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i))}y(t,[{key:"onRegister",value:function e(){var t=this;lu.removeAll();this._engine=this.facade.retrieveProxy("engine");this._engine.addItem(this);this._engine._scene.background=new Ki(16777215);this._engine.show(0);this._engine.hide(3e3);this._res=hu.Assest.zip.two;var i=Ou.paser(this._res.getFile("level.json").file,this._res);this.add(i.scene);i.scene.rotation.set(Math.PI/180*35.26439,-Math.PI/4,0);i.scene.position.set(88,400,0);i.scene.scale.set(.285,.285,.285);this._scene=i.scene;var r=new yd("starteffect");this.facade.registerMediator(r);i.scene.add(r);var n=this._scene.getObjectByName("总");var a=n.getObjectByName("中间");var s=n.getObjectByName("左").getObjectByName("左前部分");s.position.y+=20;n.getObjectByName("左").getObjectByName("左前部分").getObjectByName("按钮1").visible=false;var o=this.createGrass("grass1.png");o.position.set(-200,-1820,-80);i.scene.add(o);var o=this.createGrass("grass2.png");o.position.set(-600,-1820,700);i.scene.add(o);var o=this.createGrass("grass3.png");o.position.set(0,-2300,0);i.scene.add(o);this.parseMaterial(i.scene);this.createPath(i.scene);this.child=new pd;this.child.hitObjects=this._hitObjects;this.child.isStart=true;this.child.touchs=[this._td];this.child.currentItem=this.child.targetBox=this._se.children[this._se.children.length-1];this.child.currentItem.pre=this.child.currentItem;this.player=new dd;this.player.hideHat();this.player._playerLayer.rotation.y=0;this.player.addEventListener("gameOver",function(){t.level4()});this._isStart=true;this.player.touchs=[this._td];this.player.hitObjects=this._hitObjects;this.player.isStart=true;this.player.currentItem=this.player.targetBox=this._hitObjects[26];i.scene.add(this.player);this._click=new Kf;i.scene.add(this._click);i.scene.add(this.child)}},{key:"chihldStart",value:function e(){var t=this;var i=this._se.children.slice(this._se.children.length-23);i.reverse();this.child.moveList=i;var r=function e(){t.child.removeEventListener("moveComplete",e);t.child.callHug();t.player.callHug();t.player.addEventListener("HogComplete",function(){t._isStart=true;t.child.Next=true;t.player.childMove=function(e){t.child.moveList=[e];if(t.child.moveList.length>0){}}})};this.child.addEventListener("moveComplete",r)}},{key:"createPath",value:function e(t){var i=new ti(6e3,6e3,6e3);var r=new ti(-700,-700,-700);var n=this.createBox([{x:-15-700,y:-1236,z:411-200,r:new _a},{x:-15-700,y:-1236,z:411-100,r:new _a,depth:r,ep:true},{x:-15-700,y:-1236,z:411,r:new _a,depth:r,ep:true},{x:-15-600,y:-1236,z:411,r:new _a,depth:r,ep:true},{x:-15-500,y:-1236,z:411,r:new _a,depth:r}]);this._leftF=n;n.name="leftF";var a=this.createBox([{x:-15-1400,y:-1236,z:411-900,r:new _a,depth:i},{x:-15-1400,y:-1236,z:411-800,r:new _a,depth:i},{x:-15-1400,y:-1236,z:411-700,r:new _a,depth:i},{x:-15-1300,y:-1236,z:411-700,r:new _a,depth:i},{x:-15-1200,y:-1236,z:411-700,r:new _a,depth:i}]);this._left1=a;this._ltgg=this.createBox([{x:-15,y:-1236,z:411-300,r:new _a},{x:-15,y:-1236,z:411-400,r:new _a}]);a.name="_left1";var s=this.createBox([{x:-15,y:-1236,z:411-100,r:new _a,depth:i},{x:-15,y:-1236,z:411-200,r:new _a,ad:[{x:0,y:1,z:-1}],depth:i},{x:-15-400,y:-1236,z:411,r:new _a,depth:i,ad:[{x:-2,y:0,z:-1}],upOut:true},{x:-15-300,y:-1236,z:411,r:new _a,depth:i},{x:-15-200,y:-1236,z:411,r:new _a,depth:i},{x:-15-100,y:-1236,z:411,r:new _a,depth:i},{x:-15,y:-1236,z:411,r:new _a,openFun:this.level1.bind(this),depth:i},{x:-15+100,y:-1236,z:411,r:new _a,depth:i},{x:-15+200,y:-1236,z:411,r:new _a,depth:i},{x:-15+300,y:-1236,z:411,r:new _a,depth:i},{x:-15+400,y:-1236,z:411,r:new _a,depth:i},{x:-15+500,y:-1236,z:411,r:new _a,depth:i},{x:-15+600,y:-1236,z:411,r:new _a,depth:i},{x:-15+600,y:-1236,z:411+100,r:new _a,depth:i},{x:-15+600,y:-1236,z:411+200,r:new _a,depth:i},{x:-15+600,y:-1236,z:411+300,r:new _a,depth:i},{x:-15+600,y:-1236,z:411+400,r:new _a,depth:i},{x:-15+600,y:-1236,z:411+500,r:new _a,depth:i},{x:-15+600,y:-1236,z:411+600,r:new _a,depth:i},{x:-15+600,y:-1236,z:411+700,r:new _a,depth:i},{x:-15+600,y:-1236,z:411+800,r:new _a,depth:i,openFun:this.startAmi.bind(this)},{x:-15+600,y:-1236,z:411+900,r:new _a,depth:i},{x:-15+600,y:-1236,z:411+1e3,r:new _a,depth:i},{x:-15+700,y:-1236,z:411+1e3,r:new _a,depth:i},{x:-15+800,y:-1236,z:411+1e3,r:new _a,depth:i},{x:-15+900,y:-1236,z:411+1e3,r:new _a,depth:i},{x:-15+1e3,y:-1236,z:411+1e3,r:new _a,depth:i},{x:-15+1100,y:-1236,z:411+1e3,r:new _a,depth:i},{x:-15+1200,y:-1236,z:411+1e3,r:new _a,depth:i},{x:-15+1200,y:-1236,z:411+1100,r:new _a,depth:i},{x:-15+1200,y:-1236,z:411+1200,r:new _a,depth:i},{x:-15+1200,y:-1236,z:411+1300,r:new _a,depth:i,m:true},{x:-15+1200,y:-1236,z:411+1400,r:new _a,depth:i,m:true},{x:-15+1200,y:-1236,z:411+1500,r:new _a,depth:i,m:true},{x:-15+1200,y:-1236,z:411+1600,r:new _a,depth:i,m:true},{x:-15+1200,y:-1236,z:411+1700,r:new _a,depth:i,m:true},{x:-15+1200,y:-1236,z:411+1800,r:new _a,depth:i,m:true},{x:-15+1200,y:-1236,z:411+1900,r:new _a,depth:i,m:true},{x:-15+1200,y:-1236,z:411+2e3,r:new _a,depth:i,m:true},{x:-15+1200,y:-1236,z:411+2100,r:new _a,depth:i,m:true},{x:-15+1200,y:-1236,z:411+2200,r:new _a,depth:i,m:true},{x:-15+1200,y:-1236,z:411+2300,r:new _a,depth:i,m:true},{x:-15+1200,y:-1236,z:411+2400,r:new _a,depth:i,m:true},{x:-15+1200,y:-1236,z:411+2500,r:new _a,depth:i,m:true}]);s.name="se";this._se=s;var o=this.createBox([{x:-0,y:200,z:0,r:new _a,touch:this._td},{x:-100,y:200,z:0,r:new _a,touch:this._td},{x:-200,y:200,z:0,r:new _a,touch:this._td},{x:-300,y:200,z:0,r:new _a,touch:this._td},{x:-400,y:200,z:0,r:new _a,touch:this._td},{x:100,y:200,z:0,r:new _a,touch:this._td},{x:200,y:200,z:0,r:new _a,touch:this._td},{x:300,y:200,z:0,r:new _a,touch:this._td},{x:400,y:200,z:0,r:new _a,touch:this._td}]);this._bridge=o;var h=this.createBox([{z:-0,y:-500,x:0,r:new _a,touch:this._td},{z:-100,y:-500,x:0,r:new _a,touch:this._td},{z:-200,y:-500,x:0,r:new _a,touch:this._td},{z:-300,y:-500,x:0,r:new _a,touch:this._td},{z:-400,y:-500,x:0,r:new _a,touch:this._td},{z:100,y:-500,x:0,r:new _a,touch:this._td},{z:200,y:-500,x:0,r:new _a,touch:this._td},{z:300,y:-500,x:0,r:new _a,touch:this._td},{z:400,y:-500,x:0,r:new _a,touch:this._td}]);var l=new ti(10,10,10);var c=this.createBox([{x:-15-700,y:-1236,z:411-1200,r:new _a,depth:l},{x:-15-700,y:-1236,z:411-1300,r:new _a,depth:l},{x:-15-700,y:-1236,z:411-1400,r:new _a,depth:l},{x:-15-800,y:-1236,z:411-1400,r:new _a,depth:l},{x:-15-900,y:-1236,z:411-1400,r:new _a,depth:l},{x:-15-1e3,y:-1236,z:411-1400,r:new _a,depth:l},{x:-15-1100,y:-1236,z:411-1400,r:new _a,depth:l},{x:-15-1200,y:-1236,z:411-1400,r:new _a,depth:l},{x:-15-1300,y:-1236,z:411-1400,r:new _a,depth:l},{x:-15-1400,y:-1236,z:411-1400,r:new _a,depth:l}]);this._rightGr=c;var u=this.createBox([{x:-15-1400,y:-1236,z:411-1300,r:new _a,depth:l},{x:-15-1400,y:-1236,z:411-1200,r:new _a,depth:l},{x:-15-1400,y:-1236,z:411-1100,r:new _a,depth:l},{x:-15-1400,y:-1236,z:411-1e3,r:new _a,depth:l}]);this._drog=u;var f=this.createBox([{x:-15-200,y:-1236,z:411-700,r:new _a,depth:i,lt:true},{x:-15-200,y:-1236,z:411-800,r:new _a,depth:i,openFun:this.level2.bind(this)}]);this._rightTop=f;this._ltPath=this.createBox([{t:1,x:-15,y:-1136,z:111,r:new _a(Math.PI/4),g:true,ad:[{x:0,y:-1,z:1},{x:0,y:1,z:-1}],depth:new ti(700,700,700)},{t:1,x:-15,y:-1036,z:11,r:new _a(Math.PI/4),g:true,ad:[{x:0,y:-1,z:1},{x:0,y:0,z:-1}],depth:new ti(700,700,700)}]);this._ltPath.visible=false;this._cent2=h;this._cent2.visible=false;t.add(this._ltPath);t.add(u);t.add(a);t.add(f);t.add(s);t.add(c);t.add(this._ltgg);t.add(n);var d=t.getObjectByName("总");var p=d.getObjectByName("中间");p.getObjectByName("旋转1").add(o);p.getObjectByName("旋转1").add(h);var v=[];this._ltPath.visible=false;u.visible=false;f.visible=false;c.visible=false;a.visible=false;v=v.concat(s.children).concat(n.children).concat(this._ltgg.children).concat(o.children);this._hitObjects=v}},{key:"startAmi",value:function e(){var t=this;hu.Assest.zip.sound["level2_bmg"].play();this._isStart=false;this.player._playerLayer.rotation.y=Math.PI;var i=new lu.Tween(this.player._playerLayer.rotation).to({y:0},200);i.start();setTimeout(function(){t.player.callWave()},2e3);this.chihldStart()}},{key:"setMaterial",value:function e(t,i){if(t.map)return;switch(t.name){case"_9-1":i.material=new Xa;i.material.color=new Ki(16768057);break;case"_9-4":case"_9-3":case"_9-2":case"_9-5":case"_9-6":case"_2-2":case"_1":if(!(t instanceof Xa)){i.material=new Xa;i.material.color=t.color.clone()}break;case"_12":t.map=iu("st.png",this._res);t.transparent=true;t.needsUpdate=true;break;case"_11":case"_1-2":case"_9":case"地砖":t.emissiveIntensity=0;break;case"_10":break;case"_4-2":t.map=iu("PellicanCrossingFallenLeafs2.png",this._res);t.needsUpdate=true;break;case"_8":t.emissiveIntensity=0;break;case"_16":t.map=iu("m2.jpg",this._res);t.needsUpdate=true;break;case"门纹理":t.map=iu("m1.jpg",this._res);t.needsUpdate=true;break;case"横线":t.map=iu("hhh.jpg",this._res);t.needsUpdate=true;break;case"混合拐弯":t.map=iu("hhg.jpg",this._res);t.needsUpdate=true;break;case"_15":t.emissiveIntensity=0;t.color=new Ki(13754367);break;case"_13":case"_14":t.emissiveIntensity=0;break;case"横线2":t.map=iu("x2.jpg",this._res);t.needsUpdate=true;break;case"封顶2":t.map=iu("v2.jpg",this._res);t.needsUpdate=true;break;case"_17":t.map=iu("doorglow.jpg",this._res);t.needsUpdate=true;break;case"深蓝色":t.map=iu("sl.jpg",this._res);t.needsUpdate=true;break;case"浅蓝色-纹理":t.map=iu("cl.jpg",this._res);t.needsUpdate=true;break;case"_1":case"_2":case"_3":t.emissiveIntensity=0;break;case"_4":t.map=iu("PellicanCrossingFallenLeafs.png",this._res);t.transparent=true;t.needsUpdate=true;break;case"_5":break;case"_6":t.map=iu("t0.jpg",this._res);t.side=Y;t.needsUpdate=true;break;case"_7":t.map=iu("t1.jpg",this._res);t.needsUpdate=true;break;case"横线3":t.map=iu("x1.jpg",this._res);t.needsUpdate=true;break;case"拐角3":t.map=iu("c1.jpg",this._res);t.needsUpdate=true;break;case"封顶3":t.map=iu("v1.jpg",this._res);t.needsUpdate=true;break;case"楼梯":t.map=iu("lt.jpg",this._res);t.needsUpdate=true;break}return t}},{key:"parseMaterial",value:function e(t){var i=this;var r=new _h(16777215);r.intensity=.2;t.add(r);this._buttonList=[];t.traverse(function(e){e.old=e.position.clone();if(e instanceof Qa){if(e.material instanceof Array){for(var t=0;t<e.material.length;t++){i.setMaterial(e.material[t],e)}}else{i.setMaterial(e.material,e)}}switch(e.name){case"树1":break;case"立方体_0_6":break;case"无凹槽2":i._butEnd=e;e.visible=false;break;case"无凹槽1":break;case"按钮1":i._level3But=e;break;case"按钮2":i._levelBut=e;break;case"按钮3":i._level2But=e;break;case"桥2":i._bridge2=e;i._bridge2.visible=false;break;case"树22b":e.children[0].material=e.children[0].material.clone();e.children[0].material.emissiveIntensity=1;break;case"右后部分":break;case"柱子遮挡1":i._zz=e;break;case"立方体_0_7_6.6_8.1_0.2":e.position.x-=.5;e.position.y-=.5;e.position.z+=.5;break;case"旋转1":i._td=new fd("y");i._td.lock=[0,-Math.PI/2,Math.PI/2,Math.PI];i._td.target=e;i._td.isRotation=false;i._td.position.y=350;i._td.callback=function(){};i._td.isRotation=false;e.parent.add(i._td);break;case"前白遮罩":e.position.add(new ti(998,998,998));break;case"前白遮罩.4":case"平面":e.position.add(new ti(1e3,1e3,1e3));if(e.name=="前白遮罩.4"){e.children[0].material=new Xa({map:iu("PellicanCrossingFallenLeafs.png",i._res)});e.children[0].material.transparent=true}break;case"球体.6":var r=e.children[0].material.color.clone();e.children[0].material=new Xa;e.children[0].material.color=r;break;case"mask6":break;case"TreesLevel_TreeVolume_04":e.children[0].material.emissiveIntensity=0;break;case"mask3-1":e.position.add(new ti(700,700,700));break;case"左前部分":e.visible=false;e.children[4].visible=false;break}});var r=t.getObjectByName("灯光").children[0];r.parent.add(r.target);r.intensity=1.5;r.position.set(5,.8,15);var n=t.getObjectByName("总");var a=n.getObjectByName("前白遮罩");a.position.add(new ti(2,2,2));n.getObjectByName("后面1").position.sub(new ti(5500,5500,5500))}},{key:"setButtonColor",value:function e(t){var i=[];for(var r=0;r<t.length;r++){var n=new Xa({color:t[r]});i.push(n)}return i}},{key:"setButtonAni",value:function e(t){t.children[0].material=this.setButtonColor([10207743,6258608]);var i=t.position.y;var r=this.player._playerLayer.children[0];var n=r.position.clone();var a=function e(){r.y=n.y+t.position.y-i};var s=new lu.Tween(t.position).to({y:i-30},200);var o=new lu.Tween(t.position).to({y:i-15},200);o.onUpdate(a);s.onUpdate(a);s.onComplete(function(){});s.chain(o);o.onComplete(function(){});s.start()}},{key:"level1",value:function e(){var t=this;hu.Assest.zip.sound["button_0"].play();this.sendNotification("START_EFFECT");this._isStart=false;this.addPath(this._drog);this.addPath(this._rightTop);this.addPath(this._rightGr);this.addPath(this._left1);var i=this._scene.getObjectByName("总");var r=i.getObjectByName("中间");this.setButtonAni(this._levelBut);var n=i.getObjectByName("右");var a=i.getObjectByName("左");var s=this._scene.getObjectByName("树平台");var o=r.getObjectByName("旋转1");var h=n.getObjectByName("右后部分");var l=new ti(700,700,700);var c=new lu.Tween(s.position).to({y:s.position.y+20},600);var u=new lu.Tween(s.position).to({y:s.position.y-1e3},3500).delay(1e3).easing(lu.Easing.Circular.In);u.onComplete(function(){});r.getObjectByName("桥1").visible=false;var f=new lu.Tween(r.position).to({y:-800},2500).delay(1e3).easing(function(e){if(e<1/2.75){return 7.5625*e*e}else if(e<2/2.75){return 7.5625*(e-=1.5/2.75)*e+.75}else if(e<2.5/2.75){return 7.5625*(e-=2.25/2.75)*e+.9375}else{return 7.5625*(e-=2.625/2.75)*e+.984375}});f.onComplete(function(){r.getObjectByName("桥1").visible=true;a.o=a.position.clone();a.h=a.position.clone().sub(l);a.f=a.position.clone().add(l);a.position.copy(a.h);h.o=h.position.clone();h.h=h.position.clone().sub(l);h.f=h.position.clone().sub(l);h.position.copy(h.h);s.o=s.position.clone();s.h=s.position.clone().sub(l);s.f=s.position.clone().sub(l);s.position.copy(s.h);t._zz.position.add(new ti(1e3,1e3,1e3))});var d=n.position.y;var p=n.position.y-a.position.y;var v=new lu.Tween(n.position).to({y:-700},4e3).delay(1e3).easing(lu.Easing.Cubic.InOut);v.onUpdate(function(){r.position.y=n.position.y+600;a.position.y=n.position.y-p;o.rotation.y=(n.position.y-d)/-700*-Math.PI/2;t._td.update()});v.onStart(function(){d=n.position.y;p=n.position.y-a.position.y;var e=new lu.Tween(t._scene.position).to({y:152},4e3).delay(500).easing(lu.Easing.Cubic.InOut);e.start()});c.chain(u);u.chain(f);f.chain(v);v.onComplete(function(){t._td.isRotation=true;t._td.identifier=-1;t._isStart=true});c.start()}},{key:"createGrass",value:function e(t){var i=new Gs({color:16777215});i.map=iu(t,hu.Assest.zip.loader);i.depthTest=false;var r=new Hs(i);r.scale.set(32,32,1);return r}},{key:"setPosObj",value:function e(t,i){for(var r=0;r<t.children.length;r++){t.children[r].position.y+=i}}},{key:"addPath",value:function e(t){for(var i=0;i<t.children.length;i++){this._hitObjects.push(t.children[i])}t.visible=true}},{key:"level2",value:function e(){var t=this;hu.Assest.zip.sound["button_1"].play();this._isStart=false;this.setButtonAni(this._level2But);this._leftF.visible=false;for(var i=0;i<this._left1.children.length;i++){this._left1.children[i].data.depth=new ti(0,0,0)}this._left1.children[0].data.depth=new ti(700,700,700);for(var i=0;i<this._leftF.children.length;i++){var r=this._hitObjects.indexOf(this._leftF.children[i]);if(r!=-1){this._hitObjects.splice(r,1)}}var n=new ti(6e3,6e3,6e3);this._level2Path=this.createBox([{x:-15-800,y:-1236,z:411-200,r:new _a,depth:n,openFun:this.level3.bind(this)},{x:-15-700,y:-1236,z:411-200,r:new _a,depth:n,downOut:true,lock:new ti(0,1,0),ad:[{x:1,y:1,z:1}]},{x:-15-700+100,y:-1236+100,z:411-200+100,r:new _a,depth:n,down:true,lock:new ti(1,0,0),ad:[{x:-1,y:-1,z:-1},{x:0,y:-1,z:0}]},{x:-15-700+100,y:-1336+100,z:411-200+100,r:new _a,depth:n,up:true,lock:new ti(1,0,0),ad:[{x:2,y:0,z:1},{x:0,y:1,z:0}]}]);this._scene.add(this._level2Path);for(var i=0;i<this._level2Path.children.length;i++){this._hitObjects.push(this._level2Path.children[i])}for(var i=0;i<this._se.children.length;i++){var r=this._hitObjects.indexOf(this._se.children[i]);if(r!=-1){this._hitObjects[i].data.depth=n}}var a=this._scene.getObjectByName("总");var s=a.getObjectByName("左");var o=s.getObjectByName("左前部分");var h=s.getObjectByName("左后部分");var l=a.getObjectByName("右");var c=l.getObjectByName("右突出2");var u=c.getObjectByName("门");var r=new ti(1400,1400,1400);s.getObjectByName("左后部分").getObjectByName("mask3-2").position.add(r);var f=s.position.y;var d=new lu.Tween(s.position).to({y:f+200},2500).easing(function(e){if(e<1/2.75){return 7.5625*e*e}else if(e<2/2.75){return 7.5625*(e-=1.5/2.75)*e+.8}else if(e<2.5/2.75){return 7.5625*(e-=2.25/2.75)*e+.9375}else{return 7.5625*(e-=2.625/2.75)*e+.984375}}).delay(1e3).onUpdate(function(){});f=h.position.y;s.getObjectByName("左前部分").visible=true;var p=new lu.Tween(h.position).to({y:h.position.y+500},3500).easing(function(e){if(e<1/2.75){return 7.5625*e*e}else if(e<2/2.75){return 7.5625*(e-=1.5/2.75)*e+.8}else if(e<2.5/2.75){return 7.5625*(e-=2.25/2.75)*e+.9375}else{return 7.5625*(e-=2.625/2.75)*e+.984375}}).delay(500).onUpdate(function(){s.getObjectByName("左前部分").getObjectByName("按钮1").visible=h.position.y-f>20});p.onStart(function(){var e=new lu.Tween(t._scene.position).to({y:35},4e3).delay(500).easing(lu.Easing.Cubic.InOut);e.start()});d.chain(p);p.onComplete(function(){t._td.identifier=-1;t._td.isRotation=true;s.getObjectByName("左前部分").children[s.getObjectByName("左前部分").children.length-1].position.sub(r);s.getObjectByName("左后部分").getObjectByName("mask3-2").position.sub(r);s.getObjectByName("左前部分").position.add(r);s.getObjectByName("左前部分").getObjectByName("无凹槽1").visible=false;s.getObjectByName("左前部分").children[s.getObjectByName("左前部分").children.length-4].visible=true;t._isStart=true});d.start()}},{key:"levelLeft",value:function e(){var t=this;this._level2Path.visible=false;this._leftF.visible=true;var i=new ti(-500,-500,-500);for(var r=0;r<this._leftF.children.length;r++){this._leftF.children[r].data.depth=i;this._hitObjects.push(this._leftF.children[r])}this._leftF.children[0].data.depth=new ti(500,500,500);for(var r=0;r<this._level2Path.children.length;r++){var n=this._hitObjects.indexOf(this._level2Path.children[r]);if(n!=-1){this._hitObjects.splice(n,1)}}var a=hu.Assest.zip.sound["int_ending_landsend_finaldragger_rocks_01"];a.volume=1;a.play();for(var r=0;r<this._left1.children.length;r++){this._left1.children[r].data.depth=new ti(700,700,700)}var s=this._scene.getObjectByName("总");var o=s.getObjectByName("左");var h=s.getObjectByName("右");var l=h.getObjectByName("右突出2");var c=o.position.y;var u=o.getObjectByName("左后部分").getObjectByName("mask3-2");o.getObjectByName("左前部分").position.sub(new ti(1400,1400,1400));var f=u.clone();o.mask3=f;u.parent.add(f);f.position.y+=700;var d=new lu.Tween(o.position).to({y:c-700},2e3).easing(function(e){if(e<1/2.75){return 7.5625*e*e}else if(e<2/2.75){return 7.5625*(e-=1.5/2.75)*e+.8}else if(e<2.5/2.75){return 7.5625*(e-=2.25/2.75)*e+.9375}else{return 7.5625*(e-=2.625/2.75)*e+.984375}}).onUpdate(function(){}).onComplete(function(){u.visible=false;t._td.isRotation=true});d.start()}},{key:"level3",value:function e(){var t=this;hu.Assest.zip.sound["button_2"].play();this._isStart=false;this.setButtonAni(this._level3But);var i=this._rightTop.position.clone();var r=this._se.position.clone();var n=this._leftF.position.clone();var a=this._level2Path.position.clone();var s=this._ltPath.position.clone();this.addPath(this._cent2);this.addPath(this._ltPath);this._bridge2.visible=true;var o=new ti(700,700,700);this._rightGr.position.sub(o);this._left1.children[1].data.depth=new ti(7e3,7e3,7e3);var h=new ti(200,200,200);this._scene.add(this._bridge);for(var l=0;l<this._bridge.children.length;l++){this._bridge.children[l].data.depth=new ti(700,700,700);this._bridge.children[l].data.eh=true}for(var l=0;l<this._rightGr.children.length;l++){this._rightGr.children[l].data.depth=o}this._rightGr.children[this._rightGr.children.length-3].data.depth=new ti(1400,1400,1400);this._rightGr.children[this._rightGr.children.length-2].data.depth=new ti(1400,1400,1400);this._rightGr.children[this._rightGr.children.length-1].data.depth=new ti(1150,1150,1150);this._rightGr.children[this._rightGr.children.length-1].data.gameEnd=true;this._bridge.position.set(-1415,-1436,-1e3);var c=new ti(-700,-700,-700);var u=new ti(-500,-500,-500);this._td.callback=function(e){t._bridge.rotation.y=Math.PI/2-t._td.target.rotation.y;var o=(new ti).applyMatrix4(t.player.currentItem.matrixWorld);if(e){t._rightTop.position.copy(i.clone().add(h));t._se.position.copy(r);t._leftF.position.copy(n);t._level2Path.position.copy(a);t._ltPath.position.copy(s);for(var l=1;l<t._leftF.children.length;l++){t._leftF.children[l].data.depth=c}}else{t._ltPath.position.copy(s.clone().sub(h));t._level2Path.position.copy(a.clone().sub(h));t._se.position.copy(r.clone().sub(h));t._leftF.position.copy(n.clone().sub(h));for(var l=1;l<t._leftF.children.length;l++){t._leftF.children[l].data.depth=u}t._rightTop.position.copy(i)}t.player.upPos(o)};this._td.callback(this._td.rType);this._rightGr.position.y+=700;this._ltgg.visible=this._drog.visible=false;this._se.children[4].data.isNext=true;this._se.children[4].data.openFun=this.levelLeft.bind(this);for(var l=0;l<this._ltgg.children.length;l++){var o=this._hitObjects.indexOf(this._ltgg.children[l]);if(o!=-1){this._hitObjects.splice(o,1)}}for(var l=0;l<this._drog.children.length;l++){var o=this._hitObjects.indexOf(this._drog.children[l]);if(o!=-1){this._hitObjects.splice(o,1)}}var f=this._scene.getObjectByName("总");var d=f.getObjectByName("中间");var p=f.getObjectByName("左");var v=f.getObjectByName("右");v.getObjectByName("右后遮罩").position.add(new ti(700,700,700));v.getObjectByName("柱子遮挡1").visible=false;var m=v.getObjectByName("右突出2");var g=m.getObjectByName("门");g.position.add(new ti(700,700,700));var y=v.getObjectByName("右后部分");p.getObjectByName("左后部分").getObjectByName("mask3-2").position.add(new ti(1400,1400,1400));var _=new lu.Tween(g.rotation).to({x:-Math.PI/2},800).delay(500).easing(lu.Easing.Cubic.InOut);var x=new lu.Tween(g.rotation).to({z:Math.PI/2},800).delay(500).easing(lu.Easing.Cubic.InOut);var w=f.getObjectByName("折叠楼梯");var b=y.position.y;var M=w.position.y;var T=y.position.y-d.position.y;var E=d.getObjectByName("旋转1");E.rotation.y=0;var S=new lu.Tween(y.position).to({y:y.position.y+700},4e3).delay(500).easing(lu.Easing.Cubic.InOut).onUpdate(function(){d.position.y=y.position.y-T;w.position.y=M+(y.position.y-b)/700*200;E.rotation.y=(y.position.y-b)/-700*Math.PI/2;t._td.update()});var A=w.getObjectByName("楼梯机关");A.position.x+=.1;var L=new lu.Tween(A.rotation).to({z:-Math.PI*2},1e3).delay(500).easing(function(e){if(e<1/2.75){return 7.5625*e*e}else if(e<2/2.75){return 7.5625*(e-=1.5/2.75)*e+.8}else if(e<2.5/2.75){return 7.5625*(e-=2.25/2.75)*e+.9375}else{return 7.5625*(e-=2.625/2.75)*e+.984375}A.position.x=50.018});_.chain(x);x.chain(S);S.chain(L);L.onComplete(function(){p.getObjectByName("左后部分").getObjectByName("mask3-2").position.sub(new ti(700,700,700));t._isStart=true;t._td.identifier=-1;t._td.isRotation=true});_.start()}},{key:"level4",value:function e(){var t=this;hu.Assest.zip.sound["level2_end"].play();this._isStart=false;var i=this._scene.getObjectByName("总");var r=i.getObjectByName("中间");var n=i.getObjectByName("折叠楼梯");var a=i.getObjectByName("右");var s=i.getObjectByName("左");var o=s.getObjectByName("左后部分");var h=i.getObjectByName("前面地板");var l=a.getObjectByName("右后部分");var c=a.getObjectByName("右突出2");var u=c.getObjectByName("门");var f=n.getObjectByName("楼梯机关");var d=r.position.y;var p=a.position.y;var v=s.position.y;var m=h.position.y;var g=d-p;var y=d-v;var _=d-m;var x=d-n.position.y;var w=function e(){a.position.y=r.position.y-g;s.position.y=r.position.y-y;h.position.y=r.position.y-_;n.position.y=r.position.y-x};var b=new lu.Tween(r.position).to({y:d-50},1e3).easing(lu.Easing.Cubic.InOut).onUpdate(w);var M=new lu.Tween(r.position).to({y:-2400},5500).easing(lu.Easing.Cubic.In).onUpdate(w);b.chain(M);b.onComplete(function(){var e=new lu.Tween(t._scene.position).to({y:400},5e3).delay(3e3).easing(lu.Easing.Cubic.InOut);e.start()});var T=this._scene.getObjectByName("树平台");var E=new lu.Tween(T.position).to({y:T.position.y+1e3},3e3).easing(lu.Easing.Cubic.Out);E.delay(0);M.chain(E);E.onStart(function(){t._butEnd.visible=true;t._levelBut.visible=false;t._levelBut.parent.getObjectByName("立方体_0_6").visible=false;a.getObjectByName("右后遮罩").position.sub(new ti(700,700,700));a.getObjectByName("柱子遮挡1").visible=false;u.position.sub(new ti(700,700,700));s.mask3.visible=false;s.getObjectByName("左后部分").getObjectByName("mask3-2");a.position.y=a.old.y;r.position.y=r.old.y;s.position.y=s.old.y;h.position.y=h.old.y;l.position.y=l.old.y;u.rotation.set(0,0,0);o.position.y=o.old.y;n.position.y=n.old.y;f.rotation.z=-Math.PI;r.nowY=T.position.y-r.position.y;a.nowY=T.position.y-a.position.y-700;h.nowY=T.position.y-h.position.y;s.nowY=T.position.y-s.position.y-700;f.nowY=T.position.y-f.position.y;n.nowY=T.position.y-n.position.y});E.onUpdate(function(){r.position.y=T.position.y-r.nowY-1e3;a.position.y=T.position.y-a.nowY-2400;h.position.y=T.position.y-h.nowY-1e3;s.position.y=T.position.y-s.nowY-2400;n.position.y=T.position.y-n.nowY-1e3});E.onComplete(function(){setTimeout(function(){t.sendNotification("gameEnd")},3e3)});b.start()}},{key:"createBox",value:function e(t,i){var r=new eo;var n=new Ga(100,100,100);var a=new Xa({color:16777215});a.transparent=true;a.opacity=0;a.depthTest=false;for(var s=0;s<t.length;s++){var o=t[s];var h=new Qa(n,a);h.position.set(o.x,o.y,o.z);h.rotation.copy(o.r);h.data=o;if(i){h.touch=i}r.add(h)}return r}},{key:"onTouchStart",value:function e(t){var i=t.touches[0];this.identifier=i.identifier;var r={x:0,y:0};r.x=i.clientX/window.innerWidth*2-1;r.y=-(i.clientY/window.innerHeight)*2+1}},{key:"handleNotification",value:function e(t){switch(t.name){case"TOUCH_START":if(!this._isStart)return;this.onTouchStart(t.body);this.checkPath(t.body);if(this._td){this._td.onTouchStart(t.body)}break;case"TOUCH_END":if(!this._isStart)return;if(this._td){this._td.onTouchEnd(t.body)}break;case"TOUCH_MOVE":if(!this._isStart)return;if(this._td){this._td.onTouchMove(t.body)}break;case Nu.DRAW:if(this.player){this.player.update()}if(this.child){this.child.update(this.player._delta)}break}}},{key:"listNotificationInterests",value:function e(){return["TOUCH_START","TOUCH_MOVE","TOUCH_END",Nu.DRAW]}},{key:"getCurrent",value:function e(t,i,r){var n=null;var a=1e6;var s=[];for(var o=0;o<r.length;o++){var h=r[o];h.updateMatrixWorld();var l=(new ti).applyMatrix4(h.matrixWorld);l=this.player.parent.worldToLocal(l);var c=t.clone().sub(l).length();if(a>c){n=h;a=c}}if(a<95){return n}else{return}}},{key:"getLocalPoint",value:function e(t){t.updateMatrixWorld();var i=(new ti).applyMatrix4(t.matrixWorld);return this.player.parent.worldToLocal(i)}},{key:"getPaths",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var n=[{x:0,y:1,z:0},{x:0,y:-1,z:0},{x:0,y:1,z:-1},{x:0,y:1,z:1},{x:1,y:1,z:0},{x:-1,y:1,z:0},{x:0,y:-1,z:-1},{x:0,y:-1,z:1},{x:1,y:-1,z:0},{x:-1,y:-1,z:0}];var a=[{x:0,y:0,z:-1},{x:0,y:0,z:1},{x:1,y:0,z:0},{x:-1,y:0,z:0}];var s=[null,[{x:-1,y:1,z:0}]];var o=this.getLocalPoint(t);var h=0;for(var l=0;l<this.player.hitObjects.length;l++){var c=this.player.hitObjects[l];var u=this.getLocalPoint(c);if(c==t||t.pre==c){continue}if(t.data.ad===undefined){var f=a.concat();for(var d=0;d<f.length;d++){var p=o.clone();p.x+=f[d].x*100;p.z+=f[d].z*100;p.y+=f[d].y*100;var v=(new ti).subVectors(p,u).length();if(v<12){h++;c.pre=t;r.push(c);if(c!=i){this.getPaths(c,i,r)}else{return r}}else{}}}else{var f=a.concat();if(t.data.ad){f=f.concat(t.data.ad)}for(var d=0;d<f.length;d++){var p=o.clone();p.x+=f[d].x*100;p.z+=f[d].z*100;p.y+=f[d].y*100;var v=(new ti).subVectors(p,u).length();if(v<9){h++;c.pre=t;r.push(c);if(c!=i){this.getPaths(c,i,r)}else{return r}}}}}if(h==0){r=[]}return r}},{key:"checkPath",value:function e(t){var i=t.changedTouches[0];var r=i.clientX/window.innerWidth*2-1;var n=-(i.clientY/window.innerHeight)*2+1;var a=this._engine.getHitObject({x:r,y:n},this._hitObjects);if(a.length>0){var s=12e5;var o;var h=[];for(var l=0;l<a.length;l++){var c=a[l].object.data.lock?80:0;if(a[l].distance<s+c){s=a[l].distance;o=a[l];h.push(o)}}for(var u=0;u<h.length;u++){if(h[u].object.data.lock){if(h[u].object.data.lock.equals(h[u].face.normal)){o=h[u];break}}}if(o.object.data.m){return}var f=(new ti).applyMatrix4(o.object.matrixWorld);f=this._click.parent.worldToLocal(f);this._click.position.copy(f);this._click.show();this.player.updateMatrixWorld();if(o.object.data.depth){this._click.position.add(o.object.data.depth);this._click.position.add(new ti(20,20,20))}if(o.object.data.openFun&&!o.object.data.save){this._click.position.y+=15}if(o.object.data.down||o.object.data.up){this._click.position.x+=50;this._click.position.y-=50}if(this.player.currentItem==o.object)return;for(var u=0;u<this.player.hitObjects.length;u++){this.player.hitObjects[u].pre=undefined}var d=this.player.currentItem;if(d===undefined)return;if(d.data.openFun&&!d.data.save){d.data.save=true;d.data.openFun();if(d.data.isNext===undefined){this.player.isMove=false;return}}var p=this.getPaths(d,o.object);for(var u=0;u<p.length;u++){if(p[u]==o.object){var v=[];var m=p[u];while(m.pre){v.push(m);m=m.pre}v.reverse();this.player.moveList=v}}}}}]);return t}(tu);var xd=function(e){w(t,e);function t(){g(this,t);return b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}y(t,[{key:"removeAll",value:function e(){for(var t in this.facade.controller.commandMap){this.facade.removeCommand(t,this.facade.controller.commandMap[t])}for(var t in this.facade.model.proxyMap){this.facade.removeProxy(t,this.facade.model.proxyMap[t])}for(var t in this.facade.view.mediatorMap){this.facade.removeMediator(t,this.facade.view.mediatorMap[t])}}},{key:"execute",value:function e(i){var r=this;var n=this.facade.retrieveProxy("gameData");switch(i.name){case jd.START:n=this.facade.registerProxy(new I("gameData"));this.facade.registerProxy(new od("touch")).canvas=i.body;n.canvas=i.body;this.facade.registerCommand(P.STAGE_RESIZE,t);this.facade.registerCommand("ShowLogo",t);this.facade.registerCommand("two",t);this.facade.registerCommand(Nu.INITIALIZE,t);this.facade.registerCommand("INFO",t);this.facade.registerCommand("Loader",t);this.facade.registerCommand("setGameOver",t);this.facade.registerCommand("gameEnd",t);this.facade.registerCommand("GameStop",t);this.facade.registerCommand("startTwo",t);setTimeout(function(){r.sendNotification("Loader")},10);break;case"setGameOver":break;case Nu.INITIALIZE:break;case"GameStop":lu.removeAll();if(hu.Assest.zip.sound&&hu.Assest.zip.sound.files){for(var a=0;a<hu.Assest.zip.sound.files.length;a++){var s=hu.Assest.zip.sound.files[a];if(hu.Assest.zip.sound[s.name]){hu.Assest.zip.sound[s.name].stop();hu.Assest.zip.sound[s.name].destroy()}}}wx.onTouchStart(function(){});wx.onTouchMove(function(){});wx.onTouchEnd(function(){});this.facade.retrieveProxy("engine").stop();this.removeAll();if(i.body!==undefined&&jd.getInstance().Skip!==undefined){jd.getInstance().Skip()}break;case"gameEnd":lu.removeAll();for(var a=0;a<hu.Assest.zip.sound.files.length;a++){var s=hu.Assest.zip.sound.files[a];var o=new lu.Tween(s).to({volume:0},2e3);o.start()}this.facade.retrieveProxy("engine").show(i.body===undefined?3e3:0).onComplete(function(){for(var e=0;e<hu.Assest.zip.sound.files.length;e++){var t=hu.Assest.zip.sound.files[e];if(hu.Assest.zip.sound[t.name]){hu.Assest.zip.sound[t.name].stop();hu.Assest.zip.sound[t.name].destroy()}}wx.onTouchStart(function(){});wx.onTouchMove(function(){});wx.onTouchEnd(function(){});r.facade.retrieveProxy("engine").stop();if(jd.getInstance().GameOver!==undefined){r.removeAll();i.body===undefined?jd.getInstance().GameOver():jd.getInstance().Skip()}});break;case P.STAGE_RESIZE:n.resizeCanvas();break;case"ShowLogo":this.facade.removeMediator("loader");this.facade.registerMediator(new sd("logo"));break;case"INFO":this.facade.removeMediator("logo");this.facade.registerMediator(new ad("info"));break;case"Loader":var h=new ld("loader");this.facade.registerMediator(h);h.start("startLoad");break;case"startTwo":this.facade.retrieveMediator("loader1").show();this.facade.removeMediator("loader1");this.facade.registerMediator(new _d("two"));break;case"two":lu.removeAll();this.facade.removeMediator("info");for(var a=0;a<hu.Assest.zip.sound.files.length;a++){var l=hu.Assest.zip.sound[hu.Assest.zip.sound.files[a].name];var o=new lu.Tween(l).to({volume:0},2e3).onComplete(function(e){e.stop()});o.start()}var c=new cd("loader1");this.facade.registerMediator(c);c.hide();c.start("startLoadTwo");break}}}]);return t}(hd);var wd=function(e){w(t,e);function t(){g(this,t);return b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}y(t,[{key:"execute",value:function e(i){var r=this;var n=this.facade.retrieveProxy("engine");switch(i.name){case jd.START:n=this.facade.registerProxy(new Nu("engine"));this.facade.registerCommand("loaderComplete",t);this.facade.registerCommand(I.SET_CANVAS,t);break;case I.SET_CANVAS:n.canvas=i.body;setTimeout(function(){r.facade.registerCommand(P.STAGE_RESIZE,t);try{n.initializeEngine()}catch(e){console.log(e)}console.log("initializeEngine");var e=r.facade.retrieveProxy("stage").onResize();n.start()},0);break;case"loaderComplete":break;case P.STAGE_RESIZE:n.onResize(i.body);break;case"ShowMask":if(i.body.show){n.show(i.body.time)}else{n.hide(i.body.time)}break}}}]);return t}(hd);var bd=function(){function e(t,i,r){g(this,e);this.type=t;this.target=null;this.currentTarget=null;this.eventPhase=0;this.bubbles=!!i;this.cancelable=!!r;this.timeStamp=(new Date).getTime();this.defaultPrevented=false;this.propagationStopped=false;this.immediatePropagationStopped=false;this.removed=false}y(e,[{key:"preventDefault",value:function e(){this.defaultPrevented=this.cancelable&&true}},{key:"stopPropagation",value:function e(){this.propagationStopped=true}},{key:"stopImmediatePropagation",value:function e(){this.immediatePropagationStopped=this.propagationStopped=true}},{key:"remove",value:function e(){this.removed=true}},{key:"clone",value:function t(){return new e(this.type,this.bubbles,this.cancelable)}},{key:"set",value:function e(t){for(var i in t){this[i]=t[i]}return this}},{key:"toString",value:function e(){return"[Event (type="+this.type+")]"}}]);return e}();var Md=function(){y(e,null,[{key:"initialize",value:function t(i){var r=e.prototype;i.addEventListener=r.addEventListener;i.on=r.on;i.removeEventListener=i.off=r.removeEventListener;i.removeAllEventListeners=r.removeAllEventListeners;i.hasEventListener=r.hasEventListener;i.dispatchEvent=r.dispatchEvent;i._dispatchEvent=r._dispatchEvent;i.willTrigger=r.willTrigger}}]);function e(){g(this,e);this._listeners=null;this._captureListeners=null;this.off=this.removeEventListener.bind(this)}y(e,[{key:"addEventListener",value:function e(t,i,r){var n;if(r){n=this._captureListeners=this._captureListeners||{}}else{n=this._listeners=this._listeners||{}}var a=n[t];if(a){this.removeEventListener(t,i,r)}a=n[t];if(!a){n[t]=[i]}else{a.push(i)}return i}},{key:"on",value:function e(t,i,r,n,a,s){if(i.handleEvent){r=r||i;i=i.handleEvent}r=r||this;return this.addEventListener(t,function(e){i.call(r,e,a);n&&e.remove()},s)}},{key:"removeEventListener",value:function e(t,i,r){var n=r?this._captureListeners:this._listeners;if(!n){return}var a=n[t];if(!a){return}for(var s=0,o=a.length;s<o;s++){if(a[s]==i){if(o==1){delete n[t]}else{a.splice(s,1)}break}}}},{key:"removeAllEventListeners",value:function e(t){if(!t){this._listeners=this._captureListeners=null}else{if(this._listeners){delete this._listeners[t]}if(this._captureListeners){delete this._captureListeners[t]}}}},{key:"dispatchEvent",value:function e(t,i,r){if(typeof t=="string"){var n=this._listeners;if(!i&&(!n||!n[t])){return true}t=bd(t,i,r)}else if(t.target&&t.clone){t=t.clone()}try{t.target=this}catch(e){}if(!t.bubbles||!this.parent){this._dispatchEvent(t,2)}else{var a=this,s=[a];while(a.parent){s.push(a=a.parent)}var o,h=s.length;for(o=h-1;o>=0&&!t.propagationStopped;o--){s[o]._dispatchEvent(t,1+(o==0))}for(o=1;o<h&&!t.propagationStopped;o++){s[o]._dispatchEvent(t,3)}}return!t.defaultPrevented}},{key:"hasEventListener",value:function e(t){var i=this._listeners,r=this._captureListeners;return!!(i&&i[t]||r&&r[t])}},{key:"willTrigger",value:function e(t){var i=this;while(i){if(i.hasEventListener(t)){return true}i=i.parent}return false}},{key:"toString",value:function e(){return"[EventDispatcher]"}},{key:"_dispatchEvent",value:function e(t,i){var r,n=i==1?this._captureListeners:this._listeners;if(t&&n){var a=n[t.type];if(!a||!(r=a.length)){return}try{t.currentTarget=this}catch(e){}try{t.eventPhase=i}catch(e){}t.removed=false;a=a.slice();for(var s=0;s<r&&!t.immediatePropagationStopped;s++){var o=a[s];if(o.handleEvent){o.handleEvent(t)}else{o(t)}if(t.removed){this.off(t.type,o,i==1);t.removed=false}}}}}]);return e}();var Td=function(e){w(t,e);function t(e){var i=e.id,r=e.src,n=e.isSave,a=n===undefined?false:n,s=e.isZip,o=e.header;g(this,t);var h=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));h.id=i;h.isSave=a;h.url=r;h.header=o;h.isZip=s;h.success=h.success.bind(h);h.fail=h.fail.bind(h);h.complete=h.complete.bind(h);return h}y(t,[{key:"success",value:function e(t){var i=this;if(t.errMsg=="downloadFile:ok"){var r=new bd("success");r.data=t;this.dispatchEvent(r);{var n=wx.getFileSystemManager?wx.getFileSystemManager().readFile:wx.readFile;n({filePath:t.tempFilePath,success:function e(t){var r=t.data;i.data=r;var n=new bd("complete");i.dispatchEvent(n)},fail:function e(t){var r=new bd("error");r.error=t;i.dispatchEvent(r);console.log(t)},complete:function e(){}})}}else{var r=new bd("error");r.error=t;this.dispatchEvent(r)}}},{key:"fail",value:function e(t){var i=new bd("error");i.error=t;this.dispatchEvent(i)}},{key:"complete",value:function e(){}},{key:"url",set:function e(t){this._url=t;if(this.url){this.extension=s(this.url)}},get:function e(){return this._url}}]);return t}(Md);var Ed=function(){function e(t){g(this,e)}y(e,[{key:"execute",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:function(){};if(t){var r=this;t.execute(this,function(e){r._file=e;i()})}}},{key:"type",set:function e(t){this._type=t},get:function e(){return this._type}},{key:"name",set:function e(t){this._name=t},get:function e(){return this._name}},{key:"nativePath",set:function e(t){this._nativePath=t;var i=s(this.nativePath);if(i&&i.extension){this._isFile=true;this.name=i.name;this.type=i.extension}},get:function e(){return this._nativePath}},{key:"zip",set:function e(t){this._zip=t},get:function e(){return this._zip}},{key:"isFile",get:function e(){return this._isFile}},{key:"isCompressed",set:function e(t){this._isCompressed=t},get:function e(){return this._isCompressed}},{key:"buffer",set:function e(t){this._buffer=t},get:function e(){return this._buffer}},{key:"file",get:function e(){return this._file},set:function e(t){this._file=t}},{key:"size",get:function e(){if(this.buffer){return 0}}}]);return e}();var Sd;Sd=function(){var e=32768;var t=0,i=1;var r=32768;var n=258;var a=new Uint16Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);var s=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]);var o=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]);var h=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]);var l=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]);function c(e){var t=e.length;var i=0;var r=Number.POSITIVE_INFINITY;var n;var a;var s;var o;var h;var l;var c;var u;var f;var d;var p;for(u=0,f=t;u<f;++u){if(e[u]>i){i=e[u]}if(e[u]<r){r=e[u]}}n=1<<i;a=new Uint32Array(n);for(s=1,o=0,h=2;s<=i;){for(u=0;u<t;++u){if(e[u]===s){for(l=0,c=o,d=0;d<s;++d){l=l<<1|c&1;c>>=1}p=s<<16|u;for(d=l;d<n;d+=h){a[d]=p}++o}}++s;o<<=1;h<<=1}return[a,i,r]}var u=function(e){return e}(function(){var e=new Uint8Array(288);var t,i;for(t=0,i=e.length;t<i;++t){e[t]=t<=143?8:t<=255?9:t<=279?7:8}return c(e)}());var f=function(e){return e}(function(){var e=new Uint8Array(30);var t,i;for(t=0,i=e.length;t<i;++t){e[t]=5}return c(e)}());function d(a,s){this.blocks=[];this.bufferSize=e;this.totalpos=0;this.ip=0;this.bitsbuf=0;this.bitsbuflen=0;this.input=new Uint8Array(a);this.output;this.op;this.bfinal=false;this.bufferType=i;this.resize=false;this.prev;if(s||!(s={})){if(s["index"]){this.ip=s["index"]}if(s["bufferSize"]){this.bufferSize=s["bufferSize"]}if(s["bufferType"]){this.bufferType=s["bufferType"]}if(s["resize"]){this.resize=s["resize"]}}switch(this.bufferType){case t:this.op=r;this.output=new Uint8Array(r+this.bufferSize+n);break;case i:this.op=0;this.output=new Uint8Array(this.bufferSize);this.expandBuffer=this.expandBufferAdaptive;this.concatBuffer=this.concatBufferDynamic;this.decodeHuffman=this.decodeHuffmanAdaptive;break;default:throw new Error("invalid inflate mode")}}var p=d.prototype;p.concatBufferDynamic=function(){var e;var t=this.op;if(this.resize){e=new Uint8Array(t);e.set(this.output.subarray(0,t))}else{e=this.output.subarray(0,t)}this.buffer=e;return this.buffer};p.decodeHuffmanAdaptive=function(e,t){var i=this.output;var r=this.op;this.currentLitlenTable=e;var n=i.length;var a;var c;var u;var f;while((a=this.readCodeByTable(e))!==256){if(a<256){if(r>=n){i=this.expandBuffer();n=i.length}i[r++]=a;continue}c=a-257;f=s[c];if(o[c]>0){f+=this.readBits(o[c])}a=this.readCodeByTable(t);u=h[a];if(l[a]>0){u+=this.readBits(l[a])}if(r+f>n){i=this.expandBuffer();n=i.length}while(f--){i[r]=i[r++-u]}}while(this.bitsbuflen>=8){this.bitsbuflen-=8;this.ip--}this.op=r};p.readCodeByTable=function(e){var t=this.bitsbuf;var i=this.bitsbuflen;var r=this.input;var n=this.ip;var a=r.length;var s=e[0];var o=e[1];var h;var l;while(i<o){if(n>=a){break}t|=r[n++]<<i;i+=8}h=s[t&(1<<o)-1];l=h>>>16;this.bitsbuf=t>>l;this.bitsbuflen=i-l;this.ip=n;return h&65535};p.expandBufferAdaptive=function(e){var t;var i=this.input.length/this.ip+1|0;var r;var n;var a;var s=this.input;var o=this.output;if(e){if(typeof e.fixRatio==="number"){i=e.fixRatio}if(typeof e.addRatio==="number"){i+=e.addRatio}}if(i<2){r=(s.length-this.ip)/this.currentLitlenTable[2];a=r/2*258|0;n=a<o.length?o.length+a:o.length<<1}else{n=o.length*i}t=new Uint8Array(n);t.set(o);this.output=t;return this.output};p.parseUncompressedBlock=function(){var e=this.input;var r=this.ip;var n=this.output;var a=this.op;var s=e.length;var o;var h;var l=n.length;var c;this.bitsbuf=0;this.bitsbuflen=0;if(r+1>=s){throw new Error("invalid uncompressed block header: LEN")}o=e[r++]|e[r++]<<8;if(r+1>=s){throw new Error("invalid uncompressed block header: NLEN")}h=e[r++]|e[r++]<<8;if(o===~h){throw new Error("invalid uncompressed block header: length verify")}if(r+o>e.length){throw new Error("input buffer is broken")}switch(this.bufferType){case t:while(a+o>n.length){c=l-a;o-=c;n.set(e.subarray(r,r+c),a);a+=c;r+=c;this.op=a;n=this.expandBuffer();a=this.op}break;case i:while(a+o>n.length){n=this.expandBuffer({fixRatio:2})}break;default:throw new Error("invalid inflate mode")}n.set(e.subarray(r,r+o),a);a+=o;r+=o;this.ip=r;this.op=a;this.output=n};p.readBits=function(e){var t=this.bitsbuf;var i=this.bitsbuflen;var r=this.input;var n=this.ip;var a=r.length;var s;while(i<e){if(n>=a){throw new Error("input buffer is broken")}t|=r[n++]<<i;i+=8}s=t&(1<<e)-1;t>>>=e;i-=e;this.bitsbuf=t;this.bitsbuflen=i;this.ip=n;return s};p.parseBlock=function(){var e=this.readBits(3);if(e&1){this.bfinal=true}e>>>=1;switch(e){case 0:this.parseUncompressedBlock();break;case 1:this.parseFixedHuffmanBlock();break;case 2:this.parseDynamicHuffmanBlock();break;default:throw new Error("unknown BTYPE: "+e)}return this.bfinal};p.parseDynamicHuffmanBlock=function(){var e=this.readBits(5)+257;var t=this.readBits(5)+1;var i=this.readBits(4)+4;var r=new Uint8Array(a.length);var n;var s;var o;var h;for(h=0;h<i;++h){r[a[h]]=this.readBits(3)}n=c(r);function l(e,t,i){var r;var n=this.prev;var a;var s;for(s=0;s<e;){r=this.readCodeByTable(t);switch(r){case 16:a=3+this.readBits(2);while(a--){i[s++]=n}break;case 17:a=3+this.readBits(3);while(a--){i[s++]=0}n=0;break;case 18:a=11+this.readBits(7);while(a--){i[s++]=0}n=0;break;default:i[s++]=r;n=r;break}}this.prev=n;return i}s=new Uint8Array(e);o=new Uint8Array(t);this.prev=0;this.decodeHuffman(c(l.call(this,e,n,s)),c(l.call(this,t,n,o)))};p.parseFixedHuffmanBlock=function(){this.decodeHuffman(u,f)};p.decompress=function(){while(!this.bfinal){this.parseBlock()}return this.concatBuffer()};p.decompressAnyc=function(e,t){var i=this;var r=setInterval(function(){var t=i.parseBlock();if(t){clearInterval(r);if(e){e.apply(self,[i.concatBuffer()])}}},t)};return d}();var Ad=Sd;var Ld=67324752;var Cd=function(){function e(){g(this,e);this._files=[];this._workerCount=1}y(e,[{key:"parse",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var r=new DataView(t);while(r.getUint32(i,true)==Ld){var n=new Ed;n.zip=this;i+=6;var a=r.getUint16(i,true)==1;i+=2;var s=r.getUint16(i,true)!=0;i+=10;var h=r.getUint32(i,true);i+=4;var l=r.getUint32(i,true);i+=4;var c=r.getInt16(i,true);i+=2;var u=r.getUint16(i,true);i+=2;n.nativePath=o(r.buffer,i,c);i+=c+u;n.isCompressed=s;var f=s?h:l;n.buffer=r.buffer.slice(i,i+f);i+=f;if(a){i+=12}n.isFolder=n.type===undefined;this._files.push(n)}}},{key:"getFile",value:function e(t){for(var i=0;i<this.files.length;i++){if(this.files[i].nativePath==t){return this.files[i]}}}},{key:"_createWoker",value:function e(t){var i=new Promise(function(e,i){try{var r=new Ad(t.buffer,{index:0,bufferSize:t.buffer.byteLength,resize:true});var n=r.decompress();t.buffer=n.buffer;t.isCompressed=false}catch(e){console.log("error")}e(t)});return i}},{key:"_wokerDecompress",value:function e(t,i){var r=this;if(t.length){var n=this._workerCount;var a=0;for(var s=0;s<t.length;s++){if(s<n){var o=t.shift();a++;this._createWoker(o).then(function(){a--;r._currentCount++;if(a==0){r._wokerDecompress(t,i)}})["catch"](function(){a--;r._currentCount++;if(a==0){r._wokerDecompress(t,i)}})}}}else{if(this._count==this._currentCount){i(this)}}}},{key:"decompress",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:function(){};var i=[];var r=0;var n=[];for(var a=0;a<this.files.length;a++){var s=this.files[a];if(s.isCompressed){i.push(s)}else{n.push(1);r++}}this._count=i.length;this._currentCount=0;this._wokerDecompress(i,t)}},{key:"files",get:function e(){return this._files}}]);return e}();var Rd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var Id=new Uint8Array(256);for(var Pd=0;Pd<Rd.length;Pd++){Id[Rd.charCodeAt(Pd)]=Pd}var Od="https://game.gtimg.cn/images/mv2/act/a20171016mv2game/";var kd=[{id:"loader",isZip:true,src:Od+"resources/resources.json"},{id:"logo",isZip:true,src:Od+"/resources/logo.json"},{id:"font",isZip:true,src:Od+"/resources/font.json"},{id:"Mother",isZip:true,src:Od+"/resources/Mother.json"}];var Nd=[{id:"Child",isZip:true,src:Od+"/resources/Child.json"},{id:"two",isZip:true,src:Od+"/resources/two.json"},{id:"crow",isZip:true,src:Od+"/resources/crow.json"},{id:"smoke",isZip:true,src:Od+"/resources/smoke.json"}];var zd=function(e){w(t,e);function t(){g(this,t);return b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}y(t,[{key:"getLocalFileList",value:function e(t){var i=new Promise(function(e,i){var r=[];for(var n=0;n<t.length;n++){var a=new Td(t[n]);r.push(a)}u("download").then(d).then(function(t){if(t.length==0){e(r)}else{for(var i=0;i<t.length;i++){var n=t[i];for(var a=0;a<r.length;a++){var s=r[a].extension.name+"."+(r[a].isZip?"zip":r[a].extension.extension);if(n==s){r.splice(a,1);break}}}e(r)}}).catch(function(e){})});return i}},{key:"saveFiles",value:function e(t){var i=new Promise(function(e,i){u("download").then(function(r){var n=t.length;for(var a=0;a<t.length;a++){var s=r+"/"+t[a].extension.name+"."+(t[a].isZip?"zip":t[a].extension.extension);f(s,t[a].data).then(function(){if(--n==0){e()}}).catch(i)}})});return i}},{key:"saveZipToLocal",value:function e(t){var i=new Promise(function(e,i){u("zip").then(function(i){u(i+"/"+t.zip.name).then(function(i){f(i+"/"+t.nativePath,t.buffer).then(function(){t.filePath=i+"/"+t.nativePath;e(t)})})})});return i}},{key:"parseByteToFile",value:function e(t){var i=new Promise(function(e,i){t.filePath="zip/"+t.zip.name+"/"+t.nativePath;var r="";switch(t.type){case"jpg":case"png":t.file=wx.createImage();if(t.filePath.indexOf(wx.env.USER_DATA_PATH)==-1){t.file.src=wx.env.USER_DATA_PATH+"/"+t.filePath}else{t.file.src=t.filePath}e(t);break;case"json":var n=t.filePath;if(n.indexOf(wx.env.USER_DATA_PATH)==-1){n=wx.env.USER_DATA_PATH+"/"+n}p(n,"utf-8").then(function(i){t.file=JSON.parse(i);e(t)}).catch(function(e){});break;case"mp3":t.filePath=t.filePath.indexOf(wx.env.USER_DATA_PATH)==-1?wx.env.USER_DATA_PATH+"/"+t.filePath:t.filePath;e(t);break;default:e(t);break}});return i}},{key:"parseZip",value:function e(t){var i=new Promise(function(e,i){if(t.isZip){var r=[];var n=new Cd;n.name=t.extension.name;n.id=t.id;n.parse(t.data);var a=n.files.length;u("zip").then(function(){var r=wx.env.USER_DATA_PATH+"/zip/"+n.name;c(r).then(function(a){if(!a.isExist){u(r).then(function(){v(t.localPath,r).then(function(){e(n)},function(e){i()})})}else{e(n)}})})}});return i}},{key:"readLocalFile",value:function e(t){var i=new Promise(function(e,i){var r="download/"+t.extension.name+"."+(t.isZip?"zip":t.extension.extension);p(r).then(function(i){t.localPath=r;t.data=i;e(t)}).catch(i)});return i}},{key:"parseFile",value:function e(t){var i=[];for(var r=0;r<t.length;r++){var n=new Td(t[r]);i.push(this.readLocalFile(n).then(this.parseZip).then(this.readZipLocalFile.bind(this)))}return Promise.all(i)}},{key:"readZipLocalFile",value:function e(t){var i=[];for(var r=0;r<t.files.length;r++){i.push(this.parseByteToFile(t.files[r]))}return Promise.all(i)}},{key:"execute",value:function e(i){var r=this;var n=this.facade.retrieveProxy("loader");var a="ossweb-img/";switch(i.name){case"game_start":this.facade.registerCommand("loaderComplete",t);this.facade.registerCommand("localComplete",t);this.facade.registerCommand("startLoad",t);this.facade.registerCommand("startLoadTwo",t);break;case"startLoad":this.getLocalFileList(kd).then(function(e){if(e.length>0){n.load(e)}else{r.parseFile(kd).then(function(e){for(var t=0;t<e.length;t++){hu.Assest.zip[e[t][0].zip.id]=e[t][0].zip}console.log("start Game");r.parseModel();r.sendNotification("loaderComplete")}).catch(function(e){r.sendNotification("startLoad")});console.log("not Loader")}});break;case"startLoadTwo":this.getLocalFileList(Nd).then(function(e){if(e.length>0){n.load(e)}else{r.parseFile(Nd).then(function(e){for(var t=0;t<e.length;t++){hu.Assest.zip[e[t][0].zip.id]=e[t][0].zip}r.sendNotification("startTwo");console.log("lovel two start loader")})}});break;case"load":n.load(i.body);break;case"loaderComplete":break;case"localComplete":var s=i.body;if(t.LEVEL2){this.saveFiles(s).then(function(){r.parseFile(Nd).then(function(e){for(var t=0;t<e.length;t++){hu.Assest.zip[e[t][0].zip.id]=e[t][0].zip}r.sendNotification("startTwo")})}).catch(function(){r.sendNotification("startLoadTwo")})}else{this.saveFiles(s).then(function(){r.parseFile(kd).then(function(e){for(var t=0;t<e.length;t++){hu.Assest.zip[e[t][0].zip.id]=e[t][0].zip}r.parseModel();r.sendNotification("loaderComplete")}).catch(function(e){console.log(e.message);r.sendNotification("startLoad")})}).catch(function(e){console.log(e.message)})}break}}},{key:"parseModel",value:function e(){t.LEVEL2=true;var i=["amb_prelude_start","button_0","button_1","button_2","fs_walk_leaves_A_05","int_ending_landsend_finaldragger_rocks_01","level2_bmg","level2_end","mother_flute_phrase_intro_sustain","ui_nav_ping_default_pentatonic_pos_02","ui_nav_ping_default_pentatonic_pos_03","ui_nav_ping_default_pentatonic_pos_04"];hu.Assest.zip.sound.files=[];for(var r=0;r<i.length;r++){var n=hu.Assest.zip.sound[i[r]]=wx.createInnerAudioContext();n.src="assets/sound/"+i[r]+".mp3";hu.Assest.zip.sound.files.push({name:i[r]});n.obeyMuteSwitch=false}return;var n=new Uu;var a=hu.Assest.zip.Mother;var s=a.getFile("Mother.json").file;var s=a.getFile("Idle.json").file;qf.IDLE=ou(s);var s=a.getFile("Walk.json").file;qf.WALK=ou(s);var s=a.getFile("StairClimb.json").file;qf.S_C=ou(s);var s=a.getFile("StairDwon.json").file;qf.S_D=ou(s);var s=a.getFile("SittingFluteLoop.json").file;qf.SFL=ou(s);var s=a.getFile("SittingFluteOut.json").file;qf.SFO=ou(s)}}]);return t}(hd);zd.ERROR=0;zd.LEVEL2=false;var Bd=function(e){w(t,e);function t(){g(this,t);var e=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e.init();return e}y(t,[{key:"init",value:function e(){this._list=[]}},{key:"addItem",value:function e(t){if(t===undefined)return;if(t instanceof Td){this._list.push(t)}else if(typeof t=="string"){this.addItem(new Td({src:t}));return}else if(t instanceof Array){for(var i=0;i<t.length;i++){this.addItem(t[i])}return}else if((typeof t==="undefined"?"undefined":m(t))=="object"){this.addItem(new Td(t));return}this.dispatchEvent(new bd("add"))}},{key:"start",value:function e(){this.resultItem={};this._count=0;this._maxCount=this._length=this._list.length;this._load()}},{key:"stop",value:function e(){}},{key:"_load",value:function e(){var t=this;if(this._list.length>0){var i=this._list.shift();i.on("complete",function(){t.resultItem[i.id?i.id:i.url]=i;var e=new bd("fileload");t._count++;t._load()});i.on("error",function(e){t.dispatchEvent(e)});var r=wx.downloadFile(i);r.onProgressUpdate(function(e){var i=new bd("progress");if(e.progress>=1.1){e.progress/=100}i.progress=e.progress;i.totalProgress=(t._count+e.progress)/t._length;i.totalBytesWritten=e.totalBytesWritten;i.totalBytesExpectedToWrite=e.totalBytesExpectedToWrite;t.dispatchEvent(i)})}else{var n=new bd("complete");n.resultItem=this.resultItem;this.dispatchEvent(n)}}}]);return t}(Md);var Ud=function(e){w(t,e);function t(e){g(this,t);return b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}y(t,[{key:"onRegister",value:function e(){}},{key:"_complete",value:function e(t){var i=t.resultItem;var r=[];for(var n in i){r.push(i[n])}this.sendNotification("localComplete",r)}},{key:"_progress",value:function e(t){this.sendNotification("loaderProgress",t)}},{key:"_error",value:function e(t){t.target.removeAllEventListeners();this.sendNotification("loaderError",t)}},{key:"_fileload",value:function e(t){this.sendNotification("loaderFile",t)}},{key:"onRemove",value:function e(){}},{key:"load",value:function e(t,i){var r=new Bd;r.on("complete",this._complete.bind(this));r.on("progress",this._progress.bind(this));r.on("error",this._error.bind(this));r.on("fileload",this._fileload.bind(this));if(typeof t=="string"){t={src:t,loadType:i}}else if(t instanceof Array){for(var n=0;n<t.length;n++){if(t[n]===undefined)continue;if(typeof t[n]=="string"){t[n]={src:t,loadType:i}}else{t[n].loadType=i}}}r.addItem(t);r.start();this.sendNotification("loaderStart",t,i)}}]);return t}(R);var Dd=function(e){w(t,e);function t(){g(this,t);var e=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e._subCommands=new Array;e.initializeMacroCommand();return e}y(t,[{key:"initializeMacroCommand",value:function e(){}},{key:"addSubCommand",value:function e(t){this._subCommands.push(t)}},{key:"execute",value:function e(t){while(this._subCommands.length>0){var i=this._subCommands.shift();var r=new i;r.execute(t)}}}]);return t}(hd);var Fd=function(e){w(t,e);function t(){g(this,t);return b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}y(t,[{key:"initializeMacroCommand",value:function e(){zd.ERROR=0;zd.LEVEL2=false;var t=this.facade.registerProxy(new P("stage"));this.facade.registerProxy(new Ud("loader"));this.addSubCommand(zd);this.addSubCommand(wd);this.addSubCommand(xd)}}]);return t}(Dd);var jd=function(e){w(t,e);function t(){g(this,t);var e=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(t._instance){throw new Error("is Singleton")}return e}y(t,[{key:"initializeController",value:function e(){x(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initializeController",this).call(this);this.registerCommand(t.START,Fd)}},{key:"start",value:function e(i,r){if(!this.hasCommand(t.START)){this.registerCommand(t.START,Fd)}this.sendNotification(t.START,i);this.sendNotification("setGameOver",r)}}],[{key:"getInstance",value:function e(){return t._instance===undefined?t._instance=new t:t._instance}}]);return t}(C);jd.START="game_start";e.THREE=eu;e.TWEEN=lu;e.Game=jd;Object.defineProperty(e,"__esModule",{value:true})}); 
 			});
 		define("lib/weapp-adapter.js", function(require, module, exports){ 			
"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(1)),r=GameGlobal;GameGlobal.__isAdapterInjected||(GameGlobal.__isAdapterInjected=!0,function(){o.addEventListener=o.canvas.addEventListener=function(e,t){o.document.addEventListener(e,t)},o.removeEventListener=o.canvas.removeEventListener=function(e,t){o.document.removeEventListener(e,t)};var e=wx.getSystemInfoSync().platform;if("undefined"==typeof __devtoolssubcontext&&"devtools"===e){for(var t in o){var n=Object.getOwnPropertyDescriptor(r,t);n&&!0!==n.configurable||Object.defineProperty(window,t,{value:o[t]})}for(var i in o.document){var a=Object.getOwnPropertyDescriptor(r.document,i);a&&!0!==a.configurable||Object.defineProperty(r.document,i,{value:o.document[i]})}window.parent=window}else{for(var u in o)r[u]=o[u];r.window=o,window=r,window.top=window.parent=window}}())},function(e,t,n){function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.cancelAnimationFrame=t.requestAnimationFrame=t.clearInterval=t.clearTimeout=t.setInterval=t.setTimeout=t.canvas=t.location=t.localStorage=t.HTMLElement=t.FileReader=t.Audio=t.Image=t.WebSocket=t.XMLHttpRequest=t.navigator=t.document=void 0;var r=n(2);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var i=n(3);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=o(n(9)),u=o(n(10)),c=o(n(17)),l=o(n(18)),s=o(n(19)),f=o(n(11)),d=o(n(12)),p=o(n(20)),h=o(n(4)),y=o(n(21)),v=o(n(22));t.document=u.default,t.navigator=c.default,t.XMLHttpRequest=l.default,t.WebSocket=s.default,t.Image=f.default,t.Audio=d.default,t.FileReader=p.default,t.HTMLElement=h.default,t.localStorage=y.default,t.location=v.default;var b=new a.default;t.canvas=b,t.setTimeout=setTimeout,t.setInterval=setInterval,t.clearTimeout=clearTimeout,t.clearInterval=clearInterval,t.requestAnimationFrame=requestAnimationFrame,t.cancelAnimationFrame=cancelAnimationFrame},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=wx.getSystemInfoSync(),o=n.screenWidth,r=n.screenHeight,i=n.devicePixelRatio,a=t.innerWidth=o,u=t.innerHeight=r;t.devicePixelRatio=i;t.screen={availWidth:a,availHeight:u},t.performance={now:function(){return Date.now()/1e3}},t.ontouchstart=null,t.ontouchmove=null,t.ontouchend=null},function(t,n,o){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(t,n){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!==(void 0===n?"undefined":e(n))&&"function"!=typeof n?t:n}function a(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+(void 0===n?"undefined":e(n)));t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n)}Object.defineProperty(n,"__esModule",{value:!0}),n.HTMLCanvasElement=n.HTMLImageElement=void 0;var u=function(e){return e&&e.__esModule?e:{default:e}}(o(4));n.HTMLImageElement=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"img"))}return a(t,u.default),t}(),n.HTMLCanvasElement=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"canvas"))}return a(t,u.default),t}()},function(t,n,o){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(t,n){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!==(void 0===n?"undefined":e(n))&&"function"!=typeof n?t:n}function a(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+(void 0===n?"undefined":e(n)));t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=function(e){return e&&e.__esModule?e:{default:e}}(o(5)),l=o(8),s=o(2),f=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.className="",n.childern=[],n.style={width:s.innerWidth+"px",height:s.innerHeight+"px"},n.insertBefore=l.noop,n.innerHTML="",n.tagName=e.toUpperCase(),n}return a(t,c.default),u(t,[{key:"setAttribute",value:function(e,t){this[e]=t}},{key:"getAttribute",value:function(e){return this[e]}},{key:"getBoundingClientRect",value:function(){return{top:0,left:0,width:s.innerWidth,height:s.innerHeight}}},{key:"focus",value:function(){}},{key:"clientWidth",get:function(){var e=parseInt(this.style.fontSize,10)*this.innerHTML.length;return Number.isNaN(e)?0:e}},{key:"clientHeight",get:function(){var e=parseInt(this.style.fontSize,10);return Number.isNaN(e)?0:e}}]),t}();n.default=f},function(t,n,o){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(t,n){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!==(void 0===n?"undefined":e(n))&&"function"!=typeof n?t:n}function a(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+(void 0===n?"undefined":e(n)));t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(e){return e&&e.__esModule?e:{default:e}}(o(6)),c=function(e){function t(){r(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.className="",e.children=[],e}return a(t,u.default),t}();n.default=c},function(t,n,o){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(t,n){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!==(void 0===n?"undefined":e(n))&&"function"!=typeof n?t:n}function a(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+(void 0===n?"undefined":e(n)));t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=function(e){return e&&e.__esModule?e:{default:e}}(o(7)),l=function(e){function t(){r(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.childNodes=[],e}return a(t,c.default),u(t,[{key:"appendChild",value:function(e){if(!(e instanceof t))throw new TypeError("Failed to executed 'appendChild' on 'Node': parameter 1 is not of type 'Node'.");this.childNodes.push(e)}},{key:"cloneNode",value:function(){var e=Object.create(this);return Object.assign(e,this),e}},{key:"removeChild",value:function(e){var t=this.childNodes.findIndex(function(t){return t===e});return t>-1?this.childNodes.splice(t,1):null}}]),t}();n.default=l},function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=new WeakMap,i=function(){function e(){n(this,e),r.set(this,{})}return o(e,[{key:"addEventListener",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=r.get(this);o||(o={},r.set(this,o)),o[e]||(o[e]=[]),o[e].push(t),n.capture&&console.warn("EventTarget.addEventListener: options.capture is not implemented."),n.once&&console.warn("EventTarget.addEventListener: options.once is not implemented."),n.passive&&console.warn("EventTarget.addEventListener: options.passive is not implemented.")}},{key:"removeEventListener",value:function(e,t){var n=r.get(this)[e];if(n&&n.length>0)for(var o=n.length;o--;o>0)if(n[o]===t){n.splice(o,1);break}}},{key:"dispatchEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=r.get(this)[e.type];if(t)for(var n=0;n<t.length;n++)t[n](e)}}]),e}();t.default=i},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.noop=function(){}},function(e,t,n){function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=wx.createCanvas();e.type="canvas",e.__proto__.__proto__=new r.default("canvas");e.getContext;return e.getBoundingClientRect=function(){return{top:0,left:0,width:window.innerWidth,height:window.innerHeight}},e};n(3);var r=o(n(4));o(n(10))},function(e,t,n){function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(1)),i=o(n(4)),a=o(n(11)),u=o(n(12)),c=o(n(9));n(15);var l={},s={readyState:"complete",visibilityState:"visible",documentElement:r,hidden:!1,style:{},location:r.location,ontouchstart:null,ontouchmove:null,ontouchend:null,head:new i.default("head"),body:new i.default("body"),createElement:function(e){return"canvas"===e?new c.default:"audio"===e?new u.default:"img"===e?new a.default:new i.default(e)},getElementById:function(e){return e===r.canvas.id?r.canvas:null},getElementsByTagName:function(e){return"head"===e?[s.head]:"body"===e?[s.body]:"canvas"===e?[r.canvas]:[]},querySelector:function(e){return"head"===e?s.head:"body"===e?s.body:"canvas"===e?r.canvas:e==="#"+r.canvas.id?r.canvas:null},querySelectorAll:function(e){return"head"===e?[s.head]:"body"===e?[s.body]:"canvas"===e?[r.canvas]:[]},addEventListener:function(e,t){l[e]||(l[e]=[]),l[e].push(t)},removeEventListener:function(e,t){var n=l[e];if(n&&n.length>0)for(var o=n.length;o--;o>0)if(n[o]===t){n.splice(o,1);break}},dispatchEvent:function(e){var t=l[e.type];if(t)for(var n=0;n<t.length;n++)t[n](e)}};t.default=s},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return wx.createImage()}},function(t,n,o){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(t,n){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!==(void 0===n?"undefined":e(n))&&"function"!=typeof n?t:n}function a(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+(void 0===n?"undefined":e(n)));t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=function(e){return e&&e.__esModule?e:{default:e}}(o(13)),l=0,s=1,f=2,d=3,p=4,h=new WeakMap,y=new WeakMap,v=(new WeakMap,new WeakMap,function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));n.HAVE_NOTHING=l,n.HAVE_METADATA=s,n.HAVE_CURRENT_DATA=f,n.HAVE_FUTURE_DATA=d,n.HAVE_ENOUGH_DATA=p,n.readyState=l,y.set(n,"");var o=wx.createInnerAudioContext();return h.set(n,o),o.onCanplay(function(){n.dispatchEvent({type:"load"}),n.dispatchEvent({type:"loadend"}),n.dispatchEvent({type:"canplay"}),n.dispatchEvent({type:"canplaythrough"}),n.dispatchEvent({type:"loadedmetadata"}),n.readyState=f}),o.onPlay(function(){n.dispatchEvent({type:"play"})}),o.onPause(function(){n.dispatchEvent({type:"pause"})}),o.onEnded(function(){n.dispatchEvent({type:"ended"}),n.readyState=p}),o.onError(function(){n.dispatchEvent({type:"error"})}),e&&(h.get(n).src=e),n}return a(t,c.default),u(t,[{key:"load",value:function(){console.warn("HTMLAudioElement.load() is not implemented.")}},{key:"play",value:function(){h.get(this).play()}},{key:"pause",value:function(){h.get(this).pause()}},{key:"canPlayType",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"string"!=typeof e?"":e.indexOf("audio/mpeg")>-1||e.indexOf("audio/mp4")?"probably":""}},{key:"cloneNode",value:function(){var e=new t;return e.loop=h.get(this).loop,e.autoplay=h.get(this).loop,e.src=this.src,e}},{key:"currentTime",get:function(){return h.get(this).currentTime},set:function(e){h.get(this).seek(e)}},{key:"src",get:function(){return y.get(this)},set:function(e){y.set(this,e),h.get(this).src=e}},{key:"loop",get:function(){return h.get(this).loop},set:function(e){h.get(this).loop=e}},{key:"autoplay",get:function(){return h.get(this).autoplay},set:function(e){h.get(this).autoplay=e}},{key:"paused",get:function(){return h.get(this).paused}}]),t}());n.default=v},function(t,n,o){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(t,n){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!==(void 0===n?"undefined":e(n))&&"function"!=typeof n?t:n}function a(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+(void 0===n?"undefined":e(n)));t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(e){return e&&e.__esModule?e:{default:e}}(o(14)),c=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"audio"))}return a(t,u.default),t}();n.default=c},function(t,n,o){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(t,n){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!==(void 0===n?"undefined":e(n))&&"function"!=typeof n?t:n}function a(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+(void 0===n?"undefined":e(n)));t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=function(e){return e&&e.__esModule?e:{default:e}}(o(4)),l=function(e){function t(e){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return a(t,c.default),u(t,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),t}();n.default=l},function(e,t,n){n(16)},function(e,t,n){function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e){return function(t){var n=new c(e);n.touches=t.touches,n.targetTouches=Array.prototype.slice.call(t.touches),n.changedTouches=t.changedTouches,n.timeStamp=t.timeStamp,a.default.dispatchEvent(n)}}var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(1)),a=function(e){return e&&e.__esModule?e:{default:e}}(n(10)),u=n(8),c=function e(t){o(this,e),this.target=i.canvas,this.currentTarget=i.canvas,this.touches=[],this.targetTouches=[],this.changedTouches=[],this.preventDefault=u.noop,this.stopPropagation=u.noop,this.type=t};wx.onTouchStart(r("touchstart")),wx.onTouchMove(r("touchmove")),wx.onTouchEnd(r("touchend")),wx.onTouchCancel(r("touchcancel"))},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var o=n(8),r={platform:wx.getSystemInfoSync().platform,language:"zh-cn",appVersion:"5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/zh_CN",onLine:!0,geolocation:{getCurrentPosition:o.noop,watchPosition:o.noop,clearWatch:o.noop}};t.default=r},function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){if("function"==typeof this["on"+e]){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];this["on"+e].apply(this,n)}}function r(e){this.readyState=e,o.call(this,"readystatechange")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=new WeakMap,u=new WeakMap,c=new WeakMap,l=new WeakMap,s=new WeakMap,f=function(){function e(){n(this,e),this.onabort=null,this.onerror=null,this.onload=null,this.onloadstart=null,this.onprogress=null,this.ontimeout=null,this.onloadend=null,this.onreadystatechange=null,this.readyState=0,this.response=null,this.responseText=null,this.responseType="",this.responseXML=null,this.status=0,this.statusText="",this.upload={},this.withCredentials=!1,c.set(this,{"content-type":"application/x-www-form-urlencoded"}),l.set(this,{})}return i(e,[{key:"abort",value:function(){var e=s.get(this);e&&e.abort()}},{key:"getAllResponseHeaders",value:function(){var e=l.get(this);return Object.keys(e).map(function(t){return t+": "+e[t]}).join("\n")}},{key:"getResponseHeader",value:function(e){return l.get(this)[e]}},{key:"open",value:function(t,n){u.set(this,t),a.set(this,n),r.call(this,e.OPENED)}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.readyState!==e.OPENED)throw new Error("Failed to execute 'send' on 'XMLHttpRequest': The object's state must be OPENED.");wx.request({data:n,url:a.get(this),method:u.get(this),header:c.get(this),responseType:this.responseType,success:function(n){var i=n.data,a=n.statusCode,u=n.header;if("string"!=typeof i&&!(i instanceof ArrayBuffer))try{i=JSON.stringify(i)}catch(e){i=i}if(t.status=a,l.set(t,u),o.call(t,"loadstart"),r.call(t,e.HEADERS_RECEIVED),r.call(t,e.LOADING),t.response=i,i instanceof ArrayBuffer){t.responseText="";for(var c=new Uint8Array(i),s=c.byteLength,f=0;f<s;f++)t.responseText+=String.fromCharCode(c[f])}else t.responseText=i;r.call(t,e.DONE),o.call(t,"load"),o.call(t,"loadend")},fail:function(e){var n=e.errMsg;-1!==n.indexOf("abort")?o.call(t,"abort"):o.call(t,"error",n),o.call(t,"loadend")}})}},{key:"setRequestHeader",value:function(e,t){var n=c.get(this);n[e]=t,c.set(this,n)}}]),e}();f.UNSEND=0,f.OPENED=1,f.HEADERS_RECEIVED=2,f.LOADING=3,f.DONE=4,t.default=f},function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=new WeakMap,i=function(){function e(t){var o=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(n(this,e),this.binaryType="",this.bufferedAmount=0,this.extensions="",this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this.protocol="",this.readyState=3,"string"!=typeof t||!/(^ws:\/\/)|(^wss:\/\/)/.test(t))throw new TypeError("Failed to construct 'WebSocket': The URL '"+t+"' is invalid");this.url=t,this.readyState=e.CONNECTING;var a=wx.connectSocket({url:t,protocols:Array.isArray(i)?i:[i]});return r.set(this,a),a.onClose(function(t){o.readyState=e.CLOSED,"function"==typeof o.onclose&&o.onclose(t)}),a.onMessage(function(e){"function"==typeof o.onmessage&&o.onmessage(e)}),a.onOpen(function(){o.readyState=e.OPEN,"function"==typeof o.onopen&&o.onopen()}),a.onError(function(e){"function"==typeof o.onerror&&o.onerror(new Error(e.errMsg))}),this}return o(e,[{key:"close",value:function(t,n){this.readyState=e.CLOSING,r.get(this).close({code:t,reason:n})}},{key:"send",value:function(e){if("string"!=typeof e&&!(e instanceof ArrayBuffer))throw new TypeError("Failed to send message: The data "+e+" is invalid");r.get(this).send({data:e})}}]),e}();i.CONNECTING=0,i.OPEN=1,i.CLOSING=2,i.CLOSED=3,t.default=i},function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){n(this,e)}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={get length(){return wx.getStorageInfoSync().keys.length},key:function(e){return wx.getStorageInfoSync().keys[e]},getItem:function(e){return wx.getStorageSync(e)},setItem:function(e,t){return wx.setStorageSync(e,t)},removeItem:function(e){wx.removeStorageSync(e)},clear:function(){wx.clearStorageSync()}};t.default=n},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={href:"game.js",reload:function(){}};t.default=n}]); 
 			});
 		define("lib/wxapi.js", function(require, module, exports){ 			
"use strict";var o=require("./cos-wx-sdk-v4"),n={config:{request:{urlRoot:"https://app.ingame.qq.com",login_type:"wxapp",game:"mv2",wxapp_channelid:""},default:{nickname:"我",avatar:"https://game.gtimg.cn/images/yxzj/act/a20161206pvpmatchcenter/lol/default.png"},video:[2131,2132,2133,2134],friendInfoMaxLen:20},data:{reGetMediaData:null,reLoginCounter:null,bookingStatus:-1,videoSrcData:null,videoObj:null,storePageInfo:null},arraySliceFromTail:function(o,n){return o&&0!=o.length?o.slice(-(n||o.length)):[]},trim:function(o){var n=/^\s+/,e=/\s+$/;return o?o.toString().replace(n,"").replace(e,""):""},httpToHttps:function(o){return o?-1==o.indexOf("http://")&&-1==o.indexOf("https://")?"https:"+o:o.replace(/http:\/\//g,"https://"):""},avatarFix:function(o,n){if(!o)return"";if(-1!=o.indexOf(".png"))return o;(o=o.split("/"))[o.length-1]=void 0===n?96:n;for(var e="",t=0;t<o.length;t++)e+=t<o.length-1?o[t]+"/":o[t];return e},showLoading:function(o){wx.showToast({title:o||"正在加载...",icon:"loading",duration:1e4,mask:!0})},hideLoading:function(){wx.hideToast()},showModal:function(o){var e=n;wx.showModal({title:o.title||"提示",content:o.content,showCancel:void 0!==o.showCancel&&!!o.showCancel,cancelText:o.cancelText||"取消",confirmText:o.confirmText||"确定",confirmColor:"#3CC51F",success:function(n){n.confirm?"function"==typeof o.confirm&&o.confirm():n.cancel?"function"==typeof o.cancel&&o.cancel():e.showModal(o)}})},request:function(o){wx.request({url:o.url,data:o.data||{},header:o.header||{"content-type":"application/json"},method:o.method||"GET",success:function(n){console.log(n),"function"==typeof o.success&&o.success(n.data)},fail:function(n){console.log("WXAPI-REQEUST-FAIL:"),console.log(n),"function"==typeof o.fail&&o.fail(n)},complete:function(o){}})},login:function(o,e){var t=n;1==e&&wx.removeStorageSync("userInfo"),wx.getStorageSync("userInfo")?"function"==typeof o&&o(wx.getStorageSync("userInfo")):wx.login({success:function(n){t.request({url:t.config.request.urlRoot+"/php/ingame/mv2wxgame/login.php",data:{login_type:t.config.request.login_type,game:t.config.request.game,wxapp_channelid:t.config.request.wxapp_channelid,code:n.code},success:function(n){"SUCCESS"==n.status?(console.log("------登录成功,用户信息------"),console.log(n.data),wx.setStorageSync("userInfo",n.data),"function"==typeof o&&o(n.data)):(t.data.reLoginCounter>3?t.showModal({content:"登录失败，请稍后再试。"}):t.login(o,1),t.data.reLoginCounter=(t.data.reLoginCounter||0)+1,console.info("[登录失败][错误代码："+n.data.code+"，错误信息："+n.msg+";"+n.data.msg+"]"))},fail:function(o){console.info(o),t.showModal({content:"网络繁忙，请稍后再试。[-1001]"})}})}})},getNicknameAvatar:function(o){var e=n;wx.getStorageSync("userNicknameAvatar")?"function"==typeof o&&o(wx.getStorageSync("userNicknameAvatar")):wx.getUserInfo({success:function(n){var t={nickname:e.trim(n.userInfo.nickName.replace(/　| /g,""))||e.config.default.nickname,avatar:e.avatarFix(e.httpToHttps(n.userInfo.avatarUrl),96)||e.config.default.avatar};t.nickname!=e.config.default.nickname&&t.avatar!=e.config.default.avatar&&wx.setStorageSync("userNicknameAvatar",t),"function"==typeof o&&o(t)},fail:function(n){"function"==typeof wx.openSetting&&function n(){e.showModal({content:"小游戏需要您的允许才能正常使用。请点击“去设置”并勾选“用户信息”，即可正常使用。",confirmText:"去设置",confirm:function(){wx.openSetting({success:function(t){console.log(t),t.authSetting["scope.userInfo"]?e.getNicknameAvatar(o):n()}})}})}(),"function"!=typeof wx.openSetting&&(e.showModal({content:"小游戏需要您允许微信授权才能正常使用。请先删除当前小游戏，并再次进入本页面允许微信授权，即可正常使用。"}),"function"==typeof o&&o(!1))}})},getRecorderManager:function(){return wx.getRecorderManager()},createInnerAudioContext:function(o){var n=new wx.createInnerAudioContext;return n.src=o,n.autoplay=!0,n.obeyMuteSwitch=!1,n},storePageInfo:function(e,t){var a=n;if(a.data.storePageInfo=a.data.storePageInfo||{},a.data.storePageInfo.params&&a.data.storePageInfo.pid&&JSON.stringify(a.data.storePageInfo.params)==JSON.stringify(e))return"function"==typeof t&&t(a.data.storePageInfo.pid),void console.log("pid："+a.data.storePageInfo.pid);a.data.storePageInfo.params=e,a.data.storePageInfo.pid=null,a.showLoading("正在提交...");!function i(c){a.login(function(c){console.log("sessionid："+c.session_id),a.request({url:a.config.request.urlRoot+"/php/ingame/mv2wxgame/store_page_info.php",data:{login_type:a.config.request.login_type,game:a.config.request.game,wxapp_channelid:a.config.request.wxapp_channelid,session_id:c.session_id,salutation:e.salutation,type:e.type,avatar_url:e.avatar_url,nickname:e.nickname,audio_duration:e.audio_duration},success:function(c){if("SUCCESS"==c.status)if(console.log(c.data),e.tempFilePath){console.log("需要上传音频");var s=new o({progressInterval:1e3});s.appid=c.data.audio_upload.appid,s.bucket=c.data.audio_upload.bucket,s.region=c.data.audio_upload.region,s.getAppSign=function(o){o(c.data.audio_upload.sign)},s.getAppSignOnce=function(o){o(c.data.audio_upload.sign)},s.uploadFile({success:function(o){n.tcssCount("api.store_page_info_upload_succ"),a.hideLoading(),console.log("上传成功."),console.log(o),a.data.storePageInfo.pid=c.data.pid,"function"==typeof t&&t(c.data.pid),console.log("pid："+c.data.pid)},error:function(o){n.tcssCount("api.store_page_info_upload_fail"),a.hideLoading(),a.showModal({content:"网络繁忙，请稍后再试。[-1002]"}),console.log("网络繁忙，请稍后再试。[2]"),console.log(o)},bucket:c.data.audio_upload.bucket,path:c.data.audio_upload.filepath,filepath:e.tempFilePath,insertOnly:0,bizAttr:"test-biz-val",onProgress:function(o){}})}else n.tcssCount("api.store_page_info_succ"),a.hideLoading(),a.data.storePageInfo.pid=c.data.pid,"function"==typeof t&&t(c.data.pid),console.log("pid："+c.data.pid);else n.tcssCount("api.store_page_info_fail_"+c.data.code),-1024==c.data.code?i(1):(a.hideLoading(),a.showModal({content:"网络繁忙，请稍后再试。["+c.data.code+"]"}),console.log("网络繁忙，请稍后再试。[1]"),console.log(c)),console.info("[存用户信息-上传音频文件][错误代码："+c.data.code+"，错误信息："+c.msg+"]")},fail:function(o){a.hideLoading(),console.info(o),a.showModal({content:"网络繁忙，请稍后再试。[-1003]"})}})},c)}(0)},checkLogin:function(){var o=n;wx.checkSession({success:function(){},fail:function(){o.login(null,1)}})},getSystemInfo:function(){var o="function"==typeof wx.getSystemInfoSync?wx.getSystemInfoSync():{system:"Android 5.0"},n=/android/i.test(o.system.toLowerCase()),e=/iphone|ios|ipad/i.test(o.system.toLowerCase());return n?"android":e?"ios":"android"},checkBookingStatus:function(o){var e=n;if(-1!=e.data.bookingStatus)"function"==typeof o&&o(e.data.bookingStatus);else{!function n(t){e.login(function(t){e.request({url:e.config.request.urlRoot+"/php/ingame/digg/query_reservation_status.php",data:{login_type:e.config.request.login_type,game:e.config.request.game,wxapp_channelid:e.config.request.wxapp_channelid,session_id:t.session_id},success:function(t){"SUCCESS"==t.status?(e.hideLoading(),e.data.bookingStatus=t.data.reserved,"function"==typeof o&&o(e.data.bookingStatus)):(-1024==t.data.code?n(1):(e.hideLoading(),e.showModal({content:"网络繁忙，请稍后再试。[-1004]"}),console.log(t)),console.info("[查询用户预约情况][错误代码："+t.data.code+"，错误信息："+t.msg+"]"))},fail:function(o){e.hideLoading(),console.info(o),e.showModal({content:"网络繁忙，请稍后再试。[-1005]"})}})},t)}(0)}},bookingGame:function(o){var e=n;if(1==e.data.bookingStatus)e.showModal({content:"您已预约过游戏，请勿重复预约。"});else{e.showLoading("正在预约...");!function n(t){e.login(function(t){e.request({url:e.config.request.urlRoot+"/php/ingame/digg/reservation.php",data:{login_type:e.config.request.login_type,game:e.config.request.game,wxapp_channelid:e.config.request.wxapp_channelid,session_id:t.session_id},success:function(t){"SUCCESS"==t.status?(e.hideLoading(),console.log("恭喜您，预约成功！"),e.data.bookingStatus=1,"function"==typeof o&&o()):(-1024==t.data.code?n(1):4==t.data.code?(e.hideLoading(),e.showModal({content:"您已预约过游戏，请勿重复预约。"}),console.log(t)):(e.hideLoading(),e.showModal({content:"网络繁忙，请稍后再试。[-1006]"}),console.log(t)),console.info("[提交预约][错误代码："+t.data.code+"，错误信息："+t.msg+"]"))},fail:function(o){e.hideLoading(),console.info(o),e.showModal({content:"网络繁忙，请稍后再试。[-1007]"})}})},t)}(0)}},queryPageInfo:function(o,e){var t=n,a=wx.getStorageSync("friendInfoNew"),i=null;if(a&&a.length>0)for(var c=0;c<a.length;c++)if(a[c].pid==o){i=a[c];break}if(i)"function"==typeof e&&e(i);else{t.showLoading();!function n(a){t.login(function(a){t.request({url:t.config.request.urlRoot+"/php/ingame/mv2wxgame/query_page_info.php",data:{login_type:t.config.request.login_type,game:t.config.request.game,wxapp_channelid:t.config.request.wxapp_channelid,session_id:a.session_id,pid:o},success:function(a){if("SUCCESS"==a.status){t.hideLoading(),console.log(a.data);var i={pid:o,type:a.data.type,salutation:a.data.salutation,audio_url:a.data.audio_url,audio_duration:a.data.audio_duration,avatar_url:a.data.avatar_url,nickname:a.data.nickname},c=wx.getStorageSync("friendInfoNew")||[];c.push(i),wx.setStorageSync("friendInfoNew",t.arraySliceFromTail(c,t.config.friendInfoMaxLen)),"function"==typeof e&&e(i)}else-1024==a.data.code?n(1):(t.hideLoading(),t.showModal({content:"网络繁忙，请稍后再试。[-1008]"}),console.log(a)),console.info("[查询好友分享信息][错误代码："+a.data.code+"，错误信息："+a.msg+"]")},fail:function(o){t.hideLoading(),console.info(o),t.showModal({content:"网络繁忙，请稍后再试。[-1009]"})}})},a)}(0)}},createVideo:function(o,e){var t=n,a=function(n){t.data.videoObj=t.data.videoObj||wx.createVideo({src:n,x:0,y:0,width:window.innerWidth,height:window.innerHeight,objectFit:"cover",controls:!1,autoplay:!0,muted:!1,loop:!1,hide:!1}),t.data.videoObj.onended=function(n){console.log("end"),console.log(n),t.data.videoObj&&(t.data.videoObj.hide=!0,t.data.videoObj.destroy(),t.data.videoObj=null),"function"==typeof e&&e(o)},t.data.videoObj.onplay=function(o){t.hideLoading(),console.log("play"),console.log(o)},t.data.videoObj.onwaiting=function(o){console.log("wait"),console.log(o)},t.data.videoObj.onerror=function(o){console.log("video error"),console.log(o)},t.data.videoObj.play()};if(t.data.videoSrcData)a(t.data.videoSrcData[t.config.video[o-1]]);else{t.showLoading();!function n(){t.request({url:"https://game.gtimg.cn/images/spiderMediaData/mv2_new/mediaURLData.js",data:{},success:function(n){t.hideLoading(),t.data.videoSrcData=JSON.parse(n.split("var mediaURLData=")[1]),a(t.data.videoSrcData[t.config.video[o-1]])},fail:function(o){t.data.reGetMediaData>10?t.showModal({content:"网络繁忙，请稍后再试。[-1010]"}):n(),t.data.reGetMediaData=(t.data.reGetMediaData||0)+1}})}()}},createTimelineQrcode:function(o,e){var t=n;!function(n){t.login(function(n){var a={};a.game=t.config.request.game,a.session_id=n.session_id,a.login_type=t.config.request.login_type,a.params=JSON.stringify({width:247,scene:o});var i=t.config.request.urlRoot+"/php/ingame/mv2wxgame/get_qrcode.php?params="+a.params+"&game="+a.game+"&session_id="+a.session_id+"&login_type="+a.login_type;"function"==typeof e&&e(i)},n)}(0)},rndTextImg:function(o){var n=[[1,2,3,4],[1,2,3,4,5],[1,2,3,4,5],[1,2,3,4,5]];return(n=n[o-1])[parseInt(Math.random()*n.length)]},Base64Binary:{_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(o){var n=o.length/4*3,e=new ArrayBuffer(n);return this.decode(o,e),e},removePaddingChars:function(o){return 64==this._keyStr.indexOf(o.charAt(o.length-1))?o.substring(0,o.length-1):o},decode:function(o,n){o=this.removePaddingChars(o),o=this.removePaddingChars(o);var e,t,a,i,c,s,d,r=parseInt(o.length/4*3,10),u=0,l=0;for(e=n?new Uint8Array(n):new Uint8Array(r),o=o.replace(/[^A-Za-z0-9\+\/\=]/g,""),u=0;u<r;u+=3)t=this._keyStr.indexOf(o.charAt(l++))<<2|(c=this._keyStr.indexOf(o.charAt(l++)))>>4,a=(15&c)<<4|(s=this._keyStr.indexOf(o.charAt(l++)))>>2,i=(3&s)<<6|(d=this._keyStr.indexOf(o.charAt(l++))),e[u]=t,64!=s&&(e[u+1]=a),64!=d&&(e[u+2]=i);return e}},tcssCount:function(o,e){var t=n;t.login(function(n){var a=n.openid,i=function(o,n,e){var i="dcv_gamemina"+o+("uv"==n?"."+a:"");t.request({url:"https://pingfore.qq.com/pingd?url=/&hotx=9999&hoty=9999&rfr=mv2miniapp",data:{dm:"mv2.qq.com.hot",hottag:i,rand:Math.random()},success:function(o){(o={}).data={status:1,msg:"请求成功",data:{domain:"mv2.qq.com",hottag:i}},o.data.status&&o.data.data.hottag.length,"function"==typeof e&&e()}})},c=function(){return(new Date).getHours()};i("."+o,"pv",function(){i("_h"+c()+"."+o,"pv",function(){i("."+o,"uv",function(){i("_h"+c()+"."+o,"uv",e)})})})})}};module.exports=n; 
 			});
 		define("game.js", function(require, module, exports){ 			
"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=require("./lib/mv4");require("./lib/weapp-adapter");var n=require("./lib/wxapi.js"),t={renderer:null,camera:null,scene:null,raycaster:null,mouse:null,textureList:null,inputCurText:"",keyboardStatus:0,microphoneWaveTween:null,recorderCountdownTimer:null,soundWaveTween:null,soundAniStatus:0,recordCompleteClickStatus:0,recordStatus:0,audioType:"my",audioObj:null,recordObj:null,my:{nickname:n.config.default.nickname,avatar:n.config.default.avatar,audioSrc:"",audioDuration:0,pid:0},friend:{pid:0,type:1,salutation:"",audio_url:"",audio_duration:0,avatar_url:n.config.default.avatar,nickname:n.config.default.nickname,text_id:1},gameStatus:0};(function(){var o=0,c=null,s=null,r=0,i=0,p=0,l={recorder:{duration:6e4,sampleRate:16e3,numberOfChannels:1,encodeBitRate:24e3,format:"mp3"},inputDefaultText:"致亲爱的朋友",inputTextColor:"#ffffff",inputByteLimit:24,dpr:null,scale:window.innerWidth/750,system:n.getSystemInfo(),recordMySelect:0},g=t,u={trim:function(e){var a=/^\s+/,n=/\s+$/;return null==e?"":e.toString().replace(a,"").replace(n,"")},getByteLimitText:function(e,a){for(var n=0,t=void 0,o="",c=0,s=0;s<e.length;s++)(n+=(t=e.charCodeAt(s))>=0&&t<=255||t>=65377&&t<=65439?1:2)<=a&&(o+=e[s],c=n);return{str:o,byte:c}},getDpr:function(e){return(window.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1)},drawSprite:function(e,t,o){if(void 0!==t&&0!=t.length){void 0===o&&(o=t.length-1),g.textureList=g.textureList||{},g.textureList[t[o].name]=g.textureList[t[o].name]||new a.THREE.Texture;var c=wx.createImage();if(c.onload=function(){g.textureList[t[o].name].image=c,g.textureList[t[o].name].repeat.copy(new a.THREE.Vector2(1,1)),g.textureList[t[o].name].offset.copy(new a.THREE.Vector2(0,0)),g.textureList[t[o].name].wrapS=a.THREE.RepeatWrapping,g.textureList[t[o].name].wrapT=a.THREE.RepeatWrapping,g.textureList[t[o].name].needsUpdate=!0;var n=new a.THREE.BoxGeometry(t[o].w,t[o].h,1),s=new a.THREE.MeshBasicMaterial({map:g.textureList[t[o].name]});s.transparent=!0;var r=new a.THREE.Mesh(n,s);r.position.x=t[o].x,r.position.y=t[o].y,r.position.z=t[o].z||0,r.name=t[o].name,void 0!==t[o].opacity&&(r.material.opacity=t[o].opacity),e.add(r),o>0&&setTimeout(function(){u.drawSprite(e,t,o-1)},11),"function"==typeof t[o].cb&&t[o].cb(r)},"timelineImg"==t[o].type){n.showLoading("正在生成...");var s=new wx.createCanvas;s.width=t[o].ow,s.height=t[o].oh;var r=s.getContext("2d"),i=wx.createImage();i.onload=function(){r.drawImage(i,0,0);var e=wx.createImage();e.onload=function(){r.drawImage(e,30,25,94,94);var a=wx.createImage();a.onload=function(){r.drawImage(a,251,396,247,247);var e=new wx.createCanvas;e.width=390,e.height=80;var c=e.getContext("2d");c.fillStyle="#ffffff",c.font="30px Arial",c.fillText(t[o].text,0,30);var i=wx.createImage();i.onload=function(){r.drawImage(i,154,30),wx.getFileSystemManager().writeFile({filePath:wx.env.USER_DATA_PATH+"/timelineshareimg.jpg",data:n.Base64Binary.decodeArrayBuffer(s.toDataURL("image/png").split(",")[1]),success:function(){"function"==typeof wx.previewImage&&wx.previewImage({current:"",urls:[wx.env.USER_DATA_PATH+"/timelineshareimg.jpg"],success:function(){console.log("preview img succ.")}}),n.tcssCount("btn.page3_btn_share_timeline_succ"),n.tcssCount("btn.page3_btn_share_timeline_succ_type_"+(wx.getStorageSync("mySelectId")||0)),n.hideLoading()}})},i.src=e.toDataURL("image/png")},wx.downloadFile({url:t[o].src3,success:function(e){200===e.statusCode&&(a.src=e.tempFilePath)},fail:function(e){n.hideLoading(),console.info(e),n.showModal({content:"生成失败，请检查网络设置。"})}})},e.src=t[o].src2},i.src=t[o].src1}else if("circleImg"==t[o].type){var p=new wx.createCanvas;p.width=t[o].ow,p.height=t[o].oh;var l=p.getContext("2d"),d=wx.createImage();d.onload=function(){var e=l.createPattern(d,"no-repeat");l.arc(t[o].ow/2,t[o].ow/2,t[o].ow/2,0,2*Math.PI),l.fillStyle=e,l.fill(),c.src=p.toDataURL("image/png")},d.src=t[o].src}else if("img"==t[o].type)c.src=t[o].src;else if("font"==t[o].type){var m=new wx.createCanvas;m.width=t[o].ow,m.height=t[o].oh;var f=m.getContext("2d");f.fillStyle=t[o].color,f.font=t[o].family,f.lineWidth=t[o].lineWidth,f.textAlign="center",f.fillText(t[o].text,t[o].fillTextX,t[o].fillTextY),c.src=m.toDataURL("image/png")}}},clearScene:function(e){e.children&&(e.children=[])},setRendererBackgroundColor:function(e,a){a=a.split("#")[1],e.setClearColor(Number("0x"+a))},loopRender:function(e,n,t){c=requestAnimationFrame(function(){u.loopRender(e,n,t)}),e.render(t,n),a.TWEEN.update()},onClick:function(e,a,n,t,o,c){wx.onTouchStart(function(e){if(o.x=e.touches[0].clientX/window.innerWidth*2-1,o.y=-e.touches[0].clientY/window.innerHeight*2+1,t.setFromCamera(o,a),void 0!==c&&0!=c.length)for(var s=0;s<c.length;s++){var r=n.getObjectByName(c[s].name);r&&(t.intersectObject(r).length>0?(console.log("【点中了。。。。】"+c[s].name),"function"==typeof c[s].cb&&c[s].cb(r)):console.log("【没点中】"+c[s].name))}})},offClick:function(){wx.offTouchStart()},fadeIn:function(a){var n=a.scene.getObjectByName(a.spriteName);if(n)var t=n.material.opacity,o=setInterval(function(){t<1?((t+=.03)>1&&(t=1),n.material.opacity=Number(t.toFixed(2)),1==a.needHideWhenkeyboardShow&&g.keyboardStatus&&(n.material.opacity=0,clearInterval(o),e(a.cb)&&a.cb()),1==a.needShowWhenkeyboardShow&&g.keyboardStatus&&(n.material.opacity=1,clearInterval(o),e(a.cb)&&a.cb())):(1==a.needHideWhenkeyboardShow&&g.keyboardStatus&&(n.material.opacity=0),1==a.needShowWhenkeyboardShow&&g.keyboardStatus&&(n.material.opacity=1),clearInterval(o),e(a.cb)&&a.cb())},a.time||12)},fadeOut:function(a){var n=a.scene.getObjectByName(a.spriteName);if(n)var t=n.material.opacity,o=setInterval(function(){(t-=.03)<0&&(t=0),n.material.opacity=Number(t.toFixed(2)),t<=.05&&(t=0,n.material.opacity=Number(t.toFixed(2)),1!=a.noRemove&&a.scene.remove(n),clearInterval(o),e(a.cb)&&a.cb())},a.time||12)},removeSprite:function(e,a){var n=e.getObjectByName(a);n&&e.remove(n)},animate:function(e,n,t,o){var c=e.getObjectByName(n);if(c){var s=new a.TWEEN.Tween(o?c[o]:c.position);"function"==typeof t&&t(s,c)}},setSpriteOpacity:function(e,a,n){var t=e.getObjectByName(a);t&&void 0!==n&&(t.material.opacity=Number(n))}},d={setRenderer:function(){g.renderer=new a.THREE.WebGLRenderer({canvas:canvas,alpha:!1,antialias:!0}),g.renderer.setSize(window.innerWidth,window.innerHeight),l.dpr=l.dpr||u.getDpr((new wx.createCanvas).getContext("2d")),g.renderer.setPixelRatio(l.dpr)},setCamera:function(){g.camera=new a.THREE.OrthographicCamera(-window.innerWidth/2,window.innerWidth/2,window.innerHeight/2,-window.innerHeight/2,1,1e3),g.camera.position.z=800},setScene:function(){g.scene=new a.THREE.Scene,g.scene.position.y=-(g.camera.top-1334*l.scale/2)},setRaycaster:function(){g.raycaster=new a.THREE.Raycaster},setMouse:function(){g.mouse=new a.THREE.Vector2},page1Start:function(e){n.tcssCount("page.page1"),u.drawSprite(g.scene,[{type:"img",name:"page1-tips",src:"assets/page1-tips.png",w:443*l.scale,h:69*l.scale,y:g.camera.top-69*l.scale/2-1218*l.scale,x:0,cb:function(e){setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page1-tips",cb:function(){console.log("page1-tips-ok")}})},1900)},opacity:0},{type:"img",name:"page1-btn",src:"assets/page1-btn.png",w:122*l.scale,h:122*l.scale,y:g.camera.top-122*l.scale/2-1054*l.scale,x:0,cb:function(a){setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page1-btn",cb:function(){console.log("page1-btn-ok")}}),u.onClick(g.renderer,g.camera,g.scene,g.raycaster,g.mouse,[{name:"page1-btn",cb:function(a){console.log("您点击了"+a.name),u.fadeOut({scene:g.scene,spriteName:"page1-title",cb:function(){console.log("page1-title-ok")}}),u.fadeOut({scene:g.scene,spriteName:"page1-btn",cb:function(){console.log("page1-btn-ok")}}),u.fadeOut({scene:g.scene,spriteName:"page1-tips",cb:function(){console.log("page1-tips-ok")}}),u.fadeOut({scene:g.scene,spriteName:"page1-bg",cb:function(){console.log("page1-bg-ok"),"function"==typeof e&&e()}}),n.tcssCount("btn.page1_btn")}}])},1400)},opacity:0},{type:"img",name:"page1-title",src:"assets/page1-title.png",w:612*l.scale,h:115*l.scale,y:g.camera.top-115*l.scale/2-268*l.scale-100*l.scale,x:0,cb:function(e){u.animate(g.scene,e.name,function(e,n){e.to({x:0,y:n.position.y+100*l.scale},1500),e.easing(a.TWEEN.Easing.Quintic.InOut),e.delay(200),e.start(),e.onStart(function(){console.log("onStart")}),e.onComplete(function(){console.log("onComplete")}),e.onUpdate(function(){n.material.opacity<1&&(n.material.opacity+=.03)})})},opacity:0},{type:"img",name:"page1-bg",src:"assets/page1-bg.jpg",w:750*l.scale,h:1700*l.scale,y:g.camera.top-1700*l.scale/2+183*l.scale,x:0,z:-1,cb:function(e){u.fadeIn({scene:g.scene,spriteName:"page1-bg",cb:function(){console.log("page1-bg-ok")}})},opacity:0}])},page2Start:function(e){n.tcssCount("page.page2");var t=function(n,t){u.animate(g.scene,t.name,function(t,o){var c=o.scale.x,s=o.scale.y;t.to({x:1.068*c,y:1.068*s},500),t.easing(a.TWEEN.Easing.Bounce.Out),t.start(),t.onStart(function(){console.log("onStart")}),t.onComplete(function(){console.log("onComplete"),u.animate(g.scene,o.name,function(t,o){t.to({x:c,y:s},500),t.easing(a.TWEEN.Easing.Quartic.In),t.delay(200),t.start(),t.onStart(function(){console.log("onStart")}),t.onComplete(function(){for(var a=["page2-title","page2-item1","page2-item2","page2-item3","page2-item4","page1-btn-3","page2-bg"],t=0;t<a.length;t++)!function(t){u.fadeOut({scene:g.scene,spriteName:a[t],cb:function(){t==a.length-1&&"function"==typeof e&&e(n)}})}(t);r=0}),t.onUpdate(function(){})},"scale")}),t.onUpdate(function(){})},"scale")};u.drawSprite(g.scene,[{type:"img",name:"page1-btn-3",src:"assets/page1-btn-3.png",w:188*l.scale,h:36*l.scale,y:g.camera.top-36*l.scale/2-1244*l.scale,x:0,z:2,cb:function(e){setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page1-btn-3",cb:function(){console.log("page1-btn-3-ok")}}),u.onClick(g.renderer,g.camera,g.scene,g.raycaster,g.mouse,[{name:"page1-btn-3",cb:function(e){console.log("您点击了"+e.name),n.tcssCount("btn.page2_btn"),u.offClick();for(var a=["page2-title","page2-item1","page2-item2","page2-item3","page2-item4","page1-btn-3","page2-bg"],t=0;t<a.length;t++)!function(e){u.fadeOut({scene:g.scene,spriteName:a[e],cb:function(){e==a.length-1&&(c&&cancelAnimationFrame(c),d.gameStart(function(){c&&cancelAnimationFrame(c),g.renderer=null,d.setRenderer(),u.loopRender(g.renderer,g.camera,g.scene),d.myPageStart()}))}})}(t)}}])},3400)},opacity:0},{type:"img",name:"page2-item4",src:"assets/page2-item4.jpg",w:690*l.scale,h:250*l.scale,y:g.camera.top-250*l.scale/2-939*l.scale,x:1,cb:function(e){setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page2-item4",cb:function(){console.log("page2-item4-ok")}}),u.onClick(g.renderer,g.camera,g.scene,g.raycaster,g.mouse,[{name:"page2-item4",cb:function(e){r||(r=1,console.log("您点击了"+e.name),t(4,e))}}])},2900)},opacity:0},{type:"img",name:"page2-item3",src:"assets/page2-item3.jpg",w:690*l.scale,h:250*l.scale,y:g.camera.top-250*l.scale/2-674*l.scale,x:0,cb:function(e){setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page2-item3",cb:function(){console.log("page2-item3-ok")}}),u.onClick(g.renderer,g.camera,g.scene,g.raycaster,g.mouse,[{name:"page2-item3",cb:function(e){r||(r=1,console.log("您点击了"+e.name),t(3,e))}}])},2400)},opacity:0},{type:"img",name:"page2-item2",src:"assets/page2-item2.jpg",w:690*l.scale,h:250*l.scale,y:g.camera.top-250*l.scale/2-409*l.scale,x:0,cb:function(e){setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page2-item2",cb:function(){console.log("page2-item2-ok")}}),u.onClick(g.renderer,g.camera,g.scene,g.raycaster,g.mouse,[{name:"page2-item2",cb:function(e){r||(r=1,console.log("您点击了"+e.name),t(2,e))}}])},1900)},opacity:0},{type:"img",name:"page2-item1",src:"assets/page2-item1.jpg",w:690*l.scale,h:250*l.scale,y:g.camera.top-250*l.scale/2-144*l.scale,x:0,cb:function(e){setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page2-item1",cb:function(){console.log("page2-item1-ok")}}),u.onClick(g.renderer,g.camera,g.scene,g.raycaster,g.mouse,[{name:"page2-item1",cb:function(e){r||(r=1,console.log("您点击了"+e.name),t(1,e))}}])},1400)},opacity:0},{type:"img",name:"page2-title",src:"assets/page2-title.png",w:278*l.scale,h:38*l.scale,y:g.camera.top-38*l.scale/2-54*l.scale-50*l.scale,x:0,cb:function(e){u.animate(g.scene,e.name,function(e,n){e.to({x:0,y:n.position.y+50*l.scale},1500),e.easing(a.TWEEN.Easing.Quintic.InOut),e.delay(200),e.start(),e.onStart(function(){console.log("onStart")}),e.onComplete(function(){console.log("onComplete")}),e.onUpdate(function(){n.material.opacity<1&&(n.material.opacity+=.03)})})},opacity:0},{type:"img",name:"page2-bg",src:"assets/page2-bg.jpg",w:750*l.scale,h:1700*l.scale,y:g.camera.top-1700*l.scale/2+183*l.scale,x:0,z:-1,cb:function(e){u.fadeIn({scene:g.scene,spriteName:"page2-bg",cb:function(){console.log("page2-bg-ok")}})},opacity:0}])},page3Input:function(e,a,t,o){var c=u.getByteLimitText(u.trim(a)||l.inputDefaultText,l.inputByteLimit),s=c.str;if(2!=e||g.inputCurText!=s){g.inputCurText=s,2==e&&(u.removeSprite(g.scene,"page3-input"),u.removeSprite(g.scene,"page3-input-font"));var r=20*c.byte;r=r<=290?290:r>=480?480:r,u.drawSprite(g.scene,[{type:"font",name:"page3-input-font",text:s,color:l.inputTextColor,family:"30px Arial",lineWidth:0,fillTextX:r/2,fillTextY:30,ow:r,oh:90,w:r*l.scale,h:90*l.scale,y:g.camera.top-90*l.scale/2-54*l.scale,x:g.camera.left+r*l.scale/2+36*l.scale,z:2,cb:function(a){1==e&&setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page3-input-font",cb:function(){console.log("page3-input-font-ok")}})},200)},opacity:1==e?0:1},{type:"img",name:"page3-input",src:"assets/page3-input.png",w:(r+12)*l.scale,h:120*l.scale,y:g.camera.top-120*l.scale/2-15*l.scale,x:g.camera.left+(r+12)*l.scale/2+30*l.scale,z:2,cb:function(a){1==e&&(setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page3-input",cb:function(){console.log("page3-input-ok")}})},200),t&&u.onClick(g.renderer,g.camera,g.scene,g.raycaster,g.mouse,[{name:"page3-input",cb:function(e){console.log("您点击了"+e.name),n.tcssCount("btn.page3_btn_input"),wx.showKeyboard({defaultValue:g.inputCurText,maxLength:l.inputByteLimit,multiple:!1,confirmHold:!0,confirmType:"done",success:function(e){console.log("显示键盘"),g.keyboardStatus=1,u.setSpriteOpacity(g.scene,"page3-bg-0",1);var a=g.scene.getObjectByName("page3-text");a&&(g.soundAniStatus=1,d.page3SoundAni(),a.position.y=g.camera.top-99*l.scale/2-422*l.scale,u.setSpriteOpacity(g.scene,"page3-record",0),u.setSpriteOpacity(g.scene,"page3-record-line",0),u.setSpriteOpacity(g.scene,"page3-record-line-1",0),u.setSpriteOpacity(g.scene,"page3-share",0),u.setSpriteOpacity(g.scene,"page3-rechoose",0),u.setSpriteOpacity(g.scene,"page3-avatar",0),u.setSpriteOpacity(g.scene,"page3-sound",0),u.setSpriteOpacity(g.scene,"page3-close",0),u.setSpriteOpacity(g.scene,"page3-sound-wave-1",0),u.setSpriteOpacity(g.scene,"page3-sound-wave-2",0),u.setSpriteOpacity(g.scene,"page3-sound-wave-3",0),u.setSpriteOpacity(g.scene,"page3-sound-font",0),u.setSpriteOpacity(g.scene,"page3-record-microphone",0),u.setSpriteOpacity(g.scene,"page3-record-start",0),u.setSpriteOpacity(g.scene,"page3-record-complete",0),u.setSpriteOpacity(g.scene,"page3-record-countdown",0),g.recordStatus&&d.page3ReRecord())},fail:function(e){console.log(e.errMsg)},complete:function(e){console.log(e.errMsg)}}),console.log("呵呵"),wx.onKeyboardConfirm(function(e){console.log("点击了完成按钮."),d.page3Input(2,e.value,1,1),wx.hideKeyboard(),n.tcssCount("btn.page3_btn_kbconfirm")}),wx.onKeyboardInput(function(e){}),wx.onKeyboardComplete(function(e){g.keyboardStatus=0,u.setSpriteOpacity(g.scene,"page3-bg-0",0);var a=g.scene.getObjectByName("page3-text");a&&(a.position.y=g.camera.top-99*l.scale/2-859*l.scale,u.setSpriteOpacity(g.scene,"page3-record",1),u.setSpriteOpacity(g.scene,"page3-record-line",1),u.setSpriteOpacity(g.scene,"page3-record-line-1",1),u.setSpriteOpacity(g.scene,"page3-share",1),u.setSpriteOpacity(g.scene,"page3-rechoose",1),u.setSpriteOpacity(g.scene,"page3-avatar",1),u.setSpriteOpacity(g.scene,"page3-sound",1),u.setSpriteOpacity(g.scene,"page3-close",1),u.setSpriteOpacity(g.scene,"page3-sound-wave-1",1),u.setSpriteOpacity(g.scene,"page3-sound-wave-2",1),u.setSpriteOpacity(g.scene,"page3-sound-wave-3",1),u.setSpriteOpacity(g.scene,"page3-sound-font",1),u.setSpriteOpacity(g.scene,"page3-record-microphone",1),u.setSpriteOpacity(g.scene,"page3-record-start",1),u.setSpriteOpacity(g.scene,"page3-record-complete",1),u.setSpriteOpacity(g.scene,"page3-record-countdown",1))})}}]))},opacity:1==e?0:1}])}else console.log("相同文案了，不做处理。。")},page3ReRecord:function(){d.removePage3MicrophoneWave(),u.removeSprite(g.scene,"page3-record-complete"),u.removeSprite(g.scene,"page3-record-countdown"),setTimeout(function(){d.page3StartRecord()},500),g.recordObj&&g.recordObj.stop()},page3Bottom:function(e,a){var t=function(e){g.my.audioDuration=0,g.my.audioSrc="",g.soundAniStatus=1,d.page3SoundAni(),g.inputCurText="";for(var n=["page3-record-line","page3-record-line-1","page3-input","page3-input-font","page3-avatar","page3-sound","page3-close","page3-sound-wave-1","page3-sound-wave-2","page3-sound-wave-3","page3-sound-font","page3-text","page3-rechoose","page3-record","page3-share","page3-bg-0","page3-poster","page3-bg"],t=0;t<n.length;t++)!function(t){u.fadeOut({scene:g.scene,spriteName:n[t],cb:function(){t==n.length-1&&(console.log("最后"),"function"==typeof a&&a(e))}})}(t)},o=function(e){for(var n=["page3-rechoose","page3-record","page3-record-line","page3-share"],t=0;t<n.length;t++)!function(t){var o=0;"page3-rechoose"!=n[t]&&"page3-share"!=n[t]&&"page3-record-line"!=n[t]&&"page3-record"!=n[t]||(o=1),u.fadeOut({scene:g.scene,spriteName:n[t],cb:function(){if(t==n.length-1&&(console.log("最后"),"function"==typeof a&&a(e)),1==o){var c=g.scene.getObjectByName(n[t]);c&&(c.position.x=c.position.x-1e4)}},noRemove:o})}(t)},c=1==e?200:10;u.drawSprite(g.scene,[{type:"img",name:"page3-share",src:"assets/page3-share.png",w:122*l.scale,h:150*l.scale,y:g.camera.top-150*l.scale/2-1138*l.scale,x:g.camera.left+122*l.scale/2+508*l.scale,cb:function(e){setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page3-share",cb:function(){console.log("page3-share-ok"),u.onClick(g.renderer,g.camera,g.scene,g.raycaster,g.mouse,[{name:"page3-share",cb:function(e){console.log("您点击了"+e.name),n.tcssCount("btn.page3_btn_share"),n.tcssCount("btn.page3_btn_share_type_"+(wx.getStorageSync("mySelectId")||0)),n.storePageInfo({salutation:g.inputCurText||"",type:wx.getStorageSync("mySelectId")||1,avatar_url:g.my.avatar,nickname:g.my.nickname,audio_duration:g.my.audioDuration||0,tempFilePath:g.my.audioSrc||""},function(e){g.my.pid=e,wx.showActionSheet({itemList:["发送给朋友","生成卡片保存分享"],success:function(e){0==e.tapIndex?(n.tcssCount("btn.page3_btn_share_friend"),n.tcssCount("btn.page3_btn_share_friend_type_"+(wx.getStorageSync("mySelectId")||0)),wx.shareAppMessage({title:g.my.nickname+"给你寄来了一封信",imageUrl:"assets/share-"+(wx.getStorageSync("mySelectId")||1)+".jpg",query:"scene="+g.my.pid+"_"+(wx.getStorageSync("mySelectTextId")||1),success:function(e){n.tcssCount("btn.page3_btn_share_friend_succ"),n.tcssCount("btn.page3_btn_share_friend_succ_type_"+(wx.getStorageSync("mySelectId")||0))},fail:function(){n.tcssCount("btn.page3_btn_share_friend_fail"),n.tcssCount("btn.page3_btn_share_friend_fail_type_"+(wx.getStorageSync("mySelectId")||0))}})):1==e.tapIndex&&(n.tcssCount("btn.page3_btn_share_timeline"),n.tcssCount("btn.page3_btn_share_timeline_type_"+(wx.getStorageSync("mySelectId")||0)),d.createTimelineShareImage())},fail:function(e){console.log(e.errMsg)}})})}}])},needHideWhenkeyboardShow:1})},c)},opacity:0},{type:"img",name:"page3-record",src:"assets/page3-record.png",w:110*l.scale,h:115*l.scale,y:g.camera.top-115*l.scale/2-1038*l.scale,x:0,cb:function(e){setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page3-record",cb:function(){console.log("page3-record-ok"),u.onClick(g.renderer,g.camera,g.scene,g.raycaster,g.mouse,[{name:"page3-record",cb:function(e){console.log("您点击了"+e.name),n.tcssCount("btn.page3_btn_record"),o("record")}}])},needHideWhenkeyboardShow:1})},c)},opacity:0},{type:"img",name:"page3-rechoose",src:"assets/page3-rechoose.png",w:122*l.scale,h:150*l.scale,y:g.camera.top-150*l.scale/2-1138*l.scale,x:g.camera.left+122*l.scale/2+122*l.scale,cb:function(e){setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page3-rechoose",cb:function(){console.log("page3-rechoose-ok"),u.onClick(g.renderer,g.camera,g.scene,g.raycaster,g.mouse,[{name:"page3-rechoose",cb:function(e){console.log("您点击了"+e.name),n.tcssCount("btn.page3_btn_rechoose"),t("rechoose")}}])},needHideWhenkeyboardShow:1})},c)},opacity:0}])},addPage3MicrophoneWave:function(){u.drawSprite(g.scene,[{type:"img",name:"page3-record-rightwave",src:"assets/page3-record-rightwave.png",w:54*l.scale,h:74*l.scale,y:g.camera.top-74*l.scale/2-1056*l.scale,x:g.camera.left+54*l.scale/2+418*l.scale,z:1,cb:function(e){u.animate(g.scene,e.name,function(e,n){e.to({x:n.position.x+10*l.scale,y:n.position.y},40),e.easing(a.TWEEN.Easing.Back.InOut),e.delay(10),e.repeat(1/0),e.yoyo(!0),e.start(),e.onStart(function(){console.log("onStart")}),e.onComplete(function(){console.log("onComplete")}),e.onUpdate(function(){n.material.opacity<1&&(n.material.opacity+=.03)}),g.microphoneWaveTween=g.microphoneWaveTween||{},g.microphoneWaveTween.right=e})},opacity:1},{type:"img",name:"page3-record-leftwave",src:"assets/page3-record-leftwave.png",w:54*l.scale,h:74*l.scale,y:g.camera.top-74*l.scale/2-1056*l.scale,x:g.camera.left+54*l.scale/2+278*l.scale,z:1,cb:function(e){u.animate(g.scene,e.name,function(e,n){e.to({x:n.position.x-10*l.scale,y:n.position.y},40),e.easing(a.TWEEN.Easing.Back.InOut),e.delay(10),e.repeat(1/0),e.yoyo(!0),e.start(),e.onStart(function(){console.log("onStart")}),e.onComplete(function(){console.log("onComplete")}),e.onUpdate(function(){n.material.opacity<1&&(n.material.opacity+=.03)}),g.microphoneWaveTween=g.microphoneWaveTween||{},g.microphoneWaveTween.left=e})},opacity:1}])},removePage3MicrophoneWave:function(){console.log("已经设置为0"),g.recordStatus=0,g.recorderCountdownTimer&&clearInterval(g.recorderCountdownTimer),g.microphoneWaveTween=g.microphoneWaveTween||{},g.microphoneWaveTween.right&&g.microphoneWaveTween.right.stop(),g.microphoneWaveTween.left&&g.microphoneWaveTween.left.stop();for(var e=["page3-record-leftwave","page3-record-rightwave"],a=0;a<e.length;a++)u.removeSprite(g.scene,e[a])},addPage3RecorderCountdown:function(e){u.removeSprite(g.scene,"page3-record-countdown"),u.drawSprite(g.scene,[{type:"font",name:"page3-record-countdown",text:void 0===e?"":e,color:"#ffffff",family:"40px Arial",lineWidth:0,fillTextX:40,fillTextY:40,ow:90,oh:90,w:90*l.scale,h:90*l.scale,y:g.camera.top-90*l.scale/2-1216*l.scale,x:g.camera.left+90*l.scale/2+416*l.scale,z:3,cb:function(e){},opacity:1}])},page3RecordComplete:function(e){if(!g.recordCompleteClickStatus){g.recordObj?g.recordObj.stop():d.removePage3MicrophoneWave(),g.recordCompleteClickStatus=1,console.log("完成方法。"),setTimeout(function(){},3e3);var a=["page3-record-countdown","page3-record-microphone","page3-record-complete"];setTimeout(function(){for(var n=0;n<a.length;n++)!function(n){console.log("循环"+n),u.fadeOut({scene:g.scene,spriteName:a[n],cb:function(){if(n==a.length-1){console.log("录音完成了。"),u.drawSprite(g.scene,[{type:"font",name:"page3-sound-font",text:(g.my.audioDuration||0)+"''",color:"#ffffff",family:"40px Arial",lineWidth:0,fillTextX:40,fillTextY:40,ow:90,oh:90,w:90*l.scale,h:90*l.scale,y:g.camera.top-90*l.scale/2-187*l.scale,x:g.camera.left+90*l.scale/2+228*l.scale-1e4,z:3,cb:function(e){},opacity:0}]);var t=["page3-rechoose","page3-record-line-1","page3-share","page3-avatar","page3-sound","page3-close","page3-sound-wave-1","page3-sound-wave-2","page3-sound-wave-3","page3-sound-font"];setTimeout(function(){for(var a=0;a<t.length;a++){var n=g.scene.getObjectByName(t[a]);n&&(n.position.x=n.position.x+1e4)}for(var o=0;o<t.length;o++)!function(a){u.fadeIn({scene:g.scene,spriteName:t[a],cb:function(){a==t.length-1&&(g.recordCompleteClickStatus=0,"function"==typeof e&&e(),console.log("xxx"))},needHideWhenkeyboardShow:1})}(o)},200)}}})}(n)},200)}},page3StartRecord:function(){u.drawSprite(g.scene,[{type:"img",name:"page3-record-start",src:"assets/page3-record-start.png",w:290*l.scale,h:120*l.scale,y:g.camera.top-120*l.scale/2-1183*l.scale,x:0,z:1,cb:function(e){setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page3-record-start",cb:function(){console.log("page3-record-start-ok")},needHideWhenkeyboardShow:1})},200),u.onClick(g.renderer,g.camera,g.scene,g.raycaster,g.mouse,[{name:"page3-record-start",cb:function(e){i=1,setTimeout(function(){i=0},1e3),console.log("您点击了"+e.name),n.tcssCount("btn.page3_btn_record_start"),g.recordObj=g.recordObj||n.getRecorderManager(),g.recordObj&&g.recordObj.onStart(function(e){}),g.recordObj&&g.recordObj.onStop(function(e){if(console.log("record stop"),console.log(e),console.log("录音停止............."+g.recordStatus),g.recordStatus){g.my.audioSrc=e.tempFilePath;var a=Math.round(e.duration/1e3);g.my.audioDuration=a<1?1:a>l.recorder.duration/1e3?l.recorder.duration/1e3:a,d.removePage3MicrophoneWave()}}),g.recordObj&&g.recordObj.onError(function(e){e&&e.errMsg&&e.errMsg.indexOf("fail")>-1&&e.errMsg.indexOf("auth")>-1&&"function"==typeof wx.openSetting&&function e(){!p&&n.showModal({content:"小游戏需要您的允许才能正常使用。请点击“去设置”并勾选“录音功能”，即可正常使用。",confirmText:"去设置",confirm:function(){p=0,wx.openSetting({success:function(a){console.log(a),a.authSetting["scope.record"]||e()}})}}),p=1}(),setTimeout(function(){g.recordStatus&&d.page3ReRecord()},500),console.log("record error:"+JSON.stringify(e))}),g.recordObj&&g.recordObj.start({duration:5e3+l.recorder.duration,sampleRate:l.recorder.sampleRate,numberOfChannels:l.recorder.numberOfChannels,encodeBitRate:l.recorder.encodeBitRate,format:l.recorder.format}),console.log("record start"),g.recordStatus=1,d.addPage3MicrophoneWave(),u.removeSprite(g.scene,"page3-record-start");var a=l.recorder.duration/1e3;g.recorderCountdownTimer=setInterval(function(){a>0&&((a-=1)<=10&&d.addPage3RecorderCountdown(a),0==a&&(console.log("结束"),d.page3RecordComplete(),clearInterval(g.recorderCountdownTimer)))},1e3),u.drawSprite(g.scene,[{type:"img",name:"page3-record-complete",src:"assets/page3-record-complete.png",w:290*l.scale,h:120*l.scale,y:g.camera.top-120*l.scale/2-1183*l.scale,x:0,z:2,cb:function(e){setTimeout(function(){u.onClick(g.renderer,g.camera,g.scene,g.raycaster,g.mouse,[{name:"page3-record-complete",cb:function(e){i||(console.log("您点击了"+e.name),n.tcssCount("btn.page3_btn_record_complete"),d.page3RecordComplete())}}])},1e3)},opacity:1}])}}])},opacity:0}])},page3Microphone:function(){u.drawSprite(g.scene,[{type:"img",name:"page3-record-microphone",src:"assets/page3-record-microphone.png",w:60*l.scale,h:100*l.scale,y:g.camera.top-100*l.scale/2-1040*l.scale,x:0,z:1,cb:function(e){setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page3-record-microphone",cb:function(){console.log("page3-record-microphone-ok")},needHideWhenkeyboardShow:1})},200)},opacity:0}]),d.page3StartRecord()},page3SoundAni:function(e){g.soundWaveTween=g.soundWaveTween||{};var t=g.scene.getObjectByName("page3-sound-wave-2"),o=g.scene.getObjectByName("page3-sound-wave-3");if(t&&o)if(g.soundAniStatus)g.audioObj&&g.audioObj.stop(),"my"==g.audioType&&(g.audioObj&&g.audioObj.destroy(),g.audioObj=null),g.soundAniStatus=0,g.soundWaveTween.wave2&&g.soundWaveTween.wave2.stop(),g.soundWaveTween.wave3&&g.soundWaveTween.wave3.stop(),t.material.opacity=1,o.material.opacity=1;else{console.log("xxxxx...xxxxxx"),console.log(g.my.audioSrc),"friend"==e&&(g.audioType="friend"),console.log(e),g.audioObj=g.audioObj||n.createInnerAudioContext("my"==e?g.my.audioSrc:g.friend.audio_url),console.log("打印音频对象"),g.audioObj.onWaiting(function(){n.showLoading()}),g.audioObj.onPlay(function(){n.hideLoading()}),g.audioObj.onError(function(){n.showModal({content:"网络繁忙，请稍后再试。[-1011]"}),g.soundAniStatus=1,d.page3SoundAni()}),g.audioObj.onEnded(function(){g.soundAniStatus=1,d.page3SoundAni()}),g.audioObj&&g.audioObj.play(),g.soundAniStatus=1,t.material.opacity=0,o.material.opacity=0;var c={opacity:0};g.soundWaveTween.wave2=new a.TWEEN.Tween(c).to({opacity:1},700).onUpdate(function(){t.material.opacity=c.opacity}).repeat(1/0).yoyo(!0).start();var s={opacity:0};g.soundWaveTween.wave3=new a.TWEEN.Tween(s).to({opacity:1},340).onUpdate(function(){o.material.opacity=s.opacity}).repeat(1/0).yoyo(!0).delay(350).start()}},page3Start:function(e){n.tcssCount("page.page3"),d.page3Input(1,g.inputCurText,1,1),u.drawSprite(g.scene,[{type:"img",name:"page3-bg-0",src:"assets/page3-bg-0.png",w:750*l.scale,h:1700*l.scale,y:g.camera.top-1700*l.scale/2+183*l.scale,x:0,cb:function(e){},opacity:0},{type:"img",name:"page3-record-line-1",src:"assets/page3-record-line-1.png",w:690*l.scale,h:46*l.scale,y:g.camera.top-46*l.scale/2-1051*l.scale,x:-1e4,cb:function(e){},opacity:0},{type:"img",name:"page3-record-line",src:"assets/page3-record-line.png",w:690*l.scale,h:11*l.scale,y:g.camera.top-11*l.scale/2-1075*l.scale,x:0,cb:function(e){setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page3-record-line",cb:function(){console.log("page3-record-line-ok")},needHideWhenkeyboardShow:1})},200)},opacity:0},{type:"img",name:"page3-avatar",src:g.my.avatar,ow:94,oh:94,w:94*l.scale,h:94*l.scale,y:g.camera.top-94*l.scale/2-167*l.scale,x:g.camera.left+94*l.scale/2+54*l.scale-1e4,cb:function(e){},opacity:0},{type:"img",name:"page3-sound",src:"assets/page3-sound-"+(wx.getStorageSync("mySelectId")||1)+".png",w:472*l.scale,h:66*l.scale,y:g.camera.top-66*l.scale/2-180*l.scale,x:g.camera.left+472*l.scale/2+140*l.scale-1e4,cb:function(e){u.onClick(g.renderer,g.camera,g.scene,g.raycaster,g.mouse,[{name:"page3-sound",cb:function(e){console.log("您点击了"+e.name),n.tcssCount("btn.page3_btn_sound"),console.log(g.my.audioSrc),console.log(g.soundAniStatus),g.my.audioSrc&&d.page3SoundAni("my")}}])},opacity:0},{type:"img",name:"page3-close",src:"assets/page3-close.png",w:66*l.scale,h:66*l.scale,y:g.camera.top-66*l.scale/2-180*l.scale,x:g.camera.left+66*l.scale/2+631*l.scale-1e4,cb:function(e){u.onClick(g.renderer,g.camera,g.scene,g.raycaster,g.mouse,[{name:"page3-close",cb:function(e){console.log("您点击了"+e.name),n.tcssCount("btn.page3_btn_close"),g.my.audioDuration=0,g.my.audioSrc="",g.soundAniStatus=1,d.page3SoundAni();for(var a=["page3-record-line-1","page3-avatar","page3-sound-wave-1","page3-sound-wave-2","page3-sound-wave-3","page3-sound-font","page3-sound","page3-close"],t=0;t<a.length;t++)!function(e){var n=g.scene.getObjectByName(a[e]);n&&("page3-sound-font"==n.name?u.removeSprite(g.scene,n.name):"page3-record-line-1"==n.name?n.position.x=n.position.x-1e4:u.fadeOut({scene:g.scene,spriteName:n.name,cb:function(){n.position.x=n.position.x-1e4},noRemove:1}))}(t);var o=["page3-record-line","page3-record"];setTimeout(function(){for(var e=0;e<o.length;e++){var a=g.scene.getObjectByName(o[e]);a&&("page3-record"!=a.name&&"page3-record-line"!=a.name||(a.material.opacity=0,a.position.x=a.position.x+1e4),u.fadeIn({scene:g.scene,spriteName:a.name,cb:function(){},needHideWhenkeyboardShow:1}))}},300)}}])},opacity:0},{type:"img",name:"page3-sound-wave-1",src:"assets/page3-sound-wave-1.png",w:8*l.scale,h:36*l.scale,y:g.camera.top-36*l.scale/2-196*l.scale,x:g.camera.left+8*l.scale/2+200*l.scale-1e4,z:3,cb:function(e){},opacity:0},{type:"img",name:"page3-sound-wave-2",src:"assets/page3-sound-wave-2.png",w:8*l.scale,h:36*l.scale,y:g.camera.top-36*l.scale/2-196*l.scale,x:g.camera.left+8*l.scale/2+208*l.scale-1e4,z:3,cb:function(e){},opacity:0},{type:"img",name:"page3-sound-wave-3",src:"assets/page3-sound-wave-3.png",w:12*l.scale,h:36*l.scale,y:g.camera.top-36*l.scale/2-196*l.scale,x:g.camera.left+12*l.scale/2+214*l.scale-1e4,z:3,cb:function(e){},opacity:0},{type:"img",name:"page3-text",src:"assets/text/page3-text-"+(wx.getStorageSync("mySelectId")||1)+"-"+(wx.getStorageSync("mySelectTextId")||1)+".png",w:690*l.scale,h:99*l.scale,y:g.camera.top-99*l.scale/2-859*l.scale,x:0,z:1,cb:function(e){setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page3-text",cb:function(){console.log("page3-text-ok")},needShowWhenkeyboardShow:1})},1==g.keyboardStatus?10:200)},opacity:0},{type:"img",name:"page3-poster",src:"assets/page3-poster-"+(wx.getStorageSync("mySelectId")||1)+".jpg",w:690*l.scale,h:867*l.scale,y:g.camera.top-867*l.scale/2-143*l.scale,x:0,z:-1,cb:function(e){u.fadeIn({scene:g.scene,spriteName:"page3-poster",cb:function(){console.log("page3-poster-ok")}})},opacity:0},{type:"img",name:"page3-bg",src:"assets/page3-bg-"+(wx.getStorageSync("mySelectId")||1)+".jpg",w:750*l.scale,h:1700*l.scale,y:g.camera.top-1700*l.scale/2+183*l.scale,x:0,z:-2,cb:function(e){u.fadeIn({scene:g.scene,spriteName:"page3-bg",cb:function(){console.log("page3-bg-ok")}})},opacity:0}]),d.page3Bottom(1,function(a){"function"==typeof e&&e(a)})},friendPageStart:function(){n.tcssCount("page.page4"),n.tcssCount("page.page4_pid_"+g.friend.pid),n.tcssCount("page.page4_type_"+g.friend.type),d.page3Input(1,g.friend.salutation,0,2),0!=g.friend.audio_duration&&u.drawSprite(g.scene,[{type:"img",name:"page3-avatar",src:g.friend.avatar_url,ow:94,oh:94,w:94*l.scale,h:94*l.scale,y:g.camera.top-94*l.scale/2-167*l.scale,x:g.camera.left+94*l.scale/2+54*l.scale,z:1,cb:function(e){setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page3-avatar",cb:function(){console.log("page3-avatar-ok")},needHideWhenkeyboardShow:1})},200)},opacity:0},{type:"img",name:"page3-sound",src:"assets/page3-sound-"+g.friend.type+".png",w:472*l.scale,h:66*l.scale,y:g.camera.top-66*l.scale/2-180*l.scale,x:g.camera.left+472*l.scale/2+140*l.scale,z:1,cb:function(e){setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page3-sound",cb:function(){console.log("page3-sound-ok")},needHideWhenkeyboardShow:1})},200),u.onClick(g.renderer,g.camera,g.scene,g.raycaster,g.mouse,[{name:"page3-sound",cb:function(e){n.tcssCount("btn.page4_btn_sound"),n.tcssCount("btn.page4_btn_sound_pid_"+g.friend.pid),n.tcssCount("btn.page4_btn_sound_type_"+g.friend.type),d.page3SoundAni("friend")}}])},opacity:0},{type:"img",name:"page3-sound-wave-1",src:"assets/page3-sound-wave-1.png",w:8*l.scale,h:36*l.scale,y:g.camera.top-36*l.scale/2-196*l.scale,x:g.camera.left+8*l.scale/2+200*l.scale,z:2,cb:function(e){setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page3-sound-wave-1",cb:function(){console.log("page3-sound-wave-1-ok")},needHideWhenkeyboardShow:1})},200)},opacity:0},{type:"img",name:"page3-sound-wave-2",src:"assets/page3-sound-wave-2.png",w:8*l.scale,h:36*l.scale,y:g.camera.top-36*l.scale/2-196*l.scale,x:g.camera.left+8*l.scale/2+208*l.scale,z:2,cb:function(e){setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page3-sound-wave-2",cb:function(){console.log("page3-sound-wave-2-ok")},needHideWhenkeyboardShow:1})},200)},opacity:0},{type:"img",name:"page3-sound-wave-3",src:"assets/page3-sound-wave-3.png",w:12*l.scale,h:36*l.scale,y:g.camera.top-36*l.scale/2-196*l.scale,x:g.camera.left+12*l.scale/2+214*l.scale,z:2,cb:function(e){setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page3-sound-wave-3",cb:function(){console.log("page3-sound-wave-3-ok")},needHideWhenkeyboardShow:1})},200)},opacity:0},{type:"font",name:"page3-sound-font",text:(g.friend.audio_duration||0)+"''",color:"#ffffff",family:"40px Arial",lineWidth:0,fillTextX:40,fillTextY:40,ow:90,oh:90,w:90*l.scale,h:90*l.scale,y:g.camera.top-90*l.scale/2-187*l.scale,x:g.camera.left+90*l.scale/2+228*l.scale,z:2,cb:function(e){setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page3-sound-font",cb:function(){console.log("page3-sound-font-ok")},needHideWhenkeyboardShow:1})},200)},opacity:0}]),u.drawSprite(g.scene,[{type:"img",name:"page3-record-line-1",src:"assets/page3-record-line-1.png",w:690*l.scale,h:46*l.scale,y:g.camera.top-46*l.scale/2-1051*l.scale,x:0,cb:function(e){setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page3-record-line-1",cb:function(){console.log("page3-record-line-1-ok")}})},200)},opacity:0},{type:"img",name:"page3-go",src:"assets/page3-go.png",w:690*l.scale,h:182*l.scale,y:g.camera.top-182*l.scale/2-1136*l.scale,x:0,cb:function(e){setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page3-go",cb:function(){console.log("page3-go-ok"),u.onClick(g.renderer,g.camera,g.scene,g.raycaster,g.mouse,[{name:"page3-go",cb:function(e){console.log("您点击了"+e.name),n.tcssCount("btn.page4_btn_go"),n.tcssCount("btn.page4_btn_go_pid_"+g.friend.pid),n.tcssCount("btn.page4_btn_go_type_"+g.friend.type),g.audioType="my",g.soundAniStatus=1,d.page3SoundAni(),u.offClick();for(var a=["page3-input","page3-input-font","page3-text","page3-record-line-1","page3-go","page3-avatar","page3-sound","page3-sound-font","page3-sound-wave-1","page3-sound-wave-2","page3-sound-wave-3","page3-poster","page3-bg"],t=0;t<a.length;t++)!function(e){u.fadeOut({scene:g.scene,spriteName:a[e],cb:function(){e==a.length-1&&(g.inputCurText="",c&&cancelAnimationFrame(c),d.gameStart(function(){c&&cancelAnimationFrame(c),g.renderer=null,d.setRenderer(),u.loopRender(g.renderer,g.camera,g.scene),d.myPageStart()}))}})}(t)}}])},needShowWhenkeyboardShow:1})},200)},opacity:0},{type:"img",name:"page3-text",src:"assets/text/page3-text-"+g.friend.type+"-"+g.friend.text_id+".png",w:690*l.scale,h:99*l.scale,y:g.camera.top-99*l.scale/2-859*l.scale,x:0,cb:function(e){setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page3-text",cb:function(){console.log("page3-text-ok")},needShowWhenkeyboardShow:1})},200)},opacity:0},{type:"img",name:"page3-poster",src:"assets/page3-poster-"+g.friend.type+".jpg",w:690*l.scale,h:867*l.scale,y:g.camera.top-867*l.scale/2-143*l.scale,x:0,z:-1,cb:function(e){u.fadeIn({scene:g.scene,spriteName:"page3-poster",cb:function(){console.log("page3-poster-ok")}})},opacity:0},{type:"img",name:"page3-bg",src:"assets/page3-bg-"+g.friend.type+".jpg",w:750*l.scale,h:1700*l.scale,y:g.camera.top-1700*l.scale/2+183*l.scale,x:0,z:-2,cb:function(e){setTimeout(function(){u.fadeIn({scene:g.scene,spriteName:"page3-bg",cb:function(){console.log("page3-bg-ok")}})},200)},opacity:0}])},myPageStart:function(e){var a=function(){u.offClick();!function e(){setTimeout(function(){d.page2Start(function(a){n.tcssCount("btn.page2_item"+a),wx.setStorageSync("mySelectId",a),wx.setStorageSync("mySelectTextId",n.rndTextImg(a)),n.createVideo(a,function(a){console.log("用户点击了："+a),u.offClick(),setTimeout(function(){n.getNicknameAvatar(function(a){a?(console.log(a),g.my.nickname=a.nickname,g.my.avatar=a.avatar,d.page3Start(function(a){console.log(a),"rechoose"==a?setTimeout(function(){u.offClick(),e()},200):"record"==a&&d.page3Microphone()})):console.log("用户没有授权")})},200)})})},200)}()};e?a():setTimeout(function(){d.page1Start(function(){a()})},200)},createTimelineShareImage:function(){n.createTimelineQrcode(g.my.pid+"_"+(wx.getStorageSync("mySelectTextId")||1),function(e){console.log(e),u.drawSprite(g.scene,[{type:"timelineImg",name:"timeline-img",src1:"assets/timeline.jpg",src2:g.my.avatar,src3:e,text:n.trim(g.my.nickname.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,""))||n.config.default.nickname,ow:750,oh:1334,w:750*l.scale,h:1334*l.scale,y:0,x:0,z:100,cb:function(e){},opacity:0}])})},gameStart:function(e){g.gameStatus=1,(s=a.Game.getInstance()).start(canvas),n.tcssCount("game.start"),s.GameOver=function(){console.info("gameover.............."),setTimeout(function(){wx.setStorageSync("haveBeenPlaying",1),g.renderer.setPixelRatio(l.dpr),g.gameStatus=0,"function"==typeof e&&e()},1),n.tcssCount("game.end")},s.Skip=function(){console.info("skip.............."),setTimeout(function(){g.renderer.setPixelRatio(l.dpr),g.gameStatus=0,"function"==typeof e&&e()},1),n.tcssCount("game.skip")}}};return{init:function(){n.checkLogin(),d.setRenderer(),u.setRendererBackgroundColor(g.renderer,"#000000"),d.setCamera(),d.setScene(),d.setRaycaster(),d.setMouse(),console.info("----------------------------"),console.info("缩放倍数："+l.scale),console.info("画布宽度："+canvas.width),console.info("设备像素比："+l.dpr),console.info("----------------------------"),wx.onShow&&wx.onShow(function(e){if("function"==typeof wx.setKeepScreenOn&&wx.setKeepScreenOn({keepScreenOn:!0}),n.login(function(e){wx.gameLoginReport&&wx.gameLoginReport({data:{roleId:e.openid},success:function(e){console.log("onShow上报成功",e)},fail:function(e){console.log("onShow上报失败",e)}})}),console.log("onshow"),console.log(e),(o+=1)<=1)if(e.query&&e.query.scene){var r=""+e.query.scene;r=r.split("_"),n.queryPageInfo(r[0],function(e){g.friend=e,g.friend.text_id=r[1]||1,console.log(e),c&&cancelAnimationFrame(c),u.loopRender(g.renderer,g.camera,g.scene),d.friendPageStart()})}else wx.getStorageSync("haveBeenPlaying")?(c&&cancelAnimationFrame(c),u.loopRender(g.renderer,g.camera,g.scene),d.myPageStart(1)):d.gameStart(function(){c&&cancelAnimationFrame(c),g.renderer=null,d.setRenderer(),u.loopRender(g.renderer,g.camera,g.scene),d.myPageStart()});else if(e.query&&e.query.scene){var i=function(){g.audioObj&&g.audioObj.destroy(),g.audioObj=null,n.data.videoObj&&(n.data.videoObj.pause(),n.data.videoObj.hide=!0,n.data.videoObj.destroy(),n.data.videoObj=null),u.clearScene(g.scene),u.offClick();var a=t;a.renderer=g.renderer,a.camera=g.camera,a.scene=g.scene,a.raycaster=g.raycaster,a.mouse=g.mouse,g=a;var o=""+e.query.scene;o=o.split("_"),n.queryPageInfo(o[0],function(e){g.friend=e,g.friend.text_id=o[1]||1,console.log(e),c&&cancelAnimationFrame(c),u.loopRender(g.renderer,g.camera,g.scene),d.friendPageStart()})};g.gameStatus&&a.Game&&s?(s.sendNotification("GameStop"),g.renderer.setPixelRatio(l.dpr),g.renderer=null,d.setRenderer(),g.gameStatus=0,n.tcssCount("game.interrupt"),i()):i()}n.data.videoObj&&setTimeout(function(){n.data.videoObj.play()},200)}),wx.onHide&&wx.onHide(function(){n.login(function(e){wx.gameLogoutReport&&wx.gameLogoutReport({data:{roleId:e.openid},success:function(e){console.log("onHide上报成功",e)},fail:function(e){console.log("onHide上报失败",e)}})}),console.log("onhide"),g.recordStatus&&d.page3ReRecord(),n.data.videoObj&&n.data.videoObj.pause(),g.soundAniStatus=1,d.page3SoundAni()})}}})().init(); 
 			}); 	require("game.js");
 	